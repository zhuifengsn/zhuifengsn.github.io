<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>(K8S实践2)Pod常用操作 - 追风少年的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="(K8S实践2)Pod常用操作" />
<meta property="og:description" content="一、创建pod的两种方式 1.命令方式
①创建命令：
#kubectl run kubia --image=luksa/kubia --replicas=3
②查看资源：
#kubectl get pod -o wide
2.文件方式
#vim nginx-master.yaml
apiVersion: extensions/v1beta1 #描述文件遵循extensions/v1beta1版本的Kubernetes API kind: Deployment #创建资源类型为Deployment metadata: #该资源元数据 name: nginx-master #Deployment名称 spec: #Deployment的规格说明 replicas: 3 #指定副本数为3 template: #定义Pod的模板 metadata: #定义Pod的元数据 labels: #定义label（标签） app: nginx #label的key和value分别为app和nginx spec: #Pod的规格说明 containers: - name: nginx #容器的名称 image: nginx:latest #创建容器所使用的镜像 ①执行创建命令
#kubectl create -f nginx-master.yaml
②查看创建的资源
#kubectl get deployments -o wide
#kubectl get pod
二、进入pod 进入pod kubia-66c8b6d4fc-qhsrd(master节点)" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://zhuifengsn.github.io/posts/231c505bf834f416bf72a91244360f24/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-03-11T09:50:57+08:00" />
<meta property="article:modified_time" content="2020-03-11T09:50:57+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="追风少年的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">追风少年的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">(K8S实践2)Pod常用操作</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p><img src="https://images2.imgbox.com/78/9f/7Aor2wat_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="pod_2"></a>一、创建pod的两种方式</h3> 
<p><strong>1.命令方式</strong><br> ①创建命令：<br> #kubectl run kubia --image=luksa/kubia --replicas=3<br> ②查看资源：<br> #kubectl get pod -o wide<br> <img src="https://images2.imgbox.com/dd/38/NxiNKp6w_o.png" alt="在这里插入图片描述"><br> <strong>2.文件方式</strong><br> #vim nginx-master.yaml</p> 
<pre><code>apiVersion: extensions/v1beta1  #描述文件遵循extensions/v1beta1版本的Kubernetes API
kind: Deployment                #创建资源类型为Deployment
metadata:                       #该资源元数据
  name: nginx-master            #Deployment名称
spec:                           #Deployment的规格说明
  replicas: 3                   #指定副本数为3
  template:                     #定义Pod的模板
    metadata:                   #定义Pod的元数据
      labels:                   #定义label（标签）
        app: nginx              #label的key和value分别为app和nginx
    spec:                       #Pod的规格说明
      containers:               
      - name: nginx             #容器的名称
        image: nginx:latest     #创建容器所使用的镜像
</code></pre> 
<p>①执行创建命令<br> #kubectl create -f nginx-master.yaml<br> <img src="https://images2.imgbox.com/55/b9/LRfLhFnY_o.png" alt="在这里插入图片描述"><br> ②查看创建的资源<br> #kubectl get deployments -o wide<br> <img src="https://images2.imgbox.com/f6/c9/cZZfL9ze_o.png" alt="在这里插入图片描述"><br> #kubectl get pod<br> <img src="https://images2.imgbox.com/87/ba/GGTml9jh_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="pod_38"></a>二、进入pod</h3> 
<p>进入pod kubia-66c8b6d4fc-qhsrd(master节点)<br> #kubectl exec -it kubia-66c8b6d4fc-qhsrd bash</p> 
<p><img src="https://images2.imgbox.com/12/24/hESDgPYO_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_44"></a>三、标签</h3> 
<p>标签其实就是一对key/value，可以附加到资源的任意键值对，标签可以用来划分特定组的对象，用以选择具有改确切标签的资源。<br> <strong>1.pod使用标签</strong><br> ①pod指定标签<br> #kubectl run http-label --image=httpd --labels=“app=web,env=prod”<br> <img src="https://images2.imgbox.com/85/67/cUjBmHvb_o.png" alt="在这里插入图片描述"><br> ②查看pod的标签<br> #kubectl get pod -l app --show-labels<br> 使用标签筛选pod，通过-l app参数可筛选所有标签为app的pod<br> <img src="https://images2.imgbox.com/ae/81/o5g51p6z_o.png" alt="在这里插入图片描述"><br> ③修改现有标签<br> #kubectl label pod http-label-7cf498876f-59mws env=debug --overwrite<br> <img src="https://images2.imgbox.com/d4/6f/lmYAF3rd_o.png" alt="在这里插入图片描述"><br> #kubectl get pod --show-labels<br> <img src="https://images2.imgbox.com/13/33/0zKuU712_o.png" alt="在这里插入图片描述"><br> ④删除标签<br> #kubectl label pod http-label-7cf498876f-59mws env-<br> <img src="https://images2.imgbox.com/7e/1e/0E6XsMbU_o.png" alt="在这里插入图片描述"><br> <strong>2.通过标签指定pod创建的节点</strong><br> 给node节点打标签<br> #kubectl label nodes master node=master<br> #kubectl label nodes node1 node=node1<br> #kubectl label nodes node2 node=node2<br> 指定node创建pod<br> #vim httpd-node.yaml</p> 
<pre><code>apiVersion: extensions/v1beta1
kind: Deployment
metadata:
  name: httpd-node
spec:
  template:
    metadata:
      labels:
        env: prod
    spec:
      containers:
      - name: httpd-node
        image: httpd:latest
      nodeSelector:
        node: master
</code></pre> 
<p>执行创建命令<br> #kubectl apply -f httpd-node.yaml<br> <img src="https://images2.imgbox.com/c3/53/aXg4tStm_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_91"></a>四、命名空间</h3> 
<p>Namespace是对一组资源和对象的抽象集合，比如可以用来将系统内部的对象划分为不同的项目组或用户组。常见的pods, services, replication controllers和deployments等都是属于某一个namespace的（默认是default）<br> <strong>1.查看命名空间</strong><br> #kubectl get ns<br> <img src="https://images2.imgbox.com/b2/fe/y0tb0FuX_o.png" alt="在这里插入图片描述"><br> <strong>2.查看指定命名空间的pod</strong><br> #kubectl get pod --namespace=default<br> #kubectl get pod -n kube-system<br> <img src="https://images2.imgbox.com/61/e9/eBST8NLM_o.png" alt="在这里插入图片描述"><br> <strong>3.创建命名空间</strong><br> 文件方式创建test01-namespace.yaml<br> #vim /data/shell/test01-namespace.yaml</p> 
<pre><code>apiVersion: v1
kind: Namespace
metadata: 
  name: test01-namespace
</code></pre> 
<p>执行创建命令<br> ①#kubectl apply -f test01-namespace.yaml<br> <img src="https://images2.imgbox.com/05/2d/cM0abagj_o.png" alt="在这里插入图片描述"><br> 命令方式：<br> ②#kubectl create ns test02-namespace<br> <img src="https://images2.imgbox.com/e7/90/lAgCl1ns_o.png" alt="在这里插入图片描述"><br> <strong>4.pod指定命名空间</strong><br> ①指定创建pod的命名空间为test01-namespace<br> #kubectl run httpd --image=httpd -n test01-namespace<br> <img src="https://images2.imgbox.com/9e/7b/DlforOoq_o.png" alt="在这里插入图片描述"><br> ②查询pod<br> #kubectl get pods -n test01-namespace<br> <img src="https://images2.imgbox.com/6e/51/NhC5YeQH_o.png" alt="在这里插入图片描述"><br> ③命名空间切换<br> #alias kcd=‘kubectl config set-context $(kubectl config current-context) --namespace’<br> #kcd test01-namespace<br> <img src="https://images2.imgbox.com/5b/db/nvgFkrTr_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_130"></a>五、扩容/缩容</h3> 
<p>创建文件nginx-scale.yaml并新建资源</p> 
<pre><code>apiVersion: extensions/v1beta1  #描述文件遵循extensions/v1beta1版本的Kubernetes API
kind: Deployment                #创建资源类型为Deployment
metadata:                       #该资源元数据
  name: nginx-scale             #Deployment名称
spec:                           #Deployment的规格说明
  replicas: 3                   #指定副本数为3
  template:                     #定义Pod的模板
    metadata:                   #定义Pod的元数据
      labels:                   #定义label（标签）
        env: prod               #label的key和value分别为app和nginx
    spec:                       #Pod的规格说明
      containers:
      - name: nginx-scale       #容器的名称      
        image: nginx:latest     #创建容器所使用的镜像
</code></pre> 
<p>①执行创建<br> #kubectl -apply -f nginx-scale.yaml<br> <img src="https://images2.imgbox.com/76/42/j2rdvefU_o.png" alt="在这里插入图片描述"><br> ②查看资源<br> <img src="https://images2.imgbox.com/4f/51/BqF5l8sv_o.png" alt="在这里插入图片描述"><br> ③文件方式扩容：通过修改文件中参数replicas的值并重新执行kubectl apply命令即可实现pod的扩缩容<br> <img src="https://images2.imgbox.com/00/ea/NLo4zhFS_o.png" alt="在这里插入图片描述"><br> ④命令方式<br> #kubectl scale deployment nginx-scale --replicas=1<br> <img src="https://images2.imgbox.com/93/e9/Oik0cR67_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="failover_161"></a>六、failover</h3> 
<p><strong>1.pod节点分布查看</strong><br> #kubectl get pod -o wide --all-namespaces<br> <img src="https://images2.imgbox.com/08/f5/lMNiqYnD_o.png" alt="在这里插入图片描述"><br> <strong>2.faillover测试</strong><br> 节点node2关机<br> <img src="https://images2.imgbox.com/a1/cf/Cr0IKnMz_o.png" alt="在这里插入图片描述"><br> 查看node状态和pod分布<br> #kubectl get pod -o wide --all<br> <img src="https://images2.imgbox.com/53/2d/dL8U2LID_o.png" alt="在这里插入图片描述"><br> node2状态为NotReady且之前在该节点的pod被迁移至master或者node1.当node2恢复后，运行在该节点的Pod会被删除，且迁移至master和node1的Pod不会重新调度回到node2。</p> 
<h3><a id="_174"></a>七、升级及回滚</h3> 
<p>1.创建deployment<br> #vim nginx-roll.yaml</p> 
<pre><code>apiVersion: apps/v1
kind: Deployment
metadata:
  name: nginx-roll
  namespace: test02-namespace
spec:
  selector:
    matchLabels:
      env: prod
  replicas: 3
  template:
    metadata:
      labels:
        env: prod
    spec:
      containers:
      - name: nginx-roll
        image: nginx:1.16
</code></pre> 
<p>创建deployment nginx-roll,副本数为3，namespace为test02-namespace，nginx版本为1.16，–record参数会记录历史版本号。<br> #kubectl apply -f nginx-roll.yaml --record<br> 查看部署资源pod<br> <img src="https://images2.imgbox.com/1d/b4/bY4EpbqE_o.png" alt="在这里插入图片描述"><br> <strong>2.升级</strong><br> 升级的方式有多种，比如[kubectl edit deployments -n test02-namespace nginx-roll]方式，直接修改nginx-roll.yaml文件、kubectl set image方式等。<br> ①修改文件方式<br> #sed -i ‘s/image: nginx:1.16/image: nginx:1.17/g’ nginx-roll.yaml<br> #kubectl apply -f nginx-roll.yaml --record<br> <img src="https://images2.imgbox.com/67/8a/FPElMuj1_o.png" alt="在这里插入图片描述"><br> #kubectl rollout status deployment -n test02-namespace nginx-roll<br> <img src="https://images2.imgbox.com/33/9e/4Vd0Fxd1_o.png" alt="在这里插入图片描述"><br> ②kubectl set image方式</p> 
<p>#kubectl set image deployment -n test02-namespace nginx-roll nginx-roll=nginx:1.17.5</p> 
<p><strong>3.回滚</strong><br> ①查看deployments版本<br> #kubectl rollout history deployments -n test02-namespace nginx-roll<br> <img src="https://images2.imgbox.com/f3/fe/tIIkjjPj_o.png" alt="在这里插入图片描述"><br> ②查看deployment具体版本信息<br> #kubectl rollout history deployments -n test02-namespace nginx-roll --revision=1<br> <img src="https://images2.imgbox.com/6d/5d/bFoE6Twx_o.png" alt="在这里插入图片描述"><br> ③回滚至上一个版本<br> #kubectl rollout undo deployment -n test02-namespace nginx-roll<br> <img src="https://images2.imgbox.com/37/4b/dEd4Bec4_o.png" alt="在这里插入图片描述"><br> ④查看<br> #kubectl rollout status deployment -n test02-namespace nginx-roll<br> <img src="https://images2.imgbox.com/62/60/RZwpxnUc_o.png" alt="在这里插入图片描述"><br> ⑤回滚至指定版本<br> #kubectl rollout undo deployment -n test02-namespace nginx-roll --to-revision=1<br> <img src="https://images2.imgbox.com/0a/45/YtIFc7Na_o.png" alt="在这里插入图片描述"><br> ⑥查看<br> <img src="https://images2.imgbox.com/8a/48/uQlglJn8_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/8a/46/1LRlDb26_o.png" alt="在这里插入图片描述"></p> 
<p>⑦查看Replicasets<br> #kubectl get replicasets -n test02-namespace -o wide<br> <img src="https://images2.imgbox.com/4d/09/MqeFcDjW_o.png" alt="在这里插入图片描述"><br> 可以看到升级过程中replicaset保留了修改的历史版本信息。</p> 
<h3><a id="_240"></a>八、内网访问</h3> 
<p><strong>1.创建pod</strong><br> #vim web-svc.yaml</p> 
<pre><code>apiVersion: apps/v1
kind: Deployment
metadata: 
  name: web-svc
  namespace: test02-namespace
spec: 
  selector: 
    matchLabels: 
        app: web-svc
  replicas: 3
  template: 
    metadata: 
      labels: 
        app: web-svc
    spec: 
      containers: 
      - name: web-svc
        image: httpd:latest
</code></pre> 
<p>#kubectl apply -f web-svc.yaml<br> <img src="https://images2.imgbox.com/5f/05/I4xtKLX7_o.png" alt="在这里插入图片描述"><br> <strong>2.内网访问</strong><br> 创建service</p> 
<p>#vim web-svc.yaml</p> 
<pre><code>apiVersion: v1
kind: Service
metadata:
  name: web-svc
  namespace: test02-namespace
spec:
  selector:
    app: web-svc
  ports:
  - protocol: TCP
    port: 8080
    targetPort: 80
</code></pre> 
<p>①创建内网service<br> #kubectl apply -f web-svc.yaml<br> ②查看创建的service<br> #kubectl get service -n test02-namespace<br> <img src="https://images2.imgbox.com/1c/92/ZCy1V7bf_o.png" alt="在这里插入图片描述"><br> ③修改index.html<br> <img src="https://images2.imgbox.com/04/43/Am5bUNkv_o.png" alt="在这里插入图片描述"></p> 
<pre><code>master节点：echo '&lt;html&gt;&lt;body&gt;&lt;h1&gt;It works!web-svc-58956c55fc-z6msf&lt;/h1&gt;&lt;/body&gt;&lt;/html&gt;'&gt;index.html 
node1节点：echo '&lt;html&gt;&lt;body&gt;&lt;h1&gt;It works!web-svc-58956c55fc-dw5kk&lt;/h1&gt;&lt;/body&gt;&lt;/html&gt;'&gt;index.html
node2节点：echo '&lt;html&gt;&lt;body&gt;&lt;h1&gt;It works!web-svc-58956c55fc-bcpbx&lt;/h1&gt;&lt;/body&gt;&lt;/html&gt;'&gt;index.html
</code></pre> 
<p>④内网访问pod<br> #for i in {1…10};do sleep 1;curl 10.102.203.64:8080;done<br> <img src="https://images2.imgbox.com/b9/08/4OUb7CjL_o.png" alt="在这里插入图片描述"><br> <strong>3.外网访问</strong><br> 修改service<br> 新增’type: NodePort’和’nodePort: 30002’，通过NodePort方式外网访问pod，映射端口为30002，重新kubectl apply。(参考内网访问)</p> 
<pre><code>apiVersion: v1
kind: Service
metadata:
  name: web-svc
  namespace: test02-namespace
spec:
  type: NodePort
  selector:
    app: web-svc
  ports:
  - protocol: TCP
    nodePort: 30002
    port: 8080
    targetPort: 80
</code></pre> 
<p>外网访问pod<br> #for i in {1…10};do sleep 1;curl 192.168.3.183:30002;done<br> <img src="https://images2.imgbox.com/f1/99/r1jPMXQ4_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_325"></a>九、日志查看</h3> 
<p>使用kubectl logs命令可获取pod日志<br> <strong>1.查看最近的日志</strong><br> #kubectl logs web-svc-58956c55fc-bcpbx -n test02-namespace --tail=20<br> <img src="https://images2.imgbox.com/32/35/MX8MTmiy_o.png" alt="在这里插入图片描述"><br> ‘–tail=20’:查看命名空间test02-namespace下web-svc-58956c55fc-bcpbx最近20行的日志，<br> <strong>2.查看前一个容器的日志</strong><br> #kubectl logs web-svc-58956c55fc-bcpbx -n test02-namespace --previous<br> <strong>3.通过标签查看日志</strong><br> #kubectl logs -lapp=web<br> 查看标签为‘app=web’的日志；’-lapp=web’该日志是标签为’app=web’的合集<br> <img src="https://images2.imgbox.com/42/8c/wVAJ4NzJ_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="pod_338"></a>十、删除pod</h3> 
<p><strong>1.通过删除deployment删除pod</strong><br> 通过deployment创建pod可以直接删除deployment<br> #kubectl delete deployments kubia<br> <img src="https://images2.imgbox.com/c5/bc/KAJ1x3T0_o.png" alt="在这里插入图片描述"><br> <strong>2.通过删除namespace删除pod</strong><br> ①删除namespace中所有资源<br> #kubectl delete all --all -n test01-namespace<br> <img src="https://images2.imgbox.com/49/73/r1ijqMqm_o.png" alt="在这里插入图片描述"><br> ②直接删除namespace<br> #kubectl delete ns test01-namespace<br> <img src="https://images2.imgbox.com/72/34/OXI1GiCa_o.png" alt="在这里插入图片描述"><br> <strong>总结：</strong><br> 直接删除pod会重建一个新的不同名的pod；<br> 直接删除replicasets会重建同名replicasets，其下所有pod则会删除重建且名字不同；<br> 直接删除deployments则其下的replicasets和pod将一起被删除；</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/c87b895519eb1d84c11de5157474f393/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">洛谷题解——P1443：马的遍历</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/5a4c8339487ceab805b4c35f8bbc18c0/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">如何在windows安装NET Framework 3.5</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 追风少年的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>