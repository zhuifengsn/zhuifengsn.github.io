<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>基于图像识别框架Airtest的Windows项目自动化测试实践 - 追风少年的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="基于图像识别框架Airtest的Windows项目自动化测试实践" />
<meta property="og:description" content="写在前面
本次分享的内容是基于Airtest实现Windows应用的自动化测试，内容大纲：
Airtest框架介绍：Airtest适用项目、Airtest特点、Airtest的优势
Airtest框架组成、原理
Airtest环境搭建及IDE的简单使用
Airtest开展Windows应用自动化测试实践：连接Windows应用Windows常用API编写测试代码设计测试用例运行效果查看测试报告
总结与思考
一、Airtest框架介绍
1.Airtest介绍
Airtest是网易出品的一款基于图像识别和Poco控件识别的一款UI自动化测试工具。这个框架设计来源于新颖的图形脚本语言Sikuli，关于Sikuli框架可见上一篇分享《基于Sikuli GUI图像识别框架的PC客户端自动化测试实践》。和Sikuli框架的原理一样，用户不需要一行行的去写代码，而是用屏幕截屏的方式，用截出来的图形摆列组合成神器的程序，这是Airtest的一部分。另外，Airtest也可以基于poco这个UI控件搜索框架，通过控件的名称、id之类的来定位目标控件，原理类似于 appium。官网：airtest.netease.com/
2.Airtest适用项目
游戏
Android
iOS
Web
Windows
3.Airtest特点 跨平台易操作可扩展支持GUI编辑器 4.Airtest的优势 相比于其他的自动化测试框架，Airtest主要有如下两个优势：
大幅度降低自动化脚本的编写和维护成本 解决游戏测试的痛点 二、Airtest框架组成、原理 1.Airtest框架组成 Airtest：是一个跨平台的、基于图像识别的UI自动化测试框架，适用于游戏和App，支持平台有Windows、 Android和iOS；
Poco：是一款基于UI控件识别的自动化测试框架，目前支持Unity3D/cocos2dx/Android原生app/iOS原生app/ 微信小程序，也可以在其他引擎中自行接入poco-sdk来使用；
AirtestIDE：跨平台的UI自动化测试编辑器，内置了Airtest和Poco的相关插件功能，能够快速简单地 编写Airtest和Poco代码；
AirLab：真机自动化云测试平台，目前提供了TOP100手机兼容性测试、海外云真机兼容性测试等服务；
2.Airtest工作原理
三、Airtest环境搭建及IDE的简单使用
官方文档：airtest.doc.io.netease.com/IDEdocs/get…
1.下载安装
1）安装python
由于Airtest框架是基于python语言开发，本地需要搭建python相关环境，建议使用python3
Python 下载地址：www.python.org/downloads/
2）下载AirtestIDE客户端
AirtestIDE客户端下载：airtest.netease.com
Windows系统用户在官网上下载对应32位或是64位版本的zip包，解压后得到AirtestIDE文件夹，双击AirtestIDE/AirtestIDE.exe即可启动
2.Airtest IDE使用 1）生成报告
Airtest运行完成后，会自动生成一份报告，通过下图按钮可以查看，点击后会自动启动浏览器查看报告
2）图片/代码模式切换
Airtest IDE中右键，即可两种模式相互切换
切换后的效果如下：
四、Airtest开展Windows应用自动化测试实践 1.连接Windows应用 连接Windows应用有三种方法，分别是：
1）通过搜索窗口连接
设备窗-Windows窗口连接-搜索窗口，选择窗口后，点击连接
2）通过句柄连接
（由于句柄容易发生变化，因此不推荐此连接方式）：下图的67330即为企业微信的句柄
3）通过正则匹配应用应用标题进行连接
if not cli_setup: auto_setup(__file__, logdir=True, devices=[&#34;Windows:///?title_re=.*阅云*&#34;]) 复制代码 2.Windows常用API
官方文档：airtest.readthedocs.io/zh_CN/lates…" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://zhuifengsn.github.io/posts/6f9aa68fb1a7d55008c3bc8d15c12726/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-06-09T15:16:25+08:00" />
<meta property="article:modified_time" content="2023-06-09T15:16:25+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="追风少年的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">追风少年的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">基于图像识别框架Airtest的Windows项目自动化测试实践</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p class="img-center"><img alt="" height="382" src="https://images2.imgbox.com/27/cd/oa6FeYrw_o.png" width="526"></p> 
<p>写在前面</p> 
<p>本次分享的内容是基于Airtest实现Windows应用的自动化测试，内容大纲：</p> 
<p>Airtest框架介绍：Airtest适用项目、Airtest特点、Airtest的优势<br> Airtest框架组成、原理<br> Airtest环境搭建及IDE的简单使用<br> Airtest开展Windows应用自动化测试实践：连接Windows应用Windows常用API编写测试代码设计测试用例运行效果查看测试报告<br> 总结与思考<br> 一、Airtest框架介绍<br> 1.Airtest介绍<br> Airtest是网易出品的一款基于图像识别和Poco控件识别的一款UI自动化测试工具。这个框架设计来源于新颖的图形脚本语言Sikuli，关于Sikuli框架可见上一篇分享《基于Sikuli GUI图像识别框架的PC客户端自动化测试实践》。和Sikuli框架的原理一样，用户不需要一行行的去写代码，而是用屏幕截屏的方式，用截出来的图形摆列组合成神器的程序，这是Airtest的一部分。另外，Airtest也可以基于poco这个UI控件搜索框架，通过控件的名称、id之类的来定位目标控件，原理类似于 appium。官网：airtest.netease.com/</p> 
<p>2.Airtest适用项目<br> 游戏<br> Android<br> iOS<br> Web<br> Windows<br><img alt="" height="162" src="https://images2.imgbox.com/c9/ed/UYXhAQCO_o.png" width="814"></p> 
<p> </p> 
<h4>3.Airtest特点</h4> 
<ul><li>跨平台</li><li>易操作</li><li>可扩展</li><li>支持GUI编辑器</li></ul> 
<h4><a name="t4"></a>4.Airtest的优势</h4> 
<p>相比于其他的<a href="https://so.csdn.net/so/search?q=%E8%87%AA%E5%8A%A8%E5%8C%96%E6%B5%8B%E8%AF%95&amp;spm=1001.2101.3001.7020" title="自动化测试">自动化测试</a>框架，Airtest主要有如下两个优势：</p> 
<ul><li>大幅度降低自动化脚本的编写和维护成本</li></ul> 
<p><img alt="" height="91" src="https://images2.imgbox.com/34/70/q9barV90_o.png" width="736"></p> 
<p> </p> 
<ul><li>解决游戏测试的痛点</li></ul> 
<h3><a name="t5"></a>二、Airtest框架组成、原理</h3> 
<h4><a name="t6"></a>1.Airtest框架组成</h4> 
<p><img alt="" height="657" src="https://images2.imgbox.com/ed/e2/8iXIVyN4_o.png" width="754"></p> 
<p> Airtest：是一个跨平台的、基于图像识别的UI自动化测试框架，适用于游戏和App，支持平台有Windows、 Android和iOS；<br> Poco：是一款基于UI控件识别的自动化测试框架，目前支持Unity3D/cocos2dx/Android原生app/iOS原生app/ 微信小程序，也可以在其他引擎中自行接入poco-sdk来使用；<br> AirtestIDE：跨平台的UI自动化测试编辑器，内置了Airtest和Poco的相关插件功能，能够快速简单地 编写Airtest和Poco代码；<br> AirLab：真机自动化云测试平台，目前提供了TOP100手机兼容性测试、海外云真机兼容性测试等服务；<br> 2.Airtest工作原理<br><img alt="" height="315" src="https://images2.imgbox.com/60/ae/Kc9Y5jW6_o.png" width="798"></p> 
<p>三、Airtest环境搭建及IDE的简单使用<br> 官方文档：airtest.doc.io.netease.com/IDEdocs/get…</p> 
<p>1.下载安装<br> 1）安装python</p> 
<p>由于Airtest框架是基于python语言开发，本地需要搭建python相关环境，建议使用python3</p> 
<p>Python 下载地址：www.python.org/downloads/</p> 
<p>2）下载AirtestIDE客户端</p> 
<p>AirtestIDE客户端下载：airtest.netease.com</p> 
<p>Windows系统用户在官网上下载对应32位或是64位版本的zip包，解压后得到AirtestIDE文件夹，双击AirtestIDE/AirtestIDE.exe即可启动</p> 
<p class="img-center"><img alt="" height="121" src="https://images2.imgbox.com/d0/8d/ZSkRGWRM_o.png" width="107"></p> 
<h4>2.Airtest IDE使用</h4> 
<p>1）生成报告</p> 
<p>Airtest运行完成后，会自动生成一份报告，通过下图按钮可以查看，点击后会自动启动浏览器查看报告</p> 
<p><img alt="" height="423" src="https://images2.imgbox.com/62/4a/Nc4Dnz2x_o.png" width="756"></p> 
<p>2）图片/代码模式切换</p> 
<p>Airtest IDE中右键，即可两种模式相互切换</p> 
<p><img alt="" height="224" src="https://images2.imgbox.com/23/6e/FEwyABli_o.png" width="754"></p> 
<p> 切换后的效果如下：</p> 
<p><img alt="" height="224" src="https://images2.imgbox.com/fe/e9/yYOk4A1N_o.png" width="756"></p> 
<h3>四、Airtest开展Windows应用自动化测试实践</h3> 
<h4><a name="t12"></a>1.连接Windows应用</h4> 
<p>连接Windows应用有三种方法，分别是：</p> 
<p>1）通过搜索窗口连接</p> 
<p>设备窗-Windows窗口连接-搜索窗口，选择窗口后，点击连接</p> 
<p><img alt="" height="352" src="https://images2.imgbox.com/5f/a8/nJqNyeG7_o.png" width="755"></p> 
<p>2）通过句柄连接</p> 
<p>（由于句柄容易发生变化，因此不推荐此连接方式）：下图的67330即为企业微信的句柄</p> 
<p><img alt="" height="198" src="https://images2.imgbox.com/28/a0/lz2s9fsD_o.png" width="756"></p> 
<p> 3）通过正则匹配应用应用标题进行连接</p> 
<pre><code class="hljs">if not cli_setup:
    auto_setup(__file__, logdir=True, devices=["Windows:///?title_re=.*阅云*"])
复制代码</code></pre> 
<p>2.Windows常用API<br> 官方文档：airtest.readthedocs.io/zh_CN/lates…</p> 
<p>源码：airtest.readthedocs.io/zh_CN/lates…</p> 
<p>connect：连接设备<br> shell：执行cmd命令<br> snapshot：截图<br> keyevent：执行键盘事件<br> text：输入文本<br> key_press：按下某个按键<br> key_release：释放某个按键<br> touch：鼠标点击事件<br> double_click：鼠标双击<br> swipe：滑动<br> move_mouse：移动鼠标<br> mouse_down：按下鼠标（左/右）键<br> mouse_up：释放鼠标（左/右）键<br> 3.编写测试代码<br> 先看下待测试的windows应用的页面布局：<br><img alt="" height="510" src="https://images2.imgbox.com/bb/3b/7E5tvCcC_o.png" width="789"></p> 
<p>  1）代码构成</p> 
<p><img alt="" height="470" src="https://images2.imgbox.com/74/f1/i35EZ0CR_o.png" width="754"></p> 
<ul><li>导入核心api和初始化客户端的方法</li></ul> 
<pre><code class="hljs"># -*- encoding=utf8 -*-
__author__ = "Administrator"
import random
from airtest.core.api import *
from airtest.cli.parser import cli_setup
复制代码</code></pre> 
<ul><li>连接windows应用</li></ul> 
<pre><code class="hljs"># 连接windows应用
if not cli_setup:
    auto_setup(__file__, logdir=True, devices=["Windows:///?title_re=.*阅云*"])
复制代码</code></pre> 
<ul><li>Airtest IDE遵循python编码风格，因此可以将各个测试动作/场景封装成一个一个的函数，当然也可以封装在其他文件里，然后导入引用</li></ul> 
<p><img alt="" height="330" src="https://images2.imgbox.com/ca/f6/pPHgx7h8_o.png" width="747"></p> 
<p>2）案例</p> 
<ul><li>发送文本消息：</li></ul> 
<p>操作步骤为：进入聊天窗口&gt;输入文本内容&gt;发送</p> 
<pre><code class="hljs">def send_text(time):
    setup_send_msg()  # 进入聊天窗口
    for i in range(time):
        text("这是AIRTEST发送的第%s条消息"%str(i))  # 输入文本消息内容
        keyevent("{ENTER}")  # 按下键盘Enter键，要大写
        keyevent("{ENTER}")  # 第一遍按下Enter是防止此时的输入法为中文，第二遍按下Enter是发送
复制代码</code></pre> 
<ul><li>截图发送</li></ul> 
<p>操作步骤为：进入聊天窗口&gt;点击截图按钮&gt;滑动鼠标拉取截图区域&gt;确认发送截图</p> 
<pre><code class="hljs">def send_screenshot():
    setup_send_msg()
    touch(Template(r"tpl1656061157595.png", record_pos=(-0.028, 0.138), resolution=(959, 654)))
    sleep(1)
    swipe((300,400), (600,800), duration=0.8, steps=2)
    keyevent("{ENTER}")
复制代码</code></pre> 
<p>4.设计测试用例<br> GUI自动化测试并不适用于发现bug，更多的是将重复性高的、简单的手工操作场景转换为自动操作，用于回归测试，或是用于一些数据的构造模拟上。</p> 
<p>将一些基本操作封装为一个个函数以后，就可以进行组合、设计测试用例了，如：</p> 
<p>① 场景一：发送不同类型的消息</p> 
<p>分别调用以下函数：</p> 
<p>调用发送文本函数<br> 调用发送表情函数<br> 调用发送图片函数<br> 调用发送截图函数<br> ......<br> 当然，以上各个函数也可以单独作为一个个测试用例，从而用于回归测试；</p> 
<p>② 场景二：持续发送文本/图片消息</p> 
<p>将上述函数，加上循环，便可实现持续发送xx类型的消息；不过与其说是一条测试用例，倒不如说是为了模拟人工长时间操作运行下程序的稳定性，亦或是辅助其他特殊测试场景，比如：</p> 
<p>去年我在测试移动端时、通过自动化模拟一端持续发送大量图片消息，从而测试出【iOS移动端在弱网情况下接收大量离线文件消息程序会core掉】的bug。<br> 今天在利用Airtest模拟持续发送文本消息、测试程序稳定性时，发现【单聊发送消息传错类型参数，发送给群聊，导致发送消息失败，且无任何消息发送记录】的bug，很奇怪，我手工发送的就没任何问题，暂时还没找到规律，研发还在定位中。虽然Airtest并没有直接发现bug，但却给发现bug创造了更多可能。<br> 5.运行效果<br> 此处为语雀视频卡片，点击链接查看：Rec 0005.mp4</p> 
<p>6.查看测试报告<br> Airtest运行完成后会自动生成测试报告，通过控制台菜单栏的查看报告按钮，即可自动在浏览器打开测试报告：<br><img alt="" height="423" src="https://images2.imgbox.com/fd/bc/B4DA4Y4f_o.png" width="757"></p> 
<p> 五、总结与思考<br> Airtest也可以用于pycharm编辑器下，需要手动提前安装airtest库：pip install -U airtest，安装后即可新建airtest脚本，语法和在Airtest IDE中编写时一致。另外，pycharm编辑器也可以直接打开airtest脚本；<br> 对于web、APP自动化主要用该端特定的自动化框架，如selenium、appium，而此类测试框架无法实现的Windows应用的操作，则可以借助Airtest实现，从而打通端到端自动化测试流程；<br> 自动化测试编码实现仅仅是自动化测试流程中一个小环节，更重要的是场景设计、用例实现以及如何发挥自动化测试的价值；<br> 自动化测试可能不会发现多少bug，但却给发现bug创造了更多可能；<br> 学习安排上<br> 作为一位过来人也是希望大家少走一些弯路，如果你不想再体验一次学习时找不到资料，没人解答问题，坚持几天便放弃的感受的话，在这里我给大家分享一些自动化测试的学习资源，希望能给你前进的路上带来帮助。【保证100%免费】</p> 
<p class="img-center"><img alt="" height="803" src="https://images2.imgbox.com/82/51/Xxqbeknq_o.png" width="572"></p> 
<h3>视频文档获取方式：</h3> 
<p>这份文档和视频资料，<strong>对于想从事【软件测试】的朋友来说应该是最全面最完整的备战仓库</strong>，这个仓库也陪伴我走过了最艰难的路程，希望也能帮助到你！<strong>以上均可以分享，点下方小卡片即可自行领取。</strong></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/7939c0b5a1b89f68d54f99b716d9cb69/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">【Linux】常见基本指令（一）</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/94629c8b3d634cda703c6c51679512fd/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">OpenCV Mat类基本操作</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 追风少年的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>