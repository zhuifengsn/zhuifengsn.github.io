<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>springboot整合shiro实现认证和授权功能（非常详细） - 追风少年的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="springboot整合shiro实现认证和授权功能（非常详细）" />
<meta property="og:description" content="Shiro和Spring Security应该是我们比较常用的权限框架了，这篇文章教大家怎么通过springboot整合shiro从零开始搭建一个包含权限控制的后台管理系统。
目录
第一步：创建springboot项目
第二步：添加maven的依赖
第三步：修改配置文件
第四步：创建数据库表
第五步：创建表user对应类
第六步：创建UserRealm
第七步：创建Shiro配置类
第八步：实现登录功能
控制器层
业务层
UserRealm
持久层
第九步：测试登录功能
login.html
login.js
home.html
ShiroConfig.java
第十步：实现授权功能
UserRealm.java
UserController.java
/html/home.html 自定义过滤器实现鉴权
ShiroConfig.java
第十一步：测试鉴权功能
第一步：创建springboot项目 通过IntelliJ IDEA创建一个springboot项目，这里的项目就命名为springboot-shiro
第二步：添加maven的依赖 修改pom.xml，添加相关的maven依赖
&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt; &lt;project xmlns=&#34;http://maven.apache.org/POM/4.0.0&#34; xmlns:xsi=&#34;http://www.w3.org/2001/XMLSchema-instance&#34; xsi:schemaLocation=&#34;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&#34;&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;parent&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt; &lt;version&gt;2.5.9&lt;/version&gt; &lt;relativePath /&gt; &lt;/parent&gt; &lt;groupId&gt;cn.edu.sgu.www&lt;/groupId&gt; &lt;artifactId&gt;springboot-shiro&lt;/artifactId&gt; &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt; &lt;name&gt;springboot-shiro&lt;/name&gt; &lt;description&gt;Spring Boot整合Shiro权限认证框架&lt;/description&gt; &lt;properties&gt; &lt;java.version&gt;1.8&lt;/java.version&gt; &lt;shiro.version&gt;1.3.2&lt;/shiro.version&gt; &lt;mysql.version&gt;8.0.28&lt;/mysql.version&gt; &lt;druid.version&gt;1.1.21&lt;/druid.version&gt; &lt;lombok.version&gt;1.18.22&lt;/lombok.version&gt; &lt;fastjson.version&gt;2.0.8&lt;/fastjson.version&gt; &lt;mybatis.version&gt;2.2.2&lt;/mybatis.version&gt; &lt;/properties&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--lombok--&gt; &lt;dependency&gt; &lt;groupId&gt;org." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://zhuifengsn.github.io/posts/3ad024d6710b062e70e48263492627b2/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-12-05T03:37:44+08:00" />
<meta property="article:modified_time" content="2023-12-05T03:37:44+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="追风少年的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">追风少年的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">springboot整合shiro实现认证和授权功能（非常详细）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <blockquote> 
 <p>Shiro和Spring Security应该是我们比较常用的权限框架了，这篇文章教大家怎么通过springboot整合shiro从零开始搭建一个包含权限控制的后台管理系统。</p> 
</blockquote> 
<p></p> 
<p id="main-toc"><strong>目录</strong></p> 
<p id="%E7%AC%AC%E4%B8%80%E6%AD%A5%EF%BC%9A%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AAspringboot%E9%A1%B9%E7%9B%AE-toc" style="margin-left:0px;"><a href="#%E7%AC%AC%E4%B8%80%E6%AD%A5%EF%BC%9A%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AAspringboot%E9%A1%B9%E7%9B%AE" rel="nofollow">第一步：创建springboot项目</a></p> 
<p id="%E7%AC%AC%E4%BA%8C%E6%AD%A5%EF%BC%9A%E6%B7%BB%E5%8A%A0maven%E7%9A%84%E4%BE%9D%E8%B5%96-toc" style="margin-left:0px;"><a href="#%E7%AC%AC%E4%BA%8C%E6%AD%A5%EF%BC%9A%E6%B7%BB%E5%8A%A0maven%E7%9A%84%E4%BE%9D%E8%B5%96" rel="nofollow">第二步：添加maven的依赖</a></p> 
<p id="%C2%A0%E7%AC%AC%E4%B8%89%E6%AD%A5%EF%BC%9A%E4%BF%AE%E6%94%B9%E7%B3%BB%E7%BB%9F%E7%9A%84%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6-toc" style="margin-left:0px;"><a href="#%C2%A0%E7%AC%AC%E4%B8%89%E6%AD%A5%EF%BC%9A%E4%BF%AE%E6%94%B9%E7%B3%BB%E7%BB%9F%E7%9A%84%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6" rel="nofollow">第三步：修改配置文件</a></p> 
<p id="%E7%AC%AC%E5%9B%9B%E6%AD%A5%EF%BC%9A%E5%88%9B%E5%BB%BA%E6%95%B0%E6%8D%AE%E5%BA%93%E8%A1%A8-toc" style="margin-left:0px;"><a href="#%E7%AC%AC%E5%9B%9B%E6%AD%A5%EF%BC%9A%E5%88%9B%E5%BB%BA%E6%95%B0%E6%8D%AE%E5%BA%93%E8%A1%A8" rel="nofollow">第四步：创建数据库表</a></p> 
<p id="%E7%AC%AC%E4%BA%94%E6%AD%A5%EF%BC%9A%E5%88%9B%E5%BB%BA5%E5%BC%A0%E8%A1%A8%E5%AF%B9%E5%BA%94%E7%9A%84Bean-toc" style="margin-left:0px;"><a href="#%E7%AC%AC%E4%BA%94%E6%AD%A5%EF%BC%9A%E5%88%9B%E5%BB%BA5%E5%BC%A0%E8%A1%A8%E5%AF%B9%E5%BA%94%E7%9A%84Bean" rel="nofollow">第五步：创建表user对应类</a></p> 
<p id="%E7%AC%AC%E5%85%AD%E6%AD%A5%EF%BC%9A%E5%88%9B%E5%BB%BAUserRealm-toc" style="margin-left:0px;"><a href="#%E7%AC%AC%E5%85%AD%E6%AD%A5%EF%BC%9A%E5%88%9B%E5%BB%BAUserRealm" rel="nofollow">第六步：创建UserRealm</a></p> 
<p id="%E7%AC%AC%E4%B8%83%E6%AD%A5%EF%BC%9A%E5%88%9B%E5%BB%BAShiro%E9%85%8D%E7%BD%AE%E7%B1%BB-toc" style="margin-left:0px;"><a href="#%E7%AC%AC%E4%B8%83%E6%AD%A5%EF%BC%9A%E5%88%9B%E5%BB%BAShiro%E9%85%8D%E7%BD%AE%E7%B1%BB" rel="nofollow">第七步：创建Shiro配置类</a></p> 
<p id="%E7%AC%AC%E5%85%AB%E6%AD%A5%EF%BC%9A%E5%AE%9E%E7%8E%B0%E7%94%A8%E6%88%B7%E7%99%BB%E5%BD%95%E5%8A%9F%E8%83%BD-toc" style="margin-left:0px;"><a href="#%E7%AC%AC%E5%85%AB%E6%AD%A5%EF%BC%9A%E5%AE%9E%E7%8E%B0%E7%94%A8%E6%88%B7%E7%99%BB%E5%BD%95%E5%8A%9F%E8%83%BD" rel="nofollow">第八步：实现登录功能</a></p> 
<p id="%E6%8E%A7%E5%88%B6%E5%99%A8%E5%B1%82-toc" style="margin-left:40px;"><a href="#%E6%8E%A7%E5%88%B6%E5%99%A8%E5%B1%82" rel="nofollow">控制器层</a></p> 
<p id="%E4%B8%9A%E5%8A%A1%E5%B1%82-toc" style="margin-left:40px;"><a href="#%E4%B8%9A%E5%8A%A1%E5%B1%82" rel="nofollow">业务层</a></p> 
<p id="UserRealm-toc" style="margin-left:40px;"><a href="#UserRealm" rel="nofollow">UserRealm</a></p> 
<p id="%E6%8C%81%E4%B9%85%E5%B1%82-toc" style="margin-left:40px;"><a href="#%E6%8C%81%E4%B9%85%E5%B1%82" rel="nofollow">持久层</a></p> 
<p id="%E7%AC%AC%E4%B9%9D%E6%AD%A5%EF%BC%9A%E6%B5%8B%E8%AF%95%E6%95%88%E6%9E%9C-toc" style="margin-left:0px;"><a href="#%E7%AC%AC%E4%B9%9D%E6%AD%A5%EF%BC%9A%E6%B5%8B%E8%AF%95%E6%95%88%E6%9E%9C" rel="nofollow">第九步：测试登录功能</a></p> 
<p id="login.html-toc" style="margin-left:40px;"><a href="#login.html" rel="nofollow">login.html</a></p> 
<p id="login.js-toc" style="margin-left:40px;"><a href="#login.js" rel="nofollow">login.js</a></p> 
<p id="home.html-toc" style="margin-left:40px;"><a href="#home.html" rel="nofollow">home.html</a></p> 
<p id="ShiroConfig.java-toc" style="margin-left:40px;"><a href="#ShiroConfig.java" rel="nofollow">ShiroConfig.java</a></p> 
<p id="%E7%AC%AC%E5%8D%81%E6%AD%A5%EF%BC%9A%E5%AE%9E%E7%8E%B0%E6%8E%88%E6%9D%83%E5%8A%9F%E8%83%BD-toc" style="margin-left:0px;"><a href="#%E7%AC%AC%E5%8D%81%E6%AD%A5%EF%BC%9A%E5%AE%9E%E7%8E%B0%E6%8E%88%E6%9D%83%E5%8A%9F%E8%83%BD" rel="nofollow">第十步：实现授权功能</a></p> 
<p id="UserRealm.java-toc" style="margin-left:40px;"><a href="#UserRealm.java" rel="nofollow">UserRealm.java</a></p> 
<p id="UserController.java-toc" style="margin-left:40px;"><a href="#UserController.java" rel="nofollow">UserController.java</a></p> 
<p id="%2Fhtml%2Fhome.html%C2%A0-toc" style="margin-left:40px;"><a href="#%2Fhtml%2Fhome.html%C2%A0" rel="nofollow">/html/home.html </a></p> 
<p id="%E8%87%AA%E5%AE%9A%E4%B9%89%E8%BF%87%E6%BB%A4%E5%99%A8%E5%AE%9E%E7%8E%B0%E9%89%B4%E6%9D%83-toc" style="margin-left:40px;"><a href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E8%BF%87%E6%BB%A4%E5%99%A8%E5%AE%9E%E7%8E%B0%E9%89%B4%E6%9D%83" rel="nofollow">自定义过滤器实现鉴权</a></p> 
<p id="ShiroConfig.java-toc" style="margin-left:40px;"><a href="#ShiroConfig.java" rel="nofollow">ShiroConfig.java</a></p> 
<p id="%E7%AC%AC%E5%8D%81%E4%B8%80%E6%AD%A5%EF%BC%9A%E6%B5%8B%E8%AF%95%E9%89%B4%E6%9D%83%E5%8A%9F%E8%83%BD-toc" style="margin-left:0px;"><a href="#%E7%AC%AC%E5%8D%81%E4%B8%80%E6%AD%A5%EF%BC%9A%E6%B5%8B%E8%AF%95%E9%89%B4%E6%9D%83%E5%8A%9F%E8%83%BD" rel="nofollow">第十一步：测试鉴权功能</a></p> 
<hr id="hr-toc"> 
<p></p> 
<h2 id="%E7%AC%AC%E4%B8%80%E6%AD%A5%EF%BC%9A%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AAspringboot%E9%A1%B9%E7%9B%AE">第一步：创建springboot项目</h2> 
<p>通过IntelliJ IDEA创建一个springboot项目，这里的项目就命名为springboot-shiro</p> 
<p></p> 
<h2 id="%E7%AC%AC%E4%BA%8C%E6%AD%A5%EF%BC%9A%E6%B7%BB%E5%8A%A0maven%E7%9A%84%E4%BE%9D%E8%B5%96">第二步：添加maven的依赖</h2> 
<p>修改pom.xml，添加相关的maven依赖</p> 
<pre><code class="language-XML">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd"&gt;
    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;

    &lt;parent&gt;
        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
        &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;
        &lt;version&gt;2.5.9&lt;/version&gt;
        &lt;relativePath /&gt;
    &lt;/parent&gt;

    &lt;groupId&gt;cn.edu.sgu.www&lt;/groupId&gt;
    &lt;artifactId&gt;springboot-shiro&lt;/artifactId&gt;
    &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;
    &lt;name&gt;springboot-shiro&lt;/name&gt;
    &lt;description&gt;Spring Boot整合Shiro权限认证框架&lt;/description&gt;

    &lt;properties&gt;
        &lt;java.version&gt;1.8&lt;/java.version&gt;
        &lt;shiro.version&gt;1.3.2&lt;/shiro.version&gt;
        &lt;mysql.version&gt;8.0.28&lt;/mysql.version&gt;
        &lt;druid.version&gt;1.1.21&lt;/druid.version&gt;
        &lt;lombok.version&gt;1.18.22&lt;/lombok.version&gt;
        &lt;fastjson.version&gt;2.0.8&lt;/fastjson.version&gt;
        &lt;mybatis.version&gt;2.2.2&lt;/mybatis.version&gt;
    &lt;/properties&gt;

    &lt;dependencies&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;
        &lt;/dependency&gt;

        &lt;!--lombok--&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;
            &lt;artifactId&gt;lombok&lt;/artifactId&gt;
            &lt;version&gt;${lombok.version}&lt;/version&gt;
        &lt;/dependency&gt;

        &lt;!--mysql--&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;mysql&lt;/groupId&gt;
            &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;
            &lt;version&gt;${mysql.version}&lt;/version&gt;
        &lt;/dependency&gt;

        &lt;!--mybatis--&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.mybatis.spring.boot&lt;/groupId&gt;
            &lt;artifactId&gt;mybatis-spring-boot-starter&lt;/artifactId&gt;
            &lt;version&gt;${mybatis.version}&lt;/version&gt;
        &lt;/dependency&gt;

        &lt;!--druid--&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;com.alibaba&lt;/groupId&gt;
            &lt;artifactId&gt;druid&lt;/artifactId&gt;
            &lt;version&gt;${druid.version}&lt;/version&gt;
        &lt;/dependency&gt;

        &lt;!--fastjson--&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;com.alibaba&lt;/groupId&gt;
            &lt;artifactId&gt;fastjson&lt;/artifactId&gt;
            &lt;version&gt;${fastjson.version}&lt;/version&gt;
        &lt;/dependency&gt;

        &lt;!-- shiro --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.apache.shiro&lt;/groupId&gt;
            &lt;artifactId&gt;shiro-spring&lt;/artifactId&gt;
            &lt;version&gt;${shiro.version}&lt;/version&gt;
        &lt;/dependency&gt;
    &lt;/dependencies&gt;

    &lt;build&gt;
        &lt;plugins&gt;
            &lt;plugin&gt;
                &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
                &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;
            &lt;/plugin&gt;
        &lt;/plugins&gt;
    &lt;/build&gt;
&lt;/project&gt;</code></pre> 
<p>完成前面两步之后，删除多余的test包，项目结构如图：</p> 
<p><img alt="" height="867" src="https://images2.imgbox.com/41/f8/2XyuefCx_o.png" width="1005"></p> 
<p></p> 
<h2 id="%C2%A0%E7%AC%AC%E4%B8%89%E6%AD%A5%EF%BC%9A%E4%BF%AE%E6%94%B9%E7%B3%BB%E7%BB%9F%E7%9A%84%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6" style="background-color:transparent;">第三步：修改配置文件</h2> 
<p>修改系统的配置文件application.yml（修改默认的配置文件application.properties的名称为application.yml，只需要改后缀名），修改完成之后，把以下内容复制到application.yml中。</p> 
<pre><code class="language-XML">spring:
  profiles:
    active: dev

# mybatis的mapper.xml文件的位置
mybatis:
  mapper-locations: classpath:mapper/*Mapper.xml</code></pre> 
<p>最后再新建一个application-dev.yml</p> 
<pre><code class="language-XML"># 设置启动端口号
server:
  port: 8080

spring:
  # 配置数据源
  datasource:
    username: root
    password: root
    url: jdbc:mysql://localhost:3306/springboot-shiro
    driver-class-name: com.mysql.cj.jdbc.Driver
    type: com.alibaba.druid.pool.DruidDataSource
  # 只返回不为null的数据
  jackson:
    default-property-inclusion: non_null</code></pre> 
<p></p> 
<h2 id="%E7%AC%AC%E5%9B%9B%E6%AD%A5%EF%BC%9A%E5%88%9B%E5%BB%BA%E6%95%B0%E6%8D%AE%E5%BA%93%E8%A1%A8">第四步：创建数据库表</h2> 
<p>1、通过navicat数据库连接工具新建数据库springboot-shiro，没有用过navicat的童鞋可以参考博主的文章<a class="link-info has-card" href="https://blog.csdn.net/heyl163_/article/details/132111378" title="推荐一款非常简单实用的数据库连接工具Navicat Premium"><span class="link-card-box"><span class="link-title">推荐一款非常简单实用的数据库连接工具Navicat Premium</span><span class="link-link"><img class="link-link-icon" src="https://images2.imgbox.com/63/87/lXNSzTT2_o.png" alt="icon-default.png?t=N7T8">https://blog.csdn.net/heyl163_/article/details/132111378</span></span></a></p> 
<p><img alt="" height="1200" src="https://images2.imgbox.com/d5/f4/oyc5uyhu_o.png" width="1200"></p> 
<p>2、在springboot-shiro数据库下创建用户表user</p> 
<pre><code class="language-sql">-- ----------------------------
-- Table structure for user
-- ----------------------------
DROP TABLE IF EXISTS `user`;
CREATE TABLE `user`  (
  `id` varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL,
  `name` varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL COMMENT '姓名',
  `username` varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL COMMENT '用户名',
  `password` varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL DEFAULT '12345' COMMENT '密码',
  `phone` varchar(11) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL COMMENT '手机号',
  `gender` tinyint(4) UNSIGNED NOT NULL COMMENT '性别',
  `is_enable` tinyint(4) UNSIGNED NOT NULL COMMENT '启用状态',
  `last_login_time` datetime NULL DEFAULT NULL COMMENT '上一次登录时间',
  PRIMARY KEY (`id`) USING BTREE
) ENGINE = InnoDB CHARACTER SET = utf8mb4 COLLATE = utf8mb4_general_ci COMMENT = '用户表' ROW_FORMAT = Dynamic;

-- ----------------------------
-- Records of user
-- ----------------------------
INSERT INTO `user` VALUES ('2023', '系统管理员', 'system', '', '18888888888', 2, 1, '2022-11-25 00:15:42');
INSERT INTO `user` VALUES ('mhxy1218', '沐雨橙风ιε', 'mumu', 'mhxy1218', '16666666666', 1, 1, '2023-07-02 00:00:29');</code></pre> 
<p></p> 
<h2 id="%E7%AC%AC%E4%BA%94%E6%AD%A5%EF%BC%9A%E5%88%9B%E5%BB%BA5%E5%BC%A0%E8%A1%A8%E5%AF%B9%E5%BA%94%E7%9A%84Bean" style="background-color:transparent;">第五步：创建表user对应类</h2> 
<ul><li>数据库表对应实体类：User</li><li>持久层接口：UserMapper</li><li>业务层接口及实现类：Userservice、UserServiceImpl</li><li>控制器类：UserController</li></ul> 
<p><img alt="" height="1200" src="https://images2.imgbox.com/50/6c/g1AAS6l5_o.png" width="1025"></p> 
<p></p> 
<p>配置mapper包扫描路径</p> 
<p>在springboot的启动类或者任意一个配置类上使用注解@MapperScan注解配置mybatis的mapper包扫描路径</p> 
<pre><code class="language-java">@MapperScan("cn.edu.sgu.www.shiro.mapper")</code></pre> 
<p>在项目根目录下创建一个config包，在config包下面创建一个MybatisConfig类。</p> 
<pre><code class="language-java">package cn.edu.sgu.www.shiro.config;

import org.mybatis.spring.annotation.MapperScan;
import org.springframework.context.annotation.Configuration;

/**
 * mybatis配置类
 * @author heyunlin
 * @version 1.0
 */
@Configuration
@MapperScan("cn.edu.sgu.www.shiro.mapper")
public class MybatisConfig {

}</code></pre> 
<p><img alt="" height="1200" src="https://images2.imgbox.com/52/d4/wbWr3ZFo_o.png" width="1200"></p> 
<p></p> 
<h2 id="%E7%AC%AC%E5%85%AD%E6%AD%A5%EF%BC%9A%E5%88%9B%E5%BB%BAUserRealm">第六步：创建UserRealm</h2> 
<blockquote> 
 <p>项目根目录下创建realm包，在realm包下创建UserRealm.java，并继承AuthorizingRealm，实现AuthorizingRealm的两个认证和授权的抽象方法。</p> 
</blockquote> 
<pre><code class="language-java">package cn.edu.sgu.www.shiro.realm;

import org.apache.shiro.authc.AuthenticationException;
import org.apache.shiro.authc.AuthenticationInfo;
import org.apache.shiro.authc.AuthenticationToken;
import org.apache.shiro.authz.AuthorizationInfo;
import org.apache.shiro.realm.AuthorizingRealm;
import org.apache.shiro.subject.PrincipalCollection;
import org.springframework.stereotype.Component;

/**
 * @author heyunlin
 * @version 1.0
 */
@Component
public class UserRealm extends AuthorizingRealm {
    
    /**
     * 认证
     */
    @Override
    protected AuthenticationInfo doGetAuthenticationInfo(AuthenticationToken authenticationToken) throws AuthenticationException {
        return null;
    }

    /**
     * 授权
     */
    @Override
    protected AuthorizationInfo doGetAuthorizationInfo(PrincipalCollection principals) {
        return null;
    }

}</code></pre> 
<p></p> 
<h2 id="%E7%AC%AC%E4%B8%83%E6%AD%A5%EF%BC%9A%E5%88%9B%E5%BB%BAShiro%E9%85%8D%E7%BD%AE%E7%B1%BB" style="background-color:transparent;">第七步：创建Shiro配置类</h2> 
<blockquote> 
 <p>在config包下创建ShiroConfig.java</p> 
</blockquote> 
<pre><code class="language-java">package cn.edu.sgu.www.shiro.config;

import cn.edu.sgu.www.shiro.realm.UserRealm;
import org.apache.shiro.spring.web.ShiroFilterFactoryBean;
import org.apache.shiro.web.mgt.DefaultWebSecurityManager;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;

/**
 * shiro配置类
 */
@Configuration
public class ShiroConfig {

    /**
     * 配置安全管理器
     * @param userRealm UserRealm
     * @return DefaultWebSecurityManager
     */
    @Bean
    public DefaultWebSecurityManager securityManager(UserRealm userRealm) {
        DefaultWebSecurityManager securityManager = new DefaultWebSecurityManager();

        securityManager.setRealm(userRealm);

        return securityManager;
    }

    /**
     * 配置Shiro过滤器工厂
     * @param securityManager 安全管理器
     * @return ShiroFilterFactoryBean
     */
    @Bean
    public ShiroFilterFactoryBean shiroFilter(DefaultWebSecurityManager securityManager) {
        ShiroFilterFactoryBean shiroFilterFactoryBean = new ShiroFilterFactoryBean();

        // 注册安全管理器
        shiroFilterFactoryBean.setSecurityManager(securityManager);

        /*
         * 设置登录页面的地址
         * 当用户访问认证资源的时候，如果用户没有登录，那么就会跳转到该属性指定的页面
         */
        shiroFilterFactoryBean.setLoginUrl("/login.html");

        return shiroFilterFactoryBean;
    }

}</code></pre> 
<p></p> 
<h2 id="%E7%AC%AC%E5%85%AB%E6%AD%A5%EF%BC%9A%E5%AE%9E%E7%8E%B0%E7%94%A8%E6%88%B7%E7%99%BB%E5%BD%95%E5%8A%9F%E8%83%BD">第八步：实现登录功能</h2> 
<h3 id="%E6%8E%A7%E5%88%B6%E5%99%A8%E5%B1%82">控制器层</h3> 
<blockquote> 
 <p>在UserController类中添加一个login()方法，新建UserLoginDTO对象来接收前端传来的用户名和密码，同时通过validation验证这两个字段。</p> 
</blockquote> 
<pre><code class="language-java">package cn.edu.sgu.www.shiro.controller;

import cn.edu.sgu.www.shiro.dto.UserLoginDTO;
import cn.edu.sgu.www.shiro.restful.JsonResult;
import cn.edu.sgu.www.shiro.service.UserService;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestMethod;
import org.springframework.web.bind.annotation.RestController;

/**
 * @author heyunlin
 * @version 1.0
 */
@RestController
@RequestMapping(path = "/user", produces = "application/json;charset=utf-8")
public class UserController {

    private final UserService userService;

    @Autowired
    public UserController(UserService userService) {
        this.userService = userService;
    }

    @RequestMapping(path = "/login", method = RequestMethod.POST)
    public JsonResult&lt;Void&gt; login(UserLoginDTO loginDTO) {
        userService.login(loginDTO);

        return JsonResult.success();
    }

}</code></pre> 
<p></p> 
<h3 id="%E4%B8%9A%E5%8A%A1%E5%B1%82">业务层</h3> 
<pre><code class="language-java">package cn.edu.sgu.www.shiro.service;

import cn.edu.sgu.www.shiro.dto.UserLoginDTO;

/**
 * @author heyunlin
 * @version 1.0
 */
public interface UserService {

    /**
     * 登录认证
     * @param loginDTO 登录信息
     */
    void login(UserLoginDTO loginDTO);
}</code></pre> 
<blockquote> 
 <p>UserServiceImpl中实现用户登录的业务代码，当我们调用Subject的login()方法时，会执行UserRealm下面的认证方法doGetAuthenticationInfo()</p> 
</blockquote> 
<pre><code class="language-java">package cn.edu.sgu.www.shiro.service.impl;

import cn.edu.sgu.www.shiro.dto.UserLoginDTO;
import cn.edu.sgu.www.shiro.entity.User;
import cn.edu.sgu.www.shiro.exception.GlobalException;
import cn.edu.sgu.www.shiro.mapper.UserMapper;
import cn.edu.sgu.www.shiro.restful.ResponseCode;
import cn.edu.sgu.www.shiro.service.UserService;
import org.apache.shiro.SecurityUtils;
import org.apache.shiro.authc.UsernamePasswordToken;
import org.apache.shiro.subject.Subject;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

/**
 * @author heyunlin
 * @version 1.0
 */
@Service
public class UserServiceImpl implements UserService {

    private final UserMapper userMapper;

    @Autowired
    public UserServiceImpl(UserMapper userMapper) {
        this.userMapper = userMapper;
    }

    @Override
    public void login(UserLoginDTO loginDTO) {
        String username = loginDTO.getUsername();

        // 根据用户名查询用户信息
        User user = userMapper.selectByUsername(username);

        if (user != null) {
            if (user.getIsEnable()) {
                // shiro登录认证
                UsernamePasswordToken token = new UsernamePasswordToken(username, loginDTO.getPassword());
                Subject subject = SecurityUtils.getSubject();

                subject.login(token);
                // 设置session失效时间：永不超时
                subject.getSession().setTimeout(-1001);
            } else {
                throw new GlobalException(ResponseCode.FORBIDDEN, "账号已被锁定，禁止登录！");
            }
        } else {
            throw new GlobalException(ResponseCode.NOT_FOUND, "用户名不存在~");
        }
    }

}</code></pre> 
<p></p> 
<h3 id="UserRealm">UserRealm</h3> 
<p>实现认证的方法，当调用Subject.login()方法时，在shiro框架内部会去调用realm的认证方法。</p> 
<pre><code class="language-java">package cn.edu.sgu.www.shiro.realm;

import cn.edu.sgu.www.shiro.entity.User;
import cn.edu.sgu.www.shiro.exception.GlobalException;
import cn.edu.sgu.www.shiro.mapper.UserMapper;
import cn.edu.sgu.www.shiro.restful.ResponseCode;
import org.apache.shiro.authc.AuthenticationInfo;
import org.apache.shiro.authc.AuthenticationToken;
import org.apache.shiro.authc.SimpleAuthenticationInfo;
import org.apache.shiro.authc.UsernamePasswordToken;
import org.apache.shiro.authz.AuthorizationInfo;
import org.apache.shiro.realm.AuthorizingRealm;
import org.apache.shiro.subject.PrincipalCollection;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Component;

/**
 * @author heyunlin
 * @version 1.0
 */
@Component
public class UserRealm extends AuthorizingRealm {

    private final UserMapper userMapper;

    @Autowired
    public UserRealm(UserMapper userMapper) {
        this.userMapper = userMapper;
    }

    /**
     * 认证
     */
    @Override
    protected AuthenticationInfo doGetAuthenticationInfo(AuthenticationToken authenticationToken) {
        UsernamePasswordToken token = (UsernamePasswordToken) authenticationToken;

        // 得到用户名
        String username = token.getUsername();
        // 根据用户名查询用户信息
        User user = userMapper.selectByUsername(username);

        if (user == null) {
            throw new GlobalException(ResponseCode.BAD_REQUEST, "登录失败，用户不存在~");
        }
        if (user.getIsEnable()) {
            String password = new String(token.getPassword());

            if (user.getPassword().equals(password)) {
                return new SimpleAuthenticationInfo(user, password, username);
            } else {
                throw new GlobalException(ResponseCode.BAD_REQUEST, "用户名或密码错误，登录失败！");
            }
        }

        return null;
    }

    /**
     * 授权
     */
    @Override
    protected AuthorizationInfo doGetAuthorizationInfo(PrincipalCollection principals) {
        return null;
    }

}</code></pre> 
<p></p> 
<h3 id="%E6%8C%81%E4%B9%85%E5%B1%82">持久层</h3> 
<p>UserMapper接口新增selectByUsername()方法</p> 
<pre><code class="language-java">package cn.edu.sgu.www.shiro.mapper;

import cn.edu.sgu.www.shiro.entity.User;
import org.springframework.stereotype.Repository;

/**
 * @author heyunlin
 * @version 1.0
 */
@Repository
public interface UserMapper {

    /**
     * 根据用户名查询用户信息
     * @param username 用户名
     * @return User 查询到的用户信息
     */
    User selectByUsername(String username);
}</code></pre> 
<p>通过xml的方式绑定sql语句</p> 
<pre><code class="language-XML">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;
&lt;!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd"&gt;

&lt;mapper namespace="cn.edu.sgu.www.shiro.mapper.UserMapper"&gt;

    &lt;resultMap id="resultMap" type="cn.edu.sgu.www.shiro.entity.User"&gt;
        &lt;result column="id" property="id" /&gt;
        &lt;result column="name" property="name" /&gt;
        &lt;result column="username" property="username" /&gt;
        &lt;result column="password" property="password" /&gt;
        &lt;result column="phone" property="phone" /&gt;
        &lt;result column="is_enable" property="isEnable" /&gt;
        &lt;result column="last_login_time" property="lastLoginTime" /&gt;
    &lt;/resultMap&gt;

    &lt;select id="selectByUsername" resultMap="resultMap"&gt;
        select * from user where username = #{username}
    &lt;/select&gt;
&lt;/mapper&gt;</code></pre> 
<p></p> 
<h2 id="%E7%AC%AC%E4%B9%9D%E6%AD%A5%EF%BC%9A%E6%B5%8B%E8%AF%95%E6%95%88%E6%9E%9C">第九步：测试登录功能</h2> 
<p>创建几个简单的页面试一下效果</p> 
<blockquote> 
 <p>准备工作：</p> 
 <p>在resources目录下创建static目录，存放静态资源文件，在static目录下创建js和html目录，把jquery.min.js复制到js目录下。</p> 
</blockquote> 
<h3 id="login.html">login.html</h3> 
<p>static目录下创建登录页面login.html</p> 
<pre><code class="language-html">&lt;!DOCTYPE html&gt;
&lt;html&gt;
    &lt;head&gt;
        &lt;meta charset="UTF-8" /&gt;
        &lt;title&gt;登录页面&lt;/title&gt;
    &lt;/head&gt;

    &lt;body&gt;
        &lt;form id="loginForm"&gt;
            &lt;table&gt;
                &lt;tr&gt;
                    &lt;td&gt;用户名&lt;/td&gt;
                    &lt;td&gt;&lt;input type="text" id="username" /&gt;&lt;/td&gt;
                &lt;/tr&gt;

                &lt;tr&gt;
                    &lt;td&gt;密码&lt;/td&gt;
                    &lt;td&gt;&lt;input type="password" id="password" /&gt;&lt;/td&gt;
                &lt;/tr&gt;

                &lt;tr&gt;
                    &lt;td&gt;
                        &lt;button type="button" id="login"&gt;登录&lt;/button&gt;
                    &lt;/td&gt;
                    &lt;td&gt;
                        &lt;button type="reset"&gt;重置&lt;/button&gt;
                    &lt;/td&gt;
                &lt;/tr&gt;
            &lt;/table&gt;
        &lt;/form&gt;

        &lt;script src="/js/jquery.min.js"&gt;&lt;/script&gt;
        &lt;script src="/js/login.js"&gt;&lt;/script&gt;
    &lt;/body&gt;
&lt;/html&gt;</code></pre> 
<p></p> 
<h3 id="login.js">login.js</h3> 
<p>js目录下创建login.js，点击登录按钮时提交用户的数据到接口/user/login，完成登录操作</p> 
<pre><code class="language-javascript">$(document).ready(function () {

    $("#login").click(function () {
        let username = $("#username").val();
        let password = $("#password").val();

        $.post("/user/login", {
            username: username,
            password: password
        }, function (res) {
           if (res.code === 200) {
               location.href = "/html/home.html";
           }
        });
    });

});</code></pre> 
<p></p> 
<h3 id="home.html">home.html</h3> 
<p>html目录下创建一个页面home.html</p> 
<pre><code class="language-html">&lt;!DOCTYPE html&gt;
&lt;html&gt;
    &lt;head&gt;
        &lt;meta charset="UTF-8" /&gt;
        &lt;title&gt;系统首页&lt;/title&gt;
    &lt;/head&gt;

    &lt;body&gt;
        &lt;h1&gt;欢迎来到系统首页！&lt;/h1&gt;
    &lt;/body&gt;
&lt;/html&gt;</code></pre> 
<p></p> 
<h3 id="ShiroConfig.java">ShiroConfig.java</h3> 
<p>添加资源访问规则，配置登录页面和登录接口的地址可以不需要登录认证就能访问，同时/html/home.html需要登录才能访问。</p> 
<pre><code class="language-java">package cn.edu.sgu.www.shiro.config;

import cn.edu.sgu.www.shiro.realm.UserRealm;
import org.apache.shiro.spring.web.ShiroFilterFactoryBean;
import org.apache.shiro.web.mgt.DefaultWebSecurityManager;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;

import java.util.LinkedHashMap;
import java.util.Map;

/**
 * shiro配置类
 */
@Configuration
public class ShiroConfig {

    /**
     * 配置安全管理器
     * @param userRealm UserRealm
     * @return DefaultWebSecurityManager
     */
    @Bean
    public DefaultWebSecurityManager securityManager(UserRealm userRealm) {
        DefaultWebSecurityManager securityManager = new DefaultWebSecurityManager();

        securityManager.setRealm(userRealm);

        return securityManager;
    }

    /**
     * 配置Shiro过滤器工厂
     * @param securityManager 安全管理器
     * @return ShiroFilterFactoryBean
     */
    @Bean
    public ShiroFilterFactoryBean shiroFilter(DefaultWebSecurityManager securityManager) {
        ShiroFilterFactoryBean shiroFilterFactoryBean = new ShiroFilterFactoryBean();

        // 注册安全管理器
        shiroFilterFactoryBean.setSecurityManager(securityManager);

        /*
         * 设置登录页面的地址
         * 当用户访问认证资源的时候，如果用户没有登录，那么就会跳转到指定的页面
         */
        shiroFilterFactoryBean.setLoginUrl("/login.html");

        // 定义资源访问规则
        Map&lt;String, String&gt; map = new LinkedHashMap&lt;&gt;();

        /*
         * 过滤器说明
         * anon：不需要认证就可以访问的资源
         * authc：需要登录认证才能访问的资源
         */
        map.put("/html/home.html", "authc");

        // 不需要认证就能访问
        map.put("/login.html", "anon");
        map.put("/user/login", "anon");

        shiroFilterFactoryBean.setFilterChainDefinitionMap(map);

        return shiroFilterFactoryBean;
    }

}</code></pre> 
<blockquote> 
 <p>当我们访问localhost:8080/login.html时，输入mumu/mhxy1218，点击登录时，会跳转到/html/home.html。</p> 
 <p></p> 
 <p>然后我们清空浏览器缓存，刷新页面，发现页面重定向回了login.html。这是因为在shiro配置类里配置了/html/home.html要身份认证之后才能访问。</p> 
 <p></p> 
 <p>map.put("/html/home.html", "authc");</p> 
</blockquote> 
<p></p> 
<h2 id="%E7%AC%AC%E5%8D%81%E6%AD%A5%EF%BC%9A%E5%AE%9E%E7%8E%B0%E6%8E%88%E6%9D%83%E5%8A%9F%E8%83%BD">第十步：实现授权功能</h2> 
<blockquote> 
 <p>接下来，讲解如何通过shiro完成授权，在UserRealm里的doGetAuthorizationInfo()方法中实现授权的代码，查询用户的权限保存到shiro中，为了方便演示效果，我们模拟几条数据。</p> 
</blockquote> 
<p></p> 
<h3 id="UserRealm.java">UserRealm.java</h3> 
<p>完成doGetAuthorizationInfo()方法的具体实现</p> 
<pre><code class="language-java">package cn.edu.sgu.www.shiro.realm;

import cn.edu.sgu.www.shiro.entity.User;
import cn.edu.sgu.www.shiro.exception.GlobalException;
import cn.edu.sgu.www.shiro.mapper.UserMapper;
import cn.edu.sgu.www.shiro.restful.ResponseCode;
import org.apache.shiro.authc.AuthenticationInfo;
import org.apache.shiro.authc.AuthenticationToken;
import org.apache.shiro.authc.SimpleAuthenticationInfo;
import org.apache.shiro.authc.UsernamePasswordToken;
import org.apache.shiro.authz.AuthorizationInfo;
import org.apache.shiro.authz.SimpleAuthorizationInfo;
import org.apache.shiro.realm.AuthorizingRealm;
import org.apache.shiro.subject.PrincipalCollection;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Component;

import java.util.HashSet;
import java.util.Set;

/**
 * @author heyunlin
 * @version 1.0
 */
@Component
public class UserRealm extends AuthorizingRealm {

    private final UserMapper userMapper;

    @Autowired
    public UserRealm(UserMapper userMapper) {
        this.userMapper = userMapper;
    }

    /**
     * 认证
     */
    @Override
    protected AuthenticationInfo doGetAuthenticationInfo(AuthenticationToken authenticationToken) {
        UsernamePasswordToken token = (UsernamePasswordToken) authenticationToken;

        // 得到用户名
        String username = token.getUsername();
        // 根据用户名查询用户信息
        User user = userMapper.selectByUsername(username);

        if (user == null) {
            throw new GlobalException(ResponseCode.BAD_REQUEST, "登录失败，用户不存在~");
        }
        if (user.getIsEnable()) {
            String password = new String(token.getPassword());

            if (user.getPassword().equals(password)) {
                return new SimpleAuthenticationInfo(user, password, username);
            } else {
                throw new GlobalException(ResponseCode.BAD_REQUEST, "用户名或密码错误，登录失败！");
            }
        }

        return null;
    }

    /**
     * 授权
     */
    @Override
    protected AuthorizationInfo doGetAuthorizationInfo(PrincipalCollection principals) {
        SimpleAuthorizationInfo authorizationInfo = new SimpleAuthorizationInfo();
        Set&lt;String&gt; permissions = new HashSet&lt;&gt;();

        permissions.add("/user/delete");
        permissions.add("/user/update");

        authorizationInfo.setStringPermissions(permissions);

        return authorizationInfo;
    }

}</code></pre> 
<p></p> 
<h3 id="UserController.java">UserController.java</h3> 
<p>在UserController中添加两个方法delete()和update()</p> 
<pre><code class="language-java">package cn.edu.sgu.www.shiro.controller;

import cn.edu.sgu.www.shiro.dto.UserLoginDTO;
import cn.edu.sgu.www.shiro.restful.JsonResult;
import cn.edu.sgu.www.shiro.service.UserService;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestMethod;
import org.springframework.web.bind.annotation.RestController;

/**
 * @author heyunlin
 * @version 1.0
 */
@RestController
@RequestMapping(path = "/user", produces = "application/json;charset=utf-8")
public class UserController {

    private final UserService userService;

    @Autowired
    public UserController(UserService userService) {
        this.userService = userService;
    }

    @RequestMapping(path = "/login", method = RequestMethod.POST)
    public JsonResult&lt;Void&gt; login(UserLoginDTO loginDTO) {
        userService.login(loginDTO);

        return JsonResult.success();
    }

    @RequestMapping(path = "/delete", method = RequestMethod.POST)
    public JsonResult&lt;Void&gt; delete() {
        return JsonResult.success("删除成功");
    }

    @RequestMapping(path = "/update", method = RequestMethod.POST)
    public JsonResult&lt;Void&gt; update() {
        return JsonResult.success("修改成功");
    }

}</code></pre> 
<p></p> 
<h3 id="%2Fhtml%2Fhome.html%C2%A0">/html/home.html </h3> 
<blockquote> 
 <p>home.html中新增两个按钮，同时还有引入jquery。</p> 
</blockquote> 
<pre><code class="language-html">&lt;!DOCTYPE html&gt;
&lt;html&gt;
    &lt;head&gt;
        &lt;meta charset="UTF-8" /&gt;
        &lt;title&gt;系统首页&lt;/title&gt;
        &lt;script src="/js/jquery.min.js"&gt;&lt;/script&gt;
    &lt;/head&gt;

    &lt;body&gt;
        &lt;h1&gt;欢迎来到系统首页！&lt;/h1&gt;
        &lt;button type="button" id="delete"&gt;删除&lt;/button&gt; | &lt;button type="button" id="update"&gt;修改&lt;/button&gt;

        &lt;script&gt;
            $(function () {
                $("#delete").click(function () {
                    $.post("/user/delete", function (resp) {
                        alert(resp.message);
                    });
                });

                $("#update").click(function () {
                    $.post("/user/update", function (resp) {
                        alert(resp.message);
                    });
                });

            });
        &lt;/script&gt;
    &lt;/body&gt;
&lt;/html&gt;</code></pre> 
<p></p> 
<h3 id="%E8%87%AA%E5%AE%9A%E4%B9%89%E8%BF%87%E6%BB%A4%E5%99%A8%E5%AE%9E%E7%8E%B0%E9%89%B4%E6%9D%83">自定义过滤器实现鉴权</h3> 
<blockquote> 
 <p>自定义过滤器AuthorizationFilter实现鉴权功能，注意，这个过滤器只处理接口资源，所以把项目的静态资源/路径作为排除项，静态资源直接放行。</p> 
</blockquote> 
<pre><code class="language-java">package cn.edu.sgu.www.shiro.filter;

import cn.edu.sgu.www.shiro.restful.JsonResult;
import cn.edu.sgu.www.shiro.restful.ResponseCode;
import com.alibaba.fastjson.JSON;
import org.apache.shiro.SecurityUtils;
import org.apache.shiro.subject.Subject;

import javax.servlet.*;
import javax.servlet.annotation.WebFilter;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import java.io.IOException;

/**
 * 鉴权过滤器
 * @author heyunlin
 * @version 1.0
 */
@WebFilter
public class AuthorizationFilter implements Filter {

    @Override
    public void doFilter(ServletRequest req, ServletResponse resp, FilterChain chain) throws ServletException, IOException {
        HttpServletRequest request = (HttpServletRequest) req;
        String requestURI = request.getRequestURI();
        Subject subject = SecurityUtils.getSubject();

        if (subject != null &amp;&amp; !subject.isPermitted(requestURI)) {
            HttpServletResponse response = (HttpServletResponse) resp;
            response.setContentType("application/json;charset=utf-8");

            // 构建返回对象
            JsonResult&lt;Void&gt; jsonResult= JsonResult.error(ResponseCode.UNAUTHORIZED, "正在访问未授权的资源");
            String data = JSON.toJSONString(jsonResult);

            response.getWriter().write(data);
            return;
        }

        chain.doFilter(req, resp);
    }

}</code></pre> 
<p></p> 
<h3>ShiroConfig.java</h3> 
<p>把自定义过滤器加入到shiro的过滤器链中，处理删除和修改两个接口。</p> 
<blockquote> 
 <p>map.put("/user/delete", "authorization");<br> map.put("/user/update", "authorization");</p> 
</blockquote> 
<pre><code class="language-java">package cn.edu.sgu.www.shiro.config;

import cn.edu.sgu.www.shiro.filter.AuthorizationFilter;
import cn.edu.sgu.www.shiro.realm.UserRealm;
import org.apache.shiro.spring.web.ShiroFilterFactoryBean;
import org.apache.shiro.web.mgt.DefaultWebSecurityManager;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;

import javax.servlet.Filter;
import java.util.LinkedHashMap;
import java.util.Map;

/**
 * shiro配置类
 */
@Configuration
public class ShiroConfig {

    /**
     * 配置安全管理器
     * @param userRealm UserRealm
     * @return DefaultWebSecurityManager
     */
    @Bean
    public DefaultWebSecurityManager securityManager(UserRealm userRealm) {
        DefaultWebSecurityManager securityManager = new DefaultWebSecurityManager();

        securityManager.setRealm(userRealm);

        return securityManager;
    }

    /**
     * 配置Shiro过滤器工厂
     * @param securityManager 安全管理器
     * @return ShiroFilterFactoryBean
     */
    @Bean
    public ShiroFilterFactoryBean shiroFilter(DefaultWebSecurityManager securityManager) {
        ShiroFilterFactoryBean shiroFilterFactoryBean = new ShiroFilterFactoryBean();

        // 注册安全管理器
        shiroFilterFactoryBean.setSecurityManager(securityManager);

        /*
         * 设置登录页面的地址
         * 当用户访问认证资源的时候，如果用户没有登录，那么就会跳转到指定的页面
         */
        shiroFilterFactoryBean.setLoginUrl("/login.html");

        // 定义资源访问规则
        Map&lt;String, String&gt; map = new LinkedHashMap&lt;&gt;();

        /*
         * 过滤器说明
         * anon：不需要认证就可以访问的资源
         * authc：需要登录认证才能访问的资源
         */
        map.put("/html/home.html", "authc");

        // 不需要认证就能访问
        map.put("/login.html", "anon");
        map.put("/user/login", "anon");

        // 设置自定义过滤器
        map.put("/user/delete", "authorization");
        map.put("/user/update", "authorization");

        shiroFilterFactoryBean.setFilterChainDefinitionMap(map);

        Map&lt;String, Filter&gt; filters = shiroFilterFactoryBean.getFilters();
        filters.put("authorization", new AuthorizationFilter());
        shiroFilterFactoryBean.setFilters(filters);

        shiroFilterFactoryBean.setFilterChainDefinitionMap(map);

        return shiroFilterFactoryBean;
    }

}</code></pre> 
<p></p> 
<h2 id="%E7%AC%AC%E5%8D%81%E4%B8%80%E6%AD%A5%EF%BC%9A%E6%B5%8B%E8%AF%95%E9%89%B4%E6%9D%83%E5%8A%9F%E8%83%BD">第十一步：测试鉴权功能</h2> 
<p>为了测试，注释掉修改接口的资源权限，然后重启一下项目。</p> 
<p><img alt="" height="763" src="https://images2.imgbox.com/7a/9c/2lpfTqIp_o.png" width="1200"></p> 
<p>点击删除按钮会提升删除成功，但是修改的时候提示未授权。</p> 
<p><img alt="" height="769" src="https://images2.imgbox.com/68/64/dFhS0Wc1_o.png" width="1200"></p> 
<p>好了，文章就分享到这里了，如果看完这篇文章感觉对你有所帮助，不要忘了点赞+收藏哦~</p> 
<p>代码已经上传到git仓库，可按需获取：</p> 
<p><a class="link-info has-card" href="https://gitee.com/he-yunlin/springboot-shiro.git" rel="nofollow" title="springboot整合shiro实现认证和授权功能"><span class="link-card-box"><span class="link-title">springboot整合shiro实现认证和授权功能</span><span class="link-link"><img class="link-link-icon" src="https://images2.imgbox.com/18/31/EE4s1LG9_o.png" alt="icon-default.png?t=N7T8">https://gitee.com/he-yunlin/springboot-shiro.git</span></span></a></p> 
<p>更多代码详情，请参考博主的另一篇文章：</p> 
<p><a class="link-info has-card" href="https://blog.csdn.net/heyl163_/article/details/131518274" title="springboot整合shiro实现认证和授权功能改进"><span class="link-card-box"><span class="link-title">springboot整合shiro实现认证和授权功能改进</span><span class="link-link"><img class="link-link-icon" src="https://images2.imgbox.com/6d/69/ksrOlWmh_o.png" alt="icon-default.png?t=N7T8">https://blog.csdn.net/heyl163_/article/details/131518274</span></span></a></p> 
<p></p> 
<p></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/d6494646d6a8afb1932051266b180ebd/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">OpenCV介绍及安装</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/c120a8f5f66b4cc714ef2f845a2b895c/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">校园教务管理系统</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 追风少年的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>