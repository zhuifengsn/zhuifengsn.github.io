<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>【Spring Boot 源码学习】深入 BootstrapContext 及其默认实现 - 追风少年的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="【Spring Boot 源码学习】深入 BootstrapContext 及其默认实现" />
<meta property="og:description" content="《Spring Boot 源码学习系列》
深入 BootstrapContext 及其默认实现 一、引言二、往期内容三、主要内容3.1 BootstrapContext3.1.1 源码初识3.1.2 get 方法3.1.3 getOrElse 方法3.1.4 getOrElseSupply 方法3.1.5 getOrElseThrow 方法3.1.6 isRegistered 方法 3.2 ConfigurableBootstrapContext3.3 DefaultBootstrapContext3.3.1 源码初识3.3.2 实现 BootstrapRegistry 接口中的方法3.3.3 实现 BootstrapContext 接口中的方法3.3.4 close 方法 四、总结 一、引言 书接前文《BootstrapRegistry 详解》，在介绍 BootstrapRegistry 的内部类 InstanceSupplier 的 get 方法时，看到了它的唯一参数 BootstrapContext 接口【即引导上下文】。而这个接口及其默认实现就是本篇要重点介绍的对象，且听我娓娓道来。
二、往期内容 在开始本篇的内容介绍之前，我们先来看看往期的系列文章【有需要的朋友，欢迎关注系列专栏】：
Spring Boot 源码学习 Spring Boot 项目介绍 Spring Boot 核心运行原理介绍 【Spring Boot 源码学习】@EnableAutoConfiguration 注解 【Spring Boot 源码学习】@SpringBootApplication 注解 【Spring Boot 源码学习】走近 AutoConfigurationImportSelector 【Spring Boot 源码学习】自动装配流程源码解析（上） 【Spring Boot 源码学习】自动装配流程源码解析（下） 【Spring Boot 源码学习】深入 FilteringSpringBootCondition 【Spring Boot 源码学习】OnClassCondition 详解 【Spring Boot 源码学习】OnBeanCondition 详解 【Spring Boot 源码学习】OnWebApplicationCondition 详解 【Spring Boot 源码学习】@Conditional 条件注解 【Spring Boot 源码学习】HttpEncodingAutoConfiguration 详解 【Spring Boot 源码学习】RedisAutoConfiguration 详解 【Spring Boot 源码学习】JedisConnectionConfiguration 详解 【Spring Boot 源码学习】初识 SpringApplication 【Spring Boot 源码学习】Banner 信息打印流程 【Spring Boot 源码学习】自定义 Banner 信息打印 【Spring Boot 源码学习】BootstrapRegistryInitializer 详解 【Spring Boot 源码学习】ApplicationContextInitializer 详解 【Spring Boot 源码学习】ApplicationListener 详解 【Spring Boot 源码学习】SpringApplication 的定制化介绍 【Spring Boot 源码学习】BootstrapRegistry 详解 三、主要内容 注意： 以下涉及 Spring Boot 源码 均来自版本 2." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://zhuifengsn.github.io/posts/fb634da863f2932c4dda286e32902ffe/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-02-25T16:55:02+08:00" />
<meta property="article:modified_time" content="2024-02-25T16:55:02+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="追风少年的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">追风少年的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">【Spring Boot 源码学习】深入 BootstrapContext 及其默认实现</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p><a href="https://blog.csdn.net/u012855229/category_12387912.html">《Spring Boot 源码学习系列》</a></p> 
<p><img src="https://images2.imgbox.com/57/6f/rD4j0Ywh_o.jpg" alt="在这里插入图片描述"></p> 
<p></p> 
<div class="toc"> 
 <h4>深入 BootstrapContext 及其默认实现</h4> 
 <ul><li><a href="#_5" rel="nofollow">一、引言</a></li><li><a href="#_10" rel="nofollow">二、往期内容</a></li><li><a href="#_136" rel="nofollow">三、主要内容</a></li><li><ul><li><a href="#31_BootstrapContext_139" rel="nofollow">3.1 BootstrapContext</a></li><li><ul><li><a href="#311__141" rel="nofollow">3.1.1 源码初识</a></li><li><a href="#312_get__159" rel="nofollow">3.1.2 get 方法</a></li><li><a href="#313_getOrElse__169" rel="nofollow">3.1.3 getOrElse 方法</a></li><li><a href="#314_getOrElseSupply__178" rel="nofollow">3.1.4 getOrElseSupply 方法</a></li><li><a href="#315_getOrElseThrow__188" rel="nofollow">3.1.5 getOrElseThrow 方法</a></li><li><a href="#316_isRegistered__197" rel="nofollow">3.1.6 isRegistered 方法</a></li></ul> 
   </li><li><a href="#32_ConfigurableBootstrapContext_206" rel="nofollow">3.2 ConfigurableBootstrapContext</a></li><li><a href="#33_DefaultBootstrapContext_217" rel="nofollow">3.3 DefaultBootstrapContext</a></li><li><ul><li><a href="#331__221" rel="nofollow">3.3.1 源码初识</a></li><li><a href="#332__BootstrapRegistry__253" rel="nofollow">3.3.2 实现 BootstrapRegistry 接口中的方法</a></li><li><a href="#333__BootstrapContext__313" rel="nofollow">3.3.3 实现 BootstrapContext 接口中的方法</a></li><li><a href="#334_close__381" rel="nofollow">3.3.4 close 方法</a></li></ul> 
  </li></ul> 
  </li><li><a href="#_387" rel="nofollow">四、总结</a></li></ul> 
</div> 
<p></p> 
<h2><a id="_5"></a>一、引言</h2> 
<p>书接前文<a href="https://blog.csdn.net/u012855229/article/details/135937639">《BootstrapRegistry 详解》</a>，在介绍 <code>BootstrapRegistry</code> 的内部类 <code>InstanceSupplier</code> 的 <code>get</code> 方法时，看到了它的唯一参数 <code>BootstrapContext</code> 接口【即引导上下文】。而这个接口及其默认实现就是本篇要重点介绍的对象，且听我娓娓道来。</p> 
<p><a href="https://github.com/Huazie/flea-framework"><img src="https://images2.imgbox.com/b2/e7/ra0si7JG_o.png" alt="在这里插入图片描述"></a></p> 
<h2><a id="_10"></a>二、往期内容</h2> 
<p>在开始本篇的内容介绍之前，我们先来看看往期的系列文章【有需要的朋友，欢迎关注系列专栏】：</p> 
<table><tbody><tr><td rowspan="24" align="left"> <a href="https://blog.csdn.net/u012855229/category_12387912.html">Spring Boot 源码学习</a> </td></tr><tr><td align="left"> <a href="https://blog.csdn.net/u012855229/article/details/129095276">Spring Boot 项目介绍</a> </td></tr><tr><td align="left"> <a href="https://blog.csdn.net/u012855229/article/details/131692634">Spring Boot 核心运行原理介绍</a> </td></tr><tr><td align="left"> <a href="https://blog.csdn.net/u012855229/article/details/131798732">【Spring Boot 源码学习】@EnableAutoConfiguration 注解</a> </td></tr><tr><td align="left"> <a href="https://blog.csdn.net/u012855229/article/details/131745159">【Spring Boot 源码学习】@SpringBootApplication 注解</a> </td></tr><tr><td align="left"> <a href="https://blog.csdn.net/u012855229/article/details/131988474">【Spring Boot 源码学习】走近 AutoConfigurationImportSelector</a> </td></tr><tr><td align="left"> <a href="https://blog.csdn.net/u012855229/article/details/132023311">【Spring Boot 源码学习】自动装配流程源码解析（上）</a> </td></tr><tr><td align="left"> <a href="https://blog.csdn.net/u012855229/article/details/132136590">【Spring Boot 源码学习】自动装配流程源码解析（下）</a> </td></tr><tr><td align="left"> <a href="https://blog.csdn.net/u012855229/article/details/132432893">【Spring Boot 源码学习】深入 FilteringSpringBootCondition</a> </td></tr><tr><td align="left"> <a href="https://blog.csdn.net/u012855229/article/details/132738150">【Spring Boot 源码学习】OnClassCondition 详解</a> </td></tr><tr><td align="left"> <a href="https://blog.csdn.net/u012855229/article/details/132912330">【Spring Boot 源码学习】OnBeanCondition 详解</a> </td></tr><tr><td align="left"> <a href="https://blog.csdn.net/u012855229/article/details/133624219">【Spring Boot 源码学习】OnWebApplicationCondition 详解</a> </td></tr><tr><td align="left"> <a href="https://blog.csdn.net/u012855229/article/details/133681149">【Spring Boot 源码学习】@Conditional 条件注解</a> </td></tr><tr><td align="left"> <a href="https://blog.csdn.net/u012855229/article/details/133902414">【Spring Boot 源码学习】HttpEncodingAutoConfiguration 详解</a> </td></tr><tr><td align="left"> <a href="https://blog.csdn.net/u012855229/article/details/133989164">【Spring Boot 源码学习】RedisAutoConfiguration 详解</a> </td></tr><tr><td align="left"> <a href="https://blog.csdn.net/u012855229/article/details/134233884">【Spring Boot 源码学习】JedisConnectionConfiguration 详解</a> </td></tr><tr><td align="left"> <a href="https://blog.csdn.net/u012855229/article/details/134266259">【Spring Boot 源码学习】初识 SpringApplication</a> </td></tr><tr><td align="left"> <a href="https://blog.csdn.net/u012855229/article/details/134373269">【Spring Boot 源码学习】Banner 信息打印流程</a> </td></tr><tr><td align="left"> <a href="https://blog.csdn.net/u012855229/article/details/134425752">【Spring Boot 源码学习】自定义 Banner 信息打印</a> </td></tr><tr><td align="left"> <a href="https://blog.csdn.net/u012855229/article/details/134515191">【Spring Boot 源码学习】BootstrapRegistryInitializer 详解</a> </td></tr><tr><td align="left"> <a href="https://blog.csdn.net/u012855229/article/details/134515484">【Spring Boot 源码学习】ApplicationContextInitializer 详解</a> </td></tr><tr><td align="left"> <a href="https://blog.csdn.net/u012855229/article/details/134515439">【Spring Boot 源码学习】ApplicationListener 详解</a> </td></tr><tr><td align="left"> <a href="https://blog.csdn.net/u012855229/article/details/135432489">【Spring Boot 源码学习】SpringApplication 的定制化介绍</a> </td></tr><tr><td align="left"> <a href="https://blog.csdn.net/u012855229/article/details/135937639">【Spring Boot 源码学习】BootstrapRegistry 详解</a> </td></tr></tbody></table> 
<h2><a id="_136"></a>三、主要内容</h2> 
<blockquote> 
 <p>注意： 以下涉及 <strong>Spring Boot</strong> 源码 均来自版本 <strong>2.7.9</strong>，其他版本有所出入，可自行查看源码。</p> 
</blockquote> 
<h3><a id="31_BootstrapContext_139"></a>3.1 BootstrapContext</h3> 
<h4><a id="311__141"></a>3.1.1 源码初识</h4> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">BootstrapContext</span> <span class="token punctuation">{<!-- --></span>
	<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">T</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> type<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IllegalStateException</span><span class="token punctuation">;</span>
	<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">T</span> <span class="token function">getOrElse</span><span class="token punctuation">(</span><span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> type<span class="token punctuation">,</span> <span class="token class-name">T</span> other<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">T</span> <span class="token function">getOrElseSupply</span><span class="token punctuation">(</span><span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> type<span class="token punctuation">,</span> <span class="token class-name">Supplier</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> other<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token class-name">X</span> <span class="token keyword">extends</span> <span class="token class-name">Throwable</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">T</span> <span class="token function">getOrElseThrow</span><span class="token punctuation">(</span><span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> type<span class="token punctuation">,</span> <span class="token class-name">Supplier</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">X</span><span class="token punctuation">&gt;</span></span> exceptionSupplier<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">X</span><span class="token punctuation">;</span>
	<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">boolean</span> <span class="token function">isRegistered</span><span class="token punctuation">(</span><span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> type<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><code>BootstrapContext</code> 是一个简单的引导上下文，它在启动期间以及环境后处理过程中可用，直到应用上下文 <code>ApplicationContext</code> 准备就绪。</p> 
<p>它提供了对可能创建成本高昂的单例的延迟访问，或者在 <code>ApplicationContext</code> 可用之前需要共享的单例。</p> 
<p>它一共包含 <strong>5</strong> 个方法，下面分别来介绍下：</p> 
<h4><a id="312_get__159"></a>3.1.2 get 方法</h4> 
<p><code>get</code> 方法，只有一个参数：</p> 
<ul><li><code>Class&lt;T&gt; type</code> ：实例类型</li></ul> 
<p>该方法用于返回一个指定类型的实例对象。如果类型已在上下文中注册，则从上下文中返回一个实例。如果之前未访问过该实例，则会创建它。</p> 
<p>有关其具体实现，可查看 <strong>3.3</strong> 小节【<code>BootstrapContext</code> 的默认实现】</p> 
<h4><a id="313_getOrElse__169"></a>3.1.3 getOrElse 方法</h4> 
<p><code>getOrElse</code> 方法，包含两个参数：</p> 
<ul><li><code>Class&lt;T&gt; type</code> ：实例类型</li><li><code>T other</code> ：如果上述类型还未注册，则使用该实例进行返回</li></ul> 
<p>该方法用于返回一个指定类型的实例对象。如果类型已在上下文中注册，则从上下文中返回一个实例。如果之前未注册过该实例，则直接用第二个参数 other 进行返回【<strong>这里跟 <code>get</code> 方法有所区别</strong>】。</p> 
<p>有关其具体实现，可查看 <strong>3.3</strong> 小节【<code>BootstrapContext</code> 的默认实现】</p> 
<h4><a id="314_getOrElseSupply__178"></a>3.1.4 getOrElseSupply 方法</h4> 
<p><code>getOrElseSupply</code> 方法，也包含两个参数：</p> 
<ul><li><code>Class&lt;T&gt; type</code> ：实例类型</li><li><code>Supplier&lt;T&gt; other</code> ：如果上述类型还未注册，则使用该提供者返回指定实例对象</li></ul> 
<p>该方法用于返回一个指定类型的实例对象。如果类型已在上下文中注册，则从上下文中返回一个实例。如果之前未注册过该实例，则用 <code>other.get()</code> 进行返回【<strong>这里类似 <code>getOrElse</code> 方法，其实默认实现中 <code>getOrElse</code> 就是调用 <code>getOrElseSupply</code> 进行返回的</strong>】。</p> 
<p>有关其具体实现，可查看 <strong>3.3</strong> 小节【<code>BootstrapContext</code> 的默认实现】</p> 
<h4><a id="315_getOrElseThrow__188"></a>3.1.5 getOrElseThrow 方法</h4> 
<p><code>getOrElseThrow</code> 方法，同样也包含两个参数：</p> 
<ul><li><code>Class&lt;T&gt; type</code> ：实例类型</li><li><code>Supplier&lt;? extends X&gt; exceptionSupplier</code> ：如果上述类型还未注册，则使用该提供者抛出指定的异常</li></ul> 
<p><code>X</code> 是 <code>Throwable</code> 的子类，如果上述类型还未注册过，则将抛出 <code>X</code> 或者 <code>X</code> 的子类。</p> 
<p>该方法用于返回一个指定类型的实例对象。如果类型已在上下文中注册，则从上下文中返回一个实例。如果之前未注册过该实例，则通过 <code>throw exceptionSupplier.get()</code> 将指定异常抛出【这个在 默认实现 <code>DefaultBootstrapContext</code> 中即可看到】。</p> 
<h4><a id="316_isRegistered__197"></a>3.1.6 isRegistered 方法</h4> 
<p><code>isRegistered</code> 方法，只有一个参数：</p> 
<ul><li><code>Class&lt;T&gt; type</code> ：实例类型</li></ul> 
<p>该方法用于判断指定的类型是否已经被注册过。如果已经在上下文中注册过了，则返回 true；否则，返回false。</p> 
<p>有关其具体实现，可查看 <strong>3.3</strong> 小节【<code>BootstrapContext</code> 的默认实现】</p> 
<h3><a id="32_ConfigurableBootstrapContext_206"></a>3.2 ConfigurableBootstrapContext</h3> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">ConfigurableBootstrapContext</span> <span class="token keyword">extends</span> <span class="token class-name">BootstrapRegistry</span><span class="token punctuation">,</span> <span class="token class-name">BootstrapContext</span> <span class="token punctuation">{<!-- --></span>

<span class="token punctuation">}</span>
</code></pre> 
<p>通过阅读 <code>ConfigurableBootstrapContext</code> 源码，我们可以看到它继承了 <code>BootstrapRegistry</code> 和 <code>BootstrapContext</code> 接口。这也就意味着 <code>ConfigurableBootstrapContext</code> 接口同时拥有了这两者的所有功能，即它是一个可配置的引导上下文。</p> 
<p>对于开发人员来讲，只需要实现这个接口，并编写相应实现代码，就可以来配置和管理应用程序的引导过程。当然 <strong>Spring Boot</strong> 显然已经帮我们考虑了，这也就是下面 <strong>Huazie</strong> 将要介绍的引导上下文的默认实现 <code>DefaultBootstrapContext</code>。</p> 
<h3><a id="33_DefaultBootstrapContext_217"></a>3.3 DefaultBootstrapContext</h3> 
<p>在 <a href="https://huazie.blog.csdn.net/article/details/134515191" rel="nofollow">《BootstrapRegistryInitializer 详解》</a> 的 3.1 小节，我们提到了 <code>BootstrapRegistry</code> 的一个默认实现 <code>DefaultBootstrapContext</code> ，下面我们就来深入分析一下。</p> 
<h4><a id="331__221"></a>3.3.1 源码初识</h4> 
<p>话不多说，直接翻看对应的源码：</p> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DefaultBootstrapContext</span> <span class="token keyword">implements</span> <span class="token class-name">ConfigurableBootstrapContext</span> <span class="token punctuation">{<!-- --></span>

	<span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Class</span><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span><span class="token punctuation">,</span> <span class="token class-name">InstanceSupplier</span><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> instanceSuppliers <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Class</span><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> instances <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">ApplicationEventMulticaster</span> events <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SimpleApplicationEventMulticaster</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">// 实现 BootstrapRegistry 接口中的方法</span>

	<span class="token comment">// 实现 BootstrapContext 接口中的方法</span>

	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">close</span><span class="token punctuation">(</span><span class="token class-name">ConfigurableApplicationContext</span> applicationContext<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>events<span class="token punctuation">.</span><span class="token function">multicastEvent</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BootstrapContextClosedEvent</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> applicationContext<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>上述源码中，<strong>Huazie</strong> 省略了有关实现 <code>BootstrapRegistry</code> 或 <code>BootstrapContext</code> 接口中的方法，这些内容将会在下面的小节详细深入分析。</p> 
<p>我们从类开头，一下子就能看到三个私有的，不可变的成员变量：</p> 
<ul><li><code>Map&lt;Class&lt;?&gt;, InstanceSupplier&lt;?&gt;&gt; instanceSuppliers</code> ：这是个 <code>HashMap</code>，它的键是 <code>Class</code> 对象，值是 <code>InstanceSupplier</code> 对象【它是 <code>BootstrapRegistry</code> 中一个内部接口类，用于提供实际的实例，具体内容可以查看 <strong>Huazie</strong> 的上一篇博文 】</li><li><code>Map&lt;Class&lt;?&gt;, Object&gt; instances</code> ：这同样也是个 <code>HashMap</code>，它的键是 <code>Class</code> 对象，值是 <code>Object</code> 对象【即对应的实际实例对象】</li><li><code>ApplicationEventMulticaster events</code> ：它是 <code>Spring</code> 框架中的一个组件，用于管理和广播应用程序事件。<code>SimpleApplicationEventMulticaster</code> 是其一个简单的实现。</li></ul> 
<blockquote> 
 <p><strong>注意：</strong> <code>SimpleApplicationEventMulticaster</code> 会将所有的事件广播给所有已注册的监听器，而由监听器自行决定忽略它们不感兴趣的事件。监听器通常会在传入的事件对象上进行相应的 <code>instanceof</code> 检查。<br> 默认情况下，所有的监听器都在调用线程中被调用。这允许存在一个恶意的监听器阻塞整个应用程序的风险，但增加了最小的开销。如果指定了替代的任务执行器，可以让监听器在不同的线程中执行，例如来自一个线程池。</p> 
</blockquote> 
<h4><a id="332__BootstrapRegistry__253"></a>3.3.2 实现 BootstrapRegistry 接口中的方法</h4> 
<p>在 <a href="https://blog.csdn.net/u012855229/article/details/135937639">《BootstrapRegistry 详解》</a>中，我们已经了解相关的 5 个方法，下面直接看 <code>DefaultBootstrapContext</code> 中的实现：</p> 
<pre><code class="prism language-java">	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">void</span> <span class="token function">register</span><span class="token punctuation">(</span><span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> type<span class="token punctuation">,</span> <span class="token class-name">InstanceSupplier</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> instanceSupplier<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token function">register</span><span class="token punctuation">(</span>type<span class="token punctuation">,</span> instanceSupplier<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">void</span> <span class="token function">registerIfAbsent</span><span class="token punctuation">(</span><span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> type<span class="token punctuation">,</span> <span class="token class-name">InstanceSupplier</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> instanceSupplier<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token function">register</span><span class="token punctuation">(</span>type<span class="token punctuation">,</span> instanceSupplier<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">private</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">void</span> <span class="token function">register</span><span class="token punctuation">(</span><span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> type<span class="token punctuation">,</span> <span class="token class-name">InstanceSupplier</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> instanceSupplier<span class="token punctuation">,</span> <span class="token keyword">boolean</span> replaceExisting<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">notNull</span><span class="token punctuation">(</span>type<span class="token punctuation">,</span> <span class="token string">"Type must not be null"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">notNull</span><span class="token punctuation">(</span>instanceSupplier<span class="token punctuation">,</span> <span class="token string">"InstanceSupplier must not be null"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">synchronized</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>instanceSuppliers<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			<span class="token keyword">boolean</span> alreadyRegistered <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>instanceSuppliers<span class="token punctuation">.</span><span class="token function">containsKey</span><span class="token punctuation">(</span>type<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>replaceExisting <span class="token operator">||</span> <span class="token operator">!</span>alreadyRegistered<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
				<span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">state</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>instances<span class="token punctuation">.</span><span class="token function">containsKey</span><span class="token punctuation">(</span>type<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> type<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">" has already been created"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword">this</span><span class="token punctuation">.</span>instanceSuppliers<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>type<span class="token punctuation">,</span> instanceSupplier<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">boolean</span> <span class="token function">isRegistered</span><span class="token punctuation">(</span><span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> type<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">synchronized</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>instanceSuppliers<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			<span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>instanceSuppliers<span class="token punctuation">.</span><span class="token function">containsKey</span><span class="token punctuation">(</span>type<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	<span class="token annotation punctuation">@Override</span>
	<span class="token annotation punctuation">@SuppressWarnings</span><span class="token punctuation">(</span><span class="token string">"unchecked"</span><span class="token punctuation">)</span>
	<span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">InstanceSupplier</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token function">getRegisteredInstanceSupplier</span><span class="token punctuation">(</span><span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> type<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">synchronized</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>instanceSuppliers<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			<span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token class-name">InstanceSupplier</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">)</span> <span class="token keyword">this</span><span class="token punctuation">.</span>instanceSuppliers<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>type<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">addCloseListener</span><span class="token punctuation">(</span><span class="token class-name">ApplicationListener</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">BootstrapContextClosedEvent</span><span class="token punctuation">&gt;</span></span> listener<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>events<span class="token punctuation">.</span><span class="token function">addApplicationListener</span><span class="token punctuation">(</span>listener<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
</code></pre> 
<p>翻看上述源码，我们可以看到除了 <code>addCloseListener</code> 方法，其他方法中都使用 <code>synchronized</code> 关键字了，而这里同步的对象就是上面提到的 <code>instanceSuppliers</code>。因为 <code>instanceSuppliers</code> 是 <code>HashMap</code>，它并不是线程安全的，为了防止多个线程同时修改 <code>instanceSuppliers</code> 对象，导致数据不一致的问题，这里就需要对该对象进行同步，保证在同一时刻只有一个线程可以访问该代码块。</p> 
<p>从源码中，我们可以看出 <code>register</code> 和 <code>registerIfAbsent</code> 方法的区别：</p> 
<p><code>registerIfAbsent</code> 只会在该类型尚未注册过时，才注册该类型。而 <code>register</code> 即使该类型已经注册过了，也会重新注册该类型。</p> 
<p><code>isRegistered</code> 方法比较特殊，它在 <code>BootstrapRegistry</code> 和 <code>BootstrapContext</code> 接口中均可以看到。其实现也不难理解，通过 <code>Map</code> 的 <code>containsKey</code> 方法，判断给定类型是否已注册。如果给定类型已经注册，则返回 <code>true</code>，否则，返回 <code>false</code>。</p> 
<p><code>getRegisteredInstanceSupplier</code> 方法也比较简单，直接从 <code>instanceSuppliers</code> 中获取指定类型的供应者。</p> 
<p><code>addCloseListener</code> 方法，用于添加一个监听器，该监听器用于监听 <code>BootstrapContextClosedEvent</code>，这块后续 <strong>Huazie</strong> 会带大家实践一下。</p> 
<h4><a id="333__BootstrapContext__313"></a>3.3.3 实现 BootstrapContext 接口中的方法</h4> 
<pre><code class="prism language-java">	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">T</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> type<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IllegalStateException</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span> <span class="token function">getOrElseThrow</span><span class="token punctuation">(</span>type<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token keyword">new</span> <span class="token class-name">IllegalStateException</span><span class="token punctuation">(</span>type<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">" has not been registered"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">T</span> <span class="token function">getOrElse</span><span class="token punctuation">(</span><span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> type<span class="token punctuation">,</span> <span class="token class-name">T</span> other<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span> <span class="token function">getOrElseSupply</span><span class="token punctuation">(</span>type<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> other<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">T</span> <span class="token function">getOrElseSupply</span><span class="token punctuation">(</span><span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> type<span class="token punctuation">,</span> <span class="token class-name">Supplier</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> other<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">synchronized</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>instanceSuppliers<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			<span class="token class-name">InstanceSupplier</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> instanceSupplier <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>instanceSuppliers<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>type<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">return</span> <span class="token punctuation">(</span>instanceSupplier <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token function">getInstance</span><span class="token punctuation">(</span>type<span class="token punctuation">,</span> instanceSupplier<span class="token punctuation">)</span> <span class="token operator">:</span> other<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token class-name">X</span> <span class="token keyword">extends</span> <span class="token class-name">Throwable</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">T</span> <span class="token function">getOrElseThrow</span><span class="token punctuation">(</span><span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> type<span class="token punctuation">,</span> <span class="token class-name">Supplier</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">X</span><span class="token punctuation">&gt;</span></span> exceptionSupplier<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">X</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">synchronized</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>instanceSuppliers<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			<span class="token class-name">InstanceSupplier</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> instanceSupplier <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>instanceSuppliers<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>type<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>instanceSupplier <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
				<span class="token keyword">throw</span> exceptionSupplier<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">return</span> <span class="token function">getInstance</span><span class="token punctuation">(</span>type<span class="token punctuation">,</span> instanceSupplier<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	<span class="token annotation punctuation">@SuppressWarnings</span><span class="token punctuation">(</span><span class="token string">"unchecked"</span><span class="token punctuation">)</span>
	<span class="token keyword">private</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">T</span> <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> type<span class="token punctuation">,</span> <span class="token class-name">InstanceSupplier</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> instanceSupplier<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token comment">// 省略 。。。</span>
	<span class="token punctuation">}</span>
	
</code></pre> 
<p>从 <strong>3.1</strong> 小节，我们了解了 <code>BootstrapContext</code> 的 <strong>4</strong> 个获取方法。通过查看上述的源码，我们看到这里只需要分析 <code>getOrElseSupply</code> 和 <code>getOrElseThrow</code> 的实现即可。</p> 
<p>同样在 <code>getOrElseSupply</code> 和 <code>getOrElseThrow</code> 方法中，我们看到了 <code>synchronized (this.instanceSuppliers)</code>，这里同 <strong>3.3.2</strong> 中讲解的一样，都是为了防止多个线程同时修改 <code>instanceSuppliers</code> 对象，导致数据不一致的问题。</p> 
<p><code>getOrElseSupply</code> 方法的实现也比较简单。如果指定类型的供应者存在，则通过 <code>getInstance</code> 方法从这个供应者中获取对应类型的实例对象；否则，直接从提供者 <code>other</code> 参数中获取。</p> 
<p><code>getOrElseThrow</code> 方法的实现也好理解。如果指定类型的供应者不存在，则直接从异常供应者中获取一个异常类，并将该异常抛出去即可；否则，通过 <code>getInstance</code> 方法从这个供应者中获取对应类型的实例对象。</p> 
<p>很显然，上述方法最终都需要使用 <code>getInstance</code> 方法，从供应者中获取对应类型的实例对象。我们来看看相关的源码：</p> 
<pre><code class="prism language-java">	<span class="token class-name">T</span> instance <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">T</span><span class="token punctuation">)</span> <span class="token keyword">this</span><span class="token punctuation">.</span>instances<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>type<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>instance <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		instance <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">T</span><span class="token punctuation">)</span> instanceSupplier<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>instanceSupplier<span class="token punctuation">.</span><span class="token function">getScope</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token class-name">Scope</span><span class="token punctuation">.</span><span class="token constant">SINGLETON</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>instances<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>type<span class="token punctuation">,</span> instance<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> instance<span class="token punctuation">;</span>
</code></pre> 
<p>简单总结如下：</p> 
<ul><li>首先，从 <code>instances</code> 中获取指定类型的实例对象 <code>instance</code> 。</li><li>接着，如果 <code>instance</code> 不存在，则继续。 
  <ul><li>从实例供应者 <code>instanceSupplier</code> 中获取一个实例对象，并赋值给 <code>instance</code>；</li><li>如果实例供应者 <code>instanceSupplier</code> 指定的作用域是单例，则将获取的实例对象添加到 <code>instances</code> 中，方便后续直接获取。</li></ul> </li><li>最后，直接返回指定类型的实例对象 <code>instance</code>。</li></ul> 
<h4><a id="334_close__381"></a>3.3.4 close 方法</h4> 
<p>当 <code>BootstrapContext</code> 被关闭且 <code>ApplicationContext</code> 已准备好时，该方法将被调用【后续笔者讲解 <strong>Spring Boot</strong> 的启动引导过程会涉及到】。</p> 
<p>通过阅读源码，我们可以看到这里触发了一个名为 <code>BootstrapContextClosedEvent</code> 的事件，该事件会多播给所有注册了该事件的监听器，而这些监听器就是通过 <strong>3.3.2</strong> 小节中提到的 <code>addCloseListener</code> 方法添加的【后续 <strong>Huazie</strong> 会带大家实操一下】。</p> 
<h2><a id="_387"></a>四、总结</h2> 
<p>本篇 <strong>Huazie</strong> 带大家深入了解了 <code>BootstrapContext</code> 及其默认实现，这些内容对我们理解 <strong>Spring Boot</strong> 的启动引导过程至关重要。下篇 <strong>Huazie</strong> 将通过自定义 <code>BootstrapRegistry</code> 初始化器实现，来看看引导上下文在 <strong>Spring Boot</strong> 的启动引导过程中的作用。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/0195ef85fefd5c68941119758329a882/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">网页图片批量下载插件</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/2a2d595e6ed9a0b24f027f2b63b134d6/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">spring</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 追风少年的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>