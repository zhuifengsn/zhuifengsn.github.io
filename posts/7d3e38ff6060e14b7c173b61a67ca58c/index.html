<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>数据库和sql优化的几种方式 - 追风少年的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="数据库和sql优化的几种方式" />
<meta property="og:description" content="(1).索引
把数据根据一些算法算出一个值，把数据放入到一个区域内，这个值对应那个区域，来查询数据的时候，可以快速的根据数据值定位到某个区域，快速找到某个值。
比如字典，可以根据拼音快速找到某个字，索引就是根据把数据计算完成后放到一个区域内，下次找的时候，直接根据索引去某个区域拿值，这样查询快。
怎么创建索引
通过Navicat工具创建的，当然也可以通过sql创建。
什么时候创建索引
创建表就要创建索引,选定那个字段要创建索引,不要所有字段都创建索引.经常查询或经常当where条件的，创建索引。
使用索引好处 查询快，不好的是进行insert、update、delete的时候慢
因为索引占磁盘空间，降低增删改的性能.所以不能每个字段都创建索引。
最好的方式是实现读写分离，读的时候有索引，写表里没有索引。
索引的方式
问你用什么索引？ 你说BTree（一般用的都是BTree索引）。
为什么不用hash索引呢？ 因为hash索引有算法漏洞，计算出的hash值容易重复，造成索引的值一致，这时候数据就会查询出两条，其实我要是一条，这时就会报错。
索引有单个索引和组合索引,什么时候用哪个? 单个索引和复合索引介绍及优缺点:http://blog.csdn.net/linminqin/article/details/44342205
单个索引什么时候失效？ 使用like语句查询失效
组合什么时候失效？比如id和name字段是一个组合索引。 索引失效 id,name
1、顺序颠倒时候失效，如where name=value and id = value这是顺序颠倒
2、使用like语句时候失效
3、如果查询时使用id查询索引不失效，使用name查询会失效 如where name=value 索引失效 如where id=value 索引不失效
索引遵循最左原则，也就是说，组合索引是从左往右查询数据的，最左边属性必须有，跳属性就不管用，数据查不到 在使用like语句查询时失效
Id，name，age == 算法算完后会计算出一个值 12345678
查询条件1：id，age索引失效吗？失效
查询条件2：id,name索引失效吗？不失效
查询条件3：name,age索引失效吗？失效
查询条件4：name,id索引失效吗？失效
查询条件5：id索引失效吗？不失效
索引的类型有哪些？
一般索引（normal）：可重复的，存可重复数据的时候可以使用
唯一索引（unique）：存的数据是不可重复的，身份证号的时候使用使用，唯一索引不可重复
全文索引（fulltext）：存大的字段值时使用，我存一篇文章，我想要搜索搜索数据，这时候用这个fulltext索引查询的会比较快
你怎么知道索引创建完成后，查询时有没有用到索引呢？ 可以用explain关键字可以看到索引有没有问题。索引有没有生效。
你已经创建索引了，可还是慢，到底是索引的问题呢？还是数据量大的问题呢？ 你怎么用explain的。写sql语句前面跟一个explain关键字就可以 你看explain里面的什么东西，怎么知道它有没有效果的？ 1、看key可以看到它有没有用到索引
2、Rows 看看数据到底扫描了多少行
3、Type看看有没有执行全表扫描，如果执行全表扫描肯定就慢了 既然索引没问题，那就是数据量大呗？你怎么进行优化？
1、加redis缓存
2、分库分表，根据插入的时间拆分表
(2)sql本身优化
不用*,少用函数和like,不用嵌套语句，大sql拆小sql等
这个博客很详细了:http://blog.csdn.net/jie_liang/article/details/77340905
(3)加冗余字段
优化前：" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://zhuifengsn.github.io/posts/7d3e38ff6060e14b7c173b61a67ca58c/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2019-04-16T14:15:47+08:00" />
<meta property="article:modified_time" content="2019-04-16T14:15:47+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="追风少年的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">追风少年的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">数据库和sql优化的几种方式</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-dracula">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p><strong>(1).索引</strong></p> 
<blockquote> 
 <p>把数据根据一些算法算出一个值，把数据放入到一个区域内，这个值对应那个区域，来查询数据的时候，可以快速的根据数据值定位到某个区域，快速找到某个值。<br> 比如字典，可以根据拼音快速找到某个字，索引就是根据把数据计算完成后放到一个区域内，下次找的时候，直接根据索引去某个区域拿值，这样查询快。</p> 
</blockquote> 
<p><strong>怎么创建索引</strong></p> 
<blockquote> 
 <p>通过Navicat工具创建的，当然也可以通过sql创建。</p> 
</blockquote> 
<p><strong>什么时候创建索引</strong></p> 
<blockquote> 
 <p>创建表就要创建索引,选定那个字段要创建索引,不要所有字段都创建索引.经常查询或经常当where条件的，创建索引。</p> 
</blockquote> 
<h6><a id="_14"></a>使用索引好处</h6> 
<blockquote> 
 <p>查询快，不好的是进行insert、update、delete的时候慢<br> 因为索引占磁盘空间，降低增删改的性能.所以不能每个字段都创建索引。<br> 最好的方式是实现读写分离，读的时候有索引，写表里没有索引。</p> 
</blockquote> 
<p><strong>索引的方式</strong></p> 
<h6><a id="_20"></a>问你用什么索引？</h6> 
<blockquote> 
 <p>你说BTree（一般用的都是BTree索引）。</p> 
</blockquote> 
<h6><a id="hash_23"></a>为什么不用hash索引呢？</h6> 
<blockquote> 
 <p>因为hash索引有算法漏洞，计算出的hash值容易重复，造成索引的值一致，这时候数据就会查询出两条，其实我要是一条，这时就会报错。</p> 
</blockquote> 
<h6><a id="_27"></a>索引有单个索引和组合索引,什么时候用哪个?</h6> 
<p>单个索引和复合索引介绍及优缺点:<a href="http://blog.csdn.net/linminqin/article/details/44342205">http://blog.csdn.net/linminqin/article/details/44342205</a></p> 
<h6><a id="_29"></a>单个索引什么时候失效？</h6> 
<blockquote> 
 <p>使用like语句查询失效</p> 
</blockquote> 
<h6><a id="idname_33"></a>组合什么时候失效？比如id和name字段是一个组合索引。</h6> 
<blockquote> 
 <p>索引失效 id,name</p> 
 <p>1、顺序颠倒时候失效，如where name=value and id = value这是顺序颠倒<br> 2、使用like语句时候失效<br> 3、如果查询时使用id查询索引不失效，使用name查询会失效 如where name=value 索引失效 如where id=value 索引不失效</p> 
 <p><strong>索引遵循最左原则</strong>，也就是说，组合索引是从左往右查询数据的，最左边属性必须有，跳属性就不管用，数据查不到 在使用like语句查询时失效</p> 
 <p>Id，name，age == 算法算完后会计算出一个值 12345678<br> 查询条件1：id，age索引失效吗？失效<br> 查询条件2：id,name索引失效吗？不失效<br> 查询条件3：name,age索引失效吗？失效<br> 查询条件4：name,id索引失效吗？失效<br> 查询条件5：id索引失效吗？不失效</p> 
</blockquote> 
<p><strong>索引的类型有哪些？</strong></p> 
<blockquote> 
 <p>一般索引（normal）：可重复的，存可重复数据的时候可以使用<br> 唯一索引（unique）：存的数据是不可重复的，身份证号的时候使用使用，唯一索引不可重复<br> 全文索引（fulltext）：存大的字段值时使用，我存一篇文章，我想要搜索搜索数据，这时候用这个fulltext索引查询的会比较快</p> 
</blockquote> 
<h6><a id="_56"></a>你怎么知道索引创建完成后，查询时有没有用到索引呢？</h6> 
<blockquote> 
 <p>可以用explain关键字可以看到索引有没有问题。索引有没有生效。</p> 
</blockquote> 
<h6><a id="_60"></a>你已经创建索引了，可还是慢，到底是索引的问题呢？还是数据量大的问题呢？</h6> 
<h6><a id="explainsqlexplain_explain_61"></a>你怎么用explain的。写sql语句前面跟一个explain关键字就可以 你看explain里面的什么东西，怎么知道它有没有效果的？</h6> 
<blockquote> 
 <p>1、看key可以看到它有没有用到索引<br> 2、Rows 看看数据到底扫描了多少行<br> 3、Type看看有没有执行全表扫描，如果执行全表扫描肯定就慢了 既然索引没问题，那就是数据量大呗？你怎么进行优化？<br> 1、加redis缓存<br> 2、分库分表，根据插入的时间拆分表</p> 
</blockquote> 
<p><strong>(2)sql本身优化</strong></p> 
<blockquote> 
 <p>不用*,少用函数和like,不用嵌套语句，大sql拆小sql等<br> 这个博客很详细了:<a href="http://blog.csdn.net/jie_liang/article/details/77340905">http://blog.csdn.net/jie_liang/article/details/77340905</a></p> 
</blockquote> 
<p><strong>(3)加冗余字段</strong></p> 
<blockquote> 
 <p>优化前：<br> 汽车表： id,name,汽车的尺寸，汽车颜色，汽车的生产厂家表的id字段 生产厂家表 id，name，地址信息。</p> 
 <p>我需要展示汽车的信息列表，列表展示信息中需要包含生产厂家时，如果left join，效率会低 如果在单表中查询，速度快，</p> 
 <p>我现在对数据库进行添加冗余字段，对数据库数据优化</p> 
 <p>优化后：<br> 汽车表： id,name,汽车的尺寸，汽车颜色，汽车的生产厂家表的id字段，厂家的名字 生产厂家表 id，name，地址信息。</p> 
 <p>不能所有的字段都加成冗余字段,一定是不常变化的字段为冗余字段</p> 
</blockquote> 
<h6><a id="_87"></a>什么时候可以加冗余字段？什么情况下不可以加呢？</h6> 
<blockquote> 
 <p>如果这个冗余字段的数据经常改变，就不建议加冗余字段了</p> 
</blockquote> 
<p><strong>(4)不创建外键,靠代码和sql控制</strong></p> 
<blockquote> 
 <p>安全性要求不是很高，并且数据量很大的时候，可以不需要外键。 银行项目，安全性要求很高的项目是必须用外键的。</p> 
 <p>用外键会降低插入数据的速度，不用外键靠sql和代码控制完全不影响使用。</p> 
</blockquote> 
<p><strong>(5)读写分离，主从复制</strong></p> 
<p><strong>(6)数据库参数调优（专业DBA处理）</strong></p> 
<p><strong>(7)服务器优化（专业运维或项目经理处理）</strong></p> 
<h6><a id="mysql_103"></a>mysql常用的有两种引擎</h6> 
<blockquote> 
 <p>MyISAM引擎是最原始引擎，没有事务，事务控制是在后来添加上的，后来的引擎里有事务控制，这个引擎就是InnoDB。<br> 事务选InnoDB，并发查询的时候，不需要用事务时处理选MyISAM 在不同场景,调用的引擎不一样.</p> 
</blockquote> 
<h6><a id="sql_107"></a>如何去看这个sql有没有用到索引？</h6> 
<blockquote> 
 <p>Sql前面加explain关键字，就可以看到有没有用索引，并且可以看它扫描了多少行数据</p> 
 <p>用explain看性能:<a href="http://blog.csdn.net/u010061060/article/details/52473244">http://blog.csdn.net/u010061060/article/details/52473244</a></p> 
 <p>设置慢查询日志后,它会自动将慢的sql语句收集起来,然后查看慢的sql语句,针对比较慢的sql进行优化.<br> 开启慢查询:<a href="https://www.cnblogs.com/siqi/archive/2012/11/21/2780966.html" rel="nofollow">https://www.cnblogs.com/siqi/archive/2012/11/21/2780966.html</a></p> 
</blockquote> 
<h6><a id="_117"></a>数据库行列转换:</h6> 
<p><a href="http://blog.csdn.net/sinat_27406925/article/details/77507478">http://blog.csdn.net/sinat_27406925/article/details/77507478</a><br> <a href="http://blog.csdn.net/aya19880214/article/details/41280893">http://blog.csdn.net/aya19880214/article/details/41280893</a></p> 
<h6><a id="_122"></a>篇末福利:</h6> 
<h5><a id="_123"></a>大厂面试题</h5> 
<blockquote> 
 <p>1.索引的使用？组合索引的使用？最左原则的使用？索引的各种类型？你是怎么建索引的？<br> 2.为什么用btree，优点是什么？<br> 3. 你举个订单表的例子或购物车的例子怎么创建索引的？ 我们购物车没有用数据库，存redis的，我给你举个创建索引的例子把。<br> 4. 用户关联课程表，用户的id创建索引，课程id创建索引，购买了哪个课程，那我购买表中有用户id和课程id，这两个字段一点有索引，用的是组合索引，索引类型是一般索引。<br> 5. 你说下数据库两个引擎的作用？ 你们数据库的数据量有多少？你们商品表的商品数量有多少？<br> 6.所有表的数据量加起来吗？这个我没算过，我们用户量有五万多，商品数量有十五万多等等自己随口编。 你说下索引的弊端吧？<br> 7.hash有弊端，所以很少使用 mysql默认隔离级别是啥：重复读<br> <a href="https://blog.csdn.net/qq_33290787/article/details/51924963">https://blog.csdn.net/qq_33290787/article/details/51924963</a><br> 8.mysql的存储引擎用的是什么？myisam和innerdb的区别是啥？数据库方面的优化做过吗？<br> 9. 比如我有条sql，发现它执行的比较慢，你怎么进行优化，你的思路是啥？（explain看看性能再说）<br> 10.通过创建索引的方式优化的话，你怎么知道索引有没有用到？你怎么知道它会不会失效？ 数据库索引的长度是多少？你知道索引的结构吗？（b加tree）<br> 11 用索引吗？主键索引和唯一索引的区别是什么？唯一索引的字段可以为null吗？索引的最大长度多少？索引什么时候失效？索引有几种类型？<br> 12 你们是如何做分库分表的？ 我们项目目前没有用到或说我们做了读写分离</p> 
 <p>13mysql的四种隔离级别说下，事务的隔离级别谁高谁低？</p> 
 <p>14说下mysql优化。用到哪个引擎，哪个版本呢？哪些字段加索引？ 什么情况下加索引，对应哪些字段。</p> 
 <p>15一个是聚簇索引，一个是非聚簇索引，了解吗？</p> 
 <p>16 说下mysql的索引。索引的具体作用。 mysql分页说下它怎么使用的，并说下后面两个参数的作用。 Limit 第一个是第几页；第二个是每页多少条<br> 17. 如何测试sql的性能（explain） sql优化具体是如何做的？在什么场景下使用了？ 创建索引，加冗余，说十五条sql优化知识。<br> 18.课程详情页的使用场景，关联了多张表。<br> 19.你用过什么数据库？左连接、右连接和全连接的作用和比较和区别。 知道mysql的引擎吧，有啥区别？<br> 20.说下sql语句优化 数据库表你设计过吗？说下你是怎么设计的？<br> 21.sql优化说下。 平时用什么数据库？ sql的优化会吗?<br> 这个sql是正常跑的，我想给他进行优化，你会怎么进行优化？怎么知道sql有没有优化的空间？<br> 22. 写sql写的多吗？ 错误回答：sql都是工具类生成的，sql不需要自己写，直接调用工具就行。<br> 23.索引的使用，组合索引的使用，最左原则的使用，索引的各种类型，你是怎么建索引的，你举个订单表的例子或购物车的例子怎么创建索引的，为什么用btree，优点是什么？<br> 24.了解过数据库的存储过程吗？ sql的存储过程使用。 说下分布式事务吗？ 事务和锁有什么关系吗？ 悲观锁和乐观锁的区别说下。<br> 25.join的性能有了解过吗？ 阿里有个技术开发规范了解吗？（阿里开发手册里有，自己看）<br> 26.阿里说一般join关联不让超过三个表，太慢。一般用mybatis的conlletion的关联做处理。<br> 27.数据库死锁怎么造成的? 分布式事务是如何处理的 悲观锁和乐观锁说下是怎么用的。<br> 28.数据库锁了解吗？介绍下悲观和乐观锁。代码层面最简单的乐观锁使用。 数据库引擎了解吗？数据库的行级锁和表级锁了解吗？</p> 
</blockquote>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/6cab3a0041e69035888c38229e827ad1/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">R语言因子分析</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/ddcbb6790c7b292c12aad504881705e4/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">RGB三通道图像和灰度值简单理解</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 追风少年的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>