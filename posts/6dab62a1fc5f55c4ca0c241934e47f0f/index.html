<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>.NET中使用GridView控件输入数据时出现“ Index was out of range. Must be non-negative and less than the size of the... - 追风少年的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content=".NET中使用GridView控件输入数据时出现“ Index was out of range. Must be non-negative and less than the size of the..." />
<meta property="og:description" content="在.NET中使用GridView控件的在线编辑数据时，出现了“ Index was out of range. Must be non-negative and less than the size of the collection. Parameter name: index&#34;的关于数据索引值错误的问题，在网上查了许多，感觉都没有什么文章是直接指出解决问题的方法，先就总结下吧
其实，这个问题在操作时是需要非常注意的，它并不在GridView控件的RowEditing或者RowUpdating方法中，而是需要在获取数据的类中指定GridView控件的主键，后台代码如部分如下：
1 using System; 2 using System.Collections.Generic; 3 using System.Linq; 4 using System.Web; 5 using System.Web.UI; 6 using System.Web.UI.WebControls; 7 using System.Data; 8 using System.Data.SqlClient; 9 using System.Configuration; 10 11 namespace UI 12 { 13 public partial class _Default : System.Web.UI.Page 14 { 15 protected void Page_Load(object sender, EventArgs e) 16 { 17 //判断是否第一次加载Bind()类 18 if (!" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://zhuifengsn.github.io/posts/6dab62a1fc5f55c4ca0c241934e47f0f/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2014-04-17T14:13:00+08:00" />
<meta property="article:modified_time" content="2014-04-17T14:13:00+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="追风少年的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">追风少年的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">.NET中使用GridView控件输入数据时出现“ Index was out of range. Must be non-negative and less than the size of the...</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <div id="cnblogs_post_body" class="blogpost-body"> 
 <p>在.NET中使用GridView控件的在线编辑数据时，出现了“ Index was out of range. Must be non-negative and less than the size of the collection. Parameter name: index"的关于数据索引值错误的问题，在网上查了许多，感觉都没有什么文章是直接指出解决问题的方法，先就总结下吧</p> 
 <p>其实，这个问题在操作时是需要非常注意的，它并不在GridView控件的RowEditing或者RowUpdating方法中，而是需要在获取数据的类中指定GridView控件的主键，后台代码如部分如下：</p> 
 <p> </p> 
 <div class="cnblogs_code"> 
  <pre><span style="color:#008080;">  1</span> <span style="color:#0000ff;">using</span><span style="color:#000000;"> System;
</span><span style="color:#008080;">  2</span> <span style="color:#0000ff;">using</span><span style="color:#000000;"> System.Collections.Generic;
</span><span style="color:#008080;">  3</span> <span style="color:#0000ff;">using</span><span style="color:#000000;"> System.Linq;
</span><span style="color:#008080;">  4</span> <span style="color:#0000ff;">using</span><span style="color:#000000;"> System.Web;
</span><span style="color:#008080;">  5</span> <span style="color:#0000ff;">using</span><span style="color:#000000;"> System.Web.UI;
</span><span style="color:#008080;">  6</span> <span style="color:#0000ff;">using</span><span style="color:#000000;"> System.Web.UI.WebControls;
</span><span style="color:#008080;">  7</span> <span style="color:#0000ff;">using</span><span style="color:#000000;"> System.Data;
</span><span style="color:#008080;">  8</span> <span style="color:#0000ff;">using</span><span style="color:#000000;"> System.Data.SqlClient;
</span><span style="color:#008080;">  9</span> <span style="color:#0000ff;">using</span><span style="color:#000000;"> System.Configuration;
</span><span style="color:#008080;"> 10</span> 
<span style="color:#008080;"> 11</span> <span style="color:#0000ff;">namespace</span><span style="color:#000000;"> UI
</span><span style="color:#008080;"> 12</span> <span style="color:#000000;">{
</span><span style="color:#008080;"> 13</span>     <span style="color:#0000ff;">public</span> <span style="color:#0000ff;">partial</span> <span style="color:#0000ff;">class</span><span style="color:#000000;"> _Default : System.Web.UI.Page
</span><span style="color:#008080;"> 14</span> <span style="color:#000000;">    {
</span><span style="color:#008080;"> 15</span>         <span style="color:#0000ff;">protected</span> <span style="color:#0000ff;">void</span> Page_Load(<span style="color:#0000ff;">object</span><span style="color:#000000;"> sender, EventArgs e)
</span><span style="color:#008080;"> 16</span> <span style="color:#000000;">        {
</span><span style="color:#008080;"> 17</span>             <span style="color:#008000;">//</span><span style="color:#008000;">判断是否第一次加载Bind()类</span>
<span style="color:#008080;"> 18</span>             <span style="color:#0000ff;">if</span> (!<span style="color:#000000;">IsPostBack)
</span><span style="color:#008080;"> 19</span> <span style="color:#000000;">            {
</span><span style="color:#008080;"> 20</span> <span style="color:#000000;">                Bind();
</span><span style="color:#008080;"> 21</span> <span style="color:#000000;">            }
</span><span style="color:#008080;"> 22</span> <span style="color:#000000;">        }
</span><span style="color:#008080;"> 23</span> 
<span style="color:#008080;"> 24</span>         <span style="color:#808080;">///</span> <span style="color:#808080;">&lt;summary&gt;</span><span style="color:#008000;">创建返回数据库连接的公共类
</span><span style="color:#008080;"> 25</span>         <span style="color:#808080;">///</span> <span style="color:#808080;">&lt;/summary&gt;</span>
<span style="color:#008080;"> 26</span>         <span style="color:#808080;">///</span> <span style="color:#808080;">&lt;returns&gt;</span><span style="color:#008000;">返回连接数据库的类</span><span style="color:#808080;">&lt;/returns&gt;</span>
<span style="color:#008080;"> 27</span>         <span style="color:#0000ff;">public</span><span style="color:#000000;"> SqlConnection GetConnection()
</span><span style="color:#008080;"> 28</span> <span style="color:#000000;">        {
</span><span style="color:#008080;"> 29</span>                 <span style="color:#0000ff;">string</span> str_conn = ConfigurationManager.AppSettings[<span style="color:#800000;">"</span><span style="color:#800000;">myConStr</span><span style="color:#800000;">"</span><span style="color:#000000;">].ToString();
</span><span style="color:#008080;"> 30</span>                 SqlConnection myConn = <span style="color:#0000ff;">new</span><span style="color:#000000;"> SqlConnection(str_conn);
</span><span style="color:#008080;"> 31</span>                 <span style="color:#0000ff;">return</span><span style="color:#000000;"> myConn;
</span><span style="color:#008080;"> 32</span> <span style="color:#000000;">        }
</span><span style="color:#008080;"> 33</span> 
<span style="color:#008080;"> 34</span>         <span style="color:#808080;">///</span> <span style="color:#808080;">&lt;summary&gt;</span><span style="color:#008000;">将查询的数据绑定到GridView控件中
</span><span style="color:#008080;"> 35</span>         <span style="color:#808080;">///</span> <span style="color:#808080;">&lt;/summary&gt;</span>
<span style="color:#008080;"> 36</span>         <span style="color:#0000ff;">public</span> <span style="color:#0000ff;">void</span><span style="color:#000000;"> Bind()
</span><span style="color:#008080;"> 37</span> <span style="color:#000000;">        {     
</span><span style="color:#008080;"> 38</span>             <span style="color:#0000ff;">try</span>
<span style="color:#008080;"> 39</span> <span style="color:#000000;">            {
</span><span style="color:#008080;"> 40</span>                 SqlConnection myConn =<span style="color:#000000;"> GetConnection();
</span><span style="color:#008080;"> 41</span> <span style="color:#000000;">                myConn.Open();
</span><span style="color:#008080;"> 42</span> 
<span style="color:#008080;"> 43</span>                 <span style="color:#0000ff;">string</span> sql_Str = <span style="color:#800000;">"</span><span style="color:#800000;">select * from stuInfo order by stuAge desc</span><span style="color:#800000;">"</span><span style="color:#000000;">;
</span><span style="color:#008080;"> 44</span> 
<span style="color:#008080;"> 45</span>                 SqlDataAdapter myda = <span style="color:#0000ff;">new</span><span style="color:#000000;"> SqlDataAdapter(sql_Str, myConn);
</span><span style="color:#008080;"> 46</span>                 DataSet myDs = <span style="color:#0000ff;">new</span><span style="color:#000000;"> DataSet();
</span><span style="color:#008080;"> 47</span> <span style="color:#000000;">                myda.Fill(myDs);
</span><span style="color:#008080;"> 48</span> 
<span style="color:#008080;"> 49</span>                 GridView1.DataSource =<span style="color:#000000;"> myDs;
</span><span style="color:#008080;"> 50</span> 
<span style="color:#008080;"> 51</span>                 <span style="color:#008000;">//</span><span style="color:#008000;">为GridView控件设置主键，此处必须有否则会产生如下代码中的溢出错误</span>
<span style="color:#008080;"> 52</span>                 <span style="color:#008000;">/*</span>
<span style="color:#008080;"> 53</span> <span style="color:#008000;">                 * Index was out of range. Must be non-negative and less than the size of the collection.
</span><span style="color:#008080;"> 54</span> <span style="color:#008000;">                  Parameter name: index 
</span><span style="color:#008080;"> 55</span>                  <span style="color:#008000;">*/</span>
<span style="color:#008080;"> 56</span>                <strong><span style="color:#ff0000;"> GridView1.DataKeyNames = new string[] { "stuNo" };//GridView</span></strong><span style="color:#ff0000;">控件设置主键，此处最为关键，稍不留意就忘掉了，切记呀</span>
<span style="color:#008080;"> 57</span> <span style="color:#000000;">                GridView1.DataBind();
</span><span style="color:#008080;"> 58</span> 
<span style="color:#008080;"> 59</span> <span style="color:#000000;">                myDs.Dispose();
</span><span style="color:#008080;"> 60</span> <span style="color:#000000;">                myda.Dispose();
</span><span style="color:#008080;"> 61</span> <span style="color:#000000;">                myConn.Close();
</span><span style="color:#008080;"> 62</span> <span style="color:#000000;">            }
</span><span style="color:#008080;"> 63</span>             <span style="color:#0000ff;">catch</span><span style="color:#000000;"> (Exception ex)
</span><span style="color:#008080;"> 64</span> <span style="color:#000000;">            {
</span><span style="color:#008080;"> 65</span> <span style="color:#000000;">                Response.Write(ex.Message);
</span><span style="color:#008080;"> 66</span> <span style="color:#000000;">            }
</span><span style="color:#008080;"> 67</span> <span style="color:#000000;">        }
</span><span style="color:#008080;"> 68</span> 
<span style="color:#008080;"> 69</span>         <span style="color:#808080;">///</span> <span style="color:#808080;">&lt;summary&gt;</span><span style="color:#008000;">创建GridView控件的RowEditing事件类
</span><span style="color:#008080;"> 70</span>         <span style="color:#808080;">///</span> <span style="color:#808080;">&lt;/summary&gt;</span>
<span style="color:#008080;"> 71</span>         <span style="color:#808080;">///</span> <span style="color:#808080;">&lt;param name="sender"&gt;&lt;/param&gt;</span>
<span style="color:#008080;"> 72</span>         <span style="color:#808080;">///</span> <span style="color:#808080;">&lt;param name="e"&gt;&lt;/param&gt;</span>
<span style="color:#008080;"> 73</span>         <span style="color:#0000ff;">protected</span> <span style="color:#0000ff;">void</span> GridView1_RowEditing(<span style="color:#0000ff;">object</span><span style="color:#000000;"> sender, GridViewEditEventArgs e)
</span><span style="color:#008080;"> 74</span> <span style="color:#000000;">        {
</span><span style="color:#008080;"> 75</span>             GridView1.EditIndex =<span style="color:#000000;"> e.NewEditIndex;
</span><span style="color:#008080;"> 76</span>             <span style="color:#0000ff;">this</span><span style="color:#000000;">.Bind();
</span><span style="color:#008080;"> 77</span> <span style="color:#000000;">        }
</span><span style="color:#008080;"> 78</span> 
<span style="color:#008080;"> 79</span>         <span style="color:#808080;">///</span> <span style="color:#808080;">&lt;summary&gt;</span><span style="color:#008000;">创建GridView控件的RowUpdating事件类
</span><span style="color:#008080;"> 80</span>         <span style="color:#808080;">///</span> <span style="color:#808080;">&lt;/summary&gt;</span>
<span style="color:#008080;"> 81</span>         <span style="color:#808080;">///</span> <span style="color:#808080;">&lt;param name="sender"&gt;&lt;/param&gt;</span>
<span style="color:#008080;"> 82</span>         <span style="color:#808080;">///</span> <span style="color:#808080;">&lt;param name="e"&gt;&lt;/param&gt;</span>
<span style="color:#008080;"> 83</span>         <span style="color:#0000ff;">protected</span> <span style="color:#0000ff;">void</span> GridView1_RowUpdating(<span style="color:#0000ff;">object</span><span style="color:#000000;"> sender, GridViewUpdateEventArgs e)
</span><span style="color:#008080;"> 84</span> <span style="color:#000000;">        {
</span><span style="color:#008080;"> 85</span>             <span style="color:#0000ff;">try</span>
<span style="color:#008080;"> 86</span> <span style="color:#000000;">            {
</span><span style="color:#008080;"> 87</span>                 <span style="color:#008000;">//</span><span style="color:#008000;">获取在GridView控件里相关事件的键值</span>
<span style="color:#008080;"> 88</span>                 <span style="color:#0000ff;">int</span> stuNum =<span style="color:#000000;"> Convert.ToInt32(GridView1.DataKeys[e.RowIndex].Value.ToString());
</span><span style="color:#008080;"> 89</span>                 <span style="color:#0000ff;">string</span> newName = ((TextBox)(GridView1.Rows[e.RowIndex].Cells[<span style="color:#800080;">1</span>].Controls[<span style="color:#800080;">0</span><span style="color:#000000;">])).Text.ToString();
</span><span style="color:#008080;"> 90</span> 
<span style="color:#008080;"> 91</span>                 SqlConnection myConn =<span style="color:#000000;"> GetConnection();
</span><span style="color:#008080;"> 92</span> <span style="color:#000000;">                myConn.Open();
</span><span style="color:#008080;"> 93</span> 
<span style="color:#008080;"> 94</span>                 <span style="color:#008000;">/*</span>
<span style="color:#008080;"> 95</span> <span style="color:#008000;">                 * string sql_str = "update stuInfo set stuName='" + newName + "' where stuNo='" + stuNum + "'";
</span><span style="color:#008080;"> 96</span> <span style="color:#008000;">                 *与上句相比，以下使用带参数的SQL语句在一定程度上可防止SQL注入攻击
</span><span style="color:#008080;"> 97</span>                 <span style="color:#008000;">*/</span>
<span style="color:#008080;"> 98</span>                 <span style="color:#0000ff;">string</span> sql_str = <span style="color:#800000;">"</span><span style="color:#800000;">update stuInfo set stuName=@newName where stuNo=@stuNum</span><span style="color:#800000;">"</span><span style="color:#000000;">;
</span><span style="color:#008080;"> 99</span>                 SqlCommand myCmd = <span style="color:#0000ff;">new</span><span style="color:#000000;"> SqlCommand(sql_str, myConn);
</span><span style="color:#008080;">100</span>                 myCmd.Parameters.Add(<span style="color:#800000;">"</span><span style="color:#800000;">@newName</span><span style="color:#800000;">"</span>, SqlDbType.NVarChar).Value =<span style="color:#000000;"> newName;
</span><span style="color:#008080;">101</span>                 myCmd.Parameters.Add(<span style="color:#800000;">"</span><span style="color:#800000;">@stuNum</span><span style="color:#800000;">"</span>, SqlDbType.VarChar).Value =<span style="color:#000000;"> stuNum;
</span><span style="color:#008080;">102</span> 
<span style="color:#008080;">103</span>                 <span style="color:#0000ff;">if</span> (myCmd.ExecuteNonQuery() &gt; <span style="color:#800080;">0</span><span style="color:#000000;">)
</span><span style="color:#008080;">104</span> <span style="color:#000000;">                {
</span><span style="color:#008080;">105</span>                     Response.Write(<span style="color:#800000;">"</span><span style="color:#800000;">&lt;script type='text/javascript'&gt;alert('更新成功');&lt;/script&gt;</span><span style="color:#800000;">"</span><span style="color:#000000;">);
</span><span style="color:#008080;">106</span> <span style="color:#000000;">                }
</span><span style="color:#008080;">107</span>                 <span style="color:#0000ff;">else</span>
<span style="color:#008080;">108</span> <span style="color:#000000;">                {
</span><span style="color:#008080;">109</span>                     Response.Write(<span style="color:#800000;">"</span><span style="color:#800000;">&lt;script type='text/javascript'&gt;alert('更新失败');&lt;/script&gt;</span><span style="color:#800000;">"</span><span style="color:#000000;">);
</span><span style="color:#008080;">110</span> <span style="color:#000000;">                }
</span><span style="color:#008080;">111</span> 
<span style="color:#008080;">112</span>                 <span style="color:#008000;">//</span><span style="color:#008000;">调试用</span>
<span style="color:#008080;">113</span>                 textbox1.Text = <span style="color:#800000;">"</span><span style="color:#800000;">学号：</span><span style="color:#800000;">"</span> + stuNum + <span style="color:#800000;">"</span><span style="color:#800000;"> , 姓名：</span><span style="color:#800000;">"</span> + newName + <span style="color:#800000;">"</span><span style="color:#800000;">, </span><span style="color:#800000;">"</span> + sql_str + <span style="color:#800000;">"</span><span style="color:#800000;">, ExecuteNonQuery状态：</span><span style="color:#800000;">"</span> +<span style="color:#000000;"> myCmd.ExecuteNonQuery();
</span><span style="color:#008080;">114</span> 
<span style="color:#008080;">115</span> <span style="color:#000000;">                myCmd.Dispose();
</span><span style="color:#008080;">116</span> <span style="color:#000000;">                myConn.Close();
</span><span style="color:#008080;">117</span>                 GridView1.EditIndex = -<span style="color:#800080;">1</span><span style="color:#000000;">;
</span><span style="color:#008080;">118</span>                 <span style="color:#0000ff;">this</span><span style="color:#000000;">.Bind();
</span><span style="color:#008080;">119</span> <span style="color:#000000;">            }
</span><span style="color:#008080;">120</span>             <span style="color:#0000ff;">catch</span><span style="color:#000000;"> (Exception ex)
</span><span style="color:#008080;">121</span> <span style="color:#000000;">            {
</span><span style="color:#008080;">122</span> <span style="color:#000000;">                Response.Write(ex.Message);
</span><span style="color:#008080;">123</span> <span style="color:#000000;">            }
</span><span style="color:#008080;">124</span> <span style="color:#000000;">        }
</span><span style="color:#008080;">125</span> 
<span style="color:#008080;">126</span>         <span style="color:#808080;">///</span> <span style="color:#808080;">&lt;summary&gt;</span><span style="color:#008000;">创建GridView控件的RowCancelingEdit事件类
</span><span style="color:#008080;">127</span>         <span style="color:#808080;">///</span> <span style="color:#808080;">&lt;/summary&gt;</span>
<span style="color:#008080;">128</span>         <span style="color:#808080;">///</span> <span style="color:#808080;">&lt;param name="sender"&gt;&lt;/param&gt;</span>
<span style="color:#008080;">129</span>         <span style="color:#808080;">///</span> <span style="color:#808080;">&lt;param name="e"&gt;&lt;/param&gt;</span>
<span style="color:#008080;">130</span>         <span style="color:#0000ff;">protected</span> <span style="color:#0000ff;">void</span> GridView1_RowsCancelingEdit(<span style="color:#0000ff;">object</span><span style="color:#000000;"> sender, GridViewCancelEditEventArgs e)
</span><span style="color:#008080;">131</span> <span style="color:#000000;">        {
</span><span style="color:#008080;">132</span>             GridView1.EditIndex = -<span style="color:#800080;">1</span><span style="color:#000000;">;
</span><span style="color:#008080;">133</span>             <span style="color:#0000ff;">this</span><span style="color:#000000;">.Bind();
</span><span style="color:#008080;">134</span>         }<br>135　　　}<br>136　}</pre> 
 </div> 
 <p> </p> 
 <p>至于前台页面，无非就是绑定相关的事件了，在这就不贴代码了 </p> 
</div> 
<p>转载于:https://www.cnblogs.com/clyde-chen/p/3670636.html</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/7dd1a53cd06d3077ca2a25b4dac3ac97/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">关于 win7 NT kernel&amp;system 占用大量CPU 问题</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/a24392f2ef8cf88fa3b62848cc63dd63/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">python中的编码问题：以ascii和unicode为主线</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 追风少年的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>