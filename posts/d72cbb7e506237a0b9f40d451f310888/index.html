<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>VNC介绍及相关命令总结 - 追风少年的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="VNC介绍及相关命令总结" />
<meta property="og:description" content="What is VNCserver? VNC stands for Virtual Network Computing. It was originally developed by AT&amp;T as a way to administer machines without using the console. If you have used Windows Terminal Services (RDP), VNC will seem very familiar. Why use VNCserver? In Linux, everything can be done from a shell. However, there may be a time when you need to access the machine as if you were at the console." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://zhuifengsn.github.io/posts/d72cbb7e506237a0b9f40d451f310888/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2012-05-31T13:59:49+08:00" />
<meta property="article:modified_time" content="2012-05-31T13:59:49+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="追风少年的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">追风少年的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">VNC介绍及相关命令总结</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <div id="blog_text" class="cnt"> 
  
 <h5><em>What is VNCserver?</em></h5> VNC stands for Virtual Network Computing. It was originally developed by AT&amp;T as a way to administer machines without using the console. If you have used 
 <a href="http://www.skullbox.net/rdp.php" rel="nofollow">Windows Terminal Services (RDP)</a>, VNC will seem very familiar. 
 <br> 
 <br> 
 <h5><em>Why use VNCserver?</em></h5> In Linux, everything can be done from a 
 <a href="http://www.skullbox.net/linuxshell.php" rel="nofollow"> shell</a>. However, there may be a time when you need to access the machine as if you were at the console. 
 <br> 
 <br> 
 <h5><em>Getting Started</em></h5> You will need several things to get started: 
 <ul><li>root privledges</li><li>VNC client software (tightVNC, you can download it <a href="http://www.skullbox.net/sd/vncclient.exe" rel="nofollow"> here</a>.)</li><li>A good password!</li></ul> As I mentioned above, this example is done with RHEL, which comes standard with VNCserver installed. To start the vncserver simply invoke the following commands: 
 <pre>[root@roswell etc]# service vncserver start
Starting VNC server:                                       [  OK  ]
[root@roswell etc]# 
[root@roswell etc]# vncpasswd
Password: 
Verify: 
[root@roswell etc]#
[root@roswell etc]# vncserver

New 'roswell:1 (root)' desktop is roswell:1

Starting applications specified in /root/.vnc/xstartup
Log file is /root/.vnc/roswell:1.log

[root@roswell etc]# 
</pre> 
 <br> 
 <br> So what did we do there? First, we started the vncserver service. It may or may not have already been running on your system. Next we set a password to access the VNC desktop. When you set the password, you will not see any characters on the screen, and you must enter the password twice. You will only need to do this the very first time you run vncserver. The password will be saved in the Linux filesystem, and you can change it at any time by invoking the 
 <em>vncpasswd</em> command again. Last, to activate the VNC desktop, we simply invoked the 
 <em>vncserver</em> command. Notice the output; the desktop is named "roswell:1" which can also be replaced via the machines IP address. 
 <br> 
 <br> 
 <h5><em>Connecting</em></h5> Assuming you already installed 
 <a href="http://www.skullbox.net/sd/vncclient.exe" rel="nofollow"> TightVNC</a> or another VNC client, enter the desktop name: 
 <br> 
 <br> 
 <center> 
  <img src="https://images2.imgbox.com/b2/a6/OwXvuMPj_o.gif" alt="" border="2" height="121" width="371"> 
 </center> 
 <br> 
 <br> You can replace the server name with an IP address if you are logging in from outside your LAN. Remember, if you are using 
 <a href="http://www.skullbox.net/nat.php" rel="nofollow">NAT</a> port 5900 must be forwarded to your VNCserver. 
 <br> 
 <br> 
 <center> 
  <img src="https://images2.imgbox.com/8d/c9/ByfER4Xy_o.gif" alt="" border="2" height="121" width="371"> 
 </center> 
 <br> 
 <br> Upon successful connection, you will be prompted for a password. You will then see a terminal screen that will allow you to execute commands: 
 <br> 
 <br> 
 <center> 
  <img src="https://images2.imgbox.com/c0/f5/V44VAwoV_o.gif" alt="" border="2"> 
 </center> 
 <br> 
 <br> 
 <h5><em>VNCserver in Runlevel 5 (KDE or Gnome)</em></h5> If you are new to linux, running VNC server with a terminal isn't going to do you much good. You might want to have a menu-driven GUI like Windows. No problem. Follow these steps: 
 <br> 
 <br> 
 <br> First, we are going to assume that VNCserver is running under the root user, as shown with the example above. For this example, I will be editing my VNCserver to enter Gnome. You can specify a KDE desktop if you have KDE installed on your server. Make sure you are in the root directory. 
 <pre>[root@roswell ~]# ls -a
.                                   cacti-0.8.6c.tar.gz  .gnome2_private     .lftp                  queue.dat          temp
..                                  client.cfg           .gnupg              machinedependent.dat  .recently-used      Templates
.config                             FAHlog-Prev.txt      .gstreamer-0.8      .metacity             .rhn-applet.cache  .themes
.cshrc                              FAHlog.txt           .gtkrc              .mozilla              .rhn-applet.conf   .thumbnails
.bash_history                       Desktop              .fonts.cache-1      .gtkrc-1.2-gnome2     .rnd               .Trash
.bash_logout                        .dmrc                .gconf              .ICEauthority         .mysql_history      scripts
.bash_profile                       .eggcups             .gconfd             .icons                .nautilus          .sh_history
.viminfo                            .bashrc              .bashdevl           .esd_auth             .gnome              php-4.11
.ssh                                .vnc                  cacti-0.8.6c       .gnome2                install.log
[root@roswell ~]# cd .vnc
[root@roswell .vnc]# ls
passwd         roswell:1.pid  roswell:2.pid  roswell:3.pid  roswell:4.pid  roswell:5.pid             roswell.area51.lan:1.pid
roswell:1.log  roswell:2.log  roswell:3.log  roswell:4.log  roswell:5.log  roswell.area51.lan:1.log  roswell.area51.lan:2.log
xstartup
[root@roswell .vnc]# vi xstartup
</pre> 
 <br> 
 <br> 
 <span style="color:#800000">Using vi (vim) to edit the xstartup file, make sure your file matches this one:</span> 
 <br> 
 <br> 
 <br> 
 <pre>#!/bin/sh

# Uncomment the following two lines for normal desktop:
 unset SESSION_MANAGER
 exec /etc/X11/xinit/xinitrc

[ -x /etc/vnc/xstartup ] &amp;&amp; exec /etc/vnc/xstartup
[ -r $HOME/.Xresources ] &amp;&amp; xrdb $HOME/.Xresources
xsetroot -solid grey
vncconfig -iconic &amp;
xterm -geometry 80x24+10+10 -ls -title "$VNCDESKTOP Desktop" &amp;
startx &amp;
</pre> 
 <br> 
 <br> Notice that the last line is "startx &amp;" as this command will launch Gnome upon login via VNCserver. If you are using a KDE desktop, the line "startkde &amp;" should replace the last line. 
 <br> 
 <br> VNC相关命令：vncconfig 
 <wbr></wbr>vncpasswd 
 <wbr></wbr>vncserver 
 <wbr></wbr>vncviewer 
 <br> 
 <br> 
 1.检查vnc客户端(tscleint/vncviewer)和服务器是否已经安装在你的系统中 
 <br> 
 # rpm -qa|grep vnc 
 <br> 
 vnc-4.1.2-14.el5_3.1 
 <br> 
 vnc-server-4.1.2-14.el5_3.1 
 <br> 
 如果没有安装vncviewer，那么运行： 
 <br> 
 # yum install vnc 
 <br> 
 客户端我们也可以使用tscleint。 
 <br> 
 <br> 
 2.配置vncserver 
 <br> 
 vim /etc/sysconfig/vncservers 
 <br> 
 增加：VNCSERVERS="1:root" 
 <br> 
 <br> 
 3.vncpasswd创建一个vnc的口令 
 <br> 
 注意这将同时在你的home目录下，创建一个隐藏的目录.vnc，其中有一个文件passwd保存着你的vnc口令. 
 <br> 
 <br> 
 4. #service vncserver start 
 <br> 
 <br> 
 5. # vncserver （第一次启动时，需要指定一个密码） 
 <br> 
 You will require a password to access your desktops. 
 <br> 
 Password: 
 <br> 
 Verify: 
 <br> 
 New 'lpi:1 (root)' desktop is lpi:1 
 <br> 
 Creating default startup script /root/.vnc/xstartup 
 <br> 
 Starting applications specified in /root/.vnc/xstartup 
 <br> 
 Log file is /root/.vnc/lpi:1.log 
 <br> 
 <br> 
 可以以多个用户身份，启动多个VNC，共享多个用户的桌面： 
 <br> 
 # lsof -i:{5901,5904} 
 <br> 
 COMMAND <wbr></wbr>PID USER <wbr></wbr><wbr></wbr>FD <wbr></wbr><wbr></wbr>TYPE DEVICE SIZE NODE NAME 
 <br> 
 Xvnc <wbr></wbr><wbr></wbr><wbr></wbr>2373 root <wbr></wbr><wbr></wbr><wbr></wbr>4u <wbr></wbr>IPv4 <wbr></wbr><wbr></wbr>6975 <wbr></wbr> <wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr>TCP *:5901 (LISTEN) 
 <br> 
 Xvnc <wbr></wbr><wbr></wbr><wbr></wbr>4236 test <wbr></wbr><wbr></wbr><wbr></wbr>4u <wbr></wbr>IPv4 <wbr></wbr>16231 <wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr>TCP *:5904 (LISTEN) 
 <br> 
 <br> 
 可以手工指定display#,例如： 
 <br> 
 # vncserver :99 
 <br> 
 New 'lpi.123.com:99 (root)' desktop is server01.123.com:99 
 <br> 
 Starting applications specified in /root/.vnc/xstartup 
 <br> 
 Log file is /root/.vnc/server01.123.com:99.log 
 <br> 
 <br> 
 6.停止 vncserver(vncserver -kill :display#): <wbr></wbr> 
 <br> 
 # vncserver -kill :1 
 <br> 
 Killing Xvnc process ID 2373 
 <br> 
 <br> 
 7.设置自动运行:ntsysv 
 <br> 
 <br> 
 8.VNC给浏览器的端口是5800+N，给vncviewer的端口是5900+N，N是设置的display号 
 <br> 
 http://192.168.1.1:5801/ 
 <br> 
 ultravnc:192.168.1.1:5901 
 <br> 
 # lsof -i:5801,5901 
 <br> 
 COMMAND <wbr></wbr><wbr></wbr>PID USER <wbr></wbr><wbr></wbr>FD <wbr></wbr><wbr></wbr>TYPE DEVICE SIZE NODE NAME 
 <br> 
 Xvnc <wbr></wbr><wbr></wbr><wbr></wbr>31742 root <wbr></wbr><wbr></wbr><wbr></wbr>4u <wbr></wbr>IPv4 <wbr></wbr>51969 <wbr></wbr> <wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr>TCP *:5901 (LISTEN) 
 <br> 
 Xvnc <wbr></wbr><wbr></wbr><wbr></wbr>31742 root <wbr></wbr><wbr></wbr><wbr></wbr>5u <wbr></wbr>IPv4 <wbr></wbr>51970 <wbr></wbr> <wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr>TCP *:5801 (LISTEN) 
 <br> 
 <br> 
 9.修改VNC密码 
 <br> 
 # vncpasswd /root/.vnc/passwd 
 <br> 
 Password: 
 <br> 
 Verify: 
 <br> 
 <br> 
 VNC日志文件位于：$HOME/.vnc下的log文件，此目录也包含了一个VNC的xstartup启动文件。 
 <br> 
 <br> 
 <span style="font-weight:bold">以GNOME方式显示，修改xstartup文件</span> 
 <br> 
 <span style="color:#033cc">#!/bin/sh</span> 
 <br style="color:rgb(0,51,204)"> 
 <br style="color:rgb(0,51,204)"> 
 <span style="color:#033cc"># Uncomment the following two lines for normal desktop:</span> 
 <br style="color:rgb(0,51,204)"> 
 <span style="color:#033cc">unset SESSION_MANAGER</span> 
 <br style="color:rgb(0,51,204)"> 
 <span style="color:#033cc">exec /etc/X11/xinit/xinitrc</span> 
 <br style="color:rgb(0,51,204)"> 
 <br style="color:rgb(0,51,204)"> 
 <span style="color:#033cc">[ -x /etc/vnc/xstartup ] &amp;&amp; exec /etc/vnc/xstartup</span> 
 <br style="color:rgb(0,51,204)"> 
 <span style="color:#033cc">[ -r $HOME/.Xresources ] &amp;&amp; xrdb $HOME/.Xresources</span> 
 <br style="color:rgb(0,51,204)"> 
 <span style="color:#033cc">xsetroot -solid grey</span> 
 <br style="color:rgb(0,51,204)"> 
 <span style="color:#033cc">vncconfig -iconic &amp;</span> 
 <br style="color:rgb(0,51,204)"> 
 <span style="color:#033cc">xterm -geometry 80x24+10+10 -ls -title "$VNCDESKTOP Desktop" &amp;</span> 
 <br style="color:rgb(0,51,204)"> 
 <span style="color:#033cc">gnome-session &amp;</span> 
 <br> 
 # tsclient 
 <br> 
 出现错误：unable to connect to host: Connection refused (111) 
 <br> 
 一般是没有指定连接的display＃,例如地址输入：192.168.1.1出错，192.168.1.1:1就正确了<br> VNCserver auto run<br>  
 <span style="background-color:#ffff00">启动vncserver服务时，出现no displays configured :此错误，请编辑vncservers文件<br> #vim /etc/sysconfig/vncservers<br> <span style="color:#033cc"># The VNCSERVERS variable is a list of display:user pairs.</span><br style="color:rgb(0,51,204)"> <span style="color:#033cc">#</span><br style="color:rgb(0,51,204)"> <span style="color:#033cc"># Uncomment the lines below to start a VNC server on display :2</span><br style="color:rgb(0,51,204)"> <span style="color:#033cc"># as my 'myusername' (adjust this to your own). <wbr></wbr>You will also</span><br style="color:rgb(0,51,204)"> <span style="color:#033cc"># need to set a VNC password; run 'man vncpasswd' to see how</span><br style="color:rgb(0,51,204)"> <span style="color:#033cc"># to do that. <wbr></wbr></span><br style="color:rgb(0,51,204)"> <span style="color:#033cc">#</span><br style="color:rgb(0,51,204)"> <span style="color:#033cc"># DO NOT RUN THIS SERVICE if your local area network is</span><br style="color:rgb(0,51,204)"> <span style="color:#033cc"># untrusted! <wbr></wbr>For a secure way of using VNC, see</span><br style="color:rgb(0,51,204)"> <span style="color:#033cc"># &lt;URL:http://www.uk.research.att.com/archive/vnc/sshvnc.html&gt;.</span><br style="color:rgb(0,51,204)"> <br style="color:rgb(0,51,204)"> <span style="color:#033cc"># Use "-nolisten tcp" to prevent X connections to your VNC server via TCP.</span><br style="color:rgb(0,51,204)"> <br style="color:rgb(0,51,204)"> <span style="color:#033cc"># Use "-nohttpd" to prevent web-based VNC clients connecting.</span><br style="color:rgb(0,51,204)"> <br style="color:rgb(0,51,204)"> <span style="color:#033cc"># Use "-localhost" to prevent remote VNC clients connecting except when</span><br style="color:rgb(0,51,204)"> <span style="color:#033cc"># doing so through a secure tunnel. <wbr></wbr>See the "-via" option in the</span><br style="color:rgb(0,51,204)"> <span style="color:#033cc"># `man vncviewer' manual page.</span><br style="color:rgb(0,51,204)"> <br style="color:rgb(0,51,204)"> <span style="color:#033cc">VNCSERVERS="1:root"</span><br style="color:rgb(0,51,204)"> <span style="color:#033cc">VNCSERVERARGS[2]="-geometry 800x600 -nolisten tcp -nohttpd -localhost"</span></span> 
</div> 
<br>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/e4dae2cb234434db86c0ea3b05dc6119/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">运行时类型识别(RTTI)</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/0963a310b3c365182c4345a2c4cd702d/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">开源PACS服务器</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 追风少年的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>