<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>apt-get下载包及所有依赖 - 追风少年的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="apt-get下载包及所有依赖" />
<meta property="og:description" content="思路就是利用apt-get的depend选项，这会列出所给包的依赖，但是只是直接依赖，间接依赖需要递归。
可以手动递归，也可以用--recurse选项来递归。
下面采用--recurse递归，并用awk来过滤出需要的包名 。
同时，通过--no-*系列选项关闭了所有不必要的。
最后，用apt-get download XXX或者apt download XXX来依次下载每个包。
脚本 #!/bin/bash #$1 pkg get_all_depends() { apt-cache depends --no-pre-depends --no-suggests --no-recommends \ --no-conflicts --no-breaks --no-enhances\ --no-replaces --recurse $1 | awk &#39;{print $2}&#39;| tr -d &#39;&lt;&gt;&#39; | sort --unique } ## 遍历命令行参数，参数应为包名。 for pkg in $* do all_depends=$(get_all_depends $pkg) echo -e &#34;所有依赖共计&#34;$(echo $all_depends | wc -w)&#34;个&#34; echo $all_depends i=0 for depend in $all_depends do i=$((i&#43;1)) echo -e &#34;\033[1;32m正在下载第$i个依赖：&#34;$depend &#34;\033[0m&#34; apt-get download $depend done done 效果 漏洞 对于一些包，比如wine，依赖中有一些在下载时会提示无候选版本可下载（似乎是架构相关），暂时不知道什么意思，以后弄懂了再改它。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://zhuifengsn.github.io/posts/b3b94fd2ec055337396ebc9683d37635/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-05-03T15:43:49+08:00" />
<meta property="article:modified_time" content="2023-05-03T15:43:49+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="追风少年的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">追风少年的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">apt-get下载包及所有依赖</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-github-gist">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>思路就是利用<code>apt-get</code>的<code>depend</code>选项，这会列出所给包的依赖，但是只是直接依赖，间接依赖需要递归。</p> 
<p>可以手动递归，也可以用<code>--recurse</code>选项来递归。</p> 
<p>下面采用<code>--recurse</code>递归，并用<code>awk</code>来过滤出需要的包名 。<br> 同时，通过<code>--no-*</code>系列选项关闭了所有不必要的。<br> 最后，用<code>apt-get download XXX</code>或者<code>apt download XXX</code>来依次下载每个包。</p> 
<h4><a id="_7"></a>脚本</h4> 
<pre><code class="prism language-shell"><span class="token shebang important">#!/bin/bash</span>

<span class="token comment">#$1     pkg</span>
<span class="token function-name function">get_all_depends</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
        <span class="token function">apt-cache</span> depends --no-pre-depends --no-suggests --no-recommends <span class="token punctuation">\</span>
                --no-conflicts --no-breaks --no-enhances<span class="token punctuation">\</span>
                --no-replaces --recurse <span class="token variable">$1</span> <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">'{print $2}'</span><span class="token operator">|</span> <span class="token function">tr</span> -d <span class="token string">'&lt;&gt;'</span> <span class="token operator">|</span> <span class="token function">sort</span> --unique
<span class="token punctuation">}</span>


<span class="token comment">## 遍历命令行参数，参数应为包名。</span>
<span class="token keyword">for</span> <span class="token for-or-select variable">pkg</span> <span class="token keyword">in</span> <span class="token variable">$*</span>
<span class="token keyword">do</span>
        <span class="token assign-left variable">all_depends</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span>get_all_depends $pkg<span class="token variable">)</span></span>
        <span class="token builtin class-name">echo</span> -e <span class="token string">"所有依赖共计"</span><span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">echo</span> $all_depends <span class="token operator">|</span> <span class="token function">wc</span> -w<span class="token variable">)</span></span><span class="token string">"个"</span>
        <span class="token builtin class-name">echo</span> <span class="token variable">$all_depends</span>
        <span class="token assign-left variable">i</span><span class="token operator">=</span><span class="token number">0</span>
        <span class="token keyword">for</span> <span class="token for-or-select variable">depend</span> <span class="token keyword">in</span> <span class="token variable">$all_depends</span>
        <span class="token keyword">do</span>
                <span class="token assign-left variable">i</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$((</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token variable">))</span></span>
                <span class="token builtin class-name">echo</span> -e <span class="token string">"<span class="token entity" title="\033">\033</span>[1;32m正在下载第<span class="token variable">$i</span>个依赖："</span><span class="token variable">$depend</span> <span class="token string">"<span class="token entity" title="\033">\033</span>[0m"</span>
                <span class="token function">apt-get</span> download <span class="token variable">$depend</span>
        <span class="token keyword">done</span>
<span class="token keyword">done</span>
</code></pre> 
<h4><a id="_35"></a>效果</h4> 
<p><img src="https://images2.imgbox.com/86/0b/VlSX1lkb_o.png" alt="请添加图片描述"></p> 
<h4><a id="_37"></a>漏洞</h4> 
<p>对于一些包，比如wine，依赖中有一些在下载时会提示无候选版本可下载（似乎是架构相关），暂时不知道什么意思，以后弄懂了再改它。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/13cafda4a65d129df9c8f3b66edd3fb4/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">SpringCloud详解</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/0e119b8ca0e07174da14d82ec2fcb1fe/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Vmware下安装Linux（CentOS 7)</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 追风少年的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>