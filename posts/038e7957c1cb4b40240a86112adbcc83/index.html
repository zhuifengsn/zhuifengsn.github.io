<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Apache celeborn 安装及使用教程 - 追风少年的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Apache celeborn 安装及使用教程" />
<meta property="og:description" content="1.下载安装包 https://celeborn.apache.org/download/ 测0.4.0时出现https://github.com/apache/incubator-celeborn/issues/835
2.解压 tar -xzvf apache-celeborn-0.3.2-incubating-bin.tgz
3.修改配置文件 cp celeborn-env.sh.template celeborn-env.sh cp log4j2.xml.template log4j2.xml cp celeborn-defaults.conf.template cp celeborn-defaults.conf 3.1修改celeborn-env.sh CELEBORN_MASTER_MEMORY=2g CELEBORN_WORKER_MEMORY=2g CELEBORN_WORKER_OFFHEAP_MEMORY=4g 3.2 修改celeborn-defaults.conf # used by client and worker to connect to master celeborn.master.endpoints 10.67.78.xx:9097 # used by master to bootstrap celeborn.master.host 10.67.78.xx celeborn.master.port 9097 celeborn.metrics.enabled true celeborn.worker.flusher.buffer.size 256k # If Celeborn workers have local disks and HDFS. Following configs should be added. # If Celeborn workers have local disks, use following config." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://zhuifengsn.github.io/posts/038e7957c1cb4b40240a86112adbcc83/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-02-24T17:02:56+08:00" />
<meta property="article:modified_time" content="2024-02-24T17:02:56+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="追风少年的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">追风少年的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Apache celeborn 安装及使用教程</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h3><strong>1.下载安装包</strong></h3> 
<p><a href="https://celeborn.apache.org/download/" rel="nofollow" title="https://celeborn.apache.org/download/">https://celeborn.apache.org/download/</a> </p> 
<p><strong>测0.4.0时出现</strong><a href="https://github.com/apache/incubator-celeborn/issues/835" title="https://github.com/apache/incubator-celeborn/issues/835">https://github.com/apache/incubator-celeborn/issues/835</a></p> 
<p><img alt="" height="300" src="https://images2.imgbox.com/4d/48/MCmDYDtT_o.png" width="677"></p> 
<h3>2.解压</h3> 
<p><strong>tar -xzvf apache-celeborn-0.3.2-incubating-bin.tgz</strong></p> 
<p><img alt="" height="314" src="https://images2.imgbox.com/dd/d7/wiQZrEaL_o.png" width="439"></p> 
<h3><strong>3.修改配置文件</strong></h3> 
<pre><code class="hljs">cp celeborn-env.sh.template  celeborn-env.sh

cp log4j2.xml.template  log4j2.xml

cp celeborn-defaults.conf.template  cp celeborn-defaults.conf</code></pre> 
<h4>3.1修改<strong>celeborn-env.sh</strong></h4> 
<pre><code class="hljs">CELEBORN_MASTER_MEMORY=2g
CELEBORN_WORKER_MEMORY=2g
CELEBORN_WORKER_OFFHEAP_MEMORY=4g</code></pre> 
<h4>3.2 修改celeborn-defaults.conf</h4> 
<pre><code class="hljs"># used by client and worker to connect to master
celeborn.master.endpoints 10.67.78.xx:9097

# used by master to bootstrap
celeborn.master.host 10.67.78.xx
celeborn.master.port 9097

celeborn.metrics.enabled true
celeborn.worker.flusher.buffer.size 256k

# If Celeborn workers have local disks and HDFS. Following configs should be added.
# If Celeborn workers have local disks, use following config.
# Disk type is HDD by defaut.
#celeborn.worker.storage.dirs /mnt/disk1:disktype=SSD,/mnt/disk2:disktype=SSD

# If Celeborn workers don't have local disks. You can use HDFS.
# Do not set `celeborn.worker.storage.dirs` and use following configs.
celeborn.storage.activeTypes HDFS
celeborn.worker.sortPartition.threads 64
celeborn.worker.commitFiles.timeout 240s
celeborn.worker.commitFiles.threads 128
celeborn.master.slot.assign.policy roundrobin
celeborn.rpc.askTimeout 240s
celeborn.worker.flusher.hdfs.buffer.size 4m
celeborn.storage.hdfs.dir hdfs://10.67.78.xx:8020/celeborn
celeborn.worker.replicate.fastFail.duration 240s

# If your hosts have disk raid or use lvm, set celeborn.worker.monitor.disk.enabled to false
celeborn.worker.monitor.disk.enabled false</code></pre> 
<h3>4.复制到其他节点</h3> 
<pre><code class="hljs">scp -r /root/apache-celeborn-0.3.2-incubating-bin 10.67.78.xx1:/root/
scp -r /root/apache-celeborn-0.3.2-incubating-bin 10.67.78.xx2:/root/</code></pre> 
<p>因为在配置文件中已经配置了master 所以启动matster和worker即可。</p> 
<h3><strong>5.启动master和worker</strong></h3> 
<pre><code class="hljs">cd $CELEBORN_HOME
./sbin/start-master.sh



./sbin/start-worker.sh celeborn://&lt;Master IP&gt;:&lt;Master Port&gt;


</code></pre> 
<p><strong> 之后在master的日志中看woker是否注册上</strong></p> 
<p><img alt="" height="630" src="https://images2.imgbox.com/c0/88/rYvLU4Ir_o.png" width="1200"> </p> 
<h3>6.在 spark客户端使用</h3> 
<p><strong>复制 $CELEBORN_HOME/spark/*.jar   到   $SPARK_HOME/jars/</strong></p> 
<p><strong>修改spark-defaults.conf</strong></p> 
<pre><code class="hljs"># Shuffle manager class name changed in 0.3.0:
#    before 0.3.0: org.apache.spark.shuffle.celeborn.RssShuffleManager
#    since 0.3.0: org.apache.spark.shuffle.celeborn.SparkShuffleManager
spark.shuffle.manager org.apache.spark.shuffle.celeborn.SparkShuffleManager
# must use kryo serializer because java serializer do not support relocation
spark.serializer org.apache.spark.serializer.KryoSerializer

# celeborn master
spark.celeborn.master.endpoints clb-1:9097,clb-2:9097,clb-3:9097
# This is not necessary if your Spark external shuffle service is Spark 3.1 or newer
spark.shuffle.service.enabled false

# options: hash, sort
# Hash shuffle writer use (partition count) * (celeborn.push.buffer.max.size) * (spark.executor.cores) memory.
# Sort shuffle writer uses less memory than hash shuffle writer, if your shuffle partition count is large, try to use sort hash writer.  
spark.celeborn.client.spark.shuffle.writer hash

# We recommend setting spark.celeborn.client.push.replicate.enabled to true to enable server-side data replication
# If you have only one worker, this setting must be false 
# If your Celeborn is using HDFS, it's recommended to set this setting to false
spark.celeborn.client.push.replicate.enabled true

# Support for Spark AQE only tested under Spark 3
# we recommend setting localShuffleReader to false to get better performance of Celeborn
spark.sql.adaptive.localShuffleReader.enabled false

# If Celeborn is using HDFS
spark.celeborn.storage.hdfs.dir hdfs://&lt;namenode&gt;/celeborn

# we recommend enabling aqe support to gain better performance
spark.sql.adaptive.enabled true
spark.sql.adaptive.skewJoin.enabled true

# Support Spark Dynamic Resource Allocation
# Required Spark version &gt;= 3.5.0 注意spark版本是否满足
spark.shuffle.sort.io.plugin.class org.apache.spark.shuffle.celeborn.CelebornShuffleDataIO
# Required Spark version &gt;= 3.4.0, highly recommended to disable 注意spark版本是否满足
spark.dynamicAllocation.shuffleTracking.enabled false
</code></pre> 
<h3><strong>7.启动spark-shell</strong></h3> 
<pre><code class="hljs">./bin/spark-shell 

spark.sparkContext.parallelize(1 to 1000, 1000).flatMap(_ =&gt; (1 to 100).iterator.map(num =&gt; num)).repartition(10).count

</code></pre> 
<p></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/93c4c98499d43c8f01199aa503787ef2/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Python世界之运算符</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/244c6d5726675b414354777d4635c461/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">蛇形矩阵1</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 追风少年的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>