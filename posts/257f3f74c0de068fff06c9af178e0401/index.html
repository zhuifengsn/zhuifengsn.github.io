<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>RocketMQ Docker部署 - 追风少年的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="RocketMQ Docker部署" />
<meta property="og:description" content="1. 镜像制作前准备 1.1 clone rocketmq-docker项目的代码
#官方的docker地址 git clone https://github.com/apache/rocketmq-docker.git 复制代码 执行上面命令克隆下来这项目的代码。
2. 构建镜像 这里需要构建的镜像有两个
rocketmq-dashboard镜像(web控制台)rocketmq镜像(NameSrv和Broker) 2.1 rocketmq镜像构建
cd image-build sh build-image.sh RMQ-VERSION BASE-IMAGE 复制代码 原理：通过版本和BASE-IMAGE(支持centos, alpine)来判断是使用 Dockerfile-centos文件还是Dockerfile-alpine文件来构建镜像。
等待镜像构建完成，然后通过docker命令查看
docker image ls 复制代码 2.2 rocketmq-dashboard镜像构建
和构建rocketmq镜像一样，我们依葫芦画瓢构建rocketmq-dashboard镜像
cd image-build sh build-image-dashboard.sh dashboard-VERSION BASE-IMAGE 复制代码 BASE-IMAGE只支持centos
等待镜像构建完成。
docker image ls 复制代码 3. Docker-compose 安装 这里为什么用Docker-compose 安装呢？因为RocketMQ的安装的东西有三个部分：namesrv、broker、rocketmq-dashboard ，用Docker-compose安装起来比较方便。
3.1 环境准备
本地已经有了rocketmq-dashboard镜像和rocketmq镜像
在构建rocketmq-dashboard的时候可以修改Dockerfile-centos-dashboard文件的最后一条命令如:ENTRYPOINT [&#34;java&#34;,&#34;${JAVA_OPTS}&#34;, &#34;-jar&#34;, &#34;bin/rocketmq-dashboard.jar&#34;]; 这样构建的镜像可以调节JVM的内存大小.好处就是如果你机器内存小就可以将这个内存设置的小一点
3.2 RockerMQ 单机部署
3.2.1 NameSrv的Docker宿主机环境
主要配置的是日志路径以及存储路径。(挂载路径)
mkdir -p /root/rocketmq/data/namesrv/logs mkdir -p /root/rocketmq/data/namesrv/store 复制代码 3." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://zhuifengsn.github.io/posts/257f3f74c0de068fff06c9af178e0401/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-04-10T16:31:30+08:00" />
<meta property="article:modified_time" content="2023-04-10T16:31:30+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="追风少年的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">追风少年的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">RocketMQ Docker部署</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h4>1. 镜像制作前准备</h4> 
<p>1.1 clone rocketmq-docker项目的代码</p> 
<pre><code>#官方的docker地址
git clone https://github.com/apache/rocketmq-docker.git
复制代码</code></pre> 
<p>执行上面命令克隆下来这项目的代码。</p> 
<h4>2. 构建镜像</h4> 
<p>这里需要构建的镜像有两个</p> 
<ul><li>rocketmq-dashboard镜像(web控制台)</li><li>rocketmq镜像(NameSrv和Broker)</li></ul> 
<p>2.1 rocketmq镜像构建</p> 
<pre><code>cd image-build
sh build-image.sh RMQ-VERSION BASE-IMAGE
复制代码</code></pre> 
<blockquote> 
 <p>原理：通过版本和BASE-IMAGE(支持centos, alpine)来判断是使用 Dockerfile-centos文件还是Dockerfile-alpine文件来构建镜像。</p> 
</blockquote> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/d1/9a/y8MZxypJ_o.png"></p> 
<p>等待镜像构建完成，然后通过docker命令查看</p> 
<pre><code>docker image ls
复制代码</code></pre> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/0d/73/5vJA4YVN_o.png"></p> 
<p>2.2 rocketmq-dashboard镜像构建</p> 
<p>和构建rocketmq镜像一样，我们依葫芦画瓢构建rocketmq-dashboard镜像</p> 
<pre><code>cd image-build
sh build-image-dashboard.sh dashboard-VERSION BASE-IMAGE
复制代码</code></pre> 
<blockquote> 
 <p>BASE-IMAGE只支持centos</p> 
</blockquote> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/ff/8c/x5Qf6oys_o.png"></p> 
<p>等待镜像构建完成。</p> 
<pre><code>docker image ls
复制代码</code></pre> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/6b/d0/5O6QIdBu_o.png"></p> 
<h4>3. Docker-compose 安装</h4> 
<p>这里为什么用Docker-compose 安装呢？因为RocketMQ的安装的东西有三个部分：<strong>namesrv、broker、rocketmq-dashboard</strong> ，用Docker-compose安装起来比较方便。</p> 
<p>3.1 环境准备</p> 
<blockquote> 
 <p>本地已经有了rocketmq-dashboard镜像和rocketmq镜像</p> 
</blockquote> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/f6/49/aP4dvTKE_o.png"></p> 
<blockquote> 
 <p>在构建rocketmq-dashboard的时候可以修改Dockerfile-centos-dashboard文件的最后一条命令如:ENTRYPOINT ["java","${JAVA_OPTS}", "-jar", "bin/rocketmq-dashboard.jar"]; 这样构建的镜像可以调节JVM的内存大小.好处就是如果你机器内存小就可以将这个内存设置的小一点</p> 
</blockquote> 
<p>3.2 RockerMQ 单机部署</p> 
<p>3.2.1 NameSrv的Docker宿主机环境</p> 
<p>主要配置的是日志路径以及存储路径。(挂载路径)</p> 
<pre><code>mkdir -p /root/rocketmq/data/namesrv/logs

mkdir -p /root/rocketmq/data/namesrv/store
复制代码</code></pre> 
<p>3.2.2 Broker的Docker宿主机环境</p> 
<p>主要创建日志、数据存储、以及配置存放的挂载路径</p> 
<pre><code>mkdir -p /root/rocketmq/data/broker/logs
mkdir -p /root/rocketmq/data/broker/store
mkdir -p /root/rocketmq/etc/broker
复制代码</code></pre> 
<p>3.2.3 Broker配置文件创建</p> 
<pre><code>nano /root/rocketmq/etc/broker/broker.conf
复制代码</code></pre> 
<p>文件内容如下:</p> 
<pre><code>brokerClusterName = mxsm-docker
brokerName = mxsm-docker-a
brokerId = 0
deleteWhen = 04
fileReservedTime = 48
brokerRole = ASYNC_MASTER
flushDiskType = ASYNC_FLUSH
# Docker环境需要设置成宿主机IP
#brokerIP1 = {docker宿主机IP}
brokerIP1 = 192.168.43.128
复制代码</code></pre> 
<blockquote> 
 <p>例如：在Docker宿主机通过命令查询到的IP地址为 <strong><code>192.168.43.128</code></strong> 那么这个地方就设置为 <strong><code>192.168.43.128</code></strong></p> 
</blockquote> 
<p>3.2.4 编写Docker-compose文件</p> 
<blockquote> 
 <p>这里编写Docker-compose文件版本使用的3，有的人docker可能版本没这么高，可以使用2看个人调整。</p> 
</blockquote> 
<pre><code>version: '3'
services:
  #Service for nameserver
  namesrv:
    image: apacherocketmq/rocketmq:4.9.2
    container_name: rocketmq-namesrv
    ports:
      - 9876:9876
    environment:
      - JAVA_OPT_EXT=-server -Xms256m -Xmx256m -Xmn256m
    volumes:
      - /root/rocketmq/data/namesrv/logs:/root/logs
    command: sh mqnamesrv

  #Service for broker
  broker:
    image: apacherocketmq/rocketmq:4.9.2
    container_name: rocketmq-broker
    links:
      - namesrv
    depends_on:
      - namesrv
    ports:
      - 10909:10909
      - 10911:10911
      - 10912:10912
    environment:
      - NAMESRV_ADDR=namesrv:9876
      - JAVA_OPT_EXT=-server -Xms512m -Xmx512m -Xmn256m
    volumes:
      - /root/rocketmq/data/broker/logs:/home/rocketmq/logs
      - /root/rocketmq/data/broker/store:/home/rocketmq/store
      - /root/rocketmq/etc/broker/broker.conf:/home/rocketmq/conf/broker.conf
    command: sh mqbroker -c /home/rocketmq/conf/broker.conf

  #Service for rocketmq-dashboard
  dashboard:
    image: apache/rocketmq-dashboard:1.0.0-centos
    container_name: rocketmq-dashboard
    ports:
      - 8080:8080
    links:
      - namesrv
    depends_on:
      - namesrv
    environment:
      - NAMESRV_ADDR=namesrv:9876
复制代码</code></pre> 
<p>运行命令：</p> 
<pre><code>docker-compose -f ./docker-compose.yml up
复制代码</code></pre> 
<p>然后查看运行的情况。</p> 
<blockquote> 
 <p>在运行的过程中总是发现有这样的一个问题：rocketmq-broker exited with code 253，也没日志打印。这里可能是挂载路径没有权限的问题。加上权限即可。</p> 
</blockquote> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/f2/9f/F5dJJ60N_o.png"></p> 
<p>然后在本地登录web控制台进行验证</p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/9e/8b/YlwTLPso_o.png"></p> 
<h4>4. 总结</h4> 
<ul><li>总的来说大家可以根据官方的 <strong><code>rocketmq-docker</code></strong> 项目来进行docker部署。这里也存在一些问题，我开始用官方的创建镜像很慢，特别是下载和编译的时候。这里也可以在本地将项目进行编译然后修改一下从本地进行镜像构建。这样构建有一个好处，在本地能够构建正在开发的版本镜像。</li><li>官方的Docker-compose没有将rocketmq-dashboard控制台进行运行。</li></ul> 
<p></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/73a41219e6994802d46ada44f8837895/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">redis 底层数据结构详解</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/70325a4237218ec6ec7eec0a041fd1e2/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">神经网络中的epoch、batch、batch_size、iteration的理解</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 追风少年的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>