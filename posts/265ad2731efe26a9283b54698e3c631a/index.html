<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>学习ADO.NET技术（七） Command对象 - 追风少年的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="学习ADO.NET技术（七） Command对象" />
<meta property="og:description" content="前面几节主要学习了ADO.NET与外部数据源建立连接以及运用连接池提高连接性能的知识。连接对象（Connection）是ADO.NET的主力先锋，为用户与数据库交互搭建了扎实的桥梁。Connection对象为用户与数据库搭建好桥梁之后，它的任务就完成了。此时，Command对象就闪亮登场。Command对象在ADO.NET的世界里总是忙忙碌碌，像是一个外交官，为用户传达了所有操作数据库的信息。
目录 目录1、准备工作2、什么是Command对象？3、Command对象的几个属性4、Command对象的几个方法5、如何创建Command对象？6、选择合适的执行命令7、总结说明 1、准备工作 创建一个数据库，名为db_MyDemo.创建一个数据表，名为tb_SelCustomer。 2、什么是Command对象？ ADO.NET最主要的目的是对外部数据源提供一致的访问。而访问数据源，就少不了增删查改等操作。Connection对象连接好数据源之后，不会再对数据源进行任何操作。Command对象封装了所有对外部数据源的操作（包括增删查改等SQL语句与存储过程），并在执行完成后返回合适的结果。与Connection对象一样，对于不同数据源，ADO.NET提供了不同的Command对象。具体可见以下表格：
.Net数据提供程序对应Commad对象用于OLE DB的.Net Framework数据提供程序OleDbCommand对象用于SQL Server的.Net Framework数据提供程序SqlCommand对象用于ODBC的.Net Framework数据提供程序OdbcCommand对象用于Oracle的.Net Framework数据提供程序OracleCommand对象 不管是哪种Command对象，它都继承于DBCommand类。它同样是抽象基类，不能实例化。DBCommand类定义了完善的健全的数据库操作的基本方法和属性。它的结构如下：
public abstract class DbCommand:Component,IdbCommand,IDisposable 3、Command对象的几个属性 CommandText：获取或设置对数据源执行操作的文本命令CommandType：命令类型，指定如何解释CommandText属性。CommandType属性的值是一个枚举类型，定义结构如下： public enum CommandType { Text = 1;//SQL文本命令 StoredProcedure = 4;//存储过程的名称 TableDirect = 512;//表的名称 } 将CommandType设置为StoredProsedure时，应将CommandText属性设置为存储过程的名称。调用Execute方法之一时，该命令将执行此存储过程。Connection：设置或获取与数据源的连接。Parameters：绑定SQL语句或存储过程的参数。参数化查询中不可或缺的对象，非常重要。Tranction：获取或设置在其中执行.NetFramework数据提供程序的Command对象的事务。 4、Command对象的几个方法 ExecuteNonQuery:执行不返回数据行的操作，并返回一个Int类型的数据。 注意：对于 UPDATE、INSERT 和 DELETE 语句，返回值为该命令所影响的行数。 对于其他所有类型的语句，返回值 为 -1。
ExecuteReader：执行查询，并返回一个DataReader对象。ExecuteScalar：执行查询，并返回查询结果集中第一行的第一列。如果找不到第一行第一列，则返回null的引用。 5、如何创建Command对象？ 在创建Command对象之前，需要明确两件事情：（1）需要对哪个数据源执行操作（2）执行什么样的操作。 对哪个数据源执行操作：由连接对象来确定。执行什么样的操作，由SQL语句来决定。那么如何通过这两个信息来构造Command对象呢？一般来说，有两种方法： （1）通过构造函数。
string strSQL = &#34;select * from tb_SelCustomer&#34;; string conn = &#34;Data Source = LENOVO - PC\\MR2014; &#34; &#43; &#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://zhuifengsn.github.io/posts/265ad2731efe26a9283b54698e3c631a/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2018-08-15T20:36:35+08:00" />
<meta property="article:modified_time" content="2018-08-15T20:36:35+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="追风少年的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">追风少年的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">学习ADO.NET技术（七） Command对象</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>前面几节主要学习了ADO.NET与外部数据源建立连接以及运用连接池提高连接性能的知识。连接对象（Connection）是ADO.NET的主力先锋，为用户与数据库交互搭建了扎实的桥梁。Connection对象为用户与数据库搭建好桥梁之后，它的任务就完成了。此时，Command对象就闪亮登场。Command对象在ADO.NET的世界里总是忙忙碌碌，像是一个外交官，为用户传达了所有操作数据库的信息。</p> 
<hr> 
<h3 id="目录">目录</h3> 
<p></p> 
<div class="toc"> 
 <div class="toc"> 
  <ul><li> 
    <ul><li><a href="#%E7%9B%AE%E5%BD%95" rel="nofollow">目录</a></li><li><a href="#1%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C" rel="nofollow">1、准备工作</a></li><li><a href="#2%E4%BB%80%E4%B9%88%E6%98%AFcommand%E5%AF%B9%E8%B1%A1" rel="nofollow">2、什么是Command对象？</a></li><li><a href="#3command%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%87%A0%E4%B8%AA%E5%B1%9E%E6%80%A7" rel="nofollow">3、Command对象的几个属性</a></li><li><a href="#4command%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%87%A0%E4%B8%AA%E6%96%B9%E6%B3%95" rel="nofollow">4、Command对象的几个方法</a></li><li><a href="#5%E5%A6%82%E4%BD%95%E5%88%9B%E5%BB%BAcommand%E5%AF%B9%E8%B1%A1" rel="nofollow">5、如何创建Command对象？</a></li><li><a href="#6%E9%80%89%E6%8B%A9%E5%90%88%E9%80%82%E7%9A%84%E6%89%A7%E8%A1%8C%E5%91%BD%E4%BB%A4" rel="nofollow">6、选择合适的执行命令</a></li><li><a href="#7%E6%80%BB%E7%BB%93" rel="nofollow">7、总结</a></li><li><a href="#%E8%AF%B4%E6%98%8E" rel="nofollow">说明</a></li></ul> </li></ul> 
 </div> 
</div> 
<p></p> 
<h3 id="1准备工作">1、准备工作</h3> 
<ol><li>创建一个数据库，名为db_MyDemo.</li><li>创建一个数据表，名为tb_SelCustomer。</li></ol> 
<h3 id="2什么是command对象">2、什么是Command对象？</h3> 
<p>ADO.NET最主要的目的是对外部数据源提供一致的访问。而访问数据源，就少不了增删查改等操作。Connection对象连接好数据源之后，不会再对数据源进行任何操作。Command对象封装了所有对外部数据源的操作（包括增删查改等SQL语句与存储过程），并在执行完成后返回合适的结果。与Connection对象一样，对于不同数据源，ADO.NET提供了不同的Command对象。具体可见以下表格：</p> 
<table><thead><tr><th>.Net数据提供程序</th><th>对应Commad对象</th></tr></thead><tbody><tr><td>用于OLE DB的.Net Framework数据提供程序</td><td>OleDbCommand对象</td></tr><tr><td>用于SQL Server的.Net Framework数据提供程序</td><td>SqlCommand对象</td></tr><tr><td>用于ODBC的.Net Framework数据提供程序</td><td>OdbcCommand对象</td></tr><tr><td>用于Oracle的.Net Framework数据提供程序</td><td>OracleCommand对象</td></tr></tbody></table> 
<p>不管是哪种Command对象，它都继承于DBCommand类。它同样是抽象基类，不能实例化。DBCommand类定义了完善的健全的数据库操作的基本方法和属性。它的结构如下：</p> 
<pre class="prettyprint"><code class=" hljs cs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> DbCommand:Component,IdbCommand,IDisposable</code></pre> 
<h3 id="3command对象的几个属性">3、Command对象的几个属性</h3> 
<ul><li>CommandText：获取或设置对数据源执行操作的文本命令</li><li>CommandType：命令类型，指定如何解释CommandText属性。CommandType属性的值是一个枚举类型，定义结构如下： <br> <code>public enum CommandType <br> { <br> Text = 1;//SQL文本命令 <br> StoredProcedure = 4;//存储过程的名称 <br> TableDirect = 512;//表的名称 <br> }</code> <br> 将CommandType设置为StoredProsedure时，应将CommandText属性设置为存储过程的名称。调用Execute方法之一时，该命令将执行此存储过程。</li><li>Connection：设置或获取与数据源的连接。</li><li>Parameters：绑定SQL语句或存储过程的参数。参数化查询中不可或缺的对象，非常重要。</li><li>Tranction：获取或设置在其中执行.NetFramework数据提供程序的Command对象的事务。</li></ul> 
<h3 id="4command对象的几个方法">4、Command对象的几个方法</h3> 
<ul><li>ExecuteNonQuery:执行不返回数据行的操作，并返回一个Int类型的数据。</li></ul> 
<blockquote> 
 <p>注意：对于 UPDATE、INSERT 和 DELETE 语句，返回值为该命令所影响的行数。 对于其他所有类型的语句，返回值 为 -1。</p> 
</blockquote> 
<ul><li>ExecuteReader：执行查询，并返回一个DataReader对象。</li><li>ExecuteScalar：执行查询，并返回查询结果集中第一行的第一列。如果找不到第一行第一列，则返回null的引用。</li></ul> 
<h3 id="5如何创建command对象">5、如何创建Command对象？</h3> 
<p>在创建Command对象之前，需要明确两件事情：（1）需要对哪个数据源执行操作（2）执行什么样的操作。 <br> 对哪个数据源执行操作：由连接对象来确定。执行什么样的操作，由SQL语句来决定。那么如何通过这两个信息来构造Command对象呢？一般来说，有两种方法： <br> （1）通过构造函数。</p> 
<pre class="prettyprint"><code class=" hljs cs"> <span class="hljs-keyword">string</span> strSQL = <span class="hljs-string">"select * from tb_SelCustomer"</span>;
 <span class="hljs-keyword">string</span> conn = <span class="hljs-string">"Data Source = LENOVO - PC\\MR2014; "</span> + <span class="hljs-string">"Initial Catalog = db_MyDemo;User Id = sa;Password = ;"</span>;
 SqlCommand cmd = <span class="hljs-keyword">new</span> SqlCommand(strSQL,conn);</code></pre> 
<p>（2）通过Command对象的属性</p> 
<pre class="prettyprint"><code class=" hljs cs"> <span class="hljs-keyword">string</span> strSQL = <span class="hljs-string">"select * from tb_SelCustomer"</span>;
 SqlCommand cmd = <span class="hljs-keyword">new</span> SqlCommand();
 cmd.Connection = con;
 cmd.CommandText = strSQL;</code></pre> 
<h3 id="6选择合适的执行命令">6、选择合适的执行命令</h3> 
<ul><li>执行增删改操作，不返回数据行，返回受影响的行数。 <br> 当我们对数据表的行进行增加删除更新操作时，实际上数据是不返回数据行的，仅仅返回一个包含受影响行数信息的整数。一般地，在执行非查询操作时，我们需要调用ExecuteNonQuery方法。 <br> <font size="4" color="red">实例：</font></li></ul> 
<pre class="prettyprint"><code class=" hljs avrasm">            SqlConnectionStringBuilder connstr = new SqlConnectionStringBuilder()<span class="hljs-comment">;</span>
            connstr<span class="hljs-preprocessor">.DataSource</span> = <span class="hljs-string">"LENOVO-PC\\MR2014"</span><span class="hljs-comment">;</span>
            connstr<span class="hljs-preprocessor">.InitialCatalog</span> = <span class="hljs-string">"db_MyDemo"</span><span class="hljs-comment">;</span>
            connstr<span class="hljs-preprocessor">.IntegratedSecurity</span> = true<span class="hljs-comment">;</span>

            using (SqlConnection con = new SqlConnection(connstr<span class="hljs-preprocessor">.ConnectionString</span>))
            {
                string strSql = <span class="hljs-string">"insert into tb_SelCustomer  values('liuhao','0','0','13822223333','liuhaorain@163.com','广东省深圳市宝安区',12.234556,34.222234,'422900','备注信息')"</span><span class="hljs-comment">;</span>
                SqlCommand cmd = new SqlCommand()<span class="hljs-comment">;</span>
                cmd<span class="hljs-preprocessor">.Connection</span> = con<span class="hljs-comment">;//连接对象</span>
                cmd<span class="hljs-preprocessor">.CommandType</span> = CommandType<span class="hljs-preprocessor">.Text</span><span class="hljs-comment">;//CommandText的内容是SQL语句</span>
                cmd<span class="hljs-preprocessor">.CommandText</span> = strSql<span class="hljs-comment">;//SQL语句内容</span>
                try
                {
                    con<span class="hljs-preprocessor">.Open</span>()<span class="hljs-comment">;</span>
                    int rows = cmd<span class="hljs-preprocessor">.ExecuteNonQuery</span>()<span class="hljs-comment">;</span>
                    MessageBox<span class="hljs-preprocessor">.Show</span>(<span class="hljs-string">"受影响行数："</span> + rows<span class="hljs-preprocessor">.ToString</span>())<span class="hljs-comment">;</span>
                }
                catch (Exception ex)
                {
                    MessageBox<span class="hljs-preprocessor">.Show</span>(ex<span class="hljs-preprocessor">.Message</span>)<span class="hljs-comment">;</span>
                }
            }</code></pre> 
<p>查询数据库，发现表中已经成功插入一行了。 <br> <img src="https://images2.imgbox.com/c9/03/jlRdh7gw_o.png" alt="执行结果" title=""> <br> - 执行查操作，返回多个数据 <br> 执行查询操作时，会返回一行或多行数据，这个时候就调用ExecutReader方法。ExcuteReader方法返回一个DataReader对象。DataReader是一个只读的遍历访问每一行数据的数据流。需要注意以下几点：</p> 
<pre class="prettyprint"><code class=" hljs avrasm"> using (SqlConnection con = new SqlConnection(connstr<span class="hljs-preprocessor">.ConnectionString</span>))
            {
                string strSql = <span class="hljs-string">"select * from tb_SelCustomer"</span><span class="hljs-comment">;</span>
                SqlCommand cmd = new SqlCommand()<span class="hljs-comment">;</span>
                cmd<span class="hljs-preprocessor">.Connection</span> = con<span class="hljs-comment">;//连接对象</span>
                cmd<span class="hljs-preprocessor">.CommandType</span> = CommandType<span class="hljs-preprocessor">.Text</span><span class="hljs-comment">;//CommandText的内容是SQL语句</span>
                cmd<span class="hljs-preprocessor">.CommandText</span> = strSql<span class="hljs-comment">;//SQL语句内容</span>
                try
                {
                    int rows = <span class="hljs-number">0</span><span class="hljs-comment">;</span>
                    con<span class="hljs-preprocessor">.Open</span>()<span class="hljs-comment">;</span>
                    SqlDataReader reader = cmd<span class="hljs-preprocessor">.ExecuteReader</span>()<span class="hljs-comment">;</span>
                    if (reader != null &amp;&amp; reader<span class="hljs-preprocessor">.HasRows</span>)
                    {
                        while (reader<span class="hljs-preprocessor">.Read</span>())
                        {
                            for (int i = <span class="hljs-number">0</span><span class="hljs-comment">; i &lt; reader.FieldCount; ++i)</span>
                            {
                                MessageBox<span class="hljs-preprocessor">.Show</span>(reader<span class="hljs-preprocessor">.GetName</span>(i) + <span class="hljs-string">"  "</span> + reader<span class="hljs-preprocessor">.GetValue</span>(i))<span class="hljs-comment">;</span>
                            }
                            ++rows<span class="hljs-comment">;</span>
                        }
                        MessageBox<span class="hljs-preprocessor">.Show</span>(<span class="hljs-string">"共"</span> + rows + <span class="hljs-string">"条记录"</span>)<span class="hljs-comment">;</span>
                    }

                    reader<span class="hljs-preprocessor">.Close</span>()<span class="hljs-comment">;</span>
                }
                catch (Exception ex)
                {
                    MessageBox<span class="hljs-preprocessor">.Show</span>(ex<span class="hljs-preprocessor">.Message</span>)<span class="hljs-comment">;</span>
                }
            }</code></pre> 
<ul><li>执行查操作，返回单个值 <br> 有时查询时仅仅需要返回一个值，ExcuteScalar方法就是处理单个数据最优秀的人才。ExcuteScalar返回一个System.Object类型的数据，因此我们在获取数据时需要进行强制类型转换。当没有数据时，ExcuteScalar方法返回System.DBNull。 <br> 实例：</li></ul> 
<pre class="prettyprint"><code class=" hljs avrasm">                string strSql = <span class="hljs-string">"select count(*) from tb_SelCustomer"</span><span class="hljs-comment">;</span>
                SqlCommand cmd = new SqlCommand()<span class="hljs-comment">;</span>
                cmd<span class="hljs-preprocessor">.Connection</span> = con<span class="hljs-comment">;//连接对象</span>
                cmd<span class="hljs-preprocessor">.CommandType</span> = CommandType<span class="hljs-preprocessor">.Text</span><span class="hljs-comment">;//CommandText的内容是SQL语句</span>
                cmd<span class="hljs-preprocessor">.CommandText</span> = strSql<span class="hljs-comment">;//SQL语句内容</span>
                try
                {
                    int rows = <span class="hljs-number">0</span><span class="hljs-comment">;</span>
                    con<span class="hljs-preprocessor">.Open</span>()<span class="hljs-comment">;</span>
                    rows =(int) cmd<span class="hljs-preprocessor">.ExecuteScalar</span>()<span class="hljs-comment">;//返回单个值</span>
                    MessageBox<span class="hljs-preprocessor">.Show</span>(<span class="hljs-string">"一共返回记录数："</span> + rows<span class="hljs-preprocessor">.ToString</span>())<span class="hljs-comment">;</span>
                }
                catch (Exception ex)
                {
                    MessageBox<span class="hljs-preprocessor">.Show</span>(ex<span class="hljs-preprocessor">.Message</span>)<span class="hljs-comment">;</span>
                }
                finally
                {
                    con<span class="hljs-preprocessor">.Close</span>()<span class="hljs-comment">;</span>
                    con<span class="hljs-preprocessor">.Dispose</span>()<span class="hljs-comment">;</span>
                }</code></pre> 
<p>运行结果为：返回一条记录。当前实例返回的是数据表中记录的总个数。</p> 
<h3 id="7总结">7、总结</h3> 
<p>Command对象称为数据库命令对象，主要执行包括添加、删除、修改及查询数据的操作，也可以用来执行存储过程。用于执行存储过程时，需要将Command对象的属性CommandType设置为CommandType.StoredProcedure.。默认情况下执行SQL语句。</p> 
<h3 id="说明">说明</h3> 
<p><a href="https://www.cnblogs.com/liuhaorain/archive/2012/02/27/2361825.html" rel="nofollow">本文学习自此篇总结，详情请戳原作者文章</a></p> 
<blockquote> 
 <p>我叫刘皓，很高兴您能阅读完我的这篇文章。 我花了大量时间和精力来完成这篇文章，如果文章对您有帮助，请不要忘了点推荐哦！ <br> 如果您能点击右边的打赏按钮，打赏一杯咖啡钱，我将获得更多的动力和能量写出下一篇好文章。 </p> 
 <p>本文版权归作者和博客园共有，欢迎转载，但未经作者同意必须保留此段声明，且在文章页面明显位置给出原文链接，否则保留追究法律责任的权利。 <br> 我的博客即将搬运同步至腾讯云+社区，邀请大家一同入驻：<a href="https://cloud.tencent.com/developer/support-plan" rel="nofollow">https://cloud.tencent.com/developer/support-plan</a></p> 
</blockquote>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/94f8057104087469bd936ca833e0678b/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">安装OSX和Windows双系统以后系统时间不同步的问题</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/d57b1c8f5cdb325790d326a1b95fc1d2/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">char和uchar区别</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 追风少年的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>