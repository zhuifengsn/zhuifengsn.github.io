<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>u-boot使用bootargs给内核传参数 - 追风少年的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="u-boot使用bootargs给内核传参数" />
<meta property="og:description" content="作者 QQ群：852283276
微信：arm80x86
微信公众号：青儿创客基地
B站：主页 https://space.bilibili.com/208826118
参考 uboot环境变量（设置bootargs向linux内核传递正确的参数）
start kernel 之后没有任何输出与uboot无法将bootargs传入内核的调查方法与解决之道
Xlinx-Zedboard使用NFS挂载根文件系统
NFS rootfs: mount: only root can mount proc on /proc
记linux内核处理bootargs到内核并加载模块时传入参数（module_param_named()等）
指定IP与MAC set bootargs console=ttyAS0,115200 nwhwconf=device:eth0,hwaddr:00:81:E1:12:06:50 stmmaceth=msglvl:0,phyaddr:0,watchdog:5000 mtdparts=Onboard_Flash:256k@0k,16128k@256k root=/dev/mtdblock1 rw rootfstype=jffs2 ip=${ipaddr}::${gatewayip}:${netmask}:tree:eth0:off mem=58m bigphysarea=1500 指定根文件系统 一般有三个地方可以放置内核启动命令：
内核配置的CONFIG_CMDLINE参数由bootloader传递给内核在设备树的chosen/bootargs下描述 使用哪一个取决于内核的配置。在Xillinux中，使用设备树chosen/bootargs里描述的cmdline。arm64的boot option，Default kernel command string是bootargs相关的，
参考第二个博客，内核版本3.14，改版很大了，
我这里用下面分别用ramdisk和emmc根文件系统，cmd line最终是bootargs字符串。
#ifndef CONFIG_BOOTARGS #define CONFIG_BOOTARGS &#34;earlycon clk_ignore_unused noinitrd console=ttyPS0,115200 root=/dev/mmcblk0 rw&#34; #endif &#34;qspi_bootargs=earlycon clk_ignore_unused console=ttyPS0,115200\0&#34; \ &#34;ext4_bootargs=earlycon clk_ignore_unused noinitrd console=ttyPS0,115200 root=${ext4dev_path} rw\0&#34; \ &#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://zhuifengsn.github.io/posts/59ae2ca6f92940a2c857cd217dc7c283/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2018-07-06T01:02:23+08:00" />
<meta property="article:modified_time" content="2018-07-06T01:02:23+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="追风少年的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">追风少年的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">u-boot使用bootargs给内核传参数</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-dracula">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="_0"></a>作者</h2> 
<p>QQ群：<strong>852283276</strong><br> 微信：<strong>arm80x86</strong><br> 微信公众号：<strong>青儿创客基地</strong><br> B站：<a href="https://space.bilibili.com/208826118" rel="nofollow">主页 <code>https://space.bilibili.com/208826118</code></a></p> 
<h2><a id="_6"></a>参考</h2> 
<blockquote> 
 <p><a href="https://www.cnblogs.com/lidabo/p/5274162.html" rel="nofollow">uboot环境变量（设置bootargs向linux内核传递正确的参数）</a><br> <a href="https://blog.csdn.net/sy373466062/article/details/50363151">start kernel 之后没有任何输出与uboot无法将bootargs传入内核的调查方法与解决之道</a><br> <a href="https://blog.csdn.net/loujunang/article/details/53634141">Xlinx-Zedboard使用NFS挂载根文件系统</a><br> <a href="https://www.linuxquestions.org/questions/linux-software-2/nfs-rootfs-mount-only-root-can-mount-proc-on-proc-4175595326/" rel="nofollow">NFS rootfs: mount: only root can mount proc on /proc</a><br> <a href="https://blog.csdn.net/gzzaigcnforever/article/details/16338805">记linux内核处理bootargs到内核并加载模块时传入参数（module_param_named()等）</a></p> 
</blockquote> 
<h2><a id="IPMAC_13"></a>指定IP与MAC</h2> 
<pre><code class="prism language-shell"><span class="token keyword">set</span> bootargs console<span class="token operator">=</span>ttyAS0,115200 nwhwconf<span class="token operator">=</span>device:eth0,hwaddr:00:81:E1:12:06:50 stmmaceth<span class="token operator">=</span>msglvl:0,phyaddr:0,watchdog:5000 mtdparts<span class="token operator">=</span>Onboard_Flash:256k@0k,16128k@256k root<span class="token operator">=</span>/dev/mtdblock1 rw rootfstype<span class="token operator">=</span>jffs2 ip<span class="token operator">=</span><span class="token variable">${ipaddr}</span>::<span class="token variable">${gatewayip}</span><span class="token keyword">:</span><span class="token variable">${netmask}</span>:tree:eth0:off mem<span class="token operator">=</span>58m bigphysarea<span class="token operator">=</span>1500
</code></pre> 
<h2><a id="_18"></a>指定根文件系统</h2> 
<p>一般有三个地方可以放置内核启动命令：</p> 
<ul><li>内核配置的CONFIG_CMDLINE参数</li><li>由bootloader传递给内核</li><li>在设备树的chosen/bootargs下描述</li></ul> 
<p>使用哪一个取决于内核的配置。在Xillinux中，使用设备树chosen/bootargs里描述的cmdline。arm64的boot option，Default kernel command string是bootargs相关的，<br> <img src="https://images2.imgbox.com/eb/f2/yUrexUlS_o.png" alt="这里写图片描述"><br> 参考第二个博客，内核版本3.14，改版很大了，<br> <img src="https://images2.imgbox.com/c3/d7/GdQv0acC_o.png" alt="这里写图片描述"><br> 我这里用下面分别用ramdisk和emmc根文件系统，cmd line最终是bootargs字符串。</p> 
<pre><code class="prism language-shell"><span class="token comment">#ifndef CONFIG_BOOTARGS</span>
<span class="token comment">#define CONFIG_BOOTARGS "earlycon clk_ignore_unused noinitrd console=ttyPS0,115200 root=/dev/mmcblk0 rw"</span>
<span class="token comment">#endif</span>
	<span class="token string">"qspi_bootargs=earlycon clk_ignore_unused console=ttyPS0,115200\0"</span> \ 
	<span class="token string">"ext4_bootargs=earlycon clk_ignore_unused noinitrd console=ttyPS0,115200 root=<span class="token variable">${ext4dev_path}</span> rw\0"</span> \ 
	<span class="token string">"bootargs=earlycon clk_ignore_unused console=ttyPS0,115200 root=/dev/mmcblk0 rw\0"</span> \ 
</code></pre> 
<p>从打印来看，bootargs已经传进来了，</p> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>    0.000000<span class="token punctuation">]</span> Detected VIPT I-cache on CPU0
<span class="token punctuation">[</span>    0.000000<span class="token punctuation">]</span> CPU features: enabling workaround <span class="token keyword">for</span> ARM erratum 845719
<span class="token punctuation">[</span>    0.000000<span class="token punctuation">]</span> Built 1 zonelists <span class="token keyword">in</span> Zone order, mobility grouping on.  Total pages: 1034240
<span class="token punctuation">[</span>    0.000000<span class="token punctuation">]</span> Kernel <span class="token function">command</span> line: earlycon clk_ignore_unused noinitrd console<span class="token operator">=</span>ttyPS0,115200 root<span class="token operator">=</span>/dev/mmcblk0 rw
<span class="token punctuation">[</span>    0.000000<span class="token punctuation">]</span> PID <span class="token function">hash</span> table entries: 4096 <span class="token punctuation">(</span>order: 3, 32768 bytes<span class="token punctuation">)</span>
<span class="token punctuation">[</span>    0.000000<span class="token punctuation">]</span> Dentry cache <span class="token function">hash</span> table entries: 524288 <span class="token punctuation">(</span>order: 10, 4194304 bytes<span class="token punctuation">)</span>
<span class="token punctuation">[</span>    0.000000<span class="token punctuation">]</span> Inode-cache <span class="token function">hash</span> table entries: 262144 <span class="token punctuation">(</span>order: 9, 2097152 bytes<span class="token punctuation">)</span>
<span class="token punctuation">[</span>    0.000000<span class="token punctuation">]</span> software IO TLB <span class="token punctuation">[</span>mem 0x6bfff000-0x6ffff000<span class="token punctuation">]</span> <span class="token punctuation">(</span>64MB<span class="token punctuation">)</span> mapped at <span class="token punctuation">[</span>ffffffc06bfff000-ffffffc06fffefff<span class="token punctuation">]</span>
<span class="token punctuation">[</span>    0.000000<span class="token punctuation">]</span> Memory: 3783000K/4194304K available <span class="token punctuation">(</span>9020K kernel code, 584K rwdata, 2824K rodata, 6208K init, 397K bss, 149160K reserved, 262144K cma-reserved<span class="token punctuation">)</span>
<span class="token punctuation">[</span>    0.000000<span class="token punctuation">]</span> Virtual kernel memory layout:
</code></pre> 
<p>但是挂载的不对，但是也看到了根文件系统，因为ls /有东西，这特么是从什么地方来的呢？udev又重新挂载了一次，是不是这儿的问题呢</p> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>    3.733197<span class="token punctuation">]</span> udevd<span class="token punctuation">[</span>1585<span class="token punctuation">]</span>: starting version 3.2
<span class="token punctuation">[</span>    3.744719<span class="token punctuation">]</span> udevd<span class="token punctuation">[</span>1586<span class="token punctuation">]</span>: starting eudev-3.2
<span class="token punctuation">[</span>    4.147405<span class="token punctuation">]</span> EXT4-fs <span class="token punctuation">(</span>mmcblk0<span class="token punctuation">)</span>: mounted filesystem with ordered data mode. Opts: <span class="token punctuation">(</span>null<span class="token punctuation">)</span>
</code></pre> 
<p>如果uboot不定义宏，则kernel从设备树的chosen字段提取cmd line，目前为止没能成功从/dev/mmcblk0加载根文件系统，参考博客<a href="https://blog.csdn.net/loujunang/article/details/53634141">Xlinx-Zedboard使用NFS挂载根文件系统</a>，去掉内核的这个选项之后（<strong>后面经查，不是这个问题，因为有noinitrd参数</strong>），<br> <img src="https://images2.imgbox.com/d1/9f/TFnavwmQ_o.png" alt="这里写图片描述"><br> 可以成功从emmc挂载根文件系统了，但是出现下面的错误，</p> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>    2.789691<span class="token punctuation">]</span> EXT4-fs <span class="token punctuation">(</span>mmcblk0<span class="token punctuation">)</span>: couldn't <span class="token function">mount</span> as ext3 due to feature incompatibilities
<span class="token punctuation">[</span>    2.861774<span class="token punctuation">]</span> EXT4-fs <span class="token punctuation">(</span>mmcblk0<span class="token punctuation">)</span>: recovery complete
<span class="token punctuation">[</span>    2.870745<span class="token punctuation">]</span> EXT4-fs <span class="token punctuation">(</span>mmcblk0<span class="token punctuation">)</span>: mounted filesystem with ordered data mode. Opts: <span class="token punctuation">(</span>null<span class="token punctuation">)</span>
<span class="token punctuation">[</span>    2.878619<span class="token punctuation">]</span> VFS: Mounted root <span class="token punctuation">(</span>ext4 filesystem<span class="token punctuation">)</span> on device 179:0.
<span class="token punctuation">[</span>    2.888404<span class="token punctuation">]</span> devtmpfs: mounted
<span class="token punctuation">[</span>    2.891485<span class="token punctuation">]</span> Freeing unused kernel memory: 512K <span class="token punctuation">(</span>ffffffc000c20000 - ffffffc000ca0000<span class="token punctuation">)</span>
INIT: version 2.88 booting
mount: you must be root
mount: you must be root
grep: /proc/filesystems: No such <span class="token function">file</span> or directory
mount: you must be root
grep: /proc/filesystems: No such <span class="token function">file</span> or directory
/etc/rcS.d/S37populate-volatile.sh: line 205: /proc/cmdline: No such <span class="token function">file</span> or directory
/etc/rcS.d/S38dmesg.sh: line 17: /var/log/dmesg: No such <span class="token function">file</span> or directory
Starting internet superserver: inetd.
INIT: Entering runlevel: 5
Configuring network interfaces<span class="token punctuation">..</span>. /etc/rc5.d/S10dropbear: line 32: /proc/mounts: No such <span class="token function">file</span> or directory
Starting Dropbear SSH server: dropbear.
Starting syslogd/klogd: <span class="token keyword">done</span>
Jul  5 17:29:36 mwm syslog.info syslogd started: BusyBox v1.24.1
Jul  5 17:29:36 mwm user.debug kernel: <span class="token punctuation">[</span>    0.000000<span class="token punctuation">]</span>   DMA zone: 0 pages reserved
Jul  5 17:29:36 mwm user.debug kernel: <span class="token punctuation">[</span>    0.000000<span class="token punctuation">]</span>   DMA zone: 524288 pages, LIFO batch:31
Jul  5 17:29:36 mwm user.debug kernel: <span class="token punctuation">[</span>    0.000000<span class="token punctuation">]</span>   Normal zone: 7168 pages used <span class="token keyword">for</span> memmap
Jul  5 17:29:36 mwm user.debug kernel: <span class="token punctuation">[</span>    0.000000<span class="token punctuation">]</span>   Normal zone: 524288 pages, LIFO batch:31
Jul  5 17:29:36 mwm user.info kernel: <span class="token punctuation">[</span>    0.000000<span class="token punctuation">]</span> psci: probing <span class="token keyword">for</span> conduit method from DT.
Jul  5 17:29:36 mwm user.info kernel: <span class="token punctuation">[</span>    0.000000<span class="token punctuation">]</span> psci: PSCIv1.0 detected <span class="token keyword">in</span> firmware.
Jul  5 17:29:36 mwm user.info kernel: <span class="token punctuation">[</span>    0.000000<span class="token punctuation">]</span> psci: Using standard PSCI v0.2 <span class="token keyword">function</span> IDs
Jul  5 17:29:36 mwm user.info kernel: <span class="token punctuation">[</span>    0.000000<span class="token punctuation">]</span> psci: MIGRATE_INFO_TYPE not supported.
Jul  5 17:29:36 mwm user.info kernel: <span class="token punctuation">[</span>    0.000000<span class="token punctuation">]</span> percpu: Embedded 21 pages/cpu @ffffffc87ff79000 s48152 r8192 d29672 u86016
Jul  5 17:29:36 mwm user.debug kernel: <span class="token punctuation">[</span>    0.000000<span class="token punctuation">]</span> pcpu-alloc: s48152 r8192 d29672 u86016 alloc<span class="token operator">=</span>21*4096
Jul  5 17:29:36 mwm user.debug kernel: <span class="token punctuation">[</span>    0.000000<span class="token punctuation">]</span> pcpu-alloc: <span class="token punctuation">[</span>0<span class="token punctuation">]</span> 0 <span class="token punctuation">[</span>0<span class="token punctuation">]</span> 1 <span class="token punctuation">[</span>0<span class="token punctuation">]</span> 2 <span class="token punctuation">[</span>0<span class="token punctuation">]</span> 3 
Jul  5 17:29:36 mwm user.info kernel: <span class="token punctuation">[</span>    0.000000<span class="token punctuation">]</span> Detected VIPT I-cache on CPU0
Jul  5 17:29:36 mwm user.info kernel: <span class="token punctuation">[</span>    0.000000<span class="token punctuation">]</span> CPU features: enabling workaround <span class="token keyword">for</span> ARM erratum 845719
Jul  5 17:29:36 mwm user.info kernel: <span class="token punctuation">[</span>    0.000000<span class="token punctuation">]</span> Built 1 zonelists <span class="token keyword">in</span> Zone order, mobility grouping on.  Total pages: 1034240
Jul  5 17:29:36 mwm user.notice kernel: <span class="token punctuation">[</span>    0.000000<span class="token punctuation">]</span> Kernel <span class="token function">command</span> line: earlycon clk_ignore_unused console<span class="token operator">=</span>ttyPS0,115200 root<span class="token operator">=</span>/dev/mmcblk0 rw
</code></pre> 
<p>参考论坛<a href="https://www.linuxquestions.org/questions/linux-software-2/nfs-rootfs-mount-only-root-can-mount-proc-on-proc-4175595326/" rel="nofollow">NFS rootfs: mount: only root can mount proc on /proc</a>，看看老外是怎么说的，错误原因是，<br> <img src="https://images2.imgbox.com/6b/7f/7ovubirC_o.png" alt="这里写图片描述"></p> 
<pre><code class="prism language-shell">Nero,

Thank you so much <span class="token keyword">for</span> your reply.

I found the root cause.

On NFS server side, I<span class="token string">'m using the Yocto to generate the target rootfs.
The UID and GID for my PC account is 1000, thus the UID and GID for all of the files of target rootfs generated by Yocto is 1000,
including bin/mount binary. Also, bin/mount has SUID bit set.

So, what happen is that target boots, NFS mount is done successfully, and mounted rootfs contains bin/mount whose UID and GID are 1000 and SUID set.
Thus, bin/mount is executed as non-root user because of SUID, and resulted in the mount error.
Confirmed either changing SUID of bin/mount to disable or changing UID and GID of roofs to root resolved this issue.

But, I'</span>m curious how the people using Yocto avoid this issue<span class="token punctuation">..</span>.
I would not like to manually change the UID and GID, or SUID every <span class="token function">time</span> whenever build the rootfs.
I also would not like to use root account to generate target rootfs.

Any insights are welcome, everyone.

Kind Regards,
John Rama
</code></pre> 
<p>这个应该是yocto的锅了，不是用root编译的rootfs，可以手动改变UID和GID，未完待续。。。（2018-07-06 03:27睡的一天比一天晚了，如何是好，太多新东西需要从网上学习，好像不会有尽头，累了，天亮再说吧）。<br> （2018-07-08 21:13接着来，最近点背，两台电脑都坏了，AVStream开发停下来，继续这个吧）。<br> 看下现在的根文件系统，用户都是编译用户，不是root，对比虚拟机的文件系统都是root。</p> 
<pre><code class="prism language-shell">zc@ubuntu:~/xilinx/image/mwm178/rootfs$ <span class="token function">ls</span> -l
total 60
drwxr-xr-x  2 zc zc 4096 Jul  8 05:28 bin
drwxr-xr-x  2 zc zc 4096 Jul  8 05:28 boot
drwxr-xr-x  2 zc zc 4096 Jul  8 05:28 dev
drwxr-xr-x 22 zc zc 4096 Jul  8 05:28 etc
drwxr-xr-x  3 zc zc 4096 Jul  8 05:28 home
lrwxrwxrwx  1 zc zc   10 Jul  8 05:28 init -<span class="token operator">&gt;</span> /sbin/init
drwxr-xr-x  4 zc zc 4096 Jul  8 05:28 lib
drwxr-xr-x  2 zc zc 4096 Jul  8 05:28 media
drwxr-xr-x  2 zc zc 4096 Jul  8 05:28 mnt
drwxr-xr-x  2 zc zc 4096 Jul  8 05:28 proc
drwxr-xr-x  2 zc zc 4096 Jul  8 05:28 run
drwxr-xr-x  2 zc zc 4096 Jul  8 05:28 sbin
drwxr-xr-x  2 zc zc 4096 Jul  8 05:28 sys
drwxrwxrwt  2 zc zc 4096 Jul  8 05:28 tmp
drwxr-xr-x 10 zc zc 4096 Jul  8 05:28 usr
drwxr-xr-x  7 zc zc 4096 Jul  8 05:28 var
zc@ubuntu:~/xilinx/image/mwm178/rootfs$ <span class="token function">ls</span> -l /
total 108
drwxr-xr-x   2 root root  4096 May 28 18:02 bin
drwxr-xr-x   3 root root  4096 Jul  6 00:30 boot
drwxrwxr-x   2 root root  4096 Aug 20  2017 cdrom
drwxr-xr-x  18 root root  4000 Jul  8 03:52 dev
drwxr-xr-x 140 root root 12288 Jul  8 03:52 etc
drwxr-xr-x   3 root root  4096 Aug 20  2017 home
lrwxrwxrwx   1 root root    33 Jul  4 10:33 initrd.img -<span class="token operator">&gt;</span> boot/initrd.img-4.15.0-24-generic
lrwxrwxrwx   1 root root    33 Jul  4 10:33 initrd.img.old -<span class="token operator">&gt;</span> boot/initrd.img-4.13.0-45-generic
drwxr-xr-x  24 root root  4096 May 24 07:10 lib
drwxr-xr-x   2 root root  4096 Feb  1 07:21 lib32
drwxr-xr-x   2 root root  4096 Jan 26 06:04 lib64
drwxr-xr-x   2 root root  4096 Jan 26 06:16 libx32
drwx------   2 root root 16384 Aug 20  2017 lost+found
drwxr-xr-x   4 root root  4096 Aug 20  2017 media
drwxr-xr-x   3 root root  4096 Aug 20  2017 mnt
drwxr-xr-x   2 root root  4096 Aug 20  2017 opt
dr-xr-xr-x 270 root root     0 Jul  8 03:52 proc
drwx------   4 root root  4096 Jan 28 06:23 root
drwxr-xr-x  29 root root   920 Jul  8 05:08 run
drwxr-xr-x   2 root root 12288 May 28 18:02 sbin
drwxr-xr-x   2 root root  4096 Jan 14  2017 snap
drwxr-xr-x   2 root root  4096 Feb 15  2017 srv
dr-xr-xr-x  13 root root     0 Jul  8 03:52 sys
drwxrwxrwt  12 root root  4096 Jul  8 05:32 tmp
drwxr-xr-x  13 root root  4096 Jan 26 06:16 usr
drwxr-xr-x  14 root root  4096 Feb 15  2017 var
lrwxrwxrwx   1 root root    30 Jul  4 10:33 vmlinuz -<span class="token operator">&gt;</span> boot/vmlinuz-4.15.0-24-generic
lrwxrwxrwx   1 root root    30 Jul  4 10:33 vmlinuz.old -<span class="token operator">&gt;</span> boot/vmlinuz-4.13.0-45-generic
</code></pre> 
<p>看一下rootfs的mount程序属性，上面就是mount出错，mount设置了suid，参考博客<a href="https://blog.csdn.net/q1302182594/article/details/40866761">UID、GID和权限</a>，博客<a href="https://blog.csdn.net/wh8_2011/article/details/50825340">UID, EUID, SUID, FSUID</a>，博客<a href="https://blog.csdn.net/findstr/article/details/7330592">uid gid euid egid详解</a>，设置了set-user-ID位的可执行程序，执行时，进程的effective user ID与saved set-uesr-ID都为程序文件所属用户的ID。时real user ID与effective user ID就不一定相等了.这类程序称之为SUID程序，这类程序有特殊的用途.典型的例子：passwd程序，ping程序等。可以看到这是方便root所属的程序被普通用户执行时拥有root权限，比如普通用户执行ping。我们这里弄巧成卓了，mount设置了suid，root执行这个程序时变成了zc的权限，这就是导致权限不够的原因。</p> 
<pre><code class="prism language-shell">zc@ubuntu:~/xilinx/image/mwm178/rootfs$ <span class="token function">ls</span> -l ./bin/
total 1656
lrwxrwxrwx 1 zc zc     19 Jul  8 05:28 ash -<span class="token operator">&gt;</span> /bin/busybox.nosuid
-rwxr-xr-x 1 zc zc 864264 Jul  8 05:28 <span class="token function">bash</span>
<span class="token punctuation">..</span>.
lrwxrwxrwx 1 zc zc     19 Jul  8 05:28 <span class="token function">chgrp</span> -<span class="token operator">&gt;</span> /bin/busybox.nosuid
lrwxrwxrwx 1 zc zc     19 Jul  8 05:28 <span class="token function">chmod</span> -<span class="token operator">&gt;</span> /bin/busybox.nosuid
lrwxrwxrwx 1 zc zc     19 Jul  8 05:28 <span class="token function">chown</span> -<span class="token operator">&gt;</span> /bin/busybox.nosuid
lrwxrwxrwx 1 zc zc     19 Jul  8 05:28 <span class="token function">cp</span> -<span class="token operator">&gt;</span> /bin/busybox.nosuid
lrwxrwxrwx 1 zc zc     19 Jul  8 05:28 cpio -<span class="token operator">&gt;</span> /bin/busybox.nosuid
lrwxrwxrwx 1 zc zc     19 Jul  8 05:28 <span class="token function">more</span> -<span class="token operator">&gt;</span> /bin/busybox.nosuid
lrwxrwxrwx 1 zc zc     17 Jul  8 05:28 <span class="token function">mount</span> -<span class="token operator">&gt;</span> /bin/busybox.suid
lrwxrwxrwx 1 zc zc     24 Jul  8 05:28 mountpoint -<span class="token operator">&gt;</span> /bin/mountpoint.sysvinit
-rwxr-xr-x 1 zc zc   6760 Jul  8 05:28 mountpoint.sysvinit
<span class="token punctuation">..</span>.
</code></pre> 
<p>linux下更改uid，sid的是chown和chgrp，这两个命令很眼熟的，一般和chmod一起出现，但一直都是用chmod，参考<a href="http://man.linuxde.net/chown" rel="nofollow">chown命令</a><br> <img src="https://images2.imgbox.com/66/a4/8UnPfyzT_o.png" alt="这里写图片描述"><br> 使用chown命令来改变文件所有者。chown命令是change owner（改变拥有者）的缩写。需要要注意的是，用户必须是已经存在系统中的，也就是只能改变为在 /etc/passwd这个文件中有记录的用户名称才可以。<br> chown命令的用途很多，还可以顺便直接修改用户组的名称。此外，如果要连目录下的所有子目录或文件同时更改文件拥有者的话，直接加上 -R的参数即可。<br> 基本语法：<br> chown [-R] 账号名称 文件或目录<br> chown [-R] 账号名称:用户组名称 文件或目录<br> 使用chgrp命令来改变文件所属用户组，该命令就是change group（改变用户组）的缩写。需要注意的是要改变成为的用户组名称，必须在 /etc/group里存在，否则就会显示错误。<br> 基本语法：<br> chgrp [-R] 用户组名称 dirname/filename …<br> 执行chown -Rf root:root rootfs/*</p> 
<pre><code class="prism language-shell">zc@ubuntu:~/xilinx/image/mwm178/rootfs$ <span class="token function">ls</span> -l /bin/
total 13092
-rwxr-xr-x 1 root root 1037528 May 16  2017 <span class="token function">bash</span>
-rwxr-xr-x 1 root root   31288 May 19  2015 bunzip2
-rwxr-xr-x 1 root root 1964536 Aug 19  2015 busybox
-rwxr-xr-x 1 root root   31288 May 19  2015 bzcat
lrwxrwxrwx 1 root root       6 Aug 20  2017 bzcmp -<span class="token operator">&gt;</span> bzdiff
-rwxr-xr-x 1 root root    2140 May 19  2015 bzdiff
lrwxrwxrwx 1 root root       6 Aug 20  2017 bzegrep -<span class="token operator">&gt;</span> bzgrep
-rwxr-xr-x 1 root root    4877 May 19  2015 bzexe
lrwxrwxrwx 1 root root       6 Aug 20  2017 bzfgrep -<span class="token operator">&gt;</span> bzgrep
-rwxr-xr-x 1 root root    3642 May 19  2015 bzgrep
-rwxr-xr-x 1 root root   31288 May 19  2015 <span class="token function">bzip2</span>
-rwxr-xr-x 1 root root   14616 May 19  2015 bzip2recover
lrwxrwxrwx 1 root root       6 Aug 20  2017 bzless -<span class="token operator">&gt;</span> bzmore
-rwxr-xr-x 1 root root    1297 May 19  2015 bzmore
-rwxr-xr-x 1 root root   52080 Feb 18  2016 <span class="token function">cat</span>
-rwxr-xr-x 1 root root   14752 Feb  7  2016 chacl
-rwxr-xr-x 1 root root   60272 Feb 18  2016 <span class="token function">chgrp</span>
-rwxr-xr-x 1 root root   56112 Feb 18  2016 <span class="token function">chmod</span>
-rwxr-xr-x 1 root root   64368 Feb 18  2016 <span class="token function">chown</span>

</code></pre> 
<p>现在内核可以成功加载rootfs，但是偶尔后出现异常，经查是usb，emmc这类设备速度较慢，需要添加rootwait参数，下面是rootdelay和rootwait的对比。<br> Reading linux/Documentation/kernel-parameters.txt I found the following:</p> 
<p>rootdelay= [KNL] Delay (in seconds) to pause before attempting to<br> mount the root filesystem</p> 
<p>rootwait [KNL] Wait (indefinitely) for root device to show up.<br> Useful for devices that are detected asynchronously<br> (e.g. USB and MMC devices).</p> 
<p>Sometimes the OS can’t distinguish a peripheral that’s slow to respond from a peripheral that’s not there or completely hosed. The most obvious example is a root filesystem coming from the network (TFTP, NFS) where a slow network link or an overloaded server are difficult to distinguish from a severed network link or a crashed server. A timeout tells the kernel when to give up.</p> 
<p>This can also happen with disks that are slow to spin up, RAID arrays that need to be verified and so on. rootdelay instructs the kernel not to give up immediately if the device isn’t available. The kernel can’t know whether a SCSI drive is a local disk or some kind of RAID bay.</p> 
<p>rootwait is provided to wait indefinitely. It’s not always desirable, for example a system may want to fall back to a different root filesystem if the normal one takes too long to respond.</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/e4d5ad05b93cfd224f2ea08df75d1910/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Pandas - 知识点总结（一）</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/72f7d310a95748ad615e0f7a65f81f00/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Codeforces ~ 1004A ~ Sonya and Hotels （边界处理）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 追风少年的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>