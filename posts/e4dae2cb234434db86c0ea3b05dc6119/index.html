<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>运行时类型识别(RTTI) - 追风少年的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="运行时类型识别(RTTI)" />
<meta property="og:description" content="我们知道，有两个操作符可以提供RTTI：
&lt;1&gt;typeid操作符 这个操作符可以与任何类型的表达式使用，如果操作数不是含有虚函数的类对象，则返回操作数的静态类型，如果操作数是含有虚函数的类对象，则返回操作数的动态类型。
&lt;2&gt;dynamic_cast操作符 这个操作符可以安全的将基类类型的指针或者引用转换为派生类类型的指针或者引用。
这两个操作符的应用场景有些区别，dynamic_cast只能用在至少含有一个虚函数的类的指针或引用的转换上，如果这个类不含有虚函数，则会报错：基类不支持多态。而typeid可以用于任何场合。
单纯的理论总是难以理解的，例子才是王道，OK，来几个例子：
1.typeid的使用 （不含虚函数的类中）
#include &#34;stdafx.h&#34;
#include &lt;iostream&gt;
using namespace std;
class Base
{
};
class Derived:public Base
{
};
int _tmain(int argc, _TCHAR* argv[])
{
Base * pb;
Derived d;
pb = &amp;d;
if(typeid(d) == typeid(*pb))
{
cout &lt;&lt; &#34;返回的是动态类型&#34; &lt;&lt; endl;
}
else
{
cout &lt;&lt; &#34;返回的是静态类型&#34; &lt;&lt; endl;
}
return 0;
}
这个的输出是:
返回的是静态类型。
分析：因为这个类不含有虚函数，所以*pb返回的是静态类型，即是一个Base类型的对象，因而自然执行else语句呢。
2.typeid的使用 （含虚函数的类中）
#include &#34;stdafx.h&#34;
#include &lt;iostream&gt;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://zhuifengsn.github.io/posts/e4dae2cb234434db86c0ea3b05dc6119/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2012-03-17T10:28:39+08:00" />
<meta property="article:modified_time" content="2012-03-17T10:28:39+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="追风少年的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">追风少年的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">运行时类型识别(RTTI)</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p><span style="font-size:18px">我们知道，有两个操作符可以提供RTTI：</span></p> 
<p><span style="font-size:18px">&lt;1&gt;typeid操作符  这个操作符可以与任何类型的表达式使用，如果操作数不是含有虚函数的类对象，则返回操作数的静态类型，如果操作数是含有虚函数的类对象，则返回操作数的动态类型。</span></p> 
<p><span style="font-size:18px">&lt;2&gt;dynamic_cast操作符 这个操作符可以安全的将基类类型的指针或者引用转换为派生类类型的指针或者引用。</span></p> 
<p><span style="font-size:18px">这两个操作符的应用场景有些区别，dynamic_cast只能用在至少含有一个虚函数的类的指针或引用的转换上，如果这个类不含有虚函数，则会报错：基类不支持多态。而typeid可以用于任何场合。</span></p> 
<p><span style="font-size:18px"><br> </span></p> 
<p><span style="font-size:18px">单纯的理论总是难以理解的，例子才是王道，OK，来几个例子：</span></p> 
<p><span style="font-size:18px">1.typeid的使用 （不含虚函数的类中）</span></p> 
<p><span style="font-size:18px"> #include "stdafx.h"<br> #include &lt;iostream&gt;<br> using namespace std;<br> <br> class Base<br> {<!-- --></span></p> 
<p><span style="font-size:18px">};<br> <br> class Derived:public Base<br> {<!-- --><br> };<br> <br> int _tmain(int argc, _TCHAR* argv[])<br> {<!-- --><br> <span style="white-space:pre"></span></span></p> 
<blockquote style="margin:0 0 0 40px; border:none; padding:0px"> 
 <p><span style="font-size:18px">Base * pb;</span></p> 
 <p><span style="font-size:18px">Derived d;</span></p> 
 <p><span style="font-size:18px">pb = &amp;d;</span></p> 
</blockquote> 
<blockquote style="margin:0 0 0 40px; border:none; padding:0px"> 
 <p><span style="font-size:18px">if(typeid(d) == typeid(*pb))</span></p> 
 <p><span style="font-size:18px">{<!-- --></span></p> 
 <blockquote style="margin:0 0 0 40px; border:none; padding:0px"> 
  <p><span style="font-size:18px">cout &lt;&lt; "返回的是动态类型" &lt;&lt; endl;</span></p> 
 </blockquote> 
 <p><span style="font-size:18px">}</span></p> 
 <p><span style="font-size:18px">else</span></p> 
 <p><span style="font-size:18px">{<!-- --></span></p> 
 <blockquote style="margin:0 0 0 40px; border:none; padding:0px"> 
  <p><span style="font-size:18px">cout &lt;&lt; "返回的是静态类型" &lt;&lt; endl;</span></p> 
 </blockquote> 
 <p><span style="font-size:18px">}</span></p> 
 <p><span style="font-size:18px">return 0;</span></p> 
</blockquote> 
<p><span style="font-size:18px">}</span></p> 
<p><span style="font-size:18px">这个的输出是:<br> 返回的是静态类型。</span></p> 
<p><span style="font-size:18px">分析：因为这个类不含有虚函数，所以*pb返回的是静态类型，即是一个Base类型的对象，因而自然执行else语句呢。</span></p> 
<p><span style="font-size:18px"><br> </span></p> 
<p><span style="font-size:18px"><span style="font-size:18px">2.typeid的使用 （含虚函数的类中）</span><br> </span></p> 
<p><span style="font-size:18px"><span style="font-size:18px">#include "stdafx.h"<br> #include &lt;iostream&gt;<br> using namespace std;<br> <br> class Base<br> {<!-- --><br> public:<br> </span></span></p> 
<blockquote style="margin:0 0 0 40px; border:none; padding:0px"> 
 <p><span style="font-size:18px"><span style="font-size:18px"><span style="color:#ff0000">virtual ~Base()</span></span></span></p> 
 <p><span style="font-size:18px"><span style="font-size:18px"><span style="color:#ff0000">{<!-- --></span></span></span></p> 
 <p><span style="font-size:18px"><span style="font-size:18px"><span style="color:#ff0000">}</span></span></span></p> 
</blockquote> 
<p><span style="font-size:18px"><span style="font-size:18px">};<br> <br> class Derived:public Base<br> {<!-- --><br> };<br> <br> int _tmain(int argc, _TCHAR* argv[])<br> {<!-- --><br> <span style="white-space:pre"></span></span></span></p> 
<blockquote style="margin:0 0 0 40px; border:none; padding:0px"> 
 <p><span style="font-size:18px"><span style="font-size:18px">Base * pb;</span></span></p> 
 <p><span style="font-size:18px"><span style="font-size:18px">Derived d;</span></span></p> 
 <p><span style="font-size:18px"><span style="font-size:18px">pb = &amp;d;</span></span></p> 
</blockquote> 
<blockquote style="margin:0 0 0 40px; border:none; padding:0px"> 
 <p><span style="font-size:18px"><span style="font-size:18px">if(typeid(d) == typeid(*pb))</span></span></p> 
 <p><span style="font-size:18px"><span style="font-size:18px">{<!-- --></span></span></p> 
</blockquote> 
<blockquote style="margin:0 0 0 40px; border:none; padding:0px"> 
 <blockquote style="margin:0 0 0 40px; border:none; padding:0px"> 
  <p><span style="font-size:18px"><span style="font-size:18px">cout &lt;&lt; "返回的是动态类型" &lt;&lt; endl;</span></span></p> 
 </blockquote> 
</blockquote> 
<blockquote style="margin:0 0 0 40px; border:none; padding:0px"> 
 <p><span style="font-size:18px"><span style="font-size:18px">}</span></span></p> 
 <p><span style="font-size:18px"><span style="font-size:18px">else</span></span></p> 
 <p><span style="font-size:18px"><span style="font-size:18px">{<!-- --></span></span></p> 
</blockquote> 
<blockquote style="margin:0 0 0 40px; border:none; padding:0px"> 
 <blockquote style="margin:0 0 0 40px; border:none; padding:0px"> 
  <p><span style="font-size:18px"><span style="font-size:18px">cout &lt;&lt; "返回的是静态类型" &lt;&lt; endl;</span></span></p> 
 </blockquote> 
</blockquote> 
<blockquote style="margin:0 0 0 40px; border:none; padding:0px"> 
 <p><span style="font-size:18px"><span style="font-size:18px">}</span></span></p> 
 <p><span style="font-size:18px"><span style="font-size:18px">return 0;</span></span></p> 
</blockquote> 
<p><span style="font-size:18px"><span style="font-size:18px">}<br> </span></span></p> 
<p><span style="font-size:18px"><span style="font-size:18px"></span></span></p> 
<p><span style="font-size:18px">这个的输出是:<br> 返回的是动态类型。</span></p> 
<p><span style="font-size:18px">分析：因为这个类含有虚函数，所以*pb返回的是动态类型，即是一个Derived类型的对象，因而自然执行if语句呢。</span></p> 
<br> 
<span style="font-size:18px">3.dynamic_cast的使用 （含虚函数的类中）</span> 
<br> 
<p><span style="font-size:18px"><span style="font-size:18px"><span style="font-size:18px">#include "stdafx.h"<br> #include &lt;iostream&gt;<br> using namespace std;<br> <br> class Base<br> {<!-- --><br> public:<br> <span style="white-space:pre"></span></span></span></span></p> 
<blockquote style="margin:0 0 0 40px; border:none; padding:0px"> 
 <p><span style="font-size:18px"><span style="font-size:18px"><span style="font-size:18px">virtual ~Base()</span></span></span></p> 
 <p><span style="font-size:18px"><span style="font-size:18px"><span style="font-size:18px">{<!-- --></span></span></span></p> 
 <p><span style="font-size:18px"><span style="font-size:18px"><span style="font-size:18px">}</span></span></span></p> 
</blockquote> 
<p><span style="font-size:18px"><span style="font-size:18px"><span style="font-size:18px">};<br> <br> class Derived:public Base<br> {<!-- --><br> };<br> <br> int _tmain(int argc, _TCHAR* argv[])<br> {<!-- --><br> <span style="white-space:pre"></span></span></span></span></p> 
<blockquote style="margin:0 0 0 40px; border:none; padding:0px"> 
 <p><span style="font-size:18px"><span style="font-size:18px"><span style="font-size:18px">Base * pb;</span></span></span></p> 
 <p><span style="font-size:18px"><span style="font-size:18px"><span style="font-size:18px">Derived d;</span></span></span></p> 
 <p><span style="font-size:18px"><span style="font-size:18px"><span style="font-size:18px">pb = &amp;d;</span></span></span></p> 
 <p><span style="font-size:18px"><span style="font-size:18px"><span style="font-size:18px">if(Derived * pd = dynamic_cast&lt;Derived*&gt;(pb))</span></span></span></p> 
 <p><span style="font-size:18px"><span style="font-size:18px"><span style="font-size:18px">{<!-- --></span></span></span></p> 
</blockquote> 
<blockquote style="margin:0 0 0 40px; border:none; padding:0px"> 
 <blockquote style="margin:0 0 0 40px; border:none; padding:0px"> 
  <p><span style="font-size:18px"><span style="font-size:18px"><span style="font-size:18px">cout &lt;&lt; "pb指向一个derived对象" &lt;&lt; endl;</span></span></span></p> 
 </blockquote> 
</blockquote> 
<blockquote style="margin:0 0 0 40px; border:none; padding:0px"> 
 <p><span style="font-size:18px"><span style="font-size:18px"><span style="font-size:18px">}</span></span></span></p> 
 <p><span style="font-size:18px"><span style="font-size:18px"><span style="font-size:18px">else</span></span></span></p> 
 <p><span style="font-size:18px"><span style="font-size:18px"><span style="font-size:18px">{<!-- --></span></span></span></p> 
</blockquote> 
<blockquote style="margin:0 0 0 40px; border:none; padding:0px"> 
 <blockquote style="margin:0 0 0 40px; border:none; padding:0px"> 
  <p><span style="font-size:18px"><span style="font-size:18px"><span style="font-size:18px">cout &lt;&lt; "pb指向一个Base对象" &lt;&lt; endl;</span></span></span></p> 
 </blockquote> 
</blockquote> 
<blockquote style="margin:0 0 0 40px; border:none; padding:0px"> 
 <p><span style="font-size:18px"><span style="font-size:18px"><span style="font-size:18px">}</span></span></span></p> 
 <p><span style="font-size:18px"><span style="font-size:18px"><span style="font-size:18px">return 0;</span></span></span></p> 
</blockquote> 
<p><span style="font-size:18px"><span style="font-size:18px"><span style="font-size:18px">}<br> </span></span></span></p> 
<p><span style="font-size:18px"><span style="font-size:18px"><span style="font-size:18px"></span></span></span></p> 
<p style="font-size:18px">这个的输出是:<br> pb指向一个derived对象</p> 
<p style="font-size:18px">分析：因为这个类含有虚函数，所以*pb返回的是动态类型，即是一个Derived类型的对象，因而自然执行if语句呢。如果把虚函数的定义那部分去掉，会看到编译的时候报错： 'dynamic_cast' : 'Base' is not a polymorphic type</p> 
<p style="font-size:18px"><br> </p> 
<p style="font-size:18px">嗯，就说这么多吧，我想通过这三个例子，对这两个操作符的使用以及区别应该有了大致的了解了~</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/b16853abdfc041aa002ffe5185b721e4/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Fedora9本地安装配置中文输入法</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/d72cbb7e506237a0b9f40d451f310888/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">VNC介绍及相关命令总结</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 追风少年的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>