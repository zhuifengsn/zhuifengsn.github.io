<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>原型模式（深克隆、浅克隆） - 追风少年的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="原型模式（深克隆、浅克隆）" />
<meta property="og:description" content="上期回顾：建造者模式
文章目录 一、原型模式定义二、原型模式的结构与实现三、案例（一）浅克隆（二）深克隆（三）浅克隆和深克隆的区别 四、原型模式使用场景 一、原型模式定义 原型模式是一种创建型设计模式，Prototype模式允许一个对象再创建另外一个可定制的对象，根本无需知道任何如何创建的细节,工作原理是:通过将一个原型对象传给那个要发动创建的对象，这个要发动创建的对象通过请求原型对象拷贝它们自己来实施创建。
二、原型模式的结构与实现 原型模式有以下三种角色：
1.抽象原型类（Prototype）：规定了具体原型对象必须实现的接口。
2.具体原型类（Realizetype）：实现抽象原型类的 clone() 方法，它是可被复制的对象。
3.访问类（PrototypeTest）：使用具体原型类中的 clone() 方法来复制新的对象
原型模式的克隆可以分为浅克隆和深克隆
浅克隆：创建一个新对象，新对象的属性和原来对象完全相同，对于非基本类型属性，仍指向原有属性所指向的对象的内存地址。
深克隆：创建一个新对象，属性中引用的其他对象也会被克隆，不再指向原有对象地址。
Java中的Object类中提供clone()方法来实现浅克隆。Cloneable接口就是抽象原型类，而实现了Cloneable接口的子实现类就是具体的原型类。
原型模式设计如下：
//在这里抽象原型类是Cloneable接口 //具体原型类 public class Realizetype implements Cloneable{ public Realizetype() { System.out.println(&#34;具体原型对象已创建成功！&#34;); } @Override protected Realizetype clone() throws CloneNotSupportedException { System.out.println(&#34;具体原型已复制成功！&#34;); return (Realizetype) super.clone(); } } //访问类 public class Client { public static void main(String[] args) throws CloneNotSupportedException { //创建一个原型类对象 Realizetype realizetype = new Realizetype(); //得到原型对象的克隆对象 Realizetype clone = realizetype.clone(); //查看是否是同一个对象 System." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://zhuifengsn.github.io/posts/73537062eff89e1afbf7c2ff8deccbc9/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-04-23T12:51:19+08:00" />
<meta property="article:modified_time" content="2022-04-23T12:51:19+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="追风少年的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">追风少年的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">原型模式（深克隆、浅克隆）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <blockquote> 
 <p>上期回顾：<a href="https://blog.csdn.net/weixin_51201930/article/details/124159750">建造者模式</a></p> 
</blockquote> 
<p><img src="https://images2.imgbox.com/bf/2f/bbZYnISu_o.png" alt="在这里插入图片描述"></p> 
<p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#_12" rel="nofollow">一、原型模式定义</a></li><li><a href="#_16" rel="nofollow">二、原型模式的结构与实现</a></li><li><a href="#_78" rel="nofollow">三、案例</a></li><li><ul><li><a href="#_131" rel="nofollow">（一）浅克隆</a></li><li><a href="#_260" rel="nofollow">（二）深克隆</a></li><li><a href="#_298" rel="nofollow">（三）浅克隆和深克隆的区别</a></li></ul> 
  </li><li><a href="#_301" rel="nofollow">四、原型模式使用场景</a></li></ul> 
</div> 
<p></p> 
<hr> 
<hr> 
<h2><a id="_12"></a>一、原型模式定义</h2> 
<blockquote> 
 <p><strong>原型模式</strong>是一种创建型设计模式，Prototype模式允许一个对象再创建另外一个可定制的对象，根本无需知道任何如何创建的细节,工作原理是:通过将一个原型对象传给那个要发动创建的对象，这个要发动创建的对象通过请求原型对象拷贝它们自己来实施创建。</p> 
</blockquote> 
<h2><a id="_16"></a>二、原型模式的结构与实现</h2> 
<p>原型模式有以下三种角色：<br> 1.抽象原型类（Prototype）：规定了具体原型对象必须实现的接口。<br> 2.具体原型类（Realizetype）：实现抽象原型类的 clone() 方法，它是可被复制的对象。<br> 3.访问类（PrototypeTest）：使用具体原型类中的 clone() 方法来复制新的对象<br> <img src="https://images2.imgbox.com/cd/d9/Y7zPHm6K_o.png" alt="在这里插入图片描述"></p> 
<p>原型模式的克隆可以分为<code>浅克隆</code>和<code>深克隆</code></p> 
<blockquote> 
 <p><strong>浅克隆</strong>：创建一个新对象，新对象的属性和原来对象完全相同，对于非基本类型属性，仍指向原有属性所指向的对象的内存地址。<br> <strong>深克隆</strong>：创建一个新对象，属性中引用的其他对象也会被克隆，不再指向原有对象地址。</p> 
</blockquote> 
<p>Java中的Object类中提供<code>clone()</code>方法来实现浅克隆。<code>Cloneable</code>接口就是抽象原型类，而实现了Cloneable接口的子实现类就是具体的原型类。</p> 
<p>原型模式设计如下：</p> 
<pre><code class="prism language-java"><span class="token comment">//在这里抽象原型类是Cloneable接口</span>
<span class="token comment">//具体原型类</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Realizetype</span> <span class="token keyword">implements</span> <span class="token class-name">Cloneable</span><span class="token punctuation">{<!-- --></span>

    <span class="token keyword">public</span> <span class="token class-name">Realizetype</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"具体原型对象已创建成功！"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token class-name">Realizetype</span> <span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">CloneNotSupportedException</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"具体原型已复制成功！"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token class-name">Realizetype</span><span class="token punctuation">)</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">//访问类</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Client</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">CloneNotSupportedException</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">//创建一个原型类对象</span>
        <span class="token class-name">Realizetype</span> realizetype <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Realizetype</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//得到原型对象的克隆对象</span>
        <span class="token class-name">Realizetype</span> clone <span class="token operator">=</span> realizetype<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//查看是否是同一个对象</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"原型对象和克隆的对象是否是同一个对象:"</span><span class="token operator">+</span><span class="token punctuation">(</span>realizetype <span class="token operator">==</span> clone<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<blockquote> 
 <p><strong>测试结果：</strong><br> 具体原型对象已创建成功！<br> 具体原型已复制成功！<br> 原型对象和克隆的对象是否是同一个对象:false</p> 
</blockquote> 
<p>这里展示的原型模式只是一个简单的克隆，<strong>抽象原型类</strong>就是<code>Cloneable接口</code>，<strong>具体原型类</strong>就是<code>可被复制的对象</code>，而<strong>访问类</strong>就是<code>使用克隆clone()来复制新的对象</code>。</p> 
<p>需要注意的是，单看测试结果我们会发现原型模式有以下几个问题。</p> 
<ul><li>克隆底层不是通过new对象实现的，因为调用clone()的时候并没有打印出Realizetype 类的构造函数中的内容。</li><li>原型对象和克隆的对象不是同一个对象</li></ul> 
<p>而且查看clone()源码发现它是一个native本地方法，也是说它并不是由java语言实现的。</p> 
<pre><code class="prism language-java"> <span class="token keyword">protected</span> <span class="token keyword">native</span> <span class="token class-name">Object</span> <span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">CloneNotSupportedException</span><span class="token punctuation">;</span>
</code></pre> 
<h2><a id="_78"></a>三、案例</h2> 
<p>用原型模式来实现以下需求：<br> 假如某学校要对这一学期的社团指导老师颁发聘书，那么我现在就可以根据奖状模板进行克隆，用原型模式设计思想实现。</p> 
<p>原型对象：奖状类</p> 
<pre><code class="prism language-java"><span class="token comment">//原型对象：聘书</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Letter</span> <span class="token keyword">implements</span> <span class="token class-name">Cloneable</span><span class="token punctuation">{<!-- --></span>

    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>  <span class="token comment">//指导老师姓名</span>

    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> name<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setName</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"兹聘请 "</span><span class="token operator">+</span>name<span class="token operator">+</span><span class="token string">" 老师为 xxx 社团指导老师!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token class-name">Letter</span> <span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">CloneNotSupportedException</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token class-name">Letter</span><span class="token punctuation">)</span><span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>访问类：测试</p> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Test</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">CloneNotSupportedException</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">Letter</span> letter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Letter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//开始克隆</span>
        <span class="token class-name">Letter</span> letter1 <span class="token operator">=</span> letter<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//原型对象</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"原型对象："</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        letter<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">"张三"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        letter<span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//克隆对象</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"克隆后对象："</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        letter1<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">"李四"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        letter1<span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>运行结果：</p> 
<blockquote> 
 <p>原型对象： 兹聘请 张三 老师为 xxx 社团指导老师!<br> 克隆后对象： 兹聘请 李四 老师为 xxx 社团指导老师!</p> 
</blockquote> 
<p>这个例子比较简单好理解，现在我在这个案例中引入<code>深克隆和浅克隆</code>的概念。</p> 
<h3><a id="_131"></a>（一）浅克隆</h3> 
<p><strong>浅克隆</strong>：创建一个新对象，新对象的属性和原来对象完全相同，对于非基本类型属性，仍指向原有属性所指向的对象的内存地址。</p> 
<p>1、首先我再创建一个社团类，里面有一个社团名称的属性</p> 
<pre><code class="prism language-java"><span class="token comment">//社团类</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Association</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> name <span class="token punctuation">;</span>  <span class="token comment">//社团名称</span>

    <span class="token keyword">public</span> <span class="token class-name">Association</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> name<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setName</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>2、修改聘书类，加上一个社团类的对象属性</p> 
<pre><code class="prism language-java"><span class="token comment">//原型对象：聘书</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Letter</span> <span class="token keyword">implements</span> <span class="token class-name">Cloneable</span><span class="token punctuation">{<!-- --></span>

    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>  <span class="token comment">//指导老师姓名</span>
    <span class="token keyword">private</span> <span class="token class-name">Association</span> association<span class="token punctuation">;</span>  <span class="token comment">//社团</span>

    <span class="token keyword">public</span> <span class="token class-name">Letter</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token class-name">Association</span> association<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>association <span class="token operator">=</span> association<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> name<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setName</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">Association</span> <span class="token function">getAssociation</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> association<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setAssociation</span><span class="token punctuation">(</span><span class="token class-name">Association</span> association<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>association <span class="token operator">=</span> association<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"兹聘请 "</span><span class="token operator">+</span>name<span class="token operator">+</span><span class="token string">" 老师为 "</span><span class="token operator">+</span>association<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">" 社团指导老师!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token class-name">Letter</span> <span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">CloneNotSupportedException</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token class-name">Letter</span><span class="token punctuation">)</span><span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>测试类：将原型对象聘书类进行克隆，然后打印出原型对象中Association引用地址和克隆后Association引用地址，判断该引用地址是否发生改变</p> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Test</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">CloneNotSupportedException</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">Association</span> association <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Association</span><span class="token punctuation">(</span><span class="token string">"歌舞社"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//拷贝之前的对象</span>
        <span class="token class-name">Letter</span> letter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Letter</span><span class="token punctuation">(</span><span class="token string">"张三"</span><span class="token punctuation">,</span>association<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"克隆前对象："</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        letter<span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//拷贝之后的对象</span>
        <span class="token class-name">Letter</span> letter1 <span class="token operator">=</span> letter<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"克隆后对象："</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        letter1<span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//判断</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>letter<span class="token punctuation">.</span><span class="token function">getAssociation</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> letter1<span class="token punctuation">.</span><span class="token function">getAssociation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"克隆前Association对象的hashCode："</span><span class="token operator">+</span>letter<span class="token punctuation">.</span><span class="token function">getAssociation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"克隆后Association对象的hashCode："</span><span class="token operator">+</span>letter1<span class="token punctuation">.</span><span class="token function">getAssociation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>输出结果:</p> 
<blockquote> 
 <p>克隆前对象：兹聘请 张三 老师为 歌舞社 社团指导老师!<br> 克隆后对象：兹聘请 张三 老师为 歌舞社 社团指导老师!<br> true<br> 克隆前Association对象的hashCode：666988784<br> 克隆后Association对象的hashCode：666988784</p> 
</blockquote> 
<p>结果发现，letter.getAssociation() == letter1.getAssociation()结果返回<code>true</code>，说明克隆前后<code>Letter</code>类中持有的<code>Association</code>引用地址没有发生改变，加上show()内容一样，说明属性也没发生改变，这明显符合我们对浅克隆的定义。而且打印出来的<code>hashCode</code>值相同，同样证明了它们是引用的同一个地址。</p> 
<p><mark>由于指向同一个地址，那我对克隆后的对象修改属性，原来的原型对象中的属性也会发生变化吗？</mark><br> 测试如下，将克隆的对象中原来的张三指导的“歌舞社”改为“足球社”，再查看未克隆前的原型对象是否发生了改变。</p> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Test</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">CloneNotSupportedException</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">Association</span> association <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Association</span><span class="token punctuation">(</span><span class="token string">"歌舞社"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Letter</span> letter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Letter</span><span class="token punctuation">(</span><span class="token string">"张三"</span><span class="token punctuation">,</span>association<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//原来</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"原对象："</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        letter<span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//克隆并修改</span>
        <span class="token class-name">Letter</span> clone <span class="token operator">=</span> letter<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Association</span> association1 <span class="token operator">=</span> clone<span class="token punctuation">.</span><span class="token function">getAssociation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        association1<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">"足球社"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//再次查看原来对象</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"克隆对象修改后再次查看原来对象："</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        letter<span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>测试结果：</p> 
<blockquote> 
 <p>原对象：<br> 兹聘请 张三 老师为 歌舞社 社团指导老师!</p> 
 <p><br>克隆对象修改后再次查看原来对象：<br> 兹聘请 张三 老师为 足球社 社团指导老师!</p> 
</blockquote> 
<p>发现修改克隆对象中的属性，原对象也发生了同步改变。这再一次说明了<strong>浅克隆中，会把原型对象中成员变量为引用类型的引用地址也复制给克隆对象，且此引用对象的地址是共享给原型对象和克隆对象的。</strong></p> 
<p><strong><font color="blue">总结：浅克隆只复制指向某个对象的引用，而不复制对象本身，新旧对象还是共享同一块内存，修改对象会改到原对象</font></strong></p> 
<h3><a id="_260"></a>（二）深克隆</h3> 
<p>清楚了浅克隆例子后。再来回顾一下深克隆的定义 ---- 创建一个新对象，属性中引用的其他对象也会被克隆，不再指向原有对象地址。</p> 
<p>这要如何实现？很简单&gt;</p> 
<p>让Association类实现Cloneable接口，重写clone()方法</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Override</span>
<span class="token keyword">protected</span> <span class="token class-name">Association</span> <span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">CloneNotSupportedException</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token class-name">Association</span><span class="token punctuation">)</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>修改Letter类的clone()方法，加上对association的克隆</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Override</span>
<span class="token keyword">protected</span> <span class="token class-name">Letter</span> <span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">CloneNotSupportedException</span> <span class="token punctuation">{<!-- --></span>
    <span class="token class-name">Letter</span> letter <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Letter</span><span class="token punctuation">)</span><span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//拷贝Association对象</span>
    letter<span class="token punctuation">.</span>association<span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>association<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> letter<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>测试结果：</p> 
<blockquote> 
 <p>原对象：<br> 兹聘请 张三 老师为 歌舞社 社团指导老师!<br> <br>克隆后对象：<br> 兹聘请 张三 老师为 足球社 社团指导老师!<br> <br>克隆对象修改后再次查看原来对象：<br> 兹聘请 张三 老师为 歌舞社 社团指导老师!</p> 
</blockquote> 
<p>经过这一顿操作后，修改克隆后对象的属性，也不会影响到原对象，这就是深克隆，<strong>它将原型对象中的所有类型，无论是值类型还是引用类型，都复制了一份给克隆对象。</strong></p> 
<p><strong><font color="blue">总结：深克隆对原型对象完全拷贝，但新对象跟原对象不共享内存，修改新对象不会改变原对象。</font></strong></p> 
<h3><a id="_298"></a>（三）浅克隆和深克隆的区别</h3> 
<p>最后用一张图简单的总结一下浅克隆和深克隆的区别<br> <img src="https://images2.imgbox.com/ab/eb/OdFVHxme_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="_301"></a>四、原型模式使用场景</h2> 
<p>原型模式（Prototype Pattern）是用于创建重复的对象，同时又能保证性能。这种类型的设计模式属于创建型模式，它提供了一种创建对象的最佳方式。</p> 
<p><strong>它的使用场景如下：</strong></p> 
<blockquote> 
 <p>1、资源优化场景。<br> 2、类初始化需要消化非常多的资源，这个资源包括数据、硬件资源等。<br> 3、性能和安全要求的场景。<br> 4、通过new 产生一个对象需要非常繁琐的数据准备或访问权限，则可以使用原型模式。<br> 5、一个对象多个修改者的场景。<br> 6、一个对象需要提供给其他对象访问，而且各个调用者可能都需要修改其值时，可以考虑使用原型模式拷贝多个对象供调用者使用。<br> 7、在实际项目中，原型模式很少单独出现，一般是和工厂方法模式一起出现，通过 clone 的方法创建一个对象，然后由工厂方法提供给调用者。原型模式已经与 Java 融为浑然一体，大家可以随手拿来使用。</p> 
</blockquote>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/0ee2b0c5eed2b89972932ec8cfd50b17/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">【4.22-周五】lc贪心问题：55 &amp;&amp; 45</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/d70ad0281389b8e12d550a64505ea144/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Jenkins如何使用以及配置环境</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 追风少年的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>