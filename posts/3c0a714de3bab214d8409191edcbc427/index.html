<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>聊聊 Airtest 自动化工具 - 追风少年的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="聊聊 Airtest 自动化工具" />
<meta property="og:description" content="点击上方“ AirPython ”，选择“置顶公众号” 第一时间获取 Python 技术干货！ 阅读文本大概需要 5 分钟。 很多读者看过之前的文章，发现我使用最多的是一款 Airtest 的自动化测试框架。 Airtest 是一款适合于游戏和 App 的 UI 自动化测试框架。 下面对 Airtest 在平时自动化和爬虫过程中的常见问题做一个汇总。 1、 优势 Airtest 上手难易度低，高效方便，结合 Python 脚本，可以完成一些自动化的操作，也可以快速开发出一款 App 端的爬虫。 2、 AirtestIDE 还是 Pycharm 如果只是简单的一些操作，可以使用官网提供的 AirtestIDE，通过简单的拖拽、按压、点击就能完成脚本录制和回放操作。 当然，想完成一些复杂的操作，就需要在 Python 虚拟环境下安装 pocoui 依赖库，然后借助 Pycharm 编写 Python 脚本来完成。 3、 Airtest 结合 Python 操作 只需要在 Python 虚拟环境下安装 pocoui 依赖库。 pip3 install pocoui 4、 有线连接和无线连接 利用 Airtest 驱动手机完成自动化操作，有两种方式： 有线连接、无线连接。 有线连接 ：手机通过数据线连接 PC，确保使用 adb devices 命令能找到设备。 然后，通过下面的 Python 代码即可以完成连接操作。 # 通过有线连接 PC 端和手机 self." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://zhuifengsn.github.io/posts/3c0a714de3bab214d8409191edcbc427/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2019-10-21T09:22:00+08:00" />
<meta property="article:modified_time" content="2019-10-21T09:22:00+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="追风少年的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">追风少年的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">聊聊 Airtest 自动化工具</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <div class="rich_media_content" id="js_content"> 
 <div> 
  <div class="xmteditor"></div> 
 </div> 
 <div> 
  点击上方“ 
  AirPython 
  ”，选择“置顶公众号” 
 </div> 
 <div> 
  第一时间获取 Python 技术干货！ 
 </div> 
 <p><br></p> 
 <div> 
  <img src="https://images2.imgbox.com/9b/70/rg2JVUes_o.png" alt="640?wx_fmt=jpeg"> 
 </div> 
 <p><br></p> 
 <div class="_135editor"> 
  <div> 
   <div> 
    阅读文本大概需要 5 分钟。 
   </div> 
  </div> 
 </div> 
 <p><br></p> 
 <div> 
   
  很多读者看过之前的文章，发现我使用最多的是一款 Airtest 的自动化测试框架。 
 </div> 
 <div> 
  <br> 
 </div> 
 <div> 
  Airtest 是一款适合于游戏和 App 的 UI 自动化测试框架。 
 </div> 
 <p><br></p> 
 <div> 
  下面对 Airtest 在平时自动化和爬虫过程中的常见问题做一个汇总。 
 </div> 
 <p><br></p> 
 <p><br></p> 
 <div> 
  <em><strong>1、</strong></em> 
  优势 
 </div> 
 <div> 
  <br> 
 </div> 
 <div> 
  Airtest 上手难易度低，高效方便，结合 Python 脚本，可以完成一些自动化的操作，也可以快速开发出一款 App 端的爬虫。 
 </div> 
 <p><br></p> 
 <div> 
   
 </div> 
 <div> 
  <em><strong>2、</strong></em> 
  AirtestIDE 还是 Pycharm 
 </div> 
 <p><br></p> 
 <div> 
  如果只是简单的一些操作，可以使用官网提供的 AirtestIDE，通过简单的拖拽、按压、点击就能完成脚本录制和回放操作。 
 </div> 
 <div> 
  <br> 
 </div> 
 <div> 
  <img class="rich_pages" src="https://images2.imgbox.com/1b/5d/TN5wkugU_o.png" alt="640?wx_fmt=jpeg"> 
 </div> 
 <div> 
   
  <br> 
 </div> 
 <div> 
  当然，想完成一些复杂的操作，就需要在 Python 虚拟环境下安装 pocoui 依赖库，然后借助 Pycharm 编写 Python 脚本来完成。 
 </div> 
 <div> 
   
 </div> 
 <p><br></p> 
 <div> 
  <em><strong>3、</strong></em> 
  Airtest 结合 Python 操作 
 </div> 
 <div> 
  <br> 
 </div> 
 <div> 
  只需要在 Python 虚拟环境下安装 pocoui 依赖库。 
 </div> 
 <div> 
  <br> 
 </div> 
 <div class="output_wrapper"> 
  <pre></pre> 
  <div> 
   <span class="hljs-attribute">pip3</span> install pocoui 
   <br> 
  </div> 
 </div> 
 <div> 
   
  <br> 
 </div> 
 <div> 
  <em><strong>4、</strong></em> 
  有线连接和无线连接 
 </div> 
 <p><br></p> 
 <div> 
  利用 Airtest 驱动手机完成自动化操作，有两种方式： 
  有线连接、无线连接。 
  <br> 
 </div> 
 <p><br></p> 
 <div> 
  有线连接 
  ：手机通过数据线连接 PC，确保使用 adb devices 命令能找到设备。 
 </div> 
 <div> 
  <br> 
 </div> 
 <div> 
  然后，通过下面的 Python 代码即可以完成连接操作。 
  <br> 
 </div> 
 <div> 
  <br> 
 </div> 
 <div class="output_wrapper"> 
  <pre></pre> 
  <div> 
   <span class="hljs-comment"># 通过有线连接 PC 端和手机</span> 
   <br> 
   <span class="hljs-keyword">self</span>.poco = AndroidUiautomationPoco(screenshot_each_action= 
   <span class="hljs-keyword">False</span>) 
   <br>auto_setup( 
   <span class="hljs-keyword">__file__</span>) 
   <br> 
  </div> 
 </div> 
 <div> 
   
  <br> 
 </div> 
 <div> 
  无线连接 
  ：保证手机和 PC 在同一个网段，使用 adb 启动手机端的 adb 端口，然后使用下面的 Python 代码完成连接操作。 
  <br> 
 </div> 
 <div> 
  <br> 
 </div> 
 <div class="output_wrapper"> 
  <pre></pre> 
  <div> 
   <span class="hljs-comment"># 通过 adb 命令开启手机端的 adb 端口</span> 
   <br>adb tcpip 6666 
   <br> 
   <br> 
   <span class="hljs-comment"># 通过 Python，无线连接 PC 和手机</span> 
   <br>device = connect_device('android:///192.168.1.166:6666?cap_method=javacap&amp;touch_method=adb') 
   <br> 
   <br>poco = AndroidUiautomationPoco(device_1, screenshot_each_action=False) 
   <br> 
   <br>auto_setup(__file__) 
   <br> 
  </div> 
 </div> 
 <p><br></p> 
 <div> 
   
 </div> 
 <div> 
  <em><strong>5、</strong></em> 
  常用操作 
 </div> 
 <p><br></p> 
 <div> 
  只需要通过 Android SDK 中的 Monitor 工具识别到元素 ID 或者文本，然后借助 Poco 依赖库完成常见的操作。 
 </div> 
 <div> 
  <br> 
 </div> 
 <div> 
  常用手势操作包含：点击、长按、滑动。 
 </div> 
 <div> 
  <br> 
 </div> 
 <div class="output_wrapper"> 
  <pre></pre> 
  <div> 
   <span class="hljs-comment"># 点击1</span> 
   <br>poco(元素ID).click() 
   <br> 
   <br> 
   <span class="hljs-comment"># 点击2</span> 
   <br>poco(text= 
   <span class="hljs-string">u'元素文本内容'</span>).click() 
   <br> 
   <br> 
   <span class="hljs-comment"># 长按</span> 
   <br>poco(元素ID或者元素文本).long_click(长按的时长) 
   <br> 
   <br> 
   <span class="hljs-comment"># 滑动到下一页</span> 
   <br>poco.swipe([起始坐标x轴, 起始坐标y轴], [终点坐标x轴, 终点坐标y轴], duration=滑动时长) 
   <br> 
   <br>poco.swipe([ 
   <span class="hljs-number">0.5</span>,  
   <span class="hljs-number">0.8</span>], [ 
   <span class="hljs-number">0.5</span>,  
   <span class="hljs-number">0.3</span>], duration= 
   <span class="hljs-number">1</span>) 
   <br> 
   <br> 
   <span class="hljs-comment"># 滑动到上一页</span> 
   <br>poco.swipe([ 
   <span class="hljs-number">0.5</span>,  
   <span class="hljs-number">0.3</span>], [ 
   <span class="hljs-number">0.5</span>,  
   <span class="hljs-number">0.8</span>], duration= 
   <span class="hljs-number">1</span>) 
   <br> 
  </div> 
 </div> 
 <div> 
   
  <br> 
 </div> 
 <div> 
  pocoui 已经封装了页面的常用操作，包含：回到桌面、模拟手机返回键、锁屏键、截屏、卸载、打开应用等操作。<br> 
 </div> 
 <div> 
  <br> 
 </div> 
 <div class="output_wrapper"> 
  <pre></pre> 
  <div> 
   <span class="hljs-comment"># pocoui 封装的一些方法</span> 
   <br> 
   <br> 
   <span class="hljs-comment"># 打开应用</span> 
   <br> 
   <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">start_app</span><span class="hljs-params">(package, activity=None)</span>:</span> 
   <br> 
   <br> 
   <span class="hljs-comment"># 停止应用</span> 
   <br> 
   <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">stop_app</span><span class="hljs-params">(package)</span>:</span> 
   <br> 
   <br> 
   <span class="hljs-comment"># 截屏</span> 
   <br> 
   <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">snapshot</span><span class="hljs-params">(filename=None, msg=<span class="hljs-string">""</span>)</span>:</span> 
   <br> 
   <br> 
   <span class="hljs-comment"># 回到桌面</span> 
   <br> 
   <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">home</span><span class="hljs-params">()</span>:</span> 
   <br> 
   <br> 
   <span class="hljs-comment"># 模拟按键操作</span> 
   <br> 
   <span class="hljs-comment"># 模拟页面返回操作</span> 
   <br>keyevent( 
   <span class="hljs-string">'BACK'</span>) 
   <br> 
  </div> 
 </div> 
 <p><br></p> 
 <div> 
   
 </div> 
 <div> 
  <em><strong>6、</strong></em> 
  异常处理 
 </div> 
 <p><br></p> 
 <div> 
  由于 Airtest 是一款 UI 测试框架，对可见的元素能通过元素 ID 或者文本内容拿到元素，处理列表的时候，滑动的时候经常会导致元素异常，这里要做好异常处理。 
   
 </div> 
 <div> 
  <br> 
 </div> 
 <div class="output_wrapper"> 
  <pre></pre> 
  <div> 
   <span class="hljs-comment"># 处理列表元素</span> 
   <br> 
   <span class="hljs-keyword">try</span>: 
   <br>     self.__handle_good_list() 
   <br> 
   <span class="hljs-keyword">except</span>: 
   <br>      
   <span class="hljs-keyword">pass</span> 
   <br> 
  </div> 
 </div> 
 <p><br></p> 
 <div> 
   
 </div> 
 <div> 
   
 </div> 
 <div> 
  <em><strong>7、</strong></em> 
  元素获取不到 
 </div> 
 <p><br></p> 
 <div> 
  借助 Android SDK 中的 Monitor 查看元素属性，会发现有些元素没有 ID 和文本，这时候可以查看 UI 树的结构，找到一个可以确定的元素，通过父子关系拿到这个元素。 
 </div> 
 <p><br></p> 
 <div> 
  <em><strong>8、</strong></em> 
  点击无效 
 </div> 
 <p><br></p> 
 <div> 
  有的时候，通过 pocoui 拿到元素对象，但是点击没有效果。 
 </div> 
 <div> 
  <br> 
 </div> 
 <div> 
  这种情况，可以通过反复点击，直达某个元素出现来解决这个问题。 
 </div> 
 <p><br></p> 
 <div class="output_wrapper"> 
  <pre></pre> 
  <div> 
   <span class="hljs-comment"># 点击搜索按钮</span> 
   <br> 
   <span class="hljs-keyword">while</span>  
   <span class="hljs-keyword">True</span>: 
   <br>      
   <span class="hljs-comment"># 等待检索结果列表出现</span> 
   <br>      
   <span class="hljs-keyword">if</span> not  
   <span class="hljs-keyword">self</span>.poco(元素ID).exists(): 
   <br>           
   <span class="hljs-comment"># 再次点击</span> 
   <br>          perform_click( 
   <span class="hljs-keyword">self</span>.poco(元素ID, text= 
   <span class="hljs-string">'搜索'</span>)) 
   <br>      
   <span class="hljs-keyword">else</span>: 
   <br>           
   <span class="hljs-keyword">break</span> 
   <br> 
  </div> 
 </div> 
 <p><br></p> 
 <div> 
   
 </div> 
 <p><br></p> 
 <p><br></p> 
 <div> 
  <strong>推荐阅读</strong> 
 </div> 
 <p><br></p> 
 <div> 
  <div> 
   <div> 
    <br> 
   </div> 
   <div> 
    <br> 
   </div> 
   <div> 
    <br> 
   </div> 
  </div> 
 </div> 
 <p><br></p> 
 <p><br></p> 
 <div> 
  <img src="https://images2.imgbox.com/b7/75/Zh50UglE_o.png" alt="640?wx_fmt=jpeg"> 
 </div> 
 <p><br></p> 
 <div> 
  THANDKS 
 </div> 
 <div> 
  - End - 
 </div> 
</div>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/2026502d5ffdeaf4ca87c65be2fe920f/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">2019.10.18 - Linux与MacOS 修改系统时间</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/9c2220b9df62996ff9ada74e12b3d2e2/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Java是动态语言还是静态语言，是强类型还是弱类型？</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 追风少年的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>