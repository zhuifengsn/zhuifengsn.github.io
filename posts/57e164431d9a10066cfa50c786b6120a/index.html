<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>“特质波动率之谜”（Idiosyncratic Volatility），用Python计算特质波动率 - 追风少年的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="“特质波动率之谜”（Idiosyncratic Volatility），用Python计算特质波动率" />
<meta property="og:description" content="Hello，大家好，今天给大家介绍的是有关于“特质波动率”度量的相关内容。曾在写本科毕业论文时有所涉及，当时看了好多资料，发现它还有很多研究空间，并且由Ang所提出的“特质波动率之谜”的现象至今也未有合理的解释。所以今天就给大家用python对“特质波动率”进行计算。
特质波动率 “特质波动率之谜”的介绍特质波动率的度量方法Python代码相关文章获取代码 “特质波动率之谜”的介绍 风险与收益一直是金融学中形影不离的两个概念。经典的CAPM模型，只考虑了系统性风险，认为股票预期收益率只与市场风险溢价有关。直到1972年，Jensen，Black和Scholes对传统金融学理论提出了不同的看法，认为非系统性风险与股票收益率是存在一定的相关关系，并首次提出了特质波动率的概念。Merton曾从供需的角度来解释这两者之间的关系，认为投资者会对系统风险和非系统风险都要求进行一定的风险补偿，而这一解释也被大家广泛地接受与认可。
一般来讲，我们都认为风险与收益应该是正相关，即风险越高，收益率越高。但在2006年，Ang等人却得出了不一样的结论，他们借助Fama-French三因子模型却发现特质波动率与预期收益率之间的关系变为负相关关系。目前尚未有公认的理论可以解释这种异象，因此引起了剧烈的争论，而这一异象也被称为“特质波动率之谜”。
特质波动率的度量方法 在特质波动率的度量方面，我利用Fama-French三因子模型进行计算
（有关三因子模型的介绍与代码在之前的文章有所讲解，读者们可见文末链接）
首先，通过三因子模型，得到每日的残差，即ε
然后，计算残差的波动率，即当月残差标准差乘以当月总交易天数。
这样就得到我们所要的特质波动率了。
Python代码 Python实现的过程中，我们只需要使用pandas、statsmodels.formula.api两个包即可完成：
import pandas as pd import statsmodels.formula.api as smf 首先，读取数据，我从锐思数据库中，下载了创业板中2015-2019年所有股票每日收益率、无风险收益率以及创业板每日的三因子：
Factors = pd.read_excel(&#34;F:\\公众号\\图文素材\\特质波动率\\Data.xlsx&#34;, sheetname = 0, header = 0) Return = pd.read_excel(&#34;F:\\公众号\\图文素材\\特质波动率\\Data.xlsx&#34;, sheetname = 1, header = 0) NoRisk = pd.read_excel(&#34;F:\\公众号\\图文素材\\特质波动率\\Data.xlsx&#34;, sheetname = 2, header = 0) 为了后续筛选日期方便，我们需要将“日期”的数据类型更改为日期型：
Factors[&#39;Date&#39;] = pd.to_datetime(Factors[&#39;Date&#39;]) Return[&#39;Date&#39;] = pd.to_datetime(Return[&#39;Date&#39;]) NoRisk[&#39;Date&#39;] = pd.to_datetime(NoRisk[&#39;Date&#39;]) 通过pd.merge()将数据进行合并：
Data = pd.merge(pd.merge(Factors, Return, on = &#39;Date&#39;), NoRisk, on = &#39;Date&#39;) 参数说明：" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://zhuifengsn.github.io/posts/57e164431d9a10066cfa50c786b6120a/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-06-16T17:40:15+08:00" />
<meta property="article:modified_time" content="2020-06-16T17:40:15+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="追风少年的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">追风少年的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">“特质波动率之谜”（Idiosyncratic Volatility），用Python计算特质波动率</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>Hello，大家好，今天给大家介绍的是有关于“特质波动率”度量的相关内容。曾在写本科毕业论文时有所涉及，当时看了好多资料，发现它还有很多研究空间，并且由Ang所提出的“特质波动率之谜”的现象至今也未有合理的解释。所以今天就给大家用python对“特质波动率”进行计算。</p> 
<p></p> 
<div class="toc"> 
 <h4>特质波动率</h4> 
 <ul><li><a href="#_3" rel="nofollow">“特质波动率之谜”的介绍</a></li><li><a href="#_8" rel="nofollow">特质波动率的度量方法</a></li><li><a href="#Python_17" rel="nofollow">Python代码</a></li><li><a href="#_113" rel="nofollow">相关文章</a></li><li><a href="#_116" rel="nofollow">获取代码</a></li></ul> 
</div> 
<p></p> 
<h2><a id="_3"></a>“特质波动率之谜”的介绍</h2> 
<p>风险与收益一直是金融学中形影不离的两个概念。经典的CAPM模型，只考虑了系统性风险，认为股票预期收益率只与市场风险溢价有关。直到1972年，Jensen，Black和Scholes对传统金融学理论提出了不同的看法，认为非系统性风险与股票收益率是存在一定的相关关系，并首次提出了特质波动率的概念。Merton曾从供需的角度来解释这两者之间的关系，认为投资者会对系统风险和非系统风险都要求进行一定的风险补偿，而这一解释也被大家广泛地接受与认可。</p> 
<p>一般来讲，我们都认为风险与收益应该是正相关，即风险越高，收益率越高。但在2006年，Ang等人却得出了不一样的结论，他们借助Fama-French三因子模型却发现特质波动率与预期收益率之间的关系变为负相关关系。目前尚未有公认的理论可以解释这种异象，因此引起了剧烈的争论，而这一异象也被称为“特质波动率之谜”。</p> 
<h2><a id="_8"></a>特质波动率的度量方法</h2> 
<p>在特质波动率的度量方面，我利用Fama-French三因子模型进行计算<br> （<em>有关三因子模型的介绍与代码在之前的文章有所讲解，读者们可见文末链接</em>）</p> 
<p>首先，通过三因子模型，得到每日的残差，即ε<br> <img src="https://images2.imgbox.com/6a/26/6GGtwZ8i_o.png" alt="在这里插入图片描述"><br> 然后，计算残差的波动率，即当月残差标准差乘以当月总交易天数。<br> <img src="https://images2.imgbox.com/33/b0/3zP3z9jo_o.png" alt="在这里插入图片描述"><br> 这样就得到我们所要的特质波动率了。</p> 
<h2><a id="Python_17"></a>Python代码</h2> 
<p>Python实现的过程中，我们只需要使用pandas、statsmodels.formula.api两个包即可完成：</p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
<span class="token keyword">import</span> statsmodels<span class="token punctuation">.</span>formula<span class="token punctuation">.</span>api <span class="token keyword">as</span> smf
</code></pre> 
<p>首先，读取数据，我从锐思数据库中，下载了创业板中2015-2019年所有股票每日收益率、无风险收益率以及创业板每日的三因子：</p> 
<pre><code class="prism language-python">Factors <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_excel<span class="token punctuation">(</span><span class="token string">"F:\\公众号\\图文素材\\特质波动率\\Data.xlsx"</span><span class="token punctuation">,</span> sheetname <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> header <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span>
Return <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_excel<span class="token punctuation">(</span><span class="token string">"F:\\公众号\\图文素材\\特质波动率\\Data.xlsx"</span><span class="token punctuation">,</span> sheetname <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> header <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span>
NoRisk <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_excel<span class="token punctuation">(</span><span class="token string">"F:\\公众号\\图文素材\\特质波动率\\Data.xlsx"</span><span class="token punctuation">,</span> sheetname <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span> header <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span>
</code></pre> 
<p>为了后续筛选日期方便，我们需要将“日期”的数据类型更改为日期型：</p> 
<pre><code class="prism language-python">Factors<span class="token punctuation">[</span><span class="token string">'Date'</span><span class="token punctuation">]</span> <span class="token operator">=</span> pd<span class="token punctuation">.</span>to_datetime<span class="token punctuation">(</span>Factors<span class="token punctuation">[</span><span class="token string">'Date'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
Return<span class="token punctuation">[</span><span class="token string">'Date'</span><span class="token punctuation">]</span> <span class="token operator">=</span> pd<span class="token punctuation">.</span>to_datetime<span class="token punctuation">(</span>Return<span class="token punctuation">[</span><span class="token string">'Date'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
NoRisk<span class="token punctuation">[</span><span class="token string">'Date'</span><span class="token punctuation">]</span> <span class="token operator">=</span> pd<span class="token punctuation">.</span>to_datetime<span class="token punctuation">(</span>NoRisk<span class="token punctuation">[</span><span class="token string">'Date'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre> 
<p>通过pd.merge()将数据进行合并：</p> 
<pre><code class="prism language-python">Data <span class="token operator">=</span> pd<span class="token punctuation">.</span>merge<span class="token punctuation">(</span>pd<span class="token punctuation">.</span>merge<span class="token punctuation">(</span>Factors<span class="token punctuation">,</span> Return<span class="token punctuation">,</span> on <span class="token operator">=</span> <span class="token string">'Date'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> NoRisk<span class="token punctuation">,</span> on <span class="token operator">=</span> <span class="token string">'Date'</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/39/42/A60TUsSO_o.png" alt="在这里插入图片描述"><br> <em>参数说明：<br> pd.merge(left, right, how=‘inner’, on=None, left_on=None, right_on=None,<br> left_index=False, right_index=False, sort=True,<br> suffixes=(’_x’, ‘_y’), copy=True, indicator=False,<br> validate=None)<br> 1、left: 拼接的左侧DataFrame对象<br> 2、right: 拼接的右侧DataFrame对象<br> 3、on: 要加入的列或索引级别名称。 必须在左侧和右侧DataFrame对象中找到。 如果未传递且left_index和right_index为False，则DataFrame中的列的交集将被推断为连接键。<br> 4、left_on:左侧DataFrame中的列或索引级别用作键。 可以是列名，索引级名称，也可以是长度等于DataFrame长度的数组。<br> 5、right_on: 左侧DataFrame中的列或索引级别用作键。 可以是列名，索引级名称，也可以是长度等于DataFrame长度的数组。<br> 6、left_index: 如果为True，则使用左侧DataFrame中的索引（行标签）作为其连接键。 对于具有MultiIndex（分层）的DataFrame，级别数必须与右侧DataFrame中的连接键数相匹配。<br> 7、right_index: 与left_index功能相似。<br> 8、how: One of ‘left’, ‘right’, ‘outer’, ‘inner’. 默认inner。inner是取交集，outer取并集。比如left：[‘A’,‘B’,‘C’];right[’'A,‘C’,‘D’]；inner取交集的话，left中出现的A会和right中出现的买一个A进行匹配拼接，如果没有是B，在right中没有匹配到，则会丢失。'outer’取并集，出现的A会进行一一匹配，没有同时出现的会将缺失的部分添加缺失值。<br> 9、sort: 按字典顺序通过连接键对结果DataFrame进行排序。 默认为True，设置为False将在很多情况下显着提高性能。<br> 10、suffixes: 用于重叠列的字符串后缀元组。 默认为（‘x’，’ y’）。<br> 11、copy: 始终从传递的DataFrame对象复制数据（默认为True），即使不需要重建索引也是如此。<br> 12、indicator: 将一列添加到名为_merge的输出DataFrame，其中包含有关每行源的信息。 _merge是分类类型，并且对于其合并键仅出现在“左”DataFrame中的观察值，取得值为left_only，对于其合并键仅出现在“右”DataFrame中的观察值为right_only，并且如果在两者中都找到观察点的合并键，则为left_only。</em></p> 
<p>然后从日期中提取年份和月份：<br> Data[‘Year’] = Data[‘Date’].dt.year<br> Data[‘Month’] = Data[‘Date’].dt.month<br> <img src="https://images2.imgbox.com/70/1c/GV2vkK9r_o.png" alt="在这里插入图片描述"><br> 我们创建一个函数，用于提取某只股票某月下的数据：</p> 
<pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">get_month_data</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> code<span class="token punctuation">,</span> year<span class="token punctuation">,</span> month<span class="token punctuation">)</span><span class="token punctuation">:</span>
    month_data <span class="token operator">=</span> data<span class="token punctuation">[</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>Stkcd <span class="token operator">==</span> code<span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token punctuation">(</span>data<span class="token punctuation">.</span>Year <span class="token operator">==</span> year<span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token punctuation">(</span>data<span class="token punctuation">.</span>Month <span class="token operator">==</span> month<span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token keyword">return</span> month_data
</code></pre> 
<p>接下来，我们计算一下300001这只股票在2019年12月份的特质波动率。<br> 首先，我们获得这只股票当月的数据：</p> 
<pre><code class="prism language-python">example <span class="token operator">=</span> get_month_data<span class="token punctuation">(</span>Data<span class="token punctuation">,</span> <span class="token number">300001</span><span class="token punctuation">,</span> <span class="token number">2019</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/6b/de/6yqNBdFq_o.png" alt="在这里插入图片描述"><br> 统计当月交易总天数：</p> 
<pre><code class="prism language-python">N <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>example<span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/a3/83/WeKml2kH_o.png" alt="在这里插入图片描述"><br> 建立回归模型，并计算残差：</p> 
<pre><code class="prism language-python">model <span class="token operator">=</span> smf<span class="token punctuation">.</span>ols<span class="token punctuation">(</span><span class="token string">'Dretnd - Nrrdaydt ~ RiskPremium + SMB + HML'</span><span class="token punctuation">,</span> data <span class="token operator">=</span> example<span class="token punctuation">)</span><span class="token punctuation">.</span>fit<span class="token punctuation">(</span><span class="token punctuation">)</span>
predict <span class="token operator">=</span> model<span class="token punctuation">.</span>params<span class="token punctuation">[</span><span class="token string">'Intercept'</span><span class="token punctuation">]</span> <span class="token operator">+</span> model<span class="token punctuation">.</span>params<span class="token punctuation">[</span><span class="token string">'RiskPremium'</span><span class="token punctuation">]</span><span class="token operator">*</span>example<span class="token punctuation">[</span><span class="token string">'RiskPremium'</span><span class="token punctuation">]</span> <span class="token operator">+</span> model<span class="token punctuation">.</span>params<span class="token punctuation">[</span><span class="token string">'SMB'</span><span class="token punctuation">]</span><span class="token operator">*</span>example<span class="token punctuation">[</span><span class="token string">'SMB'</span><span class="token punctuation">]</span> <span class="token operator">+</span> model<span class="token punctuation">.</span>params<span class="token punctuation">[</span><span class="token string">'HML'</span><span class="token punctuation">]</span><span class="token operator">*</span>example<span class="token punctuation">[</span><span class="token string">'HML'</span><span class="token punctuation">]</span>
residual <span class="token operator">=</span> example<span class="token punctuation">[</span><span class="token string">'Dretnd'</span><span class="token punctuation">]</span> – predict
</code></pre> 
<p><img src="https://images2.imgbox.com/8d/bc/2QfTxUcO_o.png" alt="在这里插入图片描述"><br> 接着，计算得出特质波动率：</p> 
<pre><code class="prism language-python">IV <span class="token operator">=</span> residual<span class="token punctuation">.</span>std<span class="token punctuation">(</span>ddof<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> N
</code></pre> 
<p><img src="https://images2.imgbox.com/67/80/07JPflgQ_o.png" alt="在这里插入图片描述"><br> <em>参数说明：<br> pd.std(ddof = 1)<br> 该函数是pandas所带的标准差计算方法，默认按照无偏估计进行计算，即ddof = 1，即n-ddof。</em></p> 
<p>最后，我们可以用循环语句进行遍历计算，并创建一个DataFrame进行储存和导出：<br> <img src="https://images2.imgbox.com/eb/e3/QrKTNLYb_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="_113"></a>相关文章</h2> 
<p><a href="https://blog.csdn.net/FightingBob/article/details/105234102">数据分析—Fama-French三因子模型</a></p> 
<h2><a id="_116"></a>获取代码</h2> 
<p>以下是我的个人公众号，该篇的数据和完整代码可在公众号中回复“<strong>特质波动率</strong>”即可获得，谢谢大家支持。<br> <img src="https://images2.imgbox.com/a0/5b/xu5gEPf5_o.jpg" alt="在这里插入图片描述"></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/a2aa13c11e3478eea8827e476a7ce100/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">2020.6.16</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/28f0f5fdf0bf3207a6c815701b80471e/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">解决Spring Boot 配置SSL之后项目启动443端口占用问题</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 追风少年的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>