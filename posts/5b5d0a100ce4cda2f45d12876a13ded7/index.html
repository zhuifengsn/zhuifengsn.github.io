<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>【完结版】jmeter&#43;ant&#43;python自动化框架，且支持jenkins持续集成 - 追风少年的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="【完结版】jmeter&#43;ant&#43;python自动化框架，且支持jenkins持续集成" />
<meta property="og:description" content="前言：本文是实现jmeter&#43;ant&#43;python脚本的自动化测试框架，并且把整套部署在jenkins，通过jenkins的构建来出发脚本的运行，而且还会在jenkins上展示html报告。本文记录搭建框架的整个步骤，以及遇到的问题和记录解决办法。
一、整体框架的介绍。 项目名：jmeter_autotest
项目需要的工具：apache-jmeter-5.4.3 apache-ant-1.10.5 编辑器：pycharm （只是为了比较好修改文件）
项目目录
--project. 用来存放项目文件 jmx和build
--report 用来存放测试报告
--testing 用来存放python脚本
--tools 用来存放apache-jmeter-5.4.3 apache-ant-1.10.5 包
给大家展示下我本地的目录结构：
二、部署到jenkins，并且通过参数构建给jmeter传参数，以至于来给jmeter的用户变量传递不同的参数，达到参数构建的效果 1）jenkins的部署，这个部署步骤就百度吧或者看我之前的文章。资料很多，这里不再废话。
2）将上面的框架代码，包含jmeter和ant全部上传到gitee。我这里已上传，有需要的自取，自取的同学不要忘了给作者文章点个小赞👍哦。
3）在jenkins上创建自由风格的项目。取名jmeter_autotest
4) 选择参数化构建-选项参数，然后在名称处填上 env 在选项处填上 uat 和prod（需要换行填写） 描述可以填入 “请选择执行环境 ”的提示语
5）选择git 拉取上传到git上的代码。
6）添加构建步骤，这里一定要跟我添加的步骤一样，不然会出现各种各样的额问题
执行shell脚本删除掉历史报告 echo &#34;删除历史报告&#34; rm -rf ${WORKSPACE}/report/html/* rm -rf ${WORKSPACE}/report/jtl/* 选择Execute system Groovy script （一定是这个哈，需要先在jenkins插件管理安装Groovy插件）然后在Groovy Script处填入以下代码。这里主要是解决我们后面显示html报告时，没有出来css样式的问题。 System.setProperty(&#34;hudson.model.DirectoryBrowserSupport.CSP&#34;, &#34;&#34;) 选择 Invoke Ant， 选择版本，同样是需要先在jenkins管理中心先配置ant Target填写run Build File填写build.xml文件的路径 7）修改build.xml文件 源文件因为涉及到太多公司项目路径，这里不方便截图，需要请私聊
注意一个点：这个点我研究了很久
接收上面jenkins传过来的env，如何把值传给jmeter呢？ 答案是这样的。jenkins传给ant的build.xml文件，然后在传给需要执行jmeter的jmx文件。build.xml文件中需要增加 &lt;property name=&#34;env&#34; value=&#34;${env}&#34;/&gt; 如下图： &lt;jmeter jmeterhome=&#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://zhuifengsn.github.io/posts/5b5d0a100ce4cda2f45d12876a13ded7/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-09-24T23:36:33+08:00" />
<meta property="article:modified_time" content="2022-09-24T23:36:33+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="追风少年的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">追风少年的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">【完结版】jmeter&#43;ant&#43;python自动化框架，且支持jenkins持续集成</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>          前言：本文是实现jmeter+ant+python脚本的自动化测试框架，并且把整套部署在jenkins，通过jenkins的构建来出发脚本的运行，而且还会在jenkins上展示html报告。本文记录搭建框架的整个步骤，以及遇到的问题和记录解决办法。</p> 
<h4 id="%C2%A0%E4%B8%80%E3%80%81%E6%95%B4%E4%BD%93%E6%A1%86%E6%9E%B6%E7%9A%84%E4%BB%8B%E7%BB%8D%E3%80%82"> 一、整体框架的介绍。</h4> 
<p>        项目名：jmeter_autotest</p> 
<p>        项目需要的工具：apache-jmeter-5.4.3   apache-ant-1.10.5 </p> 
<p>        编辑器：pycharm （只是为了比较好修改文件）</p> 
<p>        项目目录</p> 
<p>                --project. 用来存放项目文件  jmx和build</p> 
<p>                --report  用来存放测试报告</p> 
<p>                --testing  用来存放python脚本</p> 
<p>                --tools   用来存放apache-jmeter-5.4.3   apache-ant-1.10.5 包</p> 
<p> 给大家展示下我本地的目录结构：</p> 
<p><img alt="" height="826" src="https://images2.imgbox.com/c3/50/6vQFzqmM_o.png" width="722"></p> 
<p> </p> 
<h4>二、部署到jenkins，并且通过参数构建给jmeter传参数，以至于来给jmeter的用户变量传递不同的参数，达到参数构建的效果</h4> 
<p>1）jenkins的部署，这个部署步骤就百度吧或者看我之前的文章。资料很多，这里不再废话。</p> 
<p>2）将上面的框架代码，包含jmeter和ant全部上传到gitee。我这里已上传，有需要的自取，自取的同学不要忘了给作者文章点个小赞👍哦。</p> 
<p>3）在jenkins上创建自由风格的项目。取名jmeter_autotest</p> 
<p>4)  选择参数化构建-选项参数，然后在名称处填上 env  在选项处填上 uat 和prod（需要换行填写） 描述可以填入 “请选择执行环境 ”的提示语</p> 
<p><img alt="" height="892" src="https://images2.imgbox.com/b7/74/tnBNZI4V_o.png" width="926"> </p> 
<p>5）选择git 拉取上传到git上的代码。</p> 
<p>6）添加构建步骤，这里一定要跟我添加的步骤一样，不然会出现各种各样的额问题</p> 
<ol><li>执行shell脚本删除掉历史报告 <pre><code class="language-bash">echo "删除历史报告"
rm -rf ${WORKSPACE}/report/html/*
rm -rf ${WORKSPACE}/report/jtl/*</code></pre> </li><li>选择Execute system Groovy script （一定是这个哈，需要先在jenkins插件管理安装Groovy插件）然后在Groovy Script处填入以下代码。这里主要是解决我们后面显示html报告时，没有出来css样式的问题。 <pre><code class="language-bash">System.setProperty("hudson.model.DirectoryBrowserSupport.CSP", "")</code></pre> </li><li>选择 Invoke Ant， 选择版本，同样是需要先在jenkins管理中心先配置ant   Target填写run Build File填写build.xml文件的路径<img alt="" height="658" src="https://images2.imgbox.com/78/db/l4v6zPW0_o.png" width="1200"></li></ol> 
<p>7）修改build.xml文件  <span style="color:#ff9900;">源文件因为涉及到太多公司项目路径，这里不方便截图，需要请私聊</span></p> 
<p><span style="color:#ff9900;">        </span><span style="color:#fe2c24;">注意一个点：这个点我研究了很久</span></p> 
<ol><li>接收上面jenkins传过来的env，如何把值传给jmeter呢？  答案是这样的。jenkins传给ant的build.xml文件，然后在传给需要执行jmeter的jmx文件。</li><li>build.xml文件中需要增加   &lt;property name="env" value="${env}"/&gt;  如下图： <pre><code class="language-bash">&lt;jmeter jmeterhome="${jmeter.home}" resultlog="${jmeter.result.jtlName}"&gt;
             &lt;!-- 声明要运行的脚本。"*.jmx"指包含此目录下的所有jmeter脚本--&gt;
            &lt;testplans dir="${jmx_dir}" includes="${jmx_file}" /&gt;
            &lt;property name="jmeter.save.saveservice.output_format" value="xml"/&gt;
			&lt;property name="env" value="${env}"/&gt;
       &lt;/jmeter&gt;</code></pre> </li><li> <p>jmeter的jmx文件中需要使用__P函数来接收这个变量，如下图    ${__P(env,uat)} 接收到新属性值作为变量传给new_env 如果没有接收到就传入默认值uat<img alt="" height="534" src="https://images2.imgbox.com/a4/c1/BxQGML7P_o.png" width="1200"></p> </li></ol> 
<p>8）构建后的操作，主要是添加html报告展示和发送邮件(发送邮件可以有多种方法，可以通过jenkins的邮件插件发送，也可以通过ant 的插件来发送。邮件发送我们后面在讲述) </p> 
<ol><li> 先在插件中心安装HTML Publisher </li><li>项目中增加构建后操作，选中 Publish HTML reports ,按如下图片填写即可，原理就是让这个插件找到jenkins工作空间下生成的报告<img alt="" height="1112" src="https://images2.imgbox.com/31/f1/KY7BNzji_o.png" width="1200"></li></ol> 
<p></p> 
<p>9） 最终展示下demo效果：大家如果觉的可以的话，请对文章点赞和加关注，如果遇到部署什么的请留言，作者看到会第一时间回复。<span style="color:#ff9900;">如果想要框架代码和安装包的同学，加关注我私发！！！</span></p> 
<p><img alt="" height="1128" src="https://images2.imgbox.com/6f/2d/n4m9CrdY_o.png" width="1200"></p> 
<p> <img alt="" height="620" src="https://images2.imgbox.com/2b/bb/WlAA6w7M_o.png" width="1200"></p> 
<p><img alt="" height="1010" src="https://images2.imgbox.com/02/25/zPMdo9CO_o.png" width="1200"> </p> 
<p> </p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/4b3f9478a9ec7571937ad72380a88af9/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Ubuntu下OpenCV3.4.16的安装及使用</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/8f4be46289dc99dd3ada7e733b776204/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Netty客户端断线重连实现及问题思考</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 追风少年的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>