<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>gitlab 企业级私有仓库搭建 - 追风少年的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="gitlab 企业级私有仓库搭建" />
<meta property="og:description" content="文章目录 一、Gitlab基本概述1.1 什么是gitlab1.2 Gitlab与Github区别1.3 Gitlab服务构成 二、gitlab安装及配置2.1 安装依赖软件2.2 安装 Gitlab 组件2.3 配置 Gitlab 域名2.4 默认安装目录分析2.5 配置 Gitlab 邮箱2.5 关闭 Gitlab 组件2.6 初始化 Gitlab 组件2.7 验证 Gitlab 组件2.8 汉化 Gitlab 组件 三、Gitlab用户与组3.1 用户与组及仓库的关系3.2 用户与组及仓库案例13.3 验证主程序员和开发者身份的权限3.4 模拟日常开发者如何更新代码至 master 分支 四、gitlab操作4.1 已有的仓库如何关联远程仓库4.2 新成员加入操作流程 五、gitlab日常维护5.1 备份5.2 Gitlab数据恢复5.3 Gitlab迁移升级5.5 Gitlab安全5.6 Gitlab忘记密码 一、Gitlab基本概述 1.1 什么是gitlab Gitlab 是一个开源分布式的版本控制系统。 Ruby语言开发完成。
Gitlab 主要实现的功能：
1.管理项目源代码。
2.对源代码进行版本控制。
Gitlab 的优势：
1.开源免费，搭建简单、维护成本较低、适合中小型公司。
2.权限管理，能实现代码对部分人可见，确保项目的安全性
3.离线同步，保证我们不在实时依赖网络环境进行代码提交。
1.2 Gitlab与Github区别 1.相同点: 两者都是提供代码托管服务，在很大程度上GitLab是仿照 GitHub来做的。
2.不同点: github创建私有仓库收费、gitlab创建私有仓库免费。
从安全方面来看，公司不希望员工获取到全部的代码，这个时候 GitLab 是最佳的选择。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://zhuifengsn.github.io/posts/73716bfdf3bba0dee1acea911b3684c4/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-10-21T04:45:00+08:00" />
<meta property="article:modified_time" content="2021-10-21T04:45:00+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="追风少年的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">追风少年的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">gitlab 企业级私有仓库搭建</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-dracula">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#Gitlab_1" rel="nofollow">一、Gitlab基本概述</a></li><li><ul><li><a href="#11_gitlab_2" rel="nofollow">1.1 什么是gitlab</a></li><li><a href="#12_GitlabGithub_11" rel="nofollow">1.2 Gitlab与Github区别</a></li><li><a href="#13_Gitlab_17" rel="nofollow">1.3 Gitlab服务构成</a></li></ul> 
  </li><li><a href="#gitlab_45" rel="nofollow">二、gitlab安装及配置</a></li><li><ul><li><a href="#21__46" rel="nofollow">2.1 安装依赖软件</a></li><li><a href="#22__Gitlab__63" rel="nofollow">2.2 安装 Gitlab 组件</a></li><li><a href="#23__Gitlab__75" rel="nofollow">2.3 配置 Gitlab 域名</a></li><li><a href="#24__84" rel="nofollow">2.4 默认安装目录分析</a></li><li><a href="#25__Gitlab__95" rel="nofollow">2.5 配置 Gitlab 邮箱</a></li><li><a href="#25__Gitlab__116" rel="nofollow">2.5 关闭 Gitlab 组件</a></li><li><a href="#26__Gitlab__129" rel="nofollow">2.6 初始化 Gitlab 组件</a></li><li><a href="#27__Gitlab__139" rel="nofollow">2.7 验证 Gitlab 组件</a></li><li><a href="#28__Gitlab__149" rel="nofollow">2.8 汉化 Gitlab 组件</a></li></ul> 
  </li><li><a href="#Gitlab_172" rel="nofollow">三、Gitlab用户与组</a></li><li><ul><li><a href="#31__173" rel="nofollow">3.1 用户与组及仓库的关系</a></li><li><a href="#32_1_179" rel="nofollow">3.2 用户与组及仓库案例1</a></li><li><a href="#33__192" rel="nofollow">3.3 验证主程序员和开发者身份的权限</a></li><li><a href="#34__master__261" rel="nofollow">3.4 模拟日常开发者如何更新代码至 master 分支</a></li></ul> 
  </li><li><a href="#gitlab_288" rel="nofollow">四、gitlab操作</a></li><li><ul><li><a href="#41__289" rel="nofollow">4.1 已有的仓库如何关联远程仓库</a></li><li><a href="#42__315" rel="nofollow">4.2 新成员加入操作流程</a></li></ul> 
  </li><li><a href="#gitlab_346" rel="nofollow">五、gitlab日常维护</a></li><li><ul><li><a href="#51__347" rel="nofollow">5.1 备份</a></li><li><a href="#52_Gitlab_371" rel="nofollow">5.2 Gitlab数据恢复</a></li><li><a href="#53_Gitlab_390" rel="nofollow">5.3 Gitlab迁移升级</a></li><li><a href="#55_Gitlab_424" rel="nofollow">5.5 Gitlab安全</a></li><li><a href="#56_Gitlab_457" rel="nofollow">5.6 Gitlab忘记密码</a></li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h2><a id="Gitlab_1"></a>一、Gitlab基本概述</h2> 
<h3><a id="11_gitlab_2"></a>1.1 什么是gitlab</h3> 
<p>Gitlab 是一个开源分布式的版本控制系统。 Ruby语言开发完成。<br> Gitlab 主要实现的功能：<br> 1.管理项目源代码。<br> 2.对源代码进行版本控制。<br> Gitlab 的优势：<br> 1.开源免费，搭建简单、维护成本较低、适合中小型公司。<br> 2.权限管理，能实现代码对部分人可见，确保项目的安全性<br> 3.离线同步，保证我们不在实时依赖网络环境进行代码提交。</p> 
<h3><a id="12_GitlabGithub_11"></a>1.2 Gitlab与Github区别</h3> 
<p>1.相同点: 两者都是提供代码托管服务，在很大程度上GitLab是仿照 GitHub来做的。<br> 2.不同点: github创建私有仓库收费、gitlab创建私有仓库免费。<br> 从安全方面来看，公司不希望员工获取到全部的代码，这个时候 GitLab 是最佳的选择。<br> 但对于开源项目而言，GitHub 依然是代码托管的首选平台。</p> 
<h3><a id="13_Gitlab_17"></a>1.3 Gitlab服务构成</h3> 
<p>gitlab 作为一个分布式代码托管软件，它必然有相关的服务组件去支持这个庞大系统<br> <img src="https://images2.imgbox.com/26/91/wqmXj2eJ_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/dd/e5/iX5jryLg_o.png" alt="在这里插入图片描述"></p> 
<ul><li>nginx，作为gitlab的proxy代理，处理http/https以及静态资源访问请求。</li><li>gitlab-workhorse，用于处理文件上传和下载。</li><li>gitlab-shell，用于处理git clone、git pull、gitpush。</li><li>Logrotate，用于处理日志的切割和打包等操作。</li><li>Postgresql，用于保存所有的gitlab数据相关信息。</li><li>Redis，用于缓存数据库的信息，加快前台访问速度，以及交互读写</li></ul> 
<p>相关命令</p> 
<pre><code class="prism language-c">gitlab<span class="token operator">-</span>ctl start #启动全部服务
gitlab<span class="token operator">-</span>ctl restart#重启全部服务
gitlab<span class="token operator">-</span>ctl stop #停止全部服务
gitlab<span class="token operator">-</span>ctl restart nginx #重启单个服务，如重启nginx
gitlab<span class="token operator">-</span>ctl status #查看服务状态
gitlab<span class="token operator">-</span>ctl reconfigure #使配置文件生效
gitlab<span class="token operator">-</span>ctl show<span class="token operator">-</span>config #验证配置文件
gitlab<span class="token operator">-</span>ctl uninstall #删除gitlab（保留数据）
gitlab<span class="token operator">-</span>ctl cleanse #删除所有数据，从新开始
gitlab<span class="token operator">-</span>ctl tail <span class="token operator">&lt;</span>service name<span class="token operator">&gt;</span>查看服务的日志
gitlab<span class="token operator">-</span>ctl tail nginx  #如查看gitlab下nginx日志
gitlab<span class="token operator">-</span>rails console  #进入控制台
</code></pre> 
<h2><a id="gitlab_45"></a>二、gitlab安装及配置</h2> 
<h3><a id="21__46"></a>2.1 安装依赖软件</h3> 
<p>1.关闭防火墙</p> 
<pre><code class="prism language-c"><span class="token punctuation">[</span>root@gitlab <span class="token operator">~</span><span class="token punctuation">]</span># setenforce <span class="token number">0</span>
setenforce<span class="token operator">:</span> SELinux is disabled
<span class="token punctuation">[</span>root@gitlab <span class="token operator">~</span><span class="token punctuation">]</span># systemctl stop firewalld
<span class="token punctuation">[</span>root@gitlab <span class="token operator">~</span><span class="token punctuation">]</span># systemctl disable firewalld

</code></pre> 
<p>2.安装 gitlab 所需依赖软件</p> 
<pre><code class="prism language-c"><span class="token punctuation">[</span>root@gitlab <span class="token operator">~</span><span class="token punctuation">]</span># yum install <span class="token operator">-</span>y curl openssh<span class="token operator">-</span>server postfix wget
</code></pre> 
<h3><a id="22__Gitlab__63"></a>2.2 安装 Gitlab 组件</h3> 
<p>1.下载 Gitlab</p> 
<pre><code class="prism language-c"><span class="token punctuation">[</span>root@gitlab <span class="token operator">~</span><span class="token punctuation">]</span># wget https<span class="token operator">:</span><span class="token comment">//mirror.tuna.tsinghua.edu.cn/gitlabce/yum/el7/gitlab-ce-12.3.9-</span>
ce<span class="token punctuation">.</span><span class="token number">0.</span>el7<span class="token punctuation">.</span>x86_64<span class="token punctuation">.</span>rpm
</code></pre> 
<p>2.使用 yum 安装 Gitlab</p> 
<pre><code class="prism language-c"><span class="token punctuation">[</span>root@gitlab <span class="token operator">~</span><span class="token punctuation">]</span># uim localinstall gitlab<span class="token operator">-</span>ce<span class="token operator">-</span><span class="token number">12.3</span><span class="token number">.9</span><span class="token operator">-</span>ce<span class="token punctuation">.</span><span class="token number">0.</span>el7<span class="token punctuation">.</span>x86_64<span class="token punctuation">.</span>rpm 
</code></pre> 
<h3><a id="23__Gitlab__75"></a>2.3 配置 Gitlab 域名</h3> 
<p>后期通过域名访问 gitlab 服务</p> 
<pre><code class="prism language-c"><span class="token punctuation">[</span>root@gitlab <span class="token operator">~</span><span class="token punctuation">]</span># vim <span class="token operator">/</span>etc<span class="token operator">/</span>gitlab<span class="token operator">/</span>gitlab<span class="token punctuation">.</span>rb 

external_url <span class="token string">'http://gitlab.bertwu.com'</span>

</code></pre> 
<h3><a id="24__84"></a>2.4 默认安装目录分析</h3> 
<pre><code class="prism language-c">gitlab组件日志路径：<span class="token operator">/</span>var<span class="token operator">/</span>log<span class="token operator">/</span>gitlab
gitlab配置路径：<span class="token operator">/</span>etc<span class="token operator">/</span>gitlab<span class="token operator">/</span>  路径下有gitlab<span class="token punctuation">.</span>rb配置文件
应用代码和组件依赖程序：<span class="token operator">/</span>opt<span class="token operator">/</span>gitlab
各个组件存储路径： <span class="token operator">/</span>var<span class="token operator">/</span>opt<span class="token operator">/</span>gitlab<span class="token operator">/</span>
仓库默认存储路径   <span class="token operator">/</span>var<span class="token operator">/</span>opt<span class="token operator">/</span>gitlab<span class="token operator">/</span>git<span class="token operator">-</span>data<span class="token operator">/</span>repositories
版本文件备份路径：<span class="token operator">/</span>var<span class="token operator">/</span>opt<span class="token operator">/</span>gitlab<span class="token operator">/</span>backups<span class="token operator">/</span>
nginx安装路径：<span class="token operator">/</span>var<span class="token operator">/</span>opt<span class="token operator">/</span>gitlab<span class="token operator">/</span>nginx<span class="token operator">/</span>
redis安装路径：<span class="token operator">/</span>var<span class="token operator">/</span>opt<span class="token operator">/</span>gitlab<span class="token operator">/</span>redis
</code></pre> 
<h3><a id="25__Gitlab__95"></a>2.5 配置 Gitlab 邮箱</h3> 
<p>1.在账号注册时，需要使用邮件验证。<br> 2.后期修改密码时，需要通过邮件修改。</p> 
<pre><code class="prism language-c">### Email Settings
gitlab_rails<span class="token punctuation">[</span><span class="token string">'gitlab_email_enabled'</span><span class="token punctuation">]</span> <span class="token operator">=</span> true
gitlab_rails<span class="token punctuation">[</span><span class="token string">'gitlab_email_from'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'1529082090@qq.com'</span> # 发件邮箱
gitlab_rails<span class="token punctuation">[</span><span class="token string">'gitlab_email_display_name'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'Bertwu-Gitlab'</span> # 发件人显示名称

gitlab_rails<span class="token punctuation">[</span><span class="token string">'smtp_enable'</span><span class="token punctuation">]</span> <span class="token operator">=</span> true
gitlab_rails<span class="token punctuation">[</span><span class="token string">'smtp_address'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"smtp.qq.com"</span>
gitlab_rails<span class="token punctuation">[</span><span class="token string">'smtp_port'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">465</span>
gitlab_rails<span class="token punctuation">[</span><span class="token string">'smtp_user_name'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"1529082090@qq.com"</span> #发件人邮箱
gitlab_rails<span class="token punctuation">[</span><span class="token string">'smtp_password'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"mqfiderkgrowhhhf"</span> #发件人邮箱客户端授权码
gitlab_rails<span class="token punctuation">[</span><span class="token string">'smtp_domain'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"qq.com"</span>
gitlab_rails<span class="token punctuation">[</span><span class="token string">'smtp_authentication'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"login"</span>
gitlab_rails<span class="token punctuation">[</span><span class="token string">'smtp_enable_starttls_auto'</span><span class="token punctuation">]</span> <span class="token operator">=</span> true
gitlab_rails<span class="token punctuation">[</span><span class="token string">'smtp_tls'</span><span class="token punctuation">]</span> <span class="token operator">=</span> false                                                                                 

</code></pre> 
<h3><a id="25__Gitlab__116"></a>2.5 关闭 Gitlab 组件</h3> 
<p>由于 Gitlab 核心功能是代码托管，所以有些额外的组件比较浪费资源，所以可以考虑关闭。</p> 
<pre><code class="prism language-c">prometheus<span class="token punctuation">[</span><span class="token string">'enable'</span><span class="token punctuation">]</span> <span class="token operator">=</span> false
prometheus<span class="token punctuation">[</span><span class="token string">'monitor_kubernetes'</span><span class="token punctuation">]</span> <span class="token operator">=</span> false
alertmanager<span class="token punctuation">[</span><span class="token string">'enable'</span><span class="token punctuation">]</span> <span class="token operator">=</span> false  
node_exporter<span class="token punctuation">[</span><span class="token string">'enable'</span><span class="token punctuation">]</span> <span class="token operator">=</span> false 
redis_exporter<span class="token punctuation">[</span><span class="token string">'enable'</span><span class="token punctuation">]</span> <span class="token operator">=</span> false 
postgres_exporter<span class="token punctuation">[</span><span class="token string">'enable'</span><span class="token punctuation">]</span> <span class="token operator">=</span> false
gitlab_exporter<span class="token punctuation">[</span><span class="token string">'probe_sidekiq'</span><span class="token punctuation">]</span> <span class="token operator">=</span> false
prometheus_monitoring<span class="token punctuation">[</span><span class="token string">'enable'</span><span class="token punctuation">]</span> <span class="token operator">=</span> false
grafana<span class="token punctuation">[</span><span class="token string">'enable'</span><span class="token punctuation">]</span> <span class="token operator">=</span> false  
</code></pre> 
<h3><a id="26__Gitlab__129"></a>2.6 初始化 Gitlab 组件</h3> 
<p>第一次需要初始化 gitlab 服务，后续如果对 gitlab<br> 配置文件进行修改，也需要执行初始化进行重新配置。</p> 
<pre><code class="prism language-c"><span class="token punctuation">[</span>root@gitlab <span class="token operator">~</span><span class="token punctuation">]</span># gitlab<span class="token operator">-</span>ctl reconfigure
<span class="token punctuation">[</span>root@gitlab <span class="token operator">~</span><span class="token punctuation">]</span># gitlab<span class="token operator">-</span>ctl status
<span class="token punctuation">[</span>root@gitlab <span class="token operator">~</span><span class="token punctuation">]</span># gitlab<span class="token operator">-</span>ctl stop
<span class="token punctuation">[</span>root@gitlab <span class="token operator">~</span><span class="token punctuation">]</span># gitlab<span class="token operator">-</span>ctl start
</code></pre> 
<h3><a id="27__Gitlab__139"></a>2.7 验证 Gitlab 组件</h3> 
<p>1.重新初始化后通过 gitlab-rails 检查 gitlab 邮箱是否可正常使用。</p> 
<pre><code class="prism language-c"><span class="token punctuation">[</span>root@gitlab <span class="token operator">~</span><span class="token punctuation">]</span># gitlab<span class="token operator">-</span>rails console # 打开控制台
# 发送邮件
<span class="token function">irb</span><span class="token punctuation">(</span>main<span class="token punctuation">)</span><span class="token operator">:</span><span class="token number">003</span><span class="token operator">:</span><span class="token number">0</span><span class="token operator">&gt;</span> Notify<span class="token punctuation">.</span><span class="token function">test_email</span><span class="token punctuation">(</span><span class="token string">'bertwu6688@163.com'</span><span class="token punctuation">,</span><span class="token string">'test'</span><span class="token punctuation">,</span><span class="token string">'gitlab'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>deliver_now

</code></pre> 
<p>2.登录gitlab,需要配置root管理员密码，再重新登录。</p> 
<h3><a id="28__Gitlab__149"></a>2.8 汉化 Gitlab 组件</h3> 
<p>1.使用 git 命令下载汉化补丁包<a href="https://gitlab.com/xhang/gitlab" rel="nofollow"> gitlab中文汉化包</a></p> 
<pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span> <span class="token directive keyword">wget</span> <span class="token expression">https<span class="token operator">:</span></span><span class="token comment">//gitlab.com/xhang/gitlab/-/archive/v12.3.0-zh/gitlab-v12.3.0-zh.zip</span></span>
<span class="token punctuation">[</span>root@gitlab <span class="token operator">~</span><span class="token punctuation">]</span># unzip gitlab<span class="token operator">-</span>v12<span class="token punctuation">.</span><span class="token number">3.0</span><span class="token operator">-</span>zh<span class="token punctuation">.</span>zip # 解压
</code></pre> 
<p>2.停止 gitlab，进行中文汉化。</p> 
<pre><code class="prism language-c"><span class="token punctuation">[</span>root@gitlab <span class="token operator">~</span><span class="token punctuation">]</span># gitlab<span class="token operator">-</span>ctl stop
<span class="token punctuation">[</span>root@gitlab <span class="token operator">~</span><span class="token punctuation">]</span># \cp <span class="token operator">-</span>r gitlab<span class="token operator">-</span>v12<span class="token punctuation">.</span><span class="token number">3.0</span><span class="token operator">-</span>zh<span class="token comment">/* /opt/gitlab/embedded/service/gitlab-rails/

</span></code></pre> 
<p>3.重启gitlab</p> 
<pre><code class="prism language-c"><span class="token punctuation">[</span>root@gitlab <span class="token operator">~</span><span class="token punctuation">]</span># gitlab<span class="token operator">-</span>ctl reconfigur
<span class="token punctuation">[</span>root@gitlab <span class="token operator">~</span><span class="token punctuation">]</span># gitlab<span class="token operator">-</span>ctl restart

</code></pre> 
<p>4.点击settings–&gt; Preferences–&gt;Localization–&gt;选择简体中文，完成整体汉化<br> <img src="https://images2.imgbox.com/02/30/2YNLAUdQ_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="Gitlab_172"></a>三、Gitlab用户与组</h2> 
<h3><a id="31__173"></a>3.1 用户与组及仓库的关系</h3> 
<p>Gitlab 中的用户、用户组、项目仓库之间的关系是什么样的？</p> 
<ul><li>如果使用user创建一个仓库，那么这个用户就是这个仓库的owner</li><li>如果使用group创建一个仓库，那这个组下面添加的所有用户就是这个仓库的owner</li></ul> 
<h3><a id="32_1_179"></a>3.2 用户与组及仓库案例1</h3> 
<p>案例1：验证项目是不是隶属于该组的成员才可以看见<br> 1.首先创建dev、ops两个组<br> 2.然后基于组创建两个项目<br> 3.最后创建用户、为用户分配组、以及组中的身份</p> 
<p>创建组示例：<br> <img src="https://images2.imgbox.com/e0/b2/flB92088_o.png" alt="在这里插入图片描述"><br> 创建具体项目示例：<br> 将项目关联到具体的组<br> <img src="https://images2.imgbox.com/e8/45/mRhChnqR_o.png" alt="在这里插入图片描述"><br> 创建具体用户，将用户加入具体的组<br> <img src="https://images2.imgbox.com/2a/72/4C0t0kPr_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="33__192"></a>3.3 验证主程序员和开发者身份的权限</h3> 
<p><img src="https://images2.imgbox.com/50/fc/FADFtQv3_o.png" alt="在这里插入图片描述"><br> 可以看到dev组两个用户bertwu是主程序猿，jack是开发人猿，这两个人对alipy项目的权限有何不同？<br> 1.主程序员：能够对 master、dev 分支进行操作；[通过命令测试]<br> 2.开发者：仅能对非 master 分支进行操作；[通过命令演示效果]<br> 2.1 关闭分支保护机制；<br> 2.2 提交到非Master分支上；</p> 
<p>1.bertwu用户登录到gitlab，按照文档步骤克隆项目，创建README.md文件后推送到远程仓库</p> 
<pre><code class="prism language-c">$ git config <span class="token operator">--</span>global user<span class="token punctuation">.</span>name <span class="token string">"bertwu"</span>
$ git config <span class="token operator">--</span>global user<span class="token punctuation">.</span>email <span class="token string">"bertwu6688@163.com"</span>

$ git clone http<span class="token operator">:</span><span class="token comment">//gitlab.bertwu.com/dev/alipay.git # 克隆项目</span>

$ cd alipay<span class="token operator">/</span>
$ git remote <span class="token operator">-</span>v # 查看仓库
origin  http<span class="token operator">:</span><span class="token comment">//gitlab.bertwu.com/dev/alipay.git (fetch)</span>
origin  http<span class="token operator">:</span><span class="token comment">//gitlab.bertwu.com/dev/alipay.git (push)</span>

$ vim README<span class="token punctuation">.</span>md # 编写程序
我是bertwu用户，主程序猿

$ git add <span class="token punctuation">.</span>
$ git commit README<span class="token punctuation">.</span>md <span class="token operator">-</span>m <span class="token string">'bertwu add README file'</span> # 提交到本地仓库
$ git push <span class="token operator">-</span>u origin master # 推送到远程仓库

</code></pre> 
<p><img src="https://images2.imgbox.com/69/e0/iRsN3bqp_o.png" alt="在这里插入图片描述"><br> 2.jack用户clone最新的项目代码到本地，修改文件后再次提交</p> 
<pre><code class="prism language-c"><span class="token punctuation">[</span>root@gitlab <span class="token operator">~</span><span class="token punctuation">]</span># git clone http<span class="token operator">:</span><span class="token comment">//gitlab.bertwu.com/dev/alipay.git</span>
<span class="token punctuation">[</span>root@gitlab alipay<span class="token punctuation">]</span># git remote <span class="token operator">-</span>v
origin	http<span class="token operator">:</span><span class="token comment">//gitlab.bertwu.com/dev/alipay.git (fetch)</span>
origin	http<span class="token operator">:</span><span class="token comment">//gitlab.bertwu.com/dev/alipay.git (push)</span>

<span class="token punctuation">[</span>root@gitlab alipay<span class="token punctuation">]</span># vim README<span class="token punctuation">.</span>md 
我是jack用户，开发人猿

<span class="token punctuation">[</span>root@gitlab alipay<span class="token punctuation">]</span># git config <span class="token operator">--</span>global user<span class="token punctuation">.</span>email <span class="token string">'jack@qq.com'</span>
<span class="token punctuation">[</span>root@gitlab alipay<span class="token punctuation">]</span># git config <span class="token operator">--</span>global user<span class="token punctuation">.</span>name <span class="token string">'jack'</span>


# 推送到远程仓库master时报错，没有权限
<span class="token punctuation">[</span>root@gitlab alipay<span class="token punctuation">]</span># git push <span class="token operator">-</span>u origin master
Username <span class="token keyword">for</span> <span class="token string">'http://gitlab.bertwu.com'</span><span class="token operator">:</span> jack
Password <span class="token keyword">for</span> <span class="token string">'http://jack@gitlab.bertwu.com'</span><span class="token operator">:</span> 
Counting objects<span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span> done<span class="token punctuation">.</span>
Compressing objects<span class="token operator">:</span> <span class="token number">100</span><span class="token operator">%</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> done<span class="token punctuation">.</span>
Writing objects<span class="token operator">:</span> <span class="token number">100</span><span class="token operator">%</span> <span class="token punctuation">(</span><span class="token number">3</span><span class="token operator">/</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">290</span> bytes <span class="token operator">|</span> <span class="token number">0</span> bytes<span class="token operator">/</span>s<span class="token punctuation">,</span> done<span class="token punctuation">.</span>
Total <span class="token number">3</span> <span class="token punctuation">(</span>delta <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> reused <span class="token number">0</span> <span class="token punctuation">(</span>delta <span class="token number">0</span><span class="token punctuation">)</span>
remote<span class="token operator">:</span> GitLab<span class="token operator">:</span> You are not allowed to push code to protected branches on this project<span class="token punctuation">.</span>
To http<span class="token operator">:</span><span class="token comment">//gitlab.bertwu.com/dev/alipay.git</span>
 <span class="token operator">!</span> <span class="token punctuation">[</span>remote rejected<span class="token punctuation">]</span> master <span class="token operator">-&gt;</span> <span class="token function">master</span> <span class="token punctuation">(</span>pre<span class="token operator">-</span>receive hook declined<span class="token punctuation">)</span>
error<span class="token operator">:</span> failed to push some refs to <span class="token string">'http://gitlab.bertwu.com/dev/alipay.git'</span>

</code></pre> 
<p><code>GitLab: You are not allowed to push code to protected branches on this</code><br> 这是因为，开发人员是没有权限向master上提交任何数据。</p> 
<p>可以向其他分支上提交。</p> 
<pre><code class="prism language-c"><span class="token punctuation">[</span>root@gitlab alipay<span class="token punctuation">]</span># git branch dev
<span class="token punctuation">[</span>root@gitlab alipay<span class="token punctuation">]</span># git checkout dev
<span class="token punctuation">[</span>root@gitlab alipay<span class="token punctuation">]</span># git push <span class="token operator">-</span>u origin dev

</code></pre> 
<h3><a id="34__master__261"></a>3.4 模拟日常开发者如何更新代码至 master 分支</h3> 
<p>1.首先创建一个 dev 分支，然后编写代码提交至远程 gitlab<br> 2.登陆 gitlab 服务端，像主程序员申请合并请求，请求 dev 合并master<br> 3.登陆主程序员账户查看合并信息，并确认合并操作<br> 4.登陆 gitlab 查看该项目是否已经是 master 与dev 分支合并后的效果</p> 
<p>1.jack用户切换到dev分支，继续开发代码，然后提交到dev分支</p> 
<pre><code class="prism language-c"><span class="token punctuation">[</span>root@gitlab alipay<span class="token punctuation">]</span># git branch
<span class="token operator">*</span> dev
  master
<span class="token punctuation">[</span>root@gitlab alipay<span class="token punctuation">]</span># echo <span class="token string">"denglu"</span> <span class="token operator">&gt;</span> login<span class="token punctuation">.</span>py 
<span class="token punctuation">[</span>root@gitlab alipay<span class="token punctuation">]</span># git add <span class="token punctuation">.</span>
<span class="token punctuation">[</span>root@gitlab alipay<span class="token punctuation">]</span># git commit <span class="token operator">-</span>m <span class="token string">"jack用户开发了登录模块"</span>
<span class="token punctuation">[</span>root@gitlab alipay<span class="token punctuation">]</span># git push <span class="token operator">-</span>u origin dev

</code></pre> 
<p>2.用户jack登录到gitlab后台<br> <img src="https://images2.imgbox.com/6d/f7/MdIauLFF_o.png" alt="在这里插入图片描述"><br> 可以看到，dev分支有刚提交的login.py ，如果想要合并到master，点击右上角合并请求<br> <img src="https://images2.imgbox.com/78/30/9CvUhBlT_o.png" alt="在这里插入图片描述"><br> 3.当bertwu主程序员登录后台时，就能看到你提交的合并请求<br> <img src="https://images2.imgbox.com/6e/48/gJDLmbnu_o.png" alt="在这里插入图片描述"><br> 4.主程序员审核之后感觉不错，就会同意合并请求。</p> 
<h2><a id="gitlab_288"></a>四、gitlab操作</h2> 
<h3><a id="41__289"></a>4.1 已有的仓库如何关联远程仓库</h3> 
<p>1.以超级管理员身份在gitlab上创建shopping项目远程仓库，用于本地项目的关联。<br> 2.在本地创建shopping文件加，初始化为仓库</p> 
<pre><code class="prism language-c"><span class="token punctuation">[</span>root@gitlab <span class="token operator">~</span><span class="token punctuation">]</span># mkdir shopping
<span class="token punctuation">[</span>root@gitlab <span class="token operator">~</span><span class="token punctuation">]</span># cd shopping<span class="token operator">/</span>
<span class="token punctuation">[</span>root@gitlab shopping<span class="token punctuation">]</span># git init
<span class="token punctuation">[</span>root@gitlab shopping<span class="token punctuation">]</span># git config <span class="token operator">--</span>global user<span class="token punctuation">.</span>name <span class="token string">"bertwu"</span>
<span class="token punctuation">[</span>root@gitlab shopping<span class="token punctuation">]</span># git config <span class="token operator">--</span>global user<span class="token punctuation">.</span>email <span class="token string">"bertwu6688@163.com"</span>
<span class="token punctuation">[</span>root@gitlab shopping<span class="token punctuation">]</span># vim README<span class="token punctuation">.</span>md
<span class="token number">1.</span>支付模块
<span class="token number">2.</span>登录模块
<span class="token number">3.</span>用户模块
<span class="token punctuation">[</span>root@gitlab shopping<span class="token punctuation">]</span># git add <span class="token punctuation">.</span>
<span class="token punctuation">[</span>root@gitlab shopping<span class="token punctuation">]</span># git commit README<span class="token punctuation">.</span>md <span class="token operator">-</span>m <span class="token string">'开发文档'</span>

<span class="token punctuation">[</span>root@gitlab shopping<span class="token punctuation">]</span># git remote add origin http<span class="token operator">:</span><span class="token comment">//gitlab.bertwu.com/dev/shopping.g # 关联远程仓库</span>

<span class="token punctuation">[</span>root@gitlab shopping<span class="token punctuation">]</span># git push <span class="token operator">-</span>u origin master # 推送

</code></pre> 
<p>3.登录bertwu用户，后台查看<br> <img src="https://images2.imgbox.com/00/83/g2Ps2mqr_o.png" alt="在这里插入图片描述"><br> 如果出现输入密码提示，则说明该主机与gitlab服务器没有配置免秘钥。那么需要在当前主机上执行ssh-keygen生成秘钥，然后将其公钥放置gitlab服务器对应的用户下。</p> 
<h3><a id="42__315"></a>4.2 新成员加入操作流程</h3> 
<p>如果有新成员需要加入该项目该怎么办?<br> 1.用gitlab超级管理员root先给新成员创建用户<br> 2.将成员加入组，此时该用户就能看到对应的项目<br> 3.使用http方式，输入用户名与密码，测试能否获取项目代码<br> 3.使用ssh方式，添加对应公钥信息，测试能否获取项目代码</p> 
<p>若原有的仓库是http 现在想换为ssh方式，如下</p> 
<pre><code class="prism language-c">
<span class="token punctuation">[</span>root@manager shopping<span class="token punctuation">]</span># git remote <span class="token operator">-</span>v # 查看仓库，为http
origin	http<span class="token operator">:</span><span class="token comment">//gitlab.bertwu.com/dev/shopping.git (fetch)</span>
origin	http<span class="token operator">:</span><span class="token comment">//gitlab.bertwu.com/dev/shopping.git (push)</span>

<span class="token punctuation">[</span>root@manager shopping<span class="token punctuation">]</span># git remote remove origin # 删除
<span class="token punctuation">[</span>root@manager shopping<span class="token punctuation">]</span># git remote <span class="token operator">-</span>v


<span class="token punctuation">[</span>root@manager shopping<span class="token punctuation">]</span># git remote add origin git@gitlab<span class="token punctuation">.</span>bertwu<span class="token punctuation">.</span>com<span class="token operator">:</span>dev<span class="token operator">/</span>shopping<span class="token punctuation">.</span>git # 重新添加ssh的仓库
<span class="token punctuation">[</span>
root@manager shopping<span class="token punctuation">]</span># git remote <span class="token operator">-</span>v # 再次查看
origin	git@gitlab<span class="token punctuation">.</span>bertwu<span class="token punctuation">.</span>com<span class="token operator">:</span>dev<span class="token operator">/</span>shopping<span class="token punctuation">.</span><span class="token function">git</span> <span class="token punctuation">(</span>fetch<span class="token punctuation">)</span>
origin	git@gitlab<span class="token punctuation">.</span>bertwu<span class="token punctuation">.</span>com<span class="token operator">:</span>dev<span class="token operator">/</span>shopping<span class="token punctuation">.</span><span class="token function">git</span> <span class="token punctuation">(</span>push<span class="token punctuation">)</span>

</code></pre> 
<p>如果在gitlab上对应用户下已经添加了对应公钥，这时候就可以免密推送了</p> 
<pre><code class="prism language-c"><span class="token punctuation">[</span>root@manager shopping<span class="token punctuation">]</span># git push <span class="token operator">-</span>u origin dev
</code></pre> 
<h2><a id="gitlab_346"></a>五、gitlab日常维护</h2> 
<h3><a id="51__347"></a>5.1 备份</h3> 
<p>1.修改默认存放备份站点目录，然后进行重新加载配置文件</p> 
<pre><code class="prism language-c"><span class="token punctuation">[</span>root@gitlab <span class="token operator">~</span><span class="token punctuation">]</span># vim <span class="token operator">/</span>etc<span class="token operator">/</span>gitlab<span class="token operator">/</span>gitlab<span class="token punctuation">.</span>rb 
gitlab_rails<span class="token punctuation">[</span><span class="token string">'backup_path'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"/data/gitlab/backups"</span> # 自定义备份路径

gitlab_rails<span class="token punctuation">[</span><span class="token string">'backup_keep_time'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">604800</span> # 保留<span class="token number">7</span>天 

<span class="token punctuation">[</span>root@gitlab <span class="token operator">~</span><span class="token punctuation">]</span># mkdir <span class="token operator">/</span>data<span class="token operator">/</span>gitlab<span class="token operator">/</span>backups <span class="token operator">-</span>p
   
</code></pre> 
<p>2.手动执行备份命令，会将备份的结果存储至/data/gitlab/backups 目录中</p> 
<pre><code class="prism language-c"><span class="token punctuation">[</span>root@gitlab backups<span class="token punctuation">]</span># gitlab<span class="token operator">-</span>rake gitlab<span class="token operator">:</span>backup<span class="token operator">:</span>create
</code></pre> 
<p>3.也可以将备份命令写入定时任务每天进行自动备份</p> 
<pre><code class="prism language-c"><span class="token punctuation">[</span>root@gitlab backups<span class="token punctuation">]</span># crontab <span class="token operator">-</span>l
<span class="token number">00</span> <span class="token number">03</span> <span class="token operator">*</span> <span class="token operator">*</span> <span class="token operator">*</span> <span class="token operator">/</span>usr<span class="token operator">/</span>bin<span class="token operator">/</span>gitlab<span class="token operator">-</span>rake gitlab<span class="token operator">:</span>backup<span class="token operator">:</span>create

</code></pre> 
<h3><a id="52_Gitlab_371"></a>5.2 Gitlab数据恢复</h3> 
<p>当误删除项目，或者误删除用户等数据时候，如果之前有备份，那么可以做恢复操作。<br> 1.停止数据写入服务</p> 
<pre><code class="prism language-c"><span class="token punctuation">[</span>root@gitlab <span class="token operator">~</span><span class="token punctuation">]</span>#  gitlab<span class="token operator">-</span>ctl stop unicorn
<span class="token punctuation">[</span>root@gitlab <span class="token operator">~</span><span class="token punctuation">]</span>#  gitlab<span class="token operator">-</span>ctl stop sidekiq
</code></pre> 
<p>2.通过 gitlab-rake 命令进行恢复，恢复时需要指定此前备份的名称。(但不需要写名称的.tar后缀)</p> 
<pre><code class="prism language-c"><span class="token punctuation">[</span>root@gitlab <span class="token operator">~</span><span class="token punctuation">]</span>#  gitlab<span class="token operator">-</span>rake gitlab<span class="token operator">:</span>backup<span class="token operator">:</span>restore BACKUP<span class="token operator">=</span><span class="token number">1634715076</span>_2021_10_20_12<span class="token punctuation">.</span><span class="token number">3.0</span>
</code></pre> 
<p>3.重启gitlab，检测是否 gitlab 是否恢复。</p> 
<pre><code class="prism language-c"><span class="token punctuation">[</span>root@gitlab <span class="token operator">~</span><span class="token punctuation">]</span>#  gitlab<span class="token operator">-</span>ctl restart

</code></pre> 
<h3><a id="53_Gitlab_390"></a>5.3 Gitlab迁移升级</h3> 
<p>一般情况，gitlab一经使用，则不会升级；除非做迁移，例如从本地环境迁移到阿里云时，可以顺便升级；</p> 
<p>迁移与升级：</p> 
<ol><li>一般情况下，迁移会迁移两个文件，/etc/gitlab/gitlab.rb 和backups下的备份文件。</li><li>在新节点需要安装相同的版本，先恢复数据</li><li>数据恢复后先升级到本版本的最后一个版本，然后再升级到下个版本，例如（12.3 —&gt; 12.9.9 --&gt; 13），不能跨版本升级。</li></ol> 
<p>1.如果从12 最后一个版本升级到13 ，会报错</p> 
<pre><code class="prism language-c"><span class="token punctuation">[</span>root@gitlab <span class="token operator">~</span><span class="token punctuation">]</span># yum localinstall gitlabce<span class="token operator">-</span><span class="token number">13.0</span><span class="token number">.10</span><span class="token operator">-</span>ce<span class="token punctuation">.</span><span class="token number">0.</span>el7<span class="token punctuation">.</span>x86_64<span class="token punctuation">.</span>rpm <span class="token operator">-</span>y
#会提示报错：
Running transaction
<span class="token operator">*</span> gitlab_monitor<span class="token punctuation">[</span><span class="token string">'enable'</span><span class="token punctuation">]</span> has been
deprecated since <span class="token number">12.3</span> and was removed in
<span class="token number">13.0</span><span class="token punctuation">.</span> Use gitlab_exporter<span class="token punctuation">[</span><span class="token string">'enable'</span><span class="token punctuation">]</span>
instead<span class="token punctuation">.</span>
</code></pre> 
<p>2.只需要根据提示编辑 /etc/gitlab.rb 配置文件</p> 
<pre><code class="prism language-c">#提示什么错变更什么即可
gitlab_monitor<span class="token punctuation">[</span><span class="token string">'enable'</span><span class="token punctuation">]</span> <span class="token operator">=</span>false

gitlab_exporter<span class="token punctuation">[</span><span class="token string">'enable'</span><span class="token punctuation">]</span> <span class="token operator">=</span> false

</code></pre> 
<p>3.修改配置后重新初始化，然后在进行升级</p> 
<pre><code class="prism language-c"><span class="token punctuation">[</span>root@gitlab <span class="token operator">~</span><span class="token punctuation">]</span># gitlab<span class="token operator">-</span>ctl reconfigure
<span class="token punctuation">[</span>root@gitlab <span class="token operator">~</span><span class="token punctuation">]</span># yum localinstall gitlabce<span class="token operator">-</span><span class="token number">13.0</span><span class="token number">.10</span><span class="token operator">-</span>ce<span class="token punctuation">.</span><span class="token number">0.</span>el7<span class="token punctuation">.</span>x86_64<span class="token punctuation">.</span>rpm <span class="token operator">-</span>y
</code></pre> 
<h3><a id="55_Gitlab_424"></a>5.5 Gitlab安全</h3> 
<p>将访问网页的 HTTP 协议升级到 HTTPS协议，保证数据安全；<br> 1.阿里云上申请下载nginx证书到/ssh_key文件夹</p> 
<pre><code class="prism language-c"><span class="token punctuation">[</span>root@gitlab <span class="token operator">~</span><span class="token punctuation">]</span># mkdir <span class="token operator">-</span>p <span class="token operator">/</span>ssl_key
</code></pre> 
<p>2.修改 Gitlab 配置文件</p> 
<pre><code class="prism language-c"><span class="token punctuation">[</span>root@gitlab <span class="token operator">~</span><span class="token punctuation">]</span># vim <span class="token operator">/</span>etc<span class="token operator">/</span>gitlab<span class="token operator">/</span>gitlab<span class="token punctuation">.</span>rb
external_url <span class="token string">"https://gitlab.bertwu.online"</span>
# 必须修改
nginx<span class="token punctuation">[</span><span class="token string">'enable'</span><span class="token punctuation">]</span> <span class="token operator">=</span> true
nginx<span class="token punctuation">[</span><span class="token string">'client_max_body_size'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'1000m'</span>
nginx<span class="token punctuation">[</span><span class="token string">'redirect_http_to_https'</span><span class="token punctuation">]</span> <span class="token operator">=</span> true
nginx<span class="token punctuation">[</span><span class="token string">'redirect_http_to_https_port'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">80</span>
# 所有请求<span class="token number">80</span>的都跳转到<span class="token number">443</span>
nginx<span class="token punctuation">[</span><span class="token string">'ssl_certificate'</span><span class="token punctuation">]</span> <span class="token operator">=</span>
<span class="token string">"/ssl_key/server.crt"</span>
nginx<span class="token punctuation">[</span><span class="token string">'ssl_certificate_key'</span><span class="token punctuation">]</span> <span class="token operator">=</span>
<span class="token string">"/ssl_key/server.key"</span>
nginx<span class="token punctuation">[</span><span class="token string">'ssl_ciphers'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"ECDHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES128-GCM-SHA256"</span>
nginx<span class="token punctuation">[</span><span class="token string">'ssl_prefer_server_ciphers'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"on"</span>
nginx<span class="token punctuation">[</span><span class="token string">'ssl_protocols'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"TLSv1.2"</span>
nginx<span class="token punctuation">[</span><span class="token string">'ssl_session_cache'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"builtin:1000 nnshared:SSL:10m"</span>
nginx<span class="token punctuation">[</span><span class="token string">'ssl_session_timeout'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"1440m"</span>
</code></pre> 
<p>3.重新初始化 Gitlab</p> 
<pre><code class="prism language-c"><span class="token punctuation">[</span>root@gitlab <span class="token operator">~</span><span class="token punctuation">]</span>#  gitlab<span class="token operator">-</span>ctl reconfigure
</code></pre> 
<h3><a id="56_Gitlab_457"></a>5.6 Gitlab忘记密码</h3> 
<p>如何重置 GitLab的 root 密码 <a href="https://docs.gitlab.com/ee/security/reset_root_password.html" rel="nofollow">官方修改密码方式</a><br> 1.在 root 用户下，执行</p> 
<pre><code class="prism language-c"><span class="token punctuation">[</span>root@gitlab <span class="token operator">~</span><span class="token punctuation">]</span># gitlab<span class="token operator">-</span>rails console <span class="token operator">-</span>e production
<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>
 GitLab<span class="token operator">:</span>       <span class="token number">12.3</span><span class="token number">.0</span> <span class="token punctuation">(</span><span class="token number">4f</span>cd588b89f<span class="token punctuation">)</span>
 GitLab Shell<span class="token operator">:</span> <span class="token number">10.0</span><span class="token number">.0</span>
 PostgreSQL<span class="token operator">:</span>   <span class="token number">10.9</span>
<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>
</code></pre> 
<p>2.获得用户数据，修改用户密码</p> 
<pre><code class="prism language-c"><span class="token function">irb</span><span class="token punctuation">(</span>main<span class="token punctuation">)</span><span class="token operator">:</span><span class="token number">001</span><span class="token operator">:</span><span class="token number">0</span><span class="token operator">&gt;</span> user<span class="token operator">=</span>User<span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span>id<span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>first
<span class="token operator">=</span><span class="token operator">&gt;</span> #<span class="token operator">&lt;</span>User id<span class="token operator">:</span><span class="token number">1</span> @root<span class="token operator">&gt;</span>

#更改密码并确认密码
<span class="token function">irb</span><span class="token punctuation">(</span>main<span class="token punctuation">)</span><span class="token operator">:</span><span class="token number">002</span><span class="token operator">:</span><span class="token number">0</span><span class="token operator">&gt;</span> user<span class="token punctuation">.</span>password<span class="token operator">=</span><span class="token string">"12345678"</span>
<span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">"12345678"</span>
<span class="token function">irb</span><span class="token punctuation">(</span>main<span class="token punctuation">)</span><span class="token operator">:</span><span class="token number">003</span><span class="token operator">:</span><span class="token number">0</span><span class="token operator">&gt;</span> user<span class="token punctuation">.</span>password_confirmation<span class="token operator">=</span><span class="token string">"12345678"</span>
<span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">"12345678"</span>

#保存退出
<span class="token function">irb</span><span class="token punctuation">(</span>main<span class="token punctuation">)</span><span class="token operator">:</span><span class="token number">004</span><span class="token operator">:</span><span class="token number">0</span><span class="token operator">&gt;</span> user<span class="token punctuation">.</span>save<span class="token operator">!</span>
Enqueued ActionMailer<span class="token operator">::</span><span class="token function">DeliveryJob</span> <span class="token punctuation">(</span>Job ID<span class="token operator">:</span> <span class="token number">07420155</span><span class="token operator">-</span><span class="token number">1</span>ccb<span class="token operator">-</span><span class="token number">44</span>a5<span class="token operator">-</span><span class="token number">9</span>b1c<span class="token operator">-</span>c74e0253f253<span class="token punctuation">)</span> to <span class="token function">Sidekiq</span><span class="token punctuation">(</span>mailers<span class="token punctuation">)</span> with arguments<span class="token operator">:</span> <span class="token string">"DeviseMailer"</span><span class="token punctuation">,</span> <span class="token string">"password_change"</span><span class="token punctuation">,</span> <span class="token string">"deliver_now"</span><span class="token punctuation">,</span> #<span class="token operator">&lt;</span>GlobalID<span class="token operator">:</span><span class="token number">0x00007f6ee7794b38</span> @uri<span class="token operator">=</span>#<span class="token operator">&lt;</span>URI<span class="token operator">::</span>GID gid<span class="token operator">:</span><span class="token comment">//gitlab/User/1&gt;&gt;</span>
<span class="token operator">=</span><span class="token operator">&gt;</span> true
<span class="token function">irb</span><span class="token punctuation">(</span>main<span class="token punctuation">)</span><span class="token operator">:</span><span class="token number">005</span><span class="token operator">:</span><span class="token number">0</span><span class="token operator">&gt;</span> quit
<span class="token punctuation">[</span>root@gitlab <span class="token operator">~</span><span class="token punctuation">]</span># 
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/b5dc9059bbdcd193b02e3e1bc9c70cfd/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">简单自动化测试：airTest vs 按键精灵</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/d8f515354a2c547a7e98a21748a87b59/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">cs188Inference in Bayes Nets（贝叶斯网络的推理）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 追风少年的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>