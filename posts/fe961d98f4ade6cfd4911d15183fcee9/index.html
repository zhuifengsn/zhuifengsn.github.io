<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>51单片机学习笔记-4矩阵键盘 - 追风少年的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="51单片机学习笔记-4矩阵键盘" />
<meta property="og:description" content="4 矩阵键盘 [toc]
注：笔记主要参考B站江科大自化协教学视频“51单片机入门教程-2020版 程序全程纯手打 从零开始入门”。
注：工程及代码文件放在了本人的Github仓库。
4.1 矩阵键盘介绍 在键盘中按键数量较多时，为了减少I/O口的占用，通常将按键排列成矩阵形式。采用逐行或逐列的“扫描”，就可以读出任何位置按键的状态。
数码管扫描（输出扫描）
原理：显示第1位→显示第2位→显示第3位→……，然后快速循环这个过程，最终实现所有数码管同时显示的效果。矩阵键盘扫描（输入扫描）
原理：读取第1行(列)→读取第2行(列) →读取第3行(列) → ……，然后快速循环这个过程，最终实现所有按键同时检测的效果。但同时按下多个按键可能会造成误判。以上两种扫描方式的共性：节省I/O口 图4-1 矩阵键盘实物图及原理图 比如，从上图所示，上四个接口表示行、下四个接口表示列。下面介绍具体的扫描过程：
逐行扫描：
先将某一行置0，此时若该行有按键按下，那该行上对应的列也就为0；以此重复所有的行，即完成一次扫描。逐列扫描：
将“逐行扫描”的行、列互换即可。 注：由于开发板IO资源有限，有一些开发板会把蜂鸣器IO口与矩阵键盘IO口复用，此时看情况更换扫描方式。
单片机的IO口是一种弱上拉（具有较弱的拉高电平或电位的能力）。关于其是如何实现双向口配置的，可以参考STC官方的器件手册“I/O口各种不同的工作模式及其配置介绍”。
4.2 实践：读取矩阵键盘 需求：在LCD1602第一行显示字符串“Matrix key:”，第二行按照按键丝印编号显示按下了哪个键（松开触发）。
为了代码简洁，编写了单独的矩阵按键检测子函数“MatrixKey.h”，并将其单独作为一个文件独立出来。当然，函数声明和定义应该分别放在头文件、源文件中，但由于函数太少，所以为了方便管理我将函数较少的源文件合并在头文件中。下面是工程的组织架构：
图4-2 “读取矩阵键盘”实验代码调用关系 代码展示：
- main.c
#include &lt;REGX52.H&gt; #include &#34;LCD1602.h&#34; #include &#34;Delay.h&#34; #include &#34;MatrixKey.h&#34; void main(){ int key = 0; // 初始化LCD显示 LCD_Init(); LCD_ShowString(1,1,&#34;Matrix key:&#34;); LCD_ShowString(2,1,&#34;S00&#34;); while(1){ key = MatrixKey(); if(key){LCD_ShowNum(2,2,key,2);}; } } - MatrixKey.h
#ifndef __MATRIXKEY_H__ #define __MATRIXKEY_H__ #include &lt;REGX52.H&gt; #include &#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://zhuifengsn.github.io/posts/fe961d98f4ade6cfd4911d15183fcee9/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-03-26T12:11:25+08:00" />
<meta property="article:modified_time" content="2023-03-26T12:11:25+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="追风少年的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">追风少年的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">51单片机学习笔记-4矩阵键盘</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-tomorrow-night">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="4__1"></a>4 矩阵键盘</h2> 
<p>[toc]</p> 
<p>注：笔记主要参考B站江科大自化协教学视频“<a href="https://www.bilibili.com/video/BV1Mb411e7re?spm_id_from=333.1007.top_right_bar_window_custom_collection.content.click" rel="nofollow">51单片机入门教程-2020版 程序全程纯手打 从零开始入门</a>”。<br> 注：工程及代码文件放在了本人的<a href="https://github.com/jjejdhhd/Learn_STC89C52">Github仓库</a>。</p> 
<hr> 
<h3><a id="41__9"></a>4.1 矩阵键盘介绍</h3> 
<p>在键盘中按键数量较多时，为了减少I/O口的占用，通常将按键排列成矩阵形式。采用逐行或逐列的“扫描”，就可以读出任何位置按键的状态。</p> 
<blockquote> 
 <ul><li>数码管扫描（输出扫描）<br> 原理：显示第1位→显示第2位→显示第3位→……，然后快速循环这个过程，最终实现所有数码管同时显示的效果。</li><li>矩阵键盘扫描（输入扫描）<br> 原理：读取第1行(列)→读取第2行(列) →读取第3行(列) → ……，然后快速循环这个过程，最终实现所有按键同时检测的效果。但同时按下多个按键可能会造成误判。</li><li>以上两种扫描方式的共性：节省I/O口</li></ul> 
</blockquote> 
<div align="center"> 
 <img src="https://images2.imgbox.com/ce/ff/fmRNeCrv_o.png" width="60%"> 
</div> 
<div align="center">
  图4-1 矩阵键盘实物图及原理图 
</div> 
<p>比如，从上图所示，上四个接口表示行、下四个接口表示列。下面介绍具体的扫描过程：</p> 
<blockquote> 
 <ul><li>逐行扫描：<br> 先将某一行置0，此时若该行有按键按下，那该行上对应的列也就为0；以此重复所有的行，即完成一次扫描。</li><li>逐列扫描：<br> 将“逐行扫描”的行、列互换即可。</li></ul> 
 <p>注：由于开发板IO资源有限，有一些开发板会把蜂鸣器IO口与矩阵键盘IO口复用，此时看情况更换扫描方式。</p> 
</blockquote> 
<p>单片机的IO口是一种弱上拉（具有较弱的拉高电平或电位的能力）。关于其是如何实现双向口配置的，可以参考STC官方的器件手册“I/O口各种不同的工作模式及其配置介绍”。</p> 
<h3><a id="42__34"></a>4.2 实践：读取矩阵键盘</h3> 
<p>需求：在LCD1602第一行显示字符串“Matrix key:”，第二行按照按键丝印编号显示按下了哪个键（松开触发）。</p> 
<p>为了代码简洁，编写了单独的矩阵按键检测子函数“MatrixKey.h”，并将其单独作为一个文件独立出来。当然，函数声明和定义应该分别放在头文件、源文件中，但由于函数太少，所以为了方便管理我将函数较少的源文件合并在头文件中。下面是工程的组织架构：</p> 
<div align="center"> 
 <img src="https://images2.imgbox.com/fb/ad/dtwyBtcu_o.png" width="20%"> 
</div> 
<div align="center">
  图4-2 “读取矩阵键盘”实验代码调用关系 
</div> 
<p>代码展示：<br> <strong>- main.c</strong></p> 
<pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;REGX52.H&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"LCD1602.h"</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"Delay.h"</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"MatrixKey.h"</span></span>

<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
  <span class="token keyword">int</span> key <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token comment">// 初始化LCD显示</span>
  <span class="token function">LCD_Init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">LCD_ShowString</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"Matrix key:"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">LCD_ShowString</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"S00"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    key <span class="token operator">=</span> <span class="token function">MatrixKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span><span class="token function">LCD_ShowNum</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span>key<span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><strong>- MatrixKey.h</strong></p> 
<pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifndef</span> <span class="token expression">__MATRIXKEY_H__</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">__MATRIXKEY_H__</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;REGX52.H&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"Delay.h"</span></span>
<span class="token comment">/**
  * @brief :按行扫描一次，检测矩阵键盘被按下的按键（松开返回）
  * @param :无
  * @retval :按下按键的标号（与丝印相同），若没有按下就返回0。
  * 注：若按键按下不松开，会一直停留在此函数，直到按键松开后。
 */</span>
<span class="token keyword">unsigned</span> <span class="token keyword">char</span> <span class="token function">MatrixKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
  <span class="token keyword">unsigned</span> <span class="token keyword">char</span> key <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

  <span class="token comment">// 扫描第一行</span>
  P1 <span class="token operator">=</span> <span class="token number">0xff</span><span class="token punctuation">;</span>  P1_7 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>P1_3 <span class="token operator">&amp;&amp;</span> P1_2 <span class="token operator">&amp;&amp;</span> P1_1 <span class="token operator">&amp;&amp;</span> P1_0<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token function">Delay</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// 按下消抖</span>
    <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">!</span>P1_3<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 等着松开</span>
    <span class="token function">Delay</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// 松开消抖</span>
    <span class="token keyword">return</span> key <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>P1_3 <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>P1_2 <span class="token operator">&amp;&amp;</span> P1_1 <span class="token operator">&amp;&amp;</span> P1_0<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token function">Delay</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">!</span>P1_2<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token function">Delay</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> key <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>P1_3 <span class="token operator">&amp;&amp;</span> P1_2 <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>P1_1 <span class="token operator">&amp;&amp;</span> P1_0<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token function">Delay</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">!</span>P1_1<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token function">Delay</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> key <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>P1_3 <span class="token operator">&amp;&amp;</span> P1_2 <span class="token operator">&amp;&amp;</span> P1_1 <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>P1_0<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token function">Delay</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">!</span>P1_0<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token function">Delay</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> key <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 扫描第二行</span>
  P1 <span class="token operator">=</span> <span class="token number">0xff</span><span class="token punctuation">;</span>  P1_6 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>P1_3 <span class="token operator">&amp;&amp;</span> P1_2 <span class="token operator">&amp;&amp;</span> P1_1 <span class="token operator">&amp;&amp;</span> P1_0<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token function">Delay</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">!</span>P1_3<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token function">Delay</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> key <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>P1_3 <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>P1_2 <span class="token operator">&amp;&amp;</span> P1_1 <span class="token operator">&amp;&amp;</span> P1_0<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token function">Delay</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">!</span>P1_2<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token function">Delay</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> key <span class="token operator">=</span> <span class="token number">6</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>P1_3 <span class="token operator">&amp;&amp;</span> P1_2 <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>P1_1 <span class="token operator">&amp;&amp;</span> P1_0<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token function">Delay</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">!</span>P1_1<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token function">Delay</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> key <span class="token operator">=</span> <span class="token number">7</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>P1_3 <span class="token operator">&amp;&amp;</span> P1_2 <span class="token operator">&amp;&amp;</span> P1_1 <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>P1_0<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token function">Delay</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">!</span>P1_0<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token function">Delay</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> key <span class="token operator">=</span> <span class="token number">8</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 扫描第三行</span>
  P1 <span class="token operator">=</span> <span class="token number">0xff</span><span class="token punctuation">;</span>  P1_5 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>P1_3 <span class="token operator">&amp;&amp;</span> P1_2 <span class="token operator">&amp;&amp;</span> P1_1 <span class="token operator">&amp;&amp;</span> P1_0<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token function">Delay</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">!</span>P1_3<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token function">Delay</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> key <span class="token operator">=</span> <span class="token number">9</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>P1_3 <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>P1_2 <span class="token operator">&amp;&amp;</span> P1_1 <span class="token operator">&amp;&amp;</span> P1_0<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token function">Delay</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">!</span>P1_2<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token function">Delay</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> key <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>P1_3 <span class="token operator">&amp;&amp;</span> P1_2 <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>P1_1 <span class="token operator">&amp;&amp;</span> P1_0<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token function">Delay</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">!</span>P1_1<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token function">Delay</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> key <span class="token operator">=</span> <span class="token number">11</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>P1_3 <span class="token operator">&amp;&amp;</span> P1_2 <span class="token operator">&amp;&amp;</span> P1_1 <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>P1_0<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token function">Delay</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">!</span>P1_0<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token function">Delay</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> key <span class="token operator">=</span> <span class="token number">12</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 扫描第四行</span>
  P1 <span class="token operator">=</span> <span class="token number">0xff</span><span class="token punctuation">;</span>  P1_4 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>P1_3 <span class="token operator">&amp;&amp;</span> P1_2 <span class="token operator">&amp;&amp;</span> P1_1 <span class="token operator">&amp;&amp;</span> P1_0<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token function">Delay</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">!</span>P1_3<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token function">Delay</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> key <span class="token operator">=</span> <span class="token number">13</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>P1_3 <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>P1_2 <span class="token operator">&amp;&amp;</span> P1_1 <span class="token operator">&amp;&amp;</span> P1_0<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token function">Delay</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">!</span>P1_2<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token function">Delay</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> key <span class="token operator">=</span> <span class="token number">14</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>P1_3 <span class="token operator">&amp;&amp;</span> P1_2 <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>P1_1 <span class="token operator">&amp;&amp;</span> P1_0<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token function">Delay</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">!</span>P1_1<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token function">Delay</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> key <span class="token operator">=</span> <span class="token number">15</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>P1_3 <span class="token operator">&amp;&amp;</span> P1_2 <span class="token operator">&amp;&amp;</span> P1_1 <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>P1_0<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token function">Delay</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">!</span>P1_0<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token function">Delay</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> key <span class="token operator">=</span> <span class="token number">16</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  
  <span class="token keyword">return</span> key<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>
</code></pre> 
<p><strong>- Dealy.h</strong></p> 
<pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifndef</span> <span class="token expression">__DEALY_H_</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">__DEALY_H_</span></span>

<span class="token comment">// 延时cycles ms，晶振@11.0592MHz</span>
<span class="token keyword">void</span> <span class="token function">Delay</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span> cycles<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
  <span class="token keyword">unsigned</span> <span class="token keyword">char</span> i<span class="token punctuation">,</span> j<span class="token punctuation">;</span>
  <span class="token keyword">do</span><span class="token punctuation">{<!-- --></span>
    i <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
    j <span class="token operator">=</span> <span class="token number">199</span><span class="token punctuation">;</span>
    <span class="token keyword">do</span><span class="token punctuation">{<!-- --></span>
      <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">--</span>j<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">--</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">--</span>cycles<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>
</code></pre> 
<p><strong>- LCD1602.h</strong></p> 
<pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifndef</span> <span class="token expression">__LCD1602_H__</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">__LCD1602_H__</span></span>

<span class="token comment">//用户调用函数：</span>
<span class="token keyword">void</span> <span class="token function">LCD_Init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">LCD_ShowChar</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> Line<span class="token punctuation">,</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> Column<span class="token punctuation">,</span><span class="token keyword">char</span> Char<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">LCD_ShowString</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> Line<span class="token punctuation">,</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> Column<span class="token punctuation">,</span><span class="token keyword">char</span> <span class="token operator">*</span>String<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">LCD_ShowNum</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> Line<span class="token punctuation">,</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> Column<span class="token punctuation">,</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span> Number<span class="token punctuation">,</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> Length<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">LCD_ShowSignedNum</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> Line<span class="token punctuation">,</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> Column<span class="token punctuation">,</span><span class="token keyword">int</span> Number<span class="token punctuation">,</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> Length<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">LCD_ShowHexNum</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> Line<span class="token punctuation">,</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> Column<span class="token punctuation">,</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span> Number<span class="token punctuation">,</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> Length<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">LCD_ShowBinNum</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> Line<span class="token punctuation">,</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> Column<span class="token punctuation">,</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span> Number<span class="token punctuation">,</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> Length<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>
</code></pre> 
<p><strong>- LCD1602.c</strong></p> 
<pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;REGX52.H&gt;</span></span>

<span class="token comment">//引脚配置：</span>
sbit LCD_RS<span class="token operator">=</span>P2<span class="token operator">^</span><span class="token number">6</span><span class="token punctuation">;</span>
sbit LCD_RW<span class="token operator">=</span>P2<span class="token operator">^</span><span class="token number">5</span><span class="token punctuation">;</span>
sbit LCD_EN<span class="token operator">=</span>P2<span class="token operator">^</span><span class="token number">7</span><span class="token punctuation">;</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">LCD_DataPort</span> <span class="token expression">P0</span></span>

<span class="token comment">//函数定义：</span>
<span class="token comment">/**
  * @brief  LCD1602延时函数，12MHz调用可延时1ms
  * @param  无
  * @retval 无
  */</span>
<span class="token keyword">void</span> <span class="token function">LCD_Delay</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">unsigned</span> <span class="token keyword">char</span> i<span class="token punctuation">,</span> j<span class="token punctuation">;</span>

	i <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
	j <span class="token operator">=</span> <span class="token number">239</span><span class="token punctuation">;</span>
	<span class="token keyword">do</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">--</span>j<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span> <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">--</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
  * @brief  LCD1602写命令
  * @param  Command 要写入的命令
  * @retval 无
  */</span>
<span class="token keyword">void</span> <span class="token function">LCD_WriteCommand</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> Command<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	LCD_RS<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
	LCD_RW<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
	LCD_DataPort<span class="token operator">=</span>Command<span class="token punctuation">;</span>
	LCD_EN<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token function">LCD_Delay</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	LCD_EN<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token function">LCD_Delay</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
  * @brief  LCD1602写数据
  * @param  Data 要写入的数据
  * @retval 无
  */</span>
<span class="token keyword">void</span> <span class="token function">LCD_WriteData</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> Data<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	LCD_RS<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>
	LCD_RW<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
	LCD_DataPort<span class="token operator">=</span>Data<span class="token punctuation">;</span>
	LCD_EN<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token function">LCD_Delay</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	LCD_EN<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token function">LCD_Delay</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
  * @brief  LCD1602设置光标位置
  * @param  Line 行位置，范围：1~2
  * @param  Column 列位置，范围：1~16
  * @retval 无
  */</span>
<span class="token keyword">void</span> <span class="token function">LCD_SetCursor</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> Line<span class="token punctuation">,</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> Column<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>Line<span class="token operator">==</span><span class="token number">1</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token function">LCD_WriteCommand</span><span class="token punctuation">(</span><span class="token number">0x80</span><span class="token operator">|</span><span class="token punctuation">(</span>Column<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>Line<span class="token operator">==</span><span class="token number">2</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token function">LCD_WriteCommand</span><span class="token punctuation">(</span><span class="token number">0x80</span><span class="token operator">|</span><span class="token punctuation">(</span>Column<span class="token operator">-</span><span class="token number">1</span><span class="token operator">+</span><span class="token number">0x40</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
  * @brief  LCD1602初始化函数
  * @param  无
  * @retval 无
  */</span>
<span class="token keyword">void</span> <span class="token function">LCD_Init</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token function">LCD_WriteCommand</span><span class="token punctuation">(</span><span class="token number">0x38</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//八位数据接口，两行显示，5*7点阵</span>
	<span class="token function">LCD_WriteCommand</span><span class="token punctuation">(</span><span class="token number">0x0c</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//显示开，光标关，闪烁关</span>
	<span class="token function">LCD_WriteCommand</span><span class="token punctuation">(</span><span class="token number">0x06</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//数据读写操作后，光标自动加一，画面不动</span>
	<span class="token function">LCD_WriteCommand</span><span class="token punctuation">(</span><span class="token number">0x01</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//光标复位，清屏</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
  * @brief  在LCD1602指定位置上显示一个字符
  * @param  Line 行位置，范围：1~2
  * @param  Column 列位置，范围：1~16
  * @param  Char 要显示的字符
  * @retval 无
  */</span>
<span class="token keyword">void</span> <span class="token function">LCD_ShowChar</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> Line<span class="token punctuation">,</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> Column<span class="token punctuation">,</span><span class="token keyword">char</span> Char<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token function">LCD_SetCursor</span><span class="token punctuation">(</span>Line<span class="token punctuation">,</span>Column<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">LCD_WriteData</span><span class="token punctuation">(</span>Char<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
  * @brief  在LCD1602指定位置开始显示所给字符串
  * @param  Line 起始行位置，范围：1~2
  * @param  Column 起始列位置，范围：1~16
  * @param  String 要显示的字符串
  * @retval 无
  */</span>
<span class="token keyword">void</span> <span class="token function">LCD_ShowString</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> Line<span class="token punctuation">,</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> Column<span class="token punctuation">,</span><span class="token keyword">char</span> <span class="token operator">*</span>String<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">unsigned</span> <span class="token keyword">char</span> i<span class="token punctuation">;</span>
	<span class="token function">LCD_SetCursor</span><span class="token punctuation">(</span>Line<span class="token punctuation">,</span>Column<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">for</span><span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>String<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">!=</span><span class="token char">'\0'</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token function">LCD_WriteData</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
  * @brief  返回值=X的Y次方
  */</span>
<span class="token keyword">int</span> <span class="token function">LCD_Pow</span><span class="token punctuation">(</span><span class="token keyword">int</span> X<span class="token punctuation">,</span><span class="token keyword">int</span> Y<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">unsigned</span> <span class="token keyword">char</span> i<span class="token punctuation">;</span>
	<span class="token keyword">int</span> Result<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token keyword">for</span><span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>Y<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		Result<span class="token operator">*=</span>X<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> Result<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
  * @brief  在LCD1602指定位置开始显示所给数字
  * @param  Line 起始行位置，范围：1~2
  * @param  Column 起始列位置，范围：1~16
  * @param  Number 要显示的数字，范围：0~65535
  * @param  Length 要显示数字的长度，范围：1~5
  * @retval 无
  */</span>
<span class="token keyword">void</span> <span class="token function">LCD_ShowNum</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> Line<span class="token punctuation">,</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> Column<span class="token punctuation">,</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span> Number<span class="token punctuation">,</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> Length<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">unsigned</span> <span class="token keyword">char</span> i<span class="token punctuation">;</span>
	<span class="token function">LCD_SetCursor</span><span class="token punctuation">(</span>Line<span class="token punctuation">,</span>Column<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">for</span><span class="token punctuation">(</span>i<span class="token operator">=</span>Length<span class="token punctuation">;</span>i<span class="token operator">&gt;</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">--</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token function">LCD_WriteData</span><span class="token punctuation">(</span>Number<span class="token operator">/</span><span class="token function">LCD_Pow</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span>i<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">%</span><span class="token number">10</span><span class="token operator">+</span><span class="token char">'0'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
  * @brief  在LCD1602指定位置开始以有符号十进制显示所给数字
  * @param  Line 起始行位置，范围：1~2
  * @param  Column 起始列位置，范围：1~16
  * @param  Number 要显示的数字，范围：-32768~32767
  * @param  Length 要显示数字的长度，范围：1~5
  * @retval 无
  */</span>
<span class="token keyword">void</span> <span class="token function">LCD_ShowSignedNum</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> Line<span class="token punctuation">,</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> Column<span class="token punctuation">,</span><span class="token keyword">int</span> Number<span class="token punctuation">,</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> Length<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">unsigned</span> <span class="token keyword">char</span> i<span class="token punctuation">;</span>
	<span class="token keyword">unsigned</span> <span class="token keyword">int</span> Number1<span class="token punctuation">;</span>
	<span class="token function">LCD_SetCursor</span><span class="token punctuation">(</span>Line<span class="token punctuation">,</span>Column<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>Number<span class="token operator">&gt;=</span><span class="token number">0</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token function">LCD_WriteData</span><span class="token punctuation">(</span><span class="token char">'+'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		Number1<span class="token operator">=</span>Number<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">else</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token function">LCD_WriteData</span><span class="token punctuation">(</span><span class="token char">'-'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		Number1<span class="token operator">=</span><span class="token operator">-</span>Number<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">for</span><span class="token punctuation">(</span>i<span class="token operator">=</span>Length<span class="token punctuation">;</span>i<span class="token operator">&gt;</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">--</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token function">LCD_WriteData</span><span class="token punctuation">(</span>Number1<span class="token operator">/</span><span class="token function">LCD_Pow</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span>i<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">%</span><span class="token number">10</span><span class="token operator">+</span><span class="token char">'0'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
  * @brief  在LCD1602指定位置开始以十六进制显示所给数字
  * @param  Line 起始行位置，范围：1~2
  * @param  Column 起始列位置，范围：1~16
  * @param  Number 要显示的数字，范围：0~0xFFFF
  * @param  Length 要显示数字的长度，范围：1~4
  * @retval 无
  */</span>
<span class="token keyword">void</span> <span class="token function">LCD_ShowHexNum</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> Line<span class="token punctuation">,</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> Column<span class="token punctuation">,</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span> Number<span class="token punctuation">,</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> Length<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">unsigned</span> <span class="token keyword">char</span> i<span class="token punctuation">,</span>SingleNumber<span class="token punctuation">;</span>
	<span class="token function">LCD_SetCursor</span><span class="token punctuation">(</span>Line<span class="token punctuation">,</span>Column<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">for</span><span class="token punctuation">(</span>i<span class="token operator">=</span>Length<span class="token punctuation">;</span>i<span class="token operator">&gt;</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">--</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		SingleNumber<span class="token operator">=</span>Number<span class="token operator">/</span><span class="token function">LCD_Pow</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">,</span>i<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">%</span><span class="token number">16</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>SingleNumber<span class="token operator">&lt;</span><span class="token number">10</span><span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token function">LCD_WriteData</span><span class="token punctuation">(</span>SingleNumber<span class="token operator">+</span><span class="token char">'0'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">else</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token function">LCD_WriteData</span><span class="token punctuation">(</span>SingleNumber<span class="token operator">-</span><span class="token number">10</span><span class="token operator">+</span><span class="token char">'A'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
  * @brief  在LCD1602指定位置开始以二进制显示所给数字
  * @param  Line 起始行位置，范围：1~2
  * @param  Column 起始列位置，范围：1~16
  * @param  Number 要显示的数字，范围：0~1111 1111 1111 1111
  * @param  Length 要显示数字的长度，范围：1~16
  * @retval 无
  */</span>
<span class="token keyword">void</span> <span class="token function">LCD_ShowBinNum</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> Line<span class="token punctuation">,</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> Column<span class="token punctuation">,</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span> Number<span class="token punctuation">,</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> Length<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">unsigned</span> <span class="token keyword">char</span> i<span class="token punctuation">;</span>
	<span class="token function">LCD_SetCursor</span><span class="token punctuation">(</span>Line<span class="token punctuation">,</span>Column<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">for</span><span class="token punctuation">(</span>i<span class="token operator">=</span>Length<span class="token punctuation">;</span>i<span class="token operator">&gt;</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">--</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token function">LCD_WriteData</span><span class="token punctuation">(</span>Number<span class="token operator">/</span><span class="token function">LCD_Pow</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span>i<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">%</span><span class="token number">2</span><span class="token operator">+</span><span class="token char">'0'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="43__417"></a>4.3 实践：矩阵键盘密码锁</h3> 
<p>需求：<br> 实现一个矩阵键盘密码锁。S1~S9代表数字1~9，S10代表数字0，S11代表“确认”，S12代表“取消”。</p> 
<blockquote> 
 <ul><li>LCD第一行左侧显示“Password:”，第二行显示输入的四位密码，每次按下按键会依次左移数字。</li><li>按下“确认”时，判断密码是否正确，并显示在LCD第一行右侧“Err!”、“True!”，同时密码归位。</li><li>按下“取消”时，当前密码归零。</li></ul> 
</blockquote> 
<div align="center"> 
 <img src="https://images2.imgbox.com/ca/97/ergiG7jy_o.png" width="20%"> 
</div> 
<div align="center">
  图4-3 “矩阵键盘密码锁”实验代码调用关系 
</div> 
<p><strong>- main.c</strong></p> 
<pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;REGX52.H&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"MatrixKey.h"</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"LCD1602.h"</span></span>

<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
  <span class="token keyword">unsigned</span> <span class="token keyword">int</span> correct <span class="token operator">=</span> <span class="token number">123</span><span class="token punctuation">;</span> <span class="token comment">// 正确的密码</span>
  <span class="token keyword">unsigned</span> <span class="token keyword">int</span> password <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// 当前的密码值</span>
  <span class="token keyword">unsigned</span> <span class="token keyword">char</span> key <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// 矩阵键盘当前按下的值</span>
  <span class="token comment">// 显示屏初始化</span>
  <span class="token function">LCD_Init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">LCD_ShowString</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"Password:"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">LCD_ShowNum</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    key <span class="token operator">=</span> <span class="token function">MatrixKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>key<span class="token operator">==</span><span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span> <span class="token comment">// 按下确认键，则进行判断</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>password <span class="token operator">==</span> correct<span class="token punctuation">)</span>
        <span class="token function">LCD_ShowString</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">12</span><span class="token punctuation">,</span><span class="token string">"True!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">else</span>
        <span class="token function">LCD_ShowString</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">13</span><span class="token punctuation">,</span><span class="token string">"Err!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>key<span class="token operator">==</span><span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span> <span class="token comment">// 按下取消键，密码归零</span>
      <span class="token function">LCD_ShowString</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">12</span><span class="token punctuation">,</span><span class="token string">"     "</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 清除对错提示</span>
      password <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
      <span class="token function">LCD_ShowNum</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span>password<span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>key<span class="token operator">&gt;=</span><span class="token number">1</span> <span class="token operator">&amp;&amp;</span> key<span class="token operator">&lt;=</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span> <span class="token comment">// 其他正常的数字键</span>
      <span class="token function">LCD_ShowString</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">12</span><span class="token punctuation">,</span><span class="token string">"     "</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 清除对错提示</span>
      key <span class="token operator">=</span> <span class="token punctuation">(</span>key<span class="token operator">==</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token number">0</span> <span class="token operator">:</span> key<span class="token punctuation">;</span> <span class="token comment">// 或者也可以对10取余</span>
      password <span class="token operator">=</span> <span class="token punctuation">(</span>password<span class="token operator">%</span><span class="token number">1000</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">10</span> <span class="token operator">+</span> key<span class="token punctuation">;</span>
      <span class="token function">LCD_ShowNum</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span>password<span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>其余的 <strong><code>MatrixKey.h</code></strong>、<strong><code>Delay.h</code></strong>、<strong><code>LCD1602.h</code></strong>、<strong><code>LCD1602.c</code></strong> 模块均与4.2节实验相同。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/aa0b51f4754ea4f2dbcdd17b0cf698b8/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">【设计模式-工厂方法】想象力和创造力：你考虑过自动化实现工厂吗？</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/7ae7a4adcaee9bee933408b308c8bce9/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Centos7安装、各种环境配置和常见bug解决方案，保姆级教程（更新中）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 追风少年的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>