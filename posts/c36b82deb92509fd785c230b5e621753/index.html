<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>上位机与stm32的串口通信（适合萌新） - 追风少年的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="上位机与stm32的串口通信（适合萌新）" />
<meta property="og:description" content="前言 之前准备电赛期间就搞过opemv和stm32之间的通信，这次工训赛又给忘了，遂记录一下。
上位机 安装python和serial库 一般来说上位机都是要用python的serial库来实现串口通信的，那么肯定要现在环境中装好python环境，选择3.8左右就可以，接着在终端里：
pip install serial -i https://pypi.tuna.tsinghua.edu.cn/simple 这样就完成python上位机的基本配置。
下位机 stm32端的配置，由于本人习惯使用DMA串口中断进行收发，所以顺便讲一下DMA如何配置
1.首先用cubemx完成基本配置后，接着在串口那里异步通信
2.接着开启DMA，选择normal模式即可
3.开启DMA中断
4.记得不要勾选这个
接着生成工程就创建完毕了，然后代码部分
5.手动在main函数的init部分开启DMA中端（收发数组就自己创建吧）
6.然后再重新定义这个函数（名字一定要一样，因为这个函数本身是个弱定义，否则就不发达成收发闭环）
如此一来，stm32就配置好了。
正片开始 上位机发float，下位机收 上位机端代码部分
import serial import struct import time if __name__ == &#34;__main__&#34;: ser = serial.Serial(&#39;COM10&#39;,baudrate=115200) float_values = [3.14, 2.718, 1.234] while True: for value in float_values: data_to_send = struct.pack(&#39;f&#39;, value) # &#39;f&#39;表示单精度浮点数 ser.write(data_to_send) print(data_to_send) time.sleep(1) ser.close() 说明：“COM10”是windows电脑的样式，如果是Linux上位机的话应该是“/dev/ttyUSB0”的样子。
发送的结果就是字节发送float类
stm32端代码部分
说明：这里使用一个联合体将收到的字节型数据和float类型做了一个转换，可以看到这里的发送是大端模式，所以0对0，1对1，如果收到结果不对可以试试反向映射。
我这里是用串口2来接受电脑发的数据，再用串口1打印回去便于可视化。
结果就是
然后int类型和float类型一模一样，
string类型的话就直接当作单个字符来接受就好，没什么难度，这里就不赘述了。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://zhuifengsn.github.io/posts/c36b82deb92509fd785c230b5e621753/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-10-12T22:40:27+08:00" />
<meta property="article:modified_time" content="2023-10-12T22:40:27+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="追风少年的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">追风少年的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">上位机与stm32的串口通信（适合萌新）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h3>        前言</h3> 
<p>        之前准备电赛期间就搞过opemv和stm32之间的通信，这次工训赛又给忘了，遂记录一下。</p> 
<h4>        上位机</h4> 
<h5>安装python和serial库</h5> 
<p>        一般来说上位机都是要用python的serial库来实现串口通信的，那么肯定要现在环境中装好python环境，选择3.8左右就可以，接着在终端里：</p> 
<pre><code class="hljs">pip install serial -i https://pypi.tuna.tsinghua.edu.cn/simple</code></pre> 
<p>这样就完成python上位机的基本配置。</p> 
<h4>        下位机</h4> 
<p>        stm32端的配置，由于本人习惯使用DMA串口中断进行收发，所以顺便讲一下DMA如何配置</p> 
<p>1.首先用cubemx完成基本配置后，接着在串口那里异步通信</p> 
<p><img alt="" height="687" src="https://images2.imgbox.com/32/d9/HoQ625JV_o.png" width="1200"></p> 
<p>2.接着开启DMA，选择normal模式即可</p> 
<p><img alt="" height="513" src="https://images2.imgbox.com/4b/57/63kczKB3_o.png" width="836"></p> 
<p>3.开启DMA中断</p> 
<p><img alt="" height="509" src="https://images2.imgbox.com/62/18/Hukb5hzN_o.png" width="839"></p> 
<p>4.记得不要勾选这个</p> 
<p><img alt="" height="792" src="https://images2.imgbox.com/5e/30/HPNDj1GS_o.png" width="1177"></p> 
<p>接着生成工程就创建完毕了，然后代码部分</p> 
<p>5.手动在main函数的init部分开启DMA中端（收发数组就自己创建吧）</p> 
<p><img alt="" height="257" src="https://images2.imgbox.com/e6/ab/CFQtkQe8_o.png" width="676"></p> 
<p>6.然后再重新定义这个函数（名字一定要一样，因为这个函数本身是个弱定义，否则就不发达成收发闭环）</p> 
<p><img alt="" height="223" src="https://images2.imgbox.com/4f/20/4bzLNiGA_o.png" width="809"></p> 
<p>如此一来，stm32就配置好了。</p> 
<h3>正片开始</h3> 
<h4>上位机发float，下位机收</h4> 
<p>上位机端代码部分</p> 
<pre><code class="language-cs">import serial
import struct
import time
if __name__ == "__main__":
    ser = serial.Serial('COM10',baudrate=115200)

    float_values = [3.14, 2.718, 1.234]
    while True:
        for value in float_values:
            data_to_send = struct.pack('f', value)  # 'f'表示单精度浮点数
            ser.write(data_to_send)
            print(data_to_send)
            time.sleep(1)
    ser.close()</code></pre> 
<p>说明：“COM10”是windows电脑的样式，如果是Linux上位机的话应该是“/dev/ttyUSB0”的样子。</p> 
<p>发送的结果就是字节发送float类</p> 
<p><img alt="" height="123" src="https://images2.imgbox.com/2b/a6/fc8964Hg_o.png" width="241"></p> 
<p>stm32端代码部分</p> 
<p><img alt="" height="519" src="https://images2.imgbox.com/f1/0f/Lnn0ppNf_o.png" width="793"></p> 
<p>说明：这里使用一个联合体将收到的字节型数据和float类型做了一个转换，可以看到这里的发送是大端模式，所以0对0，1对1，如果收到结果不对可以试试反向映射。</p> 
<p>我这里是用串口2来接受电脑发的数据，再用串口1打印回去便于可视化。</p> 
<p>结果就是</p> 
<p><img alt="" height="448" src="https://images2.imgbox.com/ed/a6/JZGGOiW9_o.png" width="882"></p> 
<p></p> 
<p>然后int类型和float类型一模一样，</p> 
<p>string类型的话就直接当作单个字符来接受就好，没什么难度，这里就不赘述了。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/313030450692be2d57c8eaad239325cb/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">VirtualBox&#43;Vagrant安装虚拟机</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/0b3f328e85853c18bdca2bf4f0fb8c85/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">如何使用FME开发自动化分析报告功能</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 追风少年的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>