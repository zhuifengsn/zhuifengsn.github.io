<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Airtest&#43;Python自动化处理windows窗口 - 追风少年的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Airtest&#43;Python自动化处理windows窗口" />
<meta property="og:description" content="今天在做回归测试的时候发现一条用例是查询数据库数据，于是思考如何使用工具自动化的方式解决该问题
首先想到的是jmeter的jdbc request配置大概如下
因为听说airtest也可以进行windows操作，随后开始研究如何使用airtest执行windows操作
打开airtest官网发现有三种方式可以连接windows应用窗口分别对应三个按钮
1-选择游戏画面：通过选择对应的应用窗口将程序嵌入airtestIDE进行操作
选取后会嵌入到IDE中
2-搜索窗口
点击对应应用窗口的名称进行连接即可
3.点击图标使用windows桌面直接操作
断开windows应用窗口的方式也非常简单，点击下图图标选择断开连接即可
整个操作过程中共碰到2个问题
1.airtest操作windwos应用时，对于应用弹出的窗口识别度不高
这种图标虽小，但是色差比较明显的图标可以清晰识别，但是对于弹框或者悬浮菜单无法可靠识别
为了解决问题，同时考虑到windows窗口对于鼠标键盘的可替代性，于是选择使用模拟键盘的方式解决上述问题
这里引出第二个问题，键盘操作底层是基于pywinauto开发的，所以按键略有不同，具体可参考
{SCROLLLOCK}, {VK_SPACE}, {VK_LSHIFT}, {VK_PAUSE}, {VK_MODECHANGE},
{BACK}, {VK_HOME}, {F23}, {F22}, {F21}, {F20}, {VK_HANGEUL}, {VK_KANJI},
{VK_RIGHT}, {BS}, {HOME}, {VK_F4}, {VK_ACCEPT}, {VK_F18}, {VK_SNAPSHOT},
{VK_PA1}, {VK_NONAME}, {VK_LCONTROL}, {ZOOM}, {VK_ATTN}, {VK_F10}, {VK_F22},
{VK_F23}, {VK_F20}, {VK_F21}, {VK_SCROLL}, {TAB}, {VK_F11}, {VK_END},
{LEFT}, {VK_UP}, {NUMLOCK}, {VK_APPS}, {PGUP}, {VK_F8}, {VK_CONTROL},
{VK_LEFT}, {PRTSC}, {VK_NUMPAD4}, {CAPSLOCK}, {VK_CONVERT}, {VK_PROCESSKEY},
{ENTER}, {VK_SEPARATOR}, {VK_RWIN}, {VK_LMENU}, {VK_NEXT}, {F1}, {F2}," />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://zhuifengsn.github.io/posts/947500a459e0a9cf7a0337d28b23c863/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-10-20T10:43:31+08:00" />
<meta property="article:modified_time" content="2020-10-20T10:43:31+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="追风少年的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">追风少年的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Airtest&#43;Python自动化处理windows窗口</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>今天在做回归测试的时候发现一条用例是查询数据库数据，于是思考如何使用工具自动化的方式解决该问题<br> 首先想到的是jmeter的jdbc request配置大概如下<br> <img src="https://images2.imgbox.com/47/3e/uKbdDLTv_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/ce/ba/6F1S5Vj6_o.png" alt="在这里插入图片描述"><br> 因为听说airtest也可以进行windows操作，随后开始研究如何使用airtest执行windows操作<br> 打开airtest官网发现有三种方式可以连接windows应用窗口分别对应三个按钮<br> <img src="https://images2.imgbox.com/be/dc/MshBJL2n_o.png" alt="在这里插入图片描述"><br> 1-选择游戏画面：通过选择对应的应用窗口将程序嵌入airtestIDE进行操作<br> <img src="https://images2.imgbox.com/dc/c3/0gMQFNYj_o.png" alt="在这里插入图片描述"><br> 选取后会嵌入到IDE中<br> <img src="https://images2.imgbox.com/c8/6b/CFkZQrH0_o.png" alt="在这里插入图片描述"><br> 2-搜索窗口<br> 点击对应应用窗口的名称进行连接即可<br> <img src="https://images2.imgbox.com/26/3a/c2ET0b9O_o.png" alt="在这里插入图片描述"><br> 3.点击图标使用windows桌面直接操作</p> 
<p>断开windows应用窗口的方式也非常简单，点击下图图标选择断开连接即可<br> <img src="https://images2.imgbox.com/10/aa/5dH2Linx_o.png" alt="在这里插入图片描述"><br> 整个操作过程中共碰到2个问题<br> 1.airtest操作windwos应用时，对于应用弹出的窗口识别度不高<br> <img src="https://images2.imgbox.com/f8/3e/38gUv1rZ_o.png" alt="在这里插入图片描述"><br> 这种图标虽小，但是色差比较明显的图标可以清晰识别，但是对于弹框或者悬浮菜单无法可靠识别<br> <img src="https://images2.imgbox.com/67/a2/FEfnQ69X_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/fe/8e/Ou368yCq_o.png" alt="在这里插入图片描述"><br> 为了解决问题，同时考虑到windows窗口对于鼠标键盘的可替代性，于是选择使用模拟键盘的方式解决上述问题<br> 这里引出第二个问题，键盘操作底层是基于pywinauto开发的，所以按键略有不同，具体可参考<br> {SCROLLLOCK}, {VK_SPACE}, {VK_LSHIFT}, {VK_PAUSE}, {VK_MODECHANGE},<br> {BACK}, {VK_HOME}, {F23}, {F22}, {F21}, {F20}, {VK_HANGEUL}, {VK_KANJI},<br> {VK_RIGHT}, {BS}, {HOME}, {VK_F4}, {VK_ACCEPT}, {VK_F18}, {VK_SNAPSHOT},<br> {VK_PA1}, {VK_NONAME}, {VK_LCONTROL}, {ZOOM}, {VK_ATTN}, {VK_F10}, {VK_F22},<br> {VK_F23}, {VK_F20}, {VK_F21}, {VK_SCROLL}, {TAB}, {VK_F11}, {VK_END},<br> {LEFT}, {VK_UP}, {NUMLOCK}, {VK_APPS}, {PGUP}, {VK_F8}, {VK_CONTROL},<br> {VK_LEFT}, {PRTSC}, {VK_NUMPAD4}, {CAPSLOCK}, {VK_CONVERT}, {VK_PROCESSKEY},<br> {ENTER}, {VK_SEPARATOR}, {VK_RWIN}, {VK_LMENU}, {VK_NEXT}, {F1}, {F2},<br> {F3}, {F4}, {F5}, {F6}, {F7}, {F8}, {F9}, {VK_ADD}, {VK_RCONTROL},<br> {VK_RETURN}, {BREAK}, {VK_NUMPAD9}, {VK_NUMPAD8}, {RWIN}, {VK_KANA},<br> {PGDN}, {VK_NUMPAD3}, {DEL}, {VK_NUMPAD1}, {VK_NUMPAD0}, {VK_NUMPAD7},<br> {VK_NUMPAD6}, {VK_NUMPAD5}, {DELETE}, {VK_PRIOR}, {VK_SUBTRACT}, {HELP},<br> {VK_PRINT}, {VK_BACK}, {CAP}, {VK_RBUTTON}, {VK_RSHIFT}, {VK_LWIN}, {DOWN},<br> {VK_HELP}, {VK_NONCONVERT}, {BACKSPACE}, {VK_SELECT}, {VK_TAB}, {VK_HANJA},<br> {VK_NUMPAD2}, {INSERT}, {VK_F9}, {VK_DECIMAL}, {VK_FINAL}, {VK_EXSEL},<br> {RMENU}, {VK_F3}, {VK_F2}, {VK_F1}, {VK_F7}, {VK_F6}, {VK_F5}, {VK_CRSEL},<br> {VK_SHIFT}, {VK_EREOF}, {VK_CANCEL}, {VK_DELETE}, {VK_HANGUL}, {VK_MBUTTON},<br> {VK_NUMLOCK}, {VK_CLEAR}, {END}, {VK_MENU}, {SPACE}, {BKSP}, {VK_INSERT},<br> {F18}, {F19}, {ESC}, {VK_MULTIPLY}, {F12}, {F13}, {F10}, {F11}, {F16},<br> {F17}, {F14}, {F15}, {F24}, {RIGHT}, {VK_F24}, {VK_CAPITAL}, {VK_LBUTTON},<br> {VK_OEM_CLEAR}, {VK_ESCAPE}, {UP}, {VK_DIVIDE}, {INS}, {VK_JUNJA},<br> {VK_F19}, {VK_EXECUTE}, {VK_PLAY}, {VK_RMENU}, {VK_F13}, {VK_F12}, {LWIN},<br> {VK_DOWN}, {VK_F17}, {VK_F16}, {VK_F15}, {VK_F14}</p> 
<p>https://www.kancloud.cn/gnefnuy/pywinauto_doc/1193047</p> 
<p>同时对于修饰符的使用会在airtest的text方法中被自动过滤，如下语句<br> select count(CAID) as a from hk where LOID in (‘0070235002350’,‘0070161401614’,‘0070161801618’)<br> 在使用text方法后会被输入成 selectcountCAIDasafromhkwhereLOIDin’0070235002350’,‘0070161401614’,‘0070161801618’<br> 仔细观察发现空格和（）不见了<br> 此处如需要输入正确语句，需要将所有空格替换为{SPACE}，换行替换为{ENTER}，而将（）通过加{}的方式解决，{}在这里有点类似Java中的\转义符<br> 替换后select{SPACE}count{(}CAID{)}{SPACE}as{SPACE}a{ENTER}from{SPACE}hk{ENTER}where{SPACE}LOID{SPACE}in{SPACE}{(}‘0070235002350’,‘0070161401614’,‘0070161801618’{)}<br> 于是，问题解决了，现在可以通过airtest做windows应用的测试了</p> 
<p>整个过程中总结为以下三点：<br> 1.airtest对于windows截图的解析还不够稳定，时常出现截图可以识别，再次运行就无法识别的情况<br> 2.airtest对于windows的应用操作存在一定局限性，建议使用第一或第二种方式更为方便<br> 3.airtest对于windows应用的自动打开和使用没有实现（这里没有深入研究，个人猜测是可以通过命令行实现的）<br> 最后附上大致图片，可以看到大致操作方式<br> <img src="https://images2.imgbox.com/9c/5f/tNEdsNZq_o.png" alt="在这里插入图片描述"></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/2cea116395bf800f73799bf8d3471502/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">几行代码轻松实现跨系统传递 traceId，再也不用担心对不上日志了！</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/1a663f37fcbc232a3abf8a94073501b8/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">数据结构实验二 单链表的基本操作</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 追风少年的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>