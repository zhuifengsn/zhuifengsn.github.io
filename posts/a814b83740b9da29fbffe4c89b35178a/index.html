<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Springboot整合Shiro安全框架 - 追风少年的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Springboot整合Shiro安全框架" />
<meta property="og:description" content="1、创建springboot工程 2、引入依赖 &lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt; &lt;project xmlns=&#34;http://maven.apache.org/POM/4.0.0&#34; xmlns:xsi=&#34;http://www.w3.org/2001/XMLSchema-instance&#34; xsi:schemaLocation=&#34;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&#34;&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;groupId&gt;com.aaa&lt;/groupId&gt; &lt;artifactId&gt;springboot-shiro&lt;/artifactId&gt; &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt; &lt;name&gt;springboot-shiro&lt;/name&gt; &lt;description&gt;springboot-shiro&lt;/description&gt; &lt;properties&gt; &lt;java.version&gt;1.8&lt;/java.version&gt; &lt;project.build.sourceEncoding&gt;UTF-8&lt;/project.build.sourceEncoding&gt; &lt;project.reporting.outputEncoding&gt;UTF-8&lt;/project.reporting.outputEncoding&gt; &lt;spring-boot.version&gt;2.3.12.RELEASE&lt;/spring-boot.version&gt; &lt;/properties&gt; &lt;dependencies&gt; &lt;!--shiro和redis整合的依赖--&gt; &lt;dependency&gt; &lt;groupId&gt;org.crazycake&lt;/groupId&gt; &lt;artifactId&gt;shiro-redis&lt;/artifactId&gt; &lt;version&gt;3.3.1&lt;/version&gt; &lt;/dependency&gt; &lt;!--shrio和thymeleaf集成的扩展依赖，为了能在页面上使用xsln:shrio的标签 --&gt; &lt;dependency&gt; &lt;groupId&gt;com.github.theborakompanioni&lt;/groupId&gt; &lt;artifactId&gt;thymeleaf-extras-shiro&lt;/artifactId&gt; &lt;version&gt;2.0.0&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;mysql&lt;/groupId&gt; &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;com.baomidou&lt;/groupId&gt; &lt;artifactId&gt;mybatis-plus-boot-starter&lt;/artifactId&gt; &lt;version&gt;3.5.1&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-thymeleaf&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.projectlombok&lt;/groupId&gt; &lt;artifactId&gt;lombok&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--shiro和springboot整合的依赖--&gt; &lt;dependency&gt; &lt;groupId&gt;org.apache.shiro&lt;/groupId&gt; &lt;artifactId&gt;shiro-spring-boot-starter&lt;/artifactId&gt; &lt;version&gt;1.7.0&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;dependencyManagement&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://zhuifengsn.github.io/posts/a814b83740b9da29fbffe4c89b35178a/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-07-13T14:40:19+08:00" />
<meta property="article:modified_time" content="2023-07-13T14:40:19+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="追风少年的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">追风少年的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Springboot整合Shiro安全框架</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h3>1、创建springboot工程</h3> 
<p><img alt="" height="842" src="https://images2.imgbox.com/ef/6c/tdsfKaBo_o.png" width="846"></p> 
<p><img alt="" height="842" src="https://images2.imgbox.com/dd/49/w8MHc4aO_o.png" width="846"></p> 
<h3> 2、引入依赖</h3> 
<p><img alt="" height="884" src="https://images2.imgbox.com/19/08/jiRksvvQ_o.png" width="532"></p> 
<pre><code class="language-XML">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd"&gt;
    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
    &lt;groupId&gt;com.aaa&lt;/groupId&gt;
    &lt;artifactId&gt;springboot-shiro&lt;/artifactId&gt;
    &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;
    &lt;name&gt;springboot-shiro&lt;/name&gt;
    &lt;description&gt;springboot-shiro&lt;/description&gt;
    &lt;properties&gt;
        &lt;java.version&gt;1.8&lt;/java.version&gt;
        &lt;project.build.sourceEncoding&gt;UTF-8&lt;/project.build.sourceEncoding&gt;
        &lt;project.reporting.outputEncoding&gt;UTF-8&lt;/project.reporting.outputEncoding&gt;
        &lt;spring-boot.version&gt;2.3.12.RELEASE&lt;/spring-boot.version&gt;
    &lt;/properties&gt;
    &lt;dependencies&gt;
        &lt;!--shiro和redis整合的依赖--&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.crazycake&lt;/groupId&gt;
            &lt;artifactId&gt;shiro-redis&lt;/artifactId&gt;
            &lt;version&gt;3.3.1&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;!--shrio和thymeleaf集成的扩展依赖，为了能在页面上使用xsln:shrio的标签 --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;com.github.theborakompanioni&lt;/groupId&gt;
            &lt;artifactId&gt;thymeleaf-extras-shiro&lt;/artifactId&gt;
            &lt;version&gt;2.0.0&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;
        &lt;/dependency&gt;

        &lt;dependency&gt;
            &lt;groupId&gt;mysql&lt;/groupId&gt;
            &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;
        &lt;/dependency&gt;

        &lt;dependency&gt;
            &lt;groupId&gt;com.baomidou&lt;/groupId&gt;
            &lt;artifactId&gt;mybatis-plus-boot-starter&lt;/artifactId&gt;
            &lt;version&gt;3.5.1&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-thymeleaf&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;
            &lt;artifactId&gt;lombok&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;!--shiro和springboot整合的依赖--&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.apache.shiro&lt;/groupId&gt;
            &lt;artifactId&gt;shiro-spring-boot-starter&lt;/artifactId&gt;
            &lt;version&gt;1.7.0&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;
            &lt;scope&gt;test&lt;/scope&gt;
        &lt;/dependency&gt;
    &lt;/dependencies&gt;
    &lt;dependencyManagement&gt;
        &lt;dependencies&gt;
            &lt;dependency&gt;
                &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
                &lt;artifactId&gt;spring-boot-dependencies&lt;/artifactId&gt;
                &lt;version&gt;${spring-boot.version}&lt;/version&gt;
                &lt;type&gt;pom&lt;/type&gt;
                &lt;scope&gt;import&lt;/scope&gt;
            &lt;/dependency&gt;
        &lt;/dependencies&gt;
    &lt;/dependencyManagement&gt;

    &lt;build&gt;
        &lt;plugins&gt;
            &lt;plugin&gt;
                &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
                &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt;
                &lt;version&gt;3.8.1&lt;/version&gt;
                &lt;configuration&gt;
                    &lt;source&gt;1.8&lt;/source&gt;
                    &lt;target&gt;1.8&lt;/target&gt;
                    &lt;encoding&gt;UTF-8&lt;/encoding&gt;
                &lt;/configuration&gt;
            &lt;/plugin&gt;
            &lt;plugin&gt;
                &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
                &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;
                &lt;version&gt;${spring-boot.version}&lt;/version&gt;
                &lt;configuration&gt;
                    &lt;mainClass&gt;com.aaa.SpringbootShiroApplication&lt;/mainClass&gt;
                    &lt;skip&gt;true&lt;/skip&gt;
                &lt;/configuration&gt;
                &lt;executions&gt;
                    &lt;execution&gt;
                        &lt;id&gt;repackage&lt;/id&gt;
                        &lt;goals&gt;
                            &lt;goal&gt;repackage&lt;/goal&gt;
                        &lt;/goals&gt;
                    &lt;/execution&gt;
                &lt;/executions&gt;
            &lt;/plugin&gt;
        &lt;/plugins&gt;
    &lt;/build&gt;

&lt;/project&gt;
</code></pre> 
<h3> 3、修改qpplication配置文件</h3> 
<p><img alt="" height="418" src="https://images2.imgbox.com/3a/89/Te3qUZc1_o.png" width="745"></p> 
<pre><code class="language-XML">spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver
spring.datasource.url=jdbc:mysql:///db3_25?serverTimezone=Asia/Shanghai
spring.datasource.username=root
spring.datasource.password=root

# 日志
mybatis-plus.configuration.log-impl=org.apache.ibatis.logging.stdout.StdOutImpl

mybatis-plus.mapper-locations=classpath:/mapper/*.xml

# thymeleaf 视图解析器
spring.thymeleaf.prefix=classpath:/templates/
spring.thymeleaf.suffix=.html

# 定义shiro的加密算法
shiro.hashAlgorithmName=MD5
shiro.hashIterations=1024
</code></pre> 
<h3> 4、编写实体类和Dao层</h3> 
<p>实体类</p> 
<p><img alt="" height="326" src="https://images2.imgbox.com/1e/b5/GsG5uoXn_o.png" width="617"></p> 
<p> <img alt="" height="414" src="https://images2.imgbox.com/88/36/HRJaTYE7_o.png" width="568"></p> 
<pre><code class="language-java">package com.aaa.pojo;

import com.baomidou.mybatisplus.annotation.IdType;
import com.baomidou.mybatisplus.annotation.TableId;
import lombok.Data;

@Data
public class Permission {
    @TableId(type = IdType.AUTO)
    private Integer id;
    private String pername;
    private String percode;
}


-------------------------------------------------------------
package com.aaa.pojo;

import com.baomidou.mybatisplus.annotation.IdType;
import com.baomidou.mybatisplus.annotation.TableId;
import lombok.Data;

@Data
public class User {
    //名字主键就叫id可以不加此注解
    @TableId(type = IdType.AUTO)
    private Integer id;
    private String username;
    private String userpwd;
    private String sex;
    private String address;
    private String salt;
}
</code></pre> 
<h3>5、Dao层</h3> 
<p><img alt="" height="332" src="https://images2.imgbox.com/21/68/rIQzmq9o_o.png" width="578"></p> 
<p><img alt="" height="396" src="https://images2.imgbox.com/7f/4b/kRmhvTfx_o.png" width="709"></p> 
<pre><code class="language-java">package com.aaa.dao;

import com.aaa.pojo.Permission;
import com.baomidou.mybatisplus.core.mapper.BaseMapper;
import org.apache.ibatis.annotations.Mapper;

import java.util.List;

@Mapper
public interface PermissionDao extends BaseMapper&lt;Permission&gt; {
    List&lt;Permission&gt; findUserid(Integer userid);
}

----------------------------------------------------------


package com.aaa.dao;

import com.aaa.pojo.User;
import com.baomidou.mybatisplus.core.mapper.BaseMapper;
import org.apache.ibatis.annotations.Mapper;

@Mapper
public interface UserDao extends BaseMapper&lt;User&gt; {
}
</code></pre> 
<h3>6、编写realm层</h3> 
<p><img alt="" height="845" src="https://images2.imgbox.com/cd/f3/1ZqeQNHd_o.png" width="1180"></p> 
<pre><code class="language-java">package com.aaa.realm;

import com.aaa.pojo.Permission;
import com.aaa.pojo.User;
import com.aaa.service.PermissionService;
import com.aaa.service.UserService;
import org.apache.shiro.authc.AuthenticationException;
import org.apache.shiro.authc.AuthenticationInfo;
import org.apache.shiro.authc.AuthenticationToken;
import org.apache.shiro.authc.SimpleAuthenticationInfo;
import org.apache.shiro.authz.AuthorizationInfo;
import org.apache.shiro.authz.SimpleAuthorizationInfo;
import org.apache.shiro.realm.AuthorizingRealm;
import org.apache.shiro.subject.PrincipalCollection;
import org.apache.shiro.util.ByteSource;
import org.apache.shiro.util.SimpleByteSource;
import org.springframework.beans.factory.annotation.Autowired;

import java.util.List;

public class MyRealm  extends AuthorizingRealm {
    @Autowired
    private UserService userService;
    @Autowired
    private PermissionService permissionService;

    //授权功能
    @Override
    protected AuthorizationInfo doGetAuthorizationInfo(PrincipalCollection principalCollection) {
        User primaryPrincipal = (User) principalCollection.getPrimaryPrincipal();
        List&lt;String&gt; permission = permissionService.selectPermissionById(primaryPrincipal.getId());
        System.out.println(permission);
        if (permission != null) {
            SimpleAuthorizationInfo info = new SimpleAuthorizationInfo();
            info.addStringPermissions(permission);
            return info;
        }
        return null;
    }

    //认证功能
    @Override
    protected AuthenticationInfo doGetAuthenticationInfo(AuthenticationToken token) throws AuthenticationException {
        //获取登录账号
        String username = token.getPrincipal().toString();
        //根据账号获取用户信息
        User user = userService.findByUsername(username);
        System.out.println(user);
        if (user != null) {
            ByteSource byteSource = new SimpleByteSource(user.getSalt());
            SimpleAuthenticationInfo simpleAuthenticationInfo = new SimpleAuthenticationInfo(user,user.getUserpwd(),byteSource,this.getName());
            return simpleAuthenticationInfo;
        }
        return null;
    }
}
</code></pre> 
<h3> 7、编写Service层</h3> 
<h4>权限</h4> 
<p><img alt="" height="336" src="https://images2.imgbox.com/99/4b/Y4wo4hOZ_o.png" width="799"></p> 
<pre><code class="language-java">package com.aaa.service;

import com.aaa.pojo.Permission;

import java.util.List;

public interface PermissionService {
    public List&lt;String&gt; selectPermissionById(Integer userid);
}
</code></pre> 
<p><img alt="" height="573" src="https://images2.imgbox.com/71/68/GbpHZIWw_o.png" width="1021"></p> 
<pre><code class="language-java">package com.aaa.service.Impl;

import com.aaa.dao.PermissionDao;
import com.aaa.pojo.Permission;
import com.aaa.service.PermissionService;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

import java.util.List;
import java.util.stream.Collectors;

@Service
public class PermissionServiceImpl implements PermissionService {
    @Autowired
    private PermissionDao permissionDao;
    @Override
    public List&lt;String&gt; selectPermissionById(Integer userid) {
        List&lt;Permission&gt; userid1 = permissionDao.findUserid(userid);
        List&lt;String&gt; collect = userid1.stream().map(Permission::getPercode).collect(Collectors.toList());
        return collect;
    }
}
</code></pre> 
<h4> 用户</h4> 
<p><img alt="" height="244" src="https://images2.imgbox.com/c8/a2/VfKtUI7v_o.png" width="493"></p> 
<pre><code class="language-java">package com.aaa.service;

import com.aaa.pojo.User;

public interface UserService {
    public User findByUsername(String username);
}
</code></pre> 
<p><img alt="" height="489" src="https://images2.imgbox.com/f4/36/AwX2Dxi9_o.png" width="706"></p> 
<pre><code class="language-java">package com.aaa.service.Impl;

import com.aaa.dao.UserDao;
import com.aaa.pojo.User;
import com.aaa.service.UserService;
import com.baomidou.mybatisplus.core.conditions.query.QueryWrapper;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

@Service
public class UserServiceImpl implements UserService {

    @Autowired
    private UserDao userDao;
    @Override
    public User findByUsername(String username) {
        QueryWrapper&lt;User&gt; query = new QueryWrapper&lt;&gt;();
        query.eq("username", username);
        User user = userDao.selectOne(query);
        return user;
    }
}
</code></pre> 
<h3>8、编写Controller层</h3> 
<h4>登录 </h4> 
<p><img alt="" height="591" src="https://images2.imgbox.com/bf/b0/JHUF5Pxq_o.png" width="918"></p> 
<pre><code class="language-java">package com.aaa.controller;

import com.aaa.vo.LoginVo;
import org.apache.shiro.SecurityUtils;
import org.apache.shiro.authc.UsernamePasswordToken;
import org.apache.shiro.subject.Subject;
import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.*;

@Controller
public class LoginController {


    @PostMapping("/login")
    public String login( LoginVo loginVo){
        Subject subject = SecurityUtils.getSubject();
        UsernamePasswordToken token = new UsernamePasswordToken(loginVo.getUsername(), loginVo.getPassword());
        try {
            subject.login(token);
            System.out.println("登录成功");
            return "success";
        }catch (Exception e){
            System.out.println("登录失败");
            return "redirect:/login,html";
        }
    }
}
</code></pre> 
<h4>权限层（用户具有什么权限）</h4> 
<p><img alt="" height="553" src="https://images2.imgbox.com/16/0f/9545WIBN_o.png" width="826"></p> 
<pre><code class="language-java">package com.aaa.controller;

import org.apache.shiro.authz.annotation.RequiresPermissions;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;

@RestController
@RequestMapping("/user")
public class UserController {

    @GetMapping("/query")
    @RequiresPermissions(value = "user:query")
    public String query(){
        return "user:query------------------------";
    }

    @GetMapping("/update")
    @RequiresPermissions(value = "user:update")
    public String update(){
        return "user:update------------------------";
    }

    @GetMapping("/delete")
    @RequiresPermissions(value = "user:delete")
    public String delete(){
        return "user:delete------------------------";
    }

    @GetMapping("/insert")
    @RequiresPermissions(value = "user:insert")
    public String insert(){
        return "user:insert------------------------";
    }

    @GetMapping("/export")
    @RequiresPermissions(value = "user:export")
    public String export(){
        return "user:export------------------------";
    }
}
</code></pre> 
<h3>9、mapper层 </h3> 
<p><img alt="" height="274" src="https://images2.imgbox.com/60/cf/kQAlCaIv_o.png" width="967"></p> 
<pre><code class="language-XML">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;
&lt;!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd"&gt;
&lt;!--namesapce的内容必须和对应的接口路径映射--&gt;
&lt;mapper namespace="com.aaa.dao.PermissionDao"&gt;
    &lt;select id="findUserid" resultType="com.aaa.pojo.Permission"&gt;
        select p.* from user_role ur join role_permission rp on ur.roleid = rp.roleid
        join permission p on p.id = rp.perid where ur.userid = #{userid}
    &lt;/select&gt;
&lt;/mapper&gt;
</code></pre> 
<h3>10、编写shiro的配置类-------特别注意</h3> 
<p><img alt="" height="871" src="https://images2.imgbox.com/5a/3d/KJOMjnyG_o.png" width="789"></p> 
<pre><code class="language-java">package com.aaa.config;

import at.pollux.thymeleaf.shiro.dialect.ShiroDialect;
import com.aaa.filter.LoginFilter;
import com.aaa.realm.MyRealm;
import org.apache.shiro.authc.credential.HashedCredentialsMatcher;
import org.apache.shiro.mgt.DefaultSecurityManager;
import org.apache.shiro.session.mgt.eis.SessionDAO;
import org.apache.shiro.spring.web.ShiroFilterFactoryBean;
import org.apache.shiro.web.mgt.DefaultWebSecurityManager;
import org.apache.shiro.web.session.mgt.DefaultWebSessionManager;
import org.crazycake.shiro.RedisCacheManager;
import org.crazycake.shiro.RedisManager;
import org.crazycake.shiro.RedisSessionDAO;
import org.springframework.beans.factory.annotation.Value;
import org.springframework.boot.web.servlet.FilterRegistrationBean;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.web.filter.DelegatingFilterProxy;
import javax.servlet.Filter;
import java.util.HashMap;
import java.util.Map;

@Configuration
public class ShiroConfig {

    @Bean
    public DefaultWebSecurityManager securityManager(){
        DefaultWebSecurityManager securityManager=new DefaultWebSecurityManager();
        securityManager.setRealm(myRealm());
        securityManager.setCacheManager(redisCacheManager());
        return securityManager;
    }


    @Bean
    public RedisCacheManager redisCacheManager(){
        RedisCacheManager redisCacheManager = new RedisCacheManager();
        redisCacheManager.setRedisManager(redisManager());
        return redisCacheManager;
    }
    @Bean
    public RedisManager redisManager(){
        RedisManager redisManager = new RedisManager();
        redisManager.setHost("192.168.253.129:6379");
        redisManager.setDatabase(1);
        return redisManager;
    }



    @Bean
    public MyRealm myRealm(){
        MyRealm myRealm=new MyRealm();
        //设置密码加密器
        myRealm.setCredentialsMatcher(credentialsMatcher());
        return myRealm;
    }
    @Value("${shiro.hashAlgorithmName}")
    private String hashAlgorithmName;
    @Value("${shiro.hashIterations}")
    private int hashIterations;
    @Bean
    public HashedCredentialsMatcher credentialsMatcher(){
        HashedCredentialsMatcher credentialsMatcher=new HashedCredentialsMatcher();
        credentialsMatcher.setHashAlgorithmName(hashAlgorithmName);
        credentialsMatcher.setHashIterations(hashIterations);
        return credentialsMatcher;
    }


    @Bean(name = "shiroFilter")
    public ShiroFilterFactoryBean factoryBean(){
        ShiroFilterFactoryBean shiroFilterFactoryBean=new ShiroFilterFactoryBean();
        shiroFilterFactoryBean.setSecurityManager(securityManager());
        shiroFilterFactoryBean.setLoginUrl("/login.html");
        //设置过滤规则
        Map&lt;String,String&gt; map=new HashMap&lt;&gt;();
        map.put("/login","anon");
        map.put("/**","authc");
        shiroFilterFactoryBean.setFilterChainDefinitionMap(map);
        return shiroFilterFactoryBean;
    }


    //springboot如何注册web三大组件。
    @Bean
    public FilterRegistrationBean&lt;Filter&gt; filterRegistrationBean(){
        FilterRegistrationBean&lt;Filter&gt; filterRegistrationBean=new FilterRegistrationBean&lt;&gt;();
        filterRegistrationBean.setFilter(new DelegatingFilterProxy());
        filterRegistrationBean.setName("shiroFilter");
        filterRegistrationBean.addUrlPatterns("/*");
        return filterRegistrationBean;
    }

    /**
     * 这里是为了能在html页面引用shiro标签，
     */
    @Bean(name = "shiroDialect")
    public ShiroDialect shiroDialect() {
        return new ShiroDialect();
    }
}</code></pre> 
<h3>11、前端页面</h3> 
<p>登录页面</p> 
<pre><code class="language-html">&lt;!DOCTYPE html&gt;
&lt;html lang="en"&gt;
&lt;head&gt;
    &lt;meta charset="UTF-8"&gt;
    &lt;title&gt;Title&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;form action="/login" method="post"&gt;
  账号:&lt;input type="text" name="username"&gt;&lt;br&gt;&lt;br&gt;
  密码:&lt;input type="text" name="password"&gt;&lt;br&gt;&lt;br&gt;
  &lt;input type="submit" name="登录"/&gt;
&lt;/form&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre> 
<p>登录成功页面</p> 
<pre><code class="language-html">&lt;!DOCTYPE html&gt;
&lt;html lang="en" xmlns:th="http://thymeleaf.org" xmlns:shiro="http://www.pollix.at/thymeleaf/shiro"&gt;
&lt;head&gt;
    &lt;meta charset="UTF-8"&gt;
    &lt;title&gt;Title&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
登录成功页面-------------------
&lt;h1 shiro:hasPermission="user:query"&gt;
&lt;a href="/user/query"&gt;查询用户&lt;/a&gt;&lt;br&gt;
&lt;/h1&gt;

&lt;h1 shiro:hasPermission="user:update"&gt;
&lt;a href="/user/update"&gt;修改用户&lt;/a&gt;&lt;br&gt;
&lt;/h1&gt;

&lt;h1 shiro:hasPermission="user:delete"&gt;
&lt;a href="/user/delete"&gt;删除用户&lt;/a&gt;&lt;br&gt;
&lt;/h1&gt;

&lt;h1 shiro:hasPermission="user:insert"&gt;
&lt;a href="/user/insert"&gt;添加用户&lt;/a&gt;&lt;br&gt;
&lt;/h1&gt;

&lt;h1 shiro:hasPermission="user:export"&gt;
&lt;a href="/user/export"&gt;导出用户&lt;/a&gt;&lt;br&gt;
&lt;/h1&gt;

&lt;/body&gt;
&lt;/html&gt;</code></pre> 
<h3>12、效果展示</h3> 
<p><img alt="" height="322" src="https://images2.imgbox.com/2f/1a/2sGlXMs1_o.png" width="808"></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/447fdb4f5f2bfc59d0bf51b328f4f105/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">this version of the Java Runtime only recognizes class file versions up to 55.0 新as 打开Java项目异常</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/653e2105744f93827ba067004c882f24/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">掌握这18个Pandas知识点，快速入门数据分析</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 追风少年的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>