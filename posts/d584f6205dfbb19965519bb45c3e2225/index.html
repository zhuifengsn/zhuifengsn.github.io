<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>7-Linux内核配置编译及安装 - 追风少年的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="7-Linux内核配置编译及安装" />
<meta property="og:description" content="学习了一下Linux内核配置、安装及编译，为了防止忘记，写在博客里
1、Linux源代码下载 下载源代码最好去官网下载，地址为：https://www.kernel.org/
如果需要下载历史版本，点击网页上的https://www.kernel.org/pub/，然后选择Linux，kernel即可，比较简单。
2、配置Linux内核 把源代码拷到Linux电脑里，解压，这里我下载的是linux-4.11.tar.xz，解压输入
#tar xvJf linux-4.11.tar.xz
如果是tar.gz结尾的文件用tar xvzf linux-4.11.tar.gz命令解压
解压之后开始配置内核模块，选择自己芯片的硬件架构，选择自己需要哪些驱动模块等等，配置为指令make config或者 make menuconfig,前者是基于问答式的配置，使用不方便，后者是菜单式的配置，较为直观和方便，这里使用后者，输入
#make menuconfig
然后根据自己的需要，用上下左右键移动选择项，用空格选择是否配置该项。另外还可以选择现有的配置文件来达到目的，在源代码下面的arch/$cpu/configs下有许多现成的配置文件，输入
#ls arch/arm/configs
可以查看arm芯片的内核配置，同时还可以使用本机的配置文件，这里使用本机的配置文件，在/boot目录下，复制/boot下的配置文件 config-2.6.32-279.el6.i686 到上述解压后目录里，输入
#cp /boot/config-2.6.32-279.el6.i686 ./
开始配置内核
#make menuconfig
选择后面的load加载配置文件，输入上面文件的名字，点ok，然后再点击保存，保存文件名为.config，输入
#ls -a
可以看到这个文件
3、编译内核 编译内核需要生成映像文件和模块文件，映像文件由配置中的选择为&lt;*&gt;的文件编译链接而成，开机后直接加载在内存中运行
模块文件将选择为&lt;M&gt;的文件编译成.o文件，放在磁盘中，以备后来要用到，先配置映像文件,输入
#make bzImage
开始生成bzImage映像文件，需要10多分钟左右，正常情况下不会有什么问题，编译完成后提示bzImage文件在 arch/x86/boot 目录下
然后编译模块文件，输入
#make modules
大概需要50分钟左右，应该也不会有什么问题，可能会有一些警告，可以忽视，然后把散落在各个文件夹下的.o文件组装起来，输入
#make modules_install
组装完成后，会把文件放在/lib/modules/ 下，文件名为对应的版本号，查看可以输入
#ls /lib/modules
可以看到对应版本的文件夹
然后把存放模块文件的目录打包成一个文件，使用mkinitrd命令，输入(主要后者不要输入成/lib/modules/4.11.0)
#mkinitrd rd-4.11.0 4.11.0
前者为生成文件的名字，后者为模块文件存在的目录，需要几分钟，这样文件包rd-4.11.0就在当前文件目录上产生了。
4、安装内核 安装内核之前需要把生成的bzImage和模块文件包rd-4.11.0拷贝到/boot目录下，这样启动的时候才能够选择这个内核启动
先拷贝bzImage，输入(如#cp arch/$cpu/boot/bzImage /boot/vmlinux-$version )
#cp arch/x86/boot/bzImage /boot/vmlinuz-4.11.0
然后拷贝模块文件包，输入cp rd-$version /boot/，version为对应版本号" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://zhuifengsn.github.io/posts/d584f6205dfbb19965519bb45c3e2225/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2017-05-10T16:50:45+08:00" />
<meta property="article:modified_time" content="2017-05-10T16:50:45+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="追风少年的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">追风少年的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">7-Linux内核配置编译及安装</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>学习了一下Linux内核配置、安装及编译，为了防止忘记，写在博客里</p> 
<h2>1、Linux源代码下载</h2> 
<p>下载源代码最好去官网下载，地址为：<a href="https://www.kernel.org/pub/" rel="nofollow">https://www.kernel.org/</a></p> 
<p>如果需要下载历史版本，点击网页上的<a href="https://www.kernel.org/pub/" rel="nofollow">https://www.kernel.org/pub/</a>，然后选择Linux，kernel即可，比较简单。</p> 
<p> </p> 
<h2>2、配置Linux内核</h2> 
<p>把源代码拷到Linux电脑里，解压，这里我下载的是linux-4.11.tar.xz，解压输入</p> 
<p>#tar xvJf  linux-4.11.tar.xz</p> 
<p> </p> 
<p>如果是tar.gz结尾的文件用tar xvzf  linux-4.11.tar.gz命令解压</p> 
<p> </p> 
<p>解压之后开始配置内核模块，选择自己芯片的硬件架构，选择自己需要哪些驱动模块等等，配置为指令make config或者 make menuconfig,前者是基于问答式的配置，使用不方便，后者是菜单式的配置，较为直观和方便，这里使用后者，输入</p> 
<p>#make menuconfig</p> 
<p> </p> 
<p>然后根据自己的需要，用上下左右键移动选择项，用空格选择是否配置该项。另外还可以选择现有的配置文件来达到目的，在源代码下面的arch/$cpu/configs下有许多现成的配置文件，输入</p> 
<p>#ls arch/arm/configs</p> 
<p>可以查看arm芯片的内核配置，同时还可以使用本机的配置文件，这里使用本机的配置文件，在/boot目录下，复制/boot下的配置文件 config-2.6.32-279.el6.i686 到上述解压后目录里，输入</p> 
<p>#cp /boot/config-2.6.32-279.el6.i686 ./</p> 
<p>开始配置内核</p> 
<p>#make menuconfig</p> 
<p>选择后面的load加载配置文件，输入上面文件的名字，点ok，然后再点击保存，保存文件名为.config，输入</p> 
<p>#ls -a</p> 
<p>可以看到这个文件</p> 
<p> </p> 
<h2>3、编译内核</h2> 
<p>编译内核需要生成映像文件和模块文件，映像文件由配置中的选择为&lt;*&gt;的文件编译链接而成，开机后直接加载在内存中运行</p> 
<p>模块文件将选择为&lt;M&gt;的文件编译成.o文件，放在磁盘中，以备后来要用到，先配置映像文件,输入</p> 
<p>#make bzImage</p> 
<p>开始生成bzImage映像文件，需要10多分钟左右，正常情况下不会有什么问题，编译完成后提示bzImage文件在 arch/x86/boot 目录下</p> 
<p> </p> 
<p>然后编译模块文件，输入</p> 
<p>#make modules</p> 
<p>大概需要50分钟左右，应该也不会有什么问题，可能会有一些警告，可以忽视，然后把散落在各个文件夹下的.o文件组装起来，输入</p> 
<p>#make modules_install</p> 
<p>组装完成后，会把文件放在/lib/modules/ 下，文件名为对应的版本号，查看可以输入</p> 
<p>#ls /lib/modules</p> 
<p>可以看到对应版本的文件夹</p> 
<p>然后把存放模块文件的目录打包成一个文件，使用mkinitrd命令，输入(主要后者不要输入成/lib/modules/4.11.0)</p> 
<p>#mkinitrd  rd-4.11.0  4.11.0</p> 
<p>前者为生成文件的名字，后者为模块文件存在的目录，需要几分钟，这样文件包rd-4.11.0就在当前文件目录上产生了。</p> 
<p> </p> 
<h2>4、安装内核</h2> 
<p>安装内核之前需要把生成的bzImage和模块文件包rd-4.11.0拷贝到/boot目录下，这样启动的时候才能够选择这个内核启动</p> 
<p>先拷贝bzImage，输入(如#cp   arch/$cpu/boot/bzImage  /boot/vmlinux-$version   )</p> 
<p>#cp arch/x86/boot/bzImage  /boot/vmlinuz-4.11.0</p> 
<p> </p> 
<p>然后拷贝模块文件包，输入cp rd-$version  /boot/，version为对应版本号</p> 
<p>#cp  rd-4.11.0  /boot/</p> 
<p> </p> 
<p>然后修改/etc/grub.conf，才可以在启动时选择这个新内核，输入</p> 
<p>#vi  /etc/grub.conf</p> 
<p>赋值倒数后面的4行，输入4yy，然后拷贝到最后，输入p，修改成如下的样子</p> 
<p> </p> 
<p><img alt="" class="has" src="https://images2.imgbox.com/b1/da/dOTLInTH_o.png"></p> 
<p>主要修改3个地方，第一个是括号里的，修改成4.11.0，这是启动选择内核时版本的名称</p> 
<p>还有映像文件名字和模块文件名字，修改成对应版本，修改后保存退出。</p> 
<p> </p> 
<h2>5、启动</h2> 
<p>输入重启，然后在开机倒计时的时候按下回车，选择新的版本，启动的时候有点久。</p> 
<p>这样就成功的把内核升级了，虽然在操作的时候好像没什么变化，可以查看当前的内核版本，输入</p> 
<p>#uname -r</p> 
<p>显示的应该是最新的版本号，这样内核就升级成功了，对应的开发板的内核制作也是和这个差不多。</p> 
<p> </p> 
<h2>6、内核清理</h2> 
<p>如果需要把内核编译的文件删掉，包括镜像文件和.o文件，输入</p> 
<p>#make distclean</p> 
<p> </p> 
<p>如果仅仅需要删除.o文件，输入</p> 
<p>#make clean</p> 
<p> </p> 
<h2>更多Linux资料及视频教程点击<a href="http://t.cn/Ai9UXLyQ" rel="nofollow">这里</a></h2> 
<p><img alt="" class="has" height="435" src="https://images2.imgbox.com/bc/48/9fOTkQf7_o.png" width="507"></p> 
<p><img alt="" class="has" height="892" src="https://images2.imgbox.com/90/11/hQi8851x_o.png" width="363"></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/ce2bec4ecc170764d23de5c09c0be7cc/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">mysql主从同步分库分表同步</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/d890c661f4f4355746b27ab5e3d66af3/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">树莓派3b&#43;控制舵机、伺服电机的驱动代码。</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 追风少年的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>