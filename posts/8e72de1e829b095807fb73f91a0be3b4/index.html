<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>【解决】Error: ENOSPC: no space left on device, watch - 追风少年的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="【解决】Error: ENOSPC: no space left on device, watch" />
<meta property="og:description" content="发现问题： 启动 node 项目ReactNative时候出现报错Error: ENOSPC: no space left on device, watch
[root@iz2zeihk6kfcls5kwmqzj1z JFReactNativeProject]# npm start &gt; wk_rn@0.0.1 start /app/jenkins_workspace/workspace/JFReactNativeProject &gt; react-native start ┌──────────────────────────────────────────────────────────────────────────────┐ │ │ │ Running Metro Bundler on port 8081. │ │ │ │ Keep Metro running while developing on any JS projects. Feel free to │ │ close this tab and run your own Metro instance if you prefer. │ │ │ │ https://github.com/facebook/react-native │ │ │ └──────────────────────────────────────────────────────────────────────────────┘ Looking for JS files in /app/jenkins_workspace/workspace/JFReactNativeProject Loading dependency graph." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://zhuifengsn.github.io/posts/8e72de1e829b095807fb73f91a0be3b4/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2019-09-25T15:28:00+08:00" />
<meta property="article:modified_time" content="2019-09-25T15:28:00+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="追风少年的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">追风少年的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">【解决】Error: ENOSPC: no space left on device, watch</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown"> 
 <h4 id="发现问题">发现问题：</h4> 
 <p>启动 node 项目<code>ReactNative</code>时候出现报错<code>Error: ENOSPC: no space left on device, watch</code></p> 
 <pre class="bash"><code>[root@iz2zeihk6kfcls5kwmqzj1z JFReactNativeProject]# npm start

&gt; wk_rn@0.0.1 start /app/jenkins_workspace/workspace/JFReactNativeProject
&gt; react-native start

┌──────────────────────────────────────────────────────────────────────────────┐
│                                                                              │
│  Running Metro Bundler on port 8081.                                         │
│                                                                              │
│  Keep Metro running while developing on any JS projects. Feel free to        │
│  close this tab and run your own Metro instance if you prefer.               │
│                                                                              │
│  https://github.com/facebook/react-native                                    │
│                                                                              │
└──────────────────────────────────────────────────────────────────────────────┘

Looking for JS files in
   /app/jenkins_workspace/workspace/JFReactNativeProject

Loading dependency graph...fs.js:1413
    throw error;
    ^

Error: ENOSPC: no space left on device, watch '/app/jenkins_workspace/workspace/JFReactNativeProject/node_modules/.staging/react-native-ddd311e5/ReactAndroid/src/androidTest/java/com/facebook/react/testing/idledetection'
    at FSWatcher.start (fs.js:1407:26)
    at Object.fs.watch (fs.js:1444:11)
    at NodeWatcher.watchdir (/app/jenkins_workspace/workspace/JFReactNativeProject/node_modules/_sane@4.1.0@sane/src/node_watcher.js:159:22)
    at Walker.&lt;anonymous&gt; (/app/jenkins_workspace/workspace/JFReactNativeProject/node_modules/_sane@4.1.0@sane/src/common.js:109:31)
    at Walker.emit (events.js:182:13)
    at /app/jenkins_workspace/workspace/JFReactNativeProject/node_modules/_walker@1.0.7@walker/lib/walker.js:69:16
    at go$readdir$cb (/app/jenkins_workspace/workspace/JFReactNativeProject/node_modules/_graceful-fs@4.2.2@graceful-fs/graceful-fs.js:187:14)
    at FSReqWrap.oncomplete (fs.js:169:20)
npm ERR! code ELIFECYCLE
npm ERR! errno 1
npm ERR! wk_rn@0.0.1 start: `react-native start`
npm ERR! Exit status 1
npm ERR!
npm ERR! Failed at the wk_rn@0.0.1 start script.
npm ERR! This is probably not a problem with npm. There is likely additional logging output above.

npm ERR! A complete log of this run can be found in:
npm ERR!     /root/.npm/_logs/2019-09-25T06_57_58_754Z-debug.log
</code></pre> 
 <h4 id="解决办法">解决办法：</h4> 
 <p>ENOSPC的含义是 <code>Error No more hard-disk space available</code>（没有更多的磁盘空间可以使用）</p> 
 <p>首先使用<code>df -hT</code>发现磁盘空间还有很多</p> 
 <p>然后从报错日志中发现<code>FSWatcher</code>和<code>Object.fs.watch</code>字段，然后查看系统允许用户监听文件数相关内容</p> 
 <pre class="bash"><code>#表示同一用户同时可以添加的watch数目（watch一般是针对目录，决定了同时同一用户可以监控的目录数量）
[root@iz2zeihk6kfcls5kwmqzj1z JFReactNativeProject]# cat /proc/sys/fs/inotify/max_user_watches
8192
[root@iz2zeihk6kfcls5kwmqzj1z JFReactNativeProject]# echo 100000 &gt; /proc/sys/fs/inotify/max_user_watches
[root@iz2zeihk6kfcls5kwmqzj1z JFReactNativeProject]# cat /proc/sys/fs/inotify/max_user_watches
100000</code></pre> 
 <p>永久生效方法如下：（建议采用此方法）</p> 
 <pre class="bash"><code>vim /etc/sysctl.conf
fs.inotify.max_user_watches = 100000（后面值根据实际情况可自行调整）
添加并运行/sbin/sysctl -p即可 </code></pre> 
 <h4 id="启动验证">启动验证：</h4> 
 <p>再次启动，正常</p> 
 <pre class="bash"><code>[root@iz2zeihk6kfcls5kwmqzj1z JFReactNativeProject]# npm start

&gt; wk_rn@0.0.1 start /app/jenkins_workspace/workspace/JFReactNativeProject
&gt; react-native start

┌──────────────────────────────────────────────────────────────────────────────┐
│                                                                              │
│  Running Metro Bundler on port 8081.                                         │
│                                                                              │
│  Keep Metro running while developing on any JS projects. Feel free to        │
│  close this tab and run your own Metro instance if you prefer.               │
│                                                                              │
│  https://github.com/facebook/react-native                                    │
│                                                                              │
└──────────────────────────────────────────────────────────────────────────────┘

Looking for JS files in
   /app/jenkins_workspace/workspace/JFReactNativeProject

Loading dependency graph, done.</code></pre> 
 <h4 id="知识点">知识点：</h4> 
 <p><strong>inotify 的默认内核参数</strong></p> 
 <ul><li><code>/proc/sys/fs/inotify/max_queued_events</code> 默认值: <code>16384</code> 该文件中的值为调用inotify_init时分配给inotify instance中可排队的event的数目的最大值，超出这个值得事件被丢弃，但会触发IN_Q_OVERFLOW事件</li><li><code>/proc/sys/fs/inotify/max_user_instances</code> 默认值: <code>128</code> 指定了每一个real user ID可创建的inotify instatnces的数量上限</li><li><code>/proc/sys/fs/inotify/max_user_watches</code> 默认值: <code>8192</code> 指定了每个inotify instance相关联的watches的上限</li></ul> 
 <p>注意: <code>max_queued_events</code> 是 Inotify 管理的队列的最大长度，文件系统变化越频繁，这个值就应该越大<br> 如果你在日志中看到<code>Event Queue Overflow</code>，说明 <code>max_queued_events</code> 太小需要调整参数后再次使用.</p> 
</div> 
<p>转载于:https://www.cnblogs.com/liyongjian5179/p/11584939.html</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/2d063089b1b2b7a15c10e40cbf6542ee/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">mac 终端访问文件没有权限解决方案</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/3635a7b5c87f7459c87dae953a996032/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Android Studio获取开发版SHA1值和发布版SHA1值的史上最详细方法</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 追风少年的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>