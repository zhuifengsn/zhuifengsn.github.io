<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>用Perl制作页面计数器 - 追风少年的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="用Perl制作页面计数器" />
<meta property="og:description" content="网友大都喜欢在自己的主页上做一个计数器来显示自己主页被访问的次数。以前我们只能申请由第三方提供的计数器或用由系统管理员提供的计数器，受到很大限制。现在许多免费空间都提供了CGI权限，因此我们也可以用CGI方式实现一个自己的计数器。 计数器可以用数据库方式实现，也可以用文本文件方式实现。由于文本文件方式不涉及系统的数据库管理系统，相对简单，容易实现，因此，在这里介绍文本方式的计数器。 计数器的原理比较简单，页面每次被访问的时候，对记录访问次数的数字加1，然后将这个数显示出来。原理虽然简单，在具体实现上还是需要一定的技巧。 由于一个CGI程序在服务器上并非一直驻留在内存中，为了对访问次数进行计数，则需要把这个数字存入一个文件中，每当主页被访问时，打开该文件将访问数字加1后再存入文件中。 网站是多用户环境，在访问文件时必须对文件上锁以禁止其他用户对文件的访问，这样才能保证数据的可靠性。然而不同网站使用的操作系统不同，其对文件上锁的机制也不同。本文采用了一种各种平台都适用的方法，每当有页面被访问时，CGI程序创建一个临时文件，此时若有其它进程也要对文件进行存取则须等待，进程对文件更新后删除该临时文件，等待的进程才能对文件进行存取。 下面是用Perl实现的一个计数器源代码，并加注了注释： #!/usr/local/bin/perl ＃存贮表示主页访问量数字的文件 $data = &#39;/usr/local/etc/httpd/htdocs/counter.data&#39;; ＃用作文件锁的临时文件 $lockfile = &#39;/usr/local/etc/httpd/htdocs/counter.LOCK&#39;; # 主模块 &amp;increment; print &#34;Content-Type: text/html/n/n&#34;; print $accesses; sub increment { # 检查临时文件是否存在 while (-e $lockfile) { sleep 2; # 存在则等待2秒 } # 创建临时文件 open(LOCK,&#34; &gt;$lockfile&#34;) || die &#34;Can&#39;t create lockfile./n&#34;; # 读文件并更新数据 open(DATA,$data) || die &#34;Can&#39;t open data file./n&#34;; $accesses = &lt; DATA &gt;; $accesses&#43;&#43;; print DATA &#34;$accesses/n&#34;; close(DATA); # 删除临时文件，对数据文件开锁 close(LOCK); unlink($lockfile); } 你可以在页面上需要显示计数器的地方加上下面的HTML代码，页面被访问的时候，来访者就可以知道自己是第几位来访者了。 &lt; html &gt; &lt; head &gt; &lt; title &gt;Home Page&lt; /title &gt; &lt; /head &gt; &lt; body &gt; &lt; h1 &gt;Home Page&lt; /h1 &gt; &lt; p &gt;欢迎您！第 &lt; !" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://zhuifengsn.github.io/posts/ba0977148afe7576b2b83c123f14e4c1/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2005-11-27T13:26:00+08:00" />
<meta property="article:modified_time" content="2005-11-27T13:26:00+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="追风少年的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">追风少年的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">用Perl制作页面计数器</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    　　网友大都喜欢在自己的主页上做一个计数器来显示自己主页被访问的次数。以前我们只能申请由第三方提供的计数器或用由系统管理员提供的计数器，受到很大限制。现在许多免费空间都提供了CGI权限，因此我们也可以用CGI方式实现一个自己的计数器。 
<br> 
<br>　　计数器可以用数据库方式实现，也可以用文本文件方式实现。由于文本文件方式不涉及系统的数据库管理系统，相对简单，容易实现，因此，在这里介绍文本方式的计数器。 
<br> 
<br>　　计数器的原理比较简单，页面每次被访问的时候，对记录访问次数的数字加1，然后将这个数显示出来。原理虽然简单，在具体实现上还是需要一定的技巧。 
<br> 
<br>　　由于一个CGI程序在服务器上并非一直驻留在内存中，为了对访问次数进行计数，则需要把这个数字存入一个文件中，每当主页被访问时，打开该文件将访问数字加1后再存入文件中。 
<br> 
<br>　　网站是多用户环境，在访问文件时必须对文件上锁以禁止其他用户对文件的访问，这样才能保证数据的可靠性。然而不同网站使用的操作系统不同，其对文件上锁的机制也不同。本文采用了一种各种平台都适用的方法，每当有页面被访问时，CGI程序创建一个临时文件，此时若有其它进程也要对文件进行存取则须等待，进程对文件更新后删除该临时文件，等待的进程才能对文件进行存取。 
<br> 
<br>　　下面是用Perl实现的一个计数器源代码，并加注了注释： 
<br> 
<br>#!/usr/local/bin/perl 
<br>＃存贮表示主页访问量数字的文件 
<br>$data = '/usr/local/etc/httpd/htdocs/counter.data'; 
<br>＃用作文件锁的临时文件 
<br>$lockfile = '/usr/local/etc/httpd/htdocs/counter.LOCK'; 
<br># 主模块 
<br>&amp;increment; 
<br>print "Content-Type: text/html/n/n"; 
<br>print $accesses; 
<br>sub increment { 
<br># 检查临时文件是否存在 
<br>while (-e $lockfile) { 
<br>sleep 2; # 存在则等待2秒 
<br>} 
<br># 创建临时文件 
<br>open(LOCK," &gt;$lockfile") || die 
<br>"Can't create lockfile./n"; 
<br># 读文件并更新数据 
<br>open(DATA,$data) || die "Can't open data file./n"; 
<br>$accesses = &lt; DATA &gt;; 
<br>$accesses++; 
<br>print DATA "$accesses/n"; 
<br>close(DATA); 
<br># 删除临时文件，对数据文件开锁 
<br>　close(LOCK); 
<br>unlink($lockfile); 
<br>} 
<br>　　你可以在页面上需要显示计数器的地方加上下面的HTML代码，页面被访问的时候，来访者就可以知道自己是第几位来访者了。 
<br>&lt; html &gt; &lt; head &gt; 
<br>&lt; title &gt;Home Page&lt; /title &gt; 
<br>&lt; /head &gt; 
<br>&lt; body &gt; 
<br>&lt; h1 &gt;Home Page&lt; /h1 &gt; 
<br>&lt; p &gt;欢迎您！第 
<br>&lt; !--#exec cgi="/cgi-bin/text-counter.cgi" &gt; 
<br>位来访者.&lt; /p &gt; 
<br>&lt; /body &gt; &lt; /html &gt; 
<br> 
<br>　　只要掌握了计数器的原理，就可以设计出称心如意的计数器，使你的主页更有吸引力。
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/c4a3898dfb8be92de36f6dbda16f0585/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">OPENH323中呼叫建立过程的跟踪与分析（八）----非快速隧道方式之被叫端</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/4033ddaa5a527e46b80be79b3f2d63c8/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">google 编程挑战赛（1）answer3</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 追风少年的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>