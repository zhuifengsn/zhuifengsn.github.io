<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>RAID阵列与LVM逻辑卷组创建 - 追风少年的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="RAID阵列与LVM逻辑卷组创建" />
<meta property="og:description" content="一.Linux下RAID的创建 Linux下使用mdadm命令创建RAID
1.创建模式：
-C:新建RAID卷
专用选项：
-l：选择RAID级别
-n：硬盘设备个数
-a：自动为其创建设备文件，后跟yes、no
-c：指定chunk（数据库）大小，为2的整数次方默认为64K
-x：指定空闲盘个数--提供冗余，磁盘损坏后直接加载上去
例：创建raid0
madadm -C /dev/md0 -a yes -l 0 -n 2 /dev/sda{6,7}
Mke2fs -j /dev/md0
Mount /dev/mdo /mnt 2.管理模式：
-f | --fail ：模拟磁盘为损坏盘
Fg： mdadm /dev/md0 --fail /dev/sda7
-a | --add :新增硬盘
Fg：mdadm /dev/md0 -a /dev/sda8
-r | --remove ：移除损坏的硬盘
3.监控模式：
-F
4.增长模式：
-G 5.装配模式：
-A Fg:mdadm -A /dev/md0 /dev/sda8 /dev/sda9 6.查看当前系统的RAID信息：
-D：显示RAID的相关信息
--detail：显示信息
7.停止RAID阵列
-S | --stop 8.将当前RAID信息保存至配置文件，一便以后进行装配
Mdadm -D --scan &gt; /dev/mdadm." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://zhuifengsn.github.io/posts/6f75d8a180db6fd3e3359df1b4592366/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2016-05-09T22:01:19+08:00" />
<meta property="article:modified_time" content="2016-05-09T22:01:19+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="追风少年的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">追风少年的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">RAID阵列与LVM逻辑卷组创建</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h2><strong>一.Linux<span style="font-family:宋体">下</span><span style="font-family:Calibri">RAID</span><span style="font-family:宋体">的创建</span></strong></h2> 
<p>Linux下使用mdadm<span style="font-family:宋体">命令创建RAID</span></p> 
<p><strong>1.创建模式</strong>：</p> 
<p> -C:<span style="font-family:宋体">新建</span><span style="font-family:Calibri">RAID</span><span style="font-family:宋体">卷</span></p> 
<p> 专用选项：</p> 
<p> -l<span style="font-family:宋体">：选择</span><span style="font-family:Calibri">RAID</span><span style="font-family:宋体">级别</span></p> 
<p> -n<span style="font-family:宋体">：硬盘设备个数</span></p> 
<p> -a<span style="font-family:宋体">：自动为其创建设备文件，后跟</span><span style="font-family:Calibri">yes</span><span style="font-family:宋体">、</span><span style="font-family:Calibri">no</span></p> 
<p> -c<span style="font-family:宋体">：指定</span><span style="font-family:Calibri">chunk</span><span style="font-family:宋体">（数据库）大小，为</span><span style="font-family:Calibri">2</span><span style="font-family:宋体">的整数次方默认为</span><span style="font-family:Calibri">64K</span></p> 
<p> -x<span style="font-family:宋体">：指定空闲盘个数</span><span style="font-family:Calibri">--</span><span style="font-family:宋体">提供冗余，磁盘损坏后直接加载上去</span></p> 
<p> 例：创建<span style="font-family:Calibri">raid0</span></p> 
<p> madadm -C /dev/md0 -a yes -l 0 -n 2 /dev/sda{6,7}</p> 
<p> Mke2fs -j /dev/md0</p> 
<p> Mount /dev/mdo /mnt </p> 
<p><strong> 2.管理模式：</strong></p> 
<p> -f | --fail <span style="font-family:宋体">：模拟磁盘为损坏盘</span></p> 
<p> Fg<span style="font-family:宋体">： </span><span style="font-family:Calibri">mdadm /dev/md0 --fail /dev/sda7</span></p> 
<p> -a | --add :<span style="font-family:宋体">新增硬盘</span></p> 
<p> Fg<span style="font-family:宋体">：</span><span style="font-family:Calibri">mdadm /dev/md0 -a /dev/sda8</span></p> 
<p> -r | --remove <span style="font-family:宋体">：移除损坏的硬盘</span></p> 
<p><strong> 3.监控模式：</strong></p> 
<p> -F</p> 
<p><strong> 4.增长模式：</strong></p> 
<p> -G </p> 
<p><strong> 5.装配模式：</strong></p> 
<p> -A </p> 
<p> Fg:mdadm -A /dev/md0 /dev/sda8 /dev/sda9 </p> 
<p><strong>6.查看当前系统的<span style="font-family:Calibri">RAID</span><span style="font-family:宋体">信息：</span></strong></p> 
<p> -D<span style="font-family:宋体">：显示</span><span style="font-family:Calibri">RAID</span><span style="font-family:宋体">的相关信息</span></p> 
<p> --detail<span style="font-family:宋体">：显示信息</span></p> 
<p><strong>7.停止<span style="font-family:Calibri">RAID</span><span style="font-family:宋体">阵列</span></strong></p> 
<p> -S | --stop </p> 
<p><strong>8.将当前<span style="font-family:Calibri">RAID</span><span style="font-family:宋体">信息保存至配置文件，一便以后进行装配</span></strong></p> 
<p> Mdadm -D --scan &gt; /dev/mdadm.conf</p> 
<p> 装配：<span style="font-family:Calibri">mdadm -A /dev/md#</span></p> 
<p></p> 
<h2><strong>二.Linux<span style="font-family:宋体">下</span><span style="font-family:Calibri">LVM的</span><span style="font-family:宋体">创建</span></strong></h2> 
<p></p> 
<p><strong> 1.物理卷<span style="font-family:Calibri">PV</span></strong></p> 
<p>pvcreate <span style="font-family:宋体">：创建</span><span style="font-family:Calibri">PV </span></p> 
<p>pvmore<span style="font-family:宋体">：挪动数据</span></p> 
<p>pvremove<span style="font-family:宋体">：擦除</span><span style="font-family:Calibri">PV</span><span style="font-family:宋体">卷</span></p> 
<p>pvdisplay<span style="font-family:宋体">：显示物理卷的信息</span></p> 
<p>pvscan<span style="font-family:宋体">：扫描并显示系统上的</span><span style="font-family:Calibri">pv</span><span style="font-family:宋体">卷</span></p> 
<p>pvs<span style="font-family:宋体">：查看</span><span style="font-family:Calibri">pv</span><span style="font-family:宋体">信息</span></p> 
<p><strong>2.卷组<span style="font-family:Calibri">VG</span></strong></p> 
<p>vgcreate <span style="font-family:宋体">：创建</span><span style="font-family:Calibri">Vg </span></p> 
<p>vgmore<span style="font-family:宋体">：移除</span></p> 
<p>vgremove<span style="font-family:宋体">：删除</span><span style="font-family:Calibri">vg</span></p> 
<p>vgdisplay<span style="font-family:宋体">：显示</span><span style="font-family:Calibri">vg</span><span style="font-family:宋体">的信息</span></p> 
<p>vgs<span style="font-family:宋体">：查看</span><span style="font-family:Calibri">vg</span><span style="font-family:宋体">信息</span></p> 
<p>vgcreate -s #<span style="font-family:宋体">：指定</span><span style="font-family:Calibri">pe</span><span style="font-family:宋体">大小，默认为</span><span style="font-family:Calibri">4Mb</span><span style="font-family:宋体">，默认单位为</span><span style="font-family:Calibri">mb </span></p> 
<p><strong>3.逻辑卷<span style="font-family:Calibri">LV</span></strong></p> 
<p>lvcreate<span style="font-family:宋体">：创建</span><span style="font-family:Calibri">LV</span></p> 
<p>lvreduce<span style="font-family:宋体">：缩减</span><span style="font-family:Calibri">LV</span></p> 
<p>lvextend<span style="font-family:宋体">：拓展</span><span style="font-family:Calibri">LV</span></p> 
<p>lvremove<span style="font-family:宋体">：移除</span><span style="font-family:Calibri">lv</span><span style="font-family:宋体">，后加路径</span></p> 
<p>lvdisplay<span style="font-family:宋体">：查看</span><span style="font-family:Calibri">lv</span><span style="font-family:宋体">相关信息</span></p> 
<p>lvs<span style="font-family:宋体">：查看</span><span style="font-family:Calibri">lv</span><span style="font-family:宋体">信息</span></p> 
<p><strong>4.扩展逻辑卷</strong></p> 
<p>LVM<span style="font-family:宋体">的扩展：先扩展物理卷，再扩展逻辑卷</span></p> 
<p>lvextend  -L  [+]2T  /PATH/TO/PV<span style="font-family:宋体">：</span> //+<span style="font-family:宋体">是至增加多大，不接</span><span style="font-family:Calibri">+</span><span style="font-family:宋体">号时，则为扩展到多大</span></p> 
<p>resize2fs  /PATH/TO/LV  5G //<span style="font-family:宋体">扩展逻辑边界到</span><span style="font-family:Calibri">5G</span></p> 
<p>resize2fs  -p  /PATH/TO/LV //<span style="font-family:宋体">有多大扩展到多大</span></p> 
<p><strong>5.缩减逻辑卷</strong></p> 
<p>LVM<span style="font-family:宋体">缩减：先缩减逻辑边界，再缩减物理卷边界</span></p> 
<p>注意<span style="font-family:Calibri">:</span></p> 
<p>  1<span style="font-family:宋体">、不能在线缩减，得先卸载</span></p> 
<p>  2<span style="font-family:宋体">、确保缩减后的空间大小能储存原来所有文件</span></p> 
<p>3<span style="font-family:宋体">、在缩减之前应该强行检查文件，以确保文件系统处于一致性状态。</span></p> 
<p>e2fsck -f<span style="font-family:宋体">：强行检查文件</span></p> 
<p>df -lh<span style="font-family:宋体">：检查利用率</span></p> 
<p>umount<span style="font-family:宋体">：缩减之前必须先卸载</span></p> 
<p>resize2fs  /PATH/TO/LV  5G //<span style="font-family:宋体">缩减逻辑卷到</span><span style="font-family:Calibri">5G</span></p> 
<p>lvreduce  -L   [-]300G   /PATH/TO/PV //<span style="font-family:宋体">缩减物理卷</span></p> 
<p>mount:<span style="font-family:宋体">重新挂载。 </span></p> 
<p><strong>6.快照卷</strong></p> 
<p> 1<span style="font-family:宋体">、生命周期为整个数据时长：在这段时长内，数据的增长量不能超出块照卷大小</span></p> 
<p> 2<span style="font-family:宋体">、快照卷应该是只读的</span></p> 
<p> 3<span style="font-family:宋体">、跟原卷在同一卷组内</span></p> 
<p> 创建快照命令： </p> 
<p> lvcreate</p> 
<p> -s <span style="font-family:宋体">：指定类型为块照</span></p> 
<p> -p r|w<span style="font-family:宋体">：表示指定权限</span></p> 
<p> 例<span style="font-family:宋体">：创建、还原过程 </span></p> 
<p> lvcreate  -s  -L  2T  SLV_NAME  -p  -r  /PATH/TO/LV</p> 
<p> tar  jcf  /tmp/usrs.tar.bz2 <span style="font-family:宋体">块照挂载点内的内容</span></p> 
<p> tar  -xf  /tmp/users.tar.bz2 <span style="font-family:宋体">解压缩 </span></p> 
<h2><span style="font-family:宋体">三、案例</span></h2> 
<p>案例：为公司的<span style="font-family:Calibri">mail</span><span style="font-family:宋体">服务器扩容</span></p> 
<p>起初用于<span style="font-family:Calibri">mail</span><span style="font-family:宋体">的存储空间只有一块硬盘</span><span style="font-family:Calibri">sdb</span><span style="font-family:宋体">，使用</span><span style="font-family:Calibri">LVM</span><span style="font-family:宋体">：</span></p> 
<p>#pvcreate  /dev/sdb //<span style="font-family:宋体">创建物理卷</span></p> 
<p>#vgcreate  mail_vg0  /dev/sdb //<span style="font-family:宋体">创建卷组</span><span style="font-family:Calibri">mail_vg0</span></p> 
<p>#lvcreate  -L  2000G  -n  mail_lv0  /dev/mail_vg0/mail_lv0 /*<span style="font-family:宋体">在卷组</span><span style="font-family:Calibri">mail_vg0</span><span style="font-family:宋体">上</span> 取<span style="font-family:Calibri">2000G</span><span style="font-family:宋体">创建逻辑卷</span><span style="font-family:Calibri">/dev/mail_vg0/mail_lv */</span></p> 
<p>#mkfs.ext3  /dev/mail_vg0/mail_lv0 //<span style="font-family:宋体">格式化</span></p> 
<p>#vi  /erc/fstab //<span style="font-family:宋体">开机自动挂载</span></p> 
<p> </p> 
<p>假设随着公司人员增多，<span style="font-family:Calibri">mail</span><span style="font-family:宋体">空间不够用，需要扩容，添加硬盘</span><span style="font-family:Calibri">sdc</span><span style="font-family:宋体">、</span><span style="font-family:Calibri">sdd</span></p> 
<p>#pvcreate  /dev/sdc  /dev/sdd</p> 
<p>#vgextend  /dev/mail_vg0  /dev/sdc  /dev/sdd //<span style="font-family:宋体">向卷组中添加新的物理卷</span></p> 
<p>#lvextend  -L  +2T  /dev/mail_vg0/mail_lv0 //<span style="font-family:宋体">对逻辑卷</span><span style="font-family:Calibri">mail_lv0</span><span style="font-family:宋体">扩容</span><span style="font-family:Calibri">2T</span></p> 
<p> </p> 
<br>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/7737df10f7bb969ccd55015aad0373d9/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">【图像处理】图像频域基础</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/b818a012fcfd193a96a8fc4f3fb919ca/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">iOS 蓝牙使用小结 bluetooth</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 追风少年的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>