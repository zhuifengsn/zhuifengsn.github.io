<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>iOS淘宝授权登录及跳转淘宝页面 - 追风少年的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="iOS淘宝授权登录及跳转淘宝页面" />
<meta property="og:description" content="作者公司是做淘客的，本文会介绍淘宝授权登录的介入流程，淘客返现等逻辑想要了解的可以看作者的其他文章，或者是私聊作者，qq号见个人资料。
1.注册APP 淘宝授权登录的SDK是阿里百川的不是淘宝的，有些开发者初次了解的时候可能有误解。阿里百川开放平台需要一个淘宝账号去登录，地址：https://baichuan.taobao.com。
淘宝授权登录及淘宝其他相关电商功能（领券、返现）都在电商服务里面，去电商服务里面注册APP信息。
2.集成SDK 用cocoapods集成SDK
#source ‘http://repo.baichuan-ios.taobao.com/baichuanSDK/AliBCSpecs.git’
pod ‘AlibcTradeSDK’
导入这个SDK的时候先切换一下源，不然会出现找不到SDK的情况。
3.初始化SDK 导入头文件
#import &lt;AlibabaAuthSDK/albbsdk.h&gt;
#import &lt;ShareSDK/ShareSDK.h&gt;
// 百川平台基础SDK初始化，加载并初始化各个业务能力插件 [[AlibcTradeSDK sharedInstance] asyncInitWithSuccess:^{ } failure:^(NSError *error) { //NSLog(@&#34;Init failed: %@&#34;, error.description); }]; // 开发阶段打开日志开关，方便排查错误信息 //默认调试模式打开日志,release关闭,可以不调用下面的函数 [[AlibcTradeSDK sharedInstance] setDebugLogOpen:NO]; // 配置全局的淘客参数 //如果没有阿里妈妈的淘客账号,setTaokeParams函数需要调用 AlibcTradeTaokeParams *taokeParams = [[AlibcTradeTaokeParams alloc] init]; taokeParams.pid = kBaiChuanPID; //mm_XXXXX为你自己申请的阿里妈妈淘客pid [[AlibcTradeSDK sharedInstance] setTaokeParams:taokeParams]; //设置全局的app标识，在电商模块里等同于isv_code //没有申请过isv_code的接入方,默认不需要调用该函数 //[[AlibcTradeSDK sharedInstance] setISVCode:@&#34;your_isv_code&#34;]; // 设置全局配置，是否强制使用h5，若设置成yes，则跳转淘宝页面会用h5打开。 [[AlibcTradeSDK sharedInstance] setIsForceH5:NO]; 4.设置 URL Schemes URL Scheme为tbopen{AppKey},如tbopen123456
5.添加安全图片 注意文件名不能修改，不然会导致找不到文件" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://zhuifengsn.github.io/posts/2eb140228fc91b4914b6fde2b3b9b92b/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2019-08-13T17:25:19+08:00" />
<meta property="article:modified_time" content="2019-08-13T17:25:19+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="追风少年的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">追风少年的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">iOS淘宝授权登录及跳转淘宝页面</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>作者公司是做淘客的，本文会介绍淘宝授权登录的介入流程，淘客返现等逻辑想要了解的可以看作者的其他文章，或者是私聊作者，qq号见个人资料。</p> 
<h3><a id="1APP_2"></a>1.注册APP</h3> 
<p>淘宝授权登录的SDK是阿里百川的不是淘宝的，有些开发者初次了解的时候可能有误解。阿里百川开放平台需要一个淘宝账号去登录，地址：<a href="https://baichuan.taobao.com" rel="nofollow">https://baichuan.taobao.com</a>。<br> 淘宝授权登录及淘宝其他相关电商功能（领券、返现）都在电商服务里面，去电商服务里面注册APP信息。</p> 
<h3><a id="2SDK_7"></a>2.集成SDK</h3> 
<p>用cocoapods集成SDK</p> 
<p>#source ‘<a href="http://repo.baichuan-ios.taobao.com/baichuanSDK/AliBCSpecs.git" rel="nofollow">http://repo.baichuan-ios.taobao.com/baichuanSDK/AliBCSpecs.git</a>’<br> pod ‘AlibcTradeSDK’<br> 导入这个SDK的时候先切换一下源，不然会出现找不到SDK的情况。</p> 
<h3><a id="3SDK_16"></a>3.初始化SDK</h3> 
<p>导入头文件<br> #import &lt;AlibabaAuthSDK/albbsdk.h&gt;<br> #import &lt;ShareSDK/ShareSDK.h&gt;</p> 
<pre><code>// 百川平台基础SDK初始化，加载并初始化各个业务能力插件

[[AlibcTradeSDK sharedInstance] asyncInitWithSuccess:^{

} failure:^(NSError *error) {
    //NSLog(@"Init failed: %@", error.description);
}];

// 开发阶段打开日志开关，方便排查错误信息
//默认调试模式打开日志,release关闭,可以不调用下面的函数
[[AlibcTradeSDK sharedInstance] setDebugLogOpen:NO];

// 配置全局的淘客参数
//如果没有阿里妈妈的淘客账号,setTaokeParams函数需要调用
AlibcTradeTaokeParams *taokeParams = [[AlibcTradeTaokeParams alloc] init];
taokeParams.pid = kBaiChuanPID; //mm_XXXXX为你自己申请的阿里妈妈淘客pid
[[AlibcTradeSDK sharedInstance] setTaokeParams:taokeParams];

//设置全局的app标识，在电商模块里等同于isv_code
//没有申请过isv_code的接入方,默认不需要调用该函数
//[[AlibcTradeSDK sharedInstance] setISVCode:@"your_isv_code"];

// 设置全局配置，是否强制使用h5，若设置成yes，则跳转淘宝页面会用h5打开。
[[AlibcTradeSDK sharedInstance] setIsForceH5:NO];
</code></pre> 
<h3><a id="4_URL_Schemes_47"></a>4.设置 URL Schemes</h3> 
<p>URL Scheme为tbopen{AppKey},如tbopen123456<br> <img src="https://images2.imgbox.com/6b/93/c878SbiB_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="5_52"></a>5.添加安全图片</h3> 
<p><img src="https://images2.imgbox.com/95/1c/36L3WHMA_o.png" alt="在这里插入图片描述"><br> 注意文件名不能修改，不然会导致找不到文件</p> 
<h3><a id="6_55"></a>6.授权登录</h3> 
<pre><code>if(![[ALBBSession sharedInstance] isLogin]){
    [[ALBBSDK sharedInstance] auth:self successCallback:^(ALBBSession *session) {
        ALBBUser *user = [session getUser];

    } failureCallback:^(ALBBSession *session, NSError *error) {
        [self showAlert:@"授权失败" type:ENAlertType_Tost];
    }];
}else{
    ALBBSession *session=[ALBBSession sharedInstance];
    ALBBUser *user = [session getUser];
}
</code></pre> 
<p>淘宝授权的时候，先判断是是否已经授权，若已经授权了不用再打开淘宝去授权，直接获取授权信息即可。若没有授权过，则打开淘宝APP去授权。<br> 返回信息在 ALBBUser类里面，属性有 nick（昵称）、avatarUrl（头像）、openId、openSid、topAccessToken、topAuthCode。拿到这些信息，再去走自己的三方登录接口或者淘宝授权接口即可达到登录的目的。</p> 
<h3><a id="7_71"></a>7.跳转淘宝页面</h3> 
<pre><code>id&lt;AlibcTradePage&gt; page = [AlibcTradePageFactory page:url];
//打开店铺
//id&lt;AlibcTradePage&gt; page = [AlibcTradePageFactory shopPage: @”12333333”];
//淘客信息
AlibcTradeTaokeParams *taoKeParams=[[AlibcTradeTaokeParams alloc] init];
taoKeParams.pid= kBaiChuanPID; //
//打开方式
AlibcTradeShowParams* showParam = [[AlibcTradeShowParams alloc] init];
showParam.openType = AlibcOpenTypeNative;
//showParam.linkKey = @"tmall_scheme";//加上会拉起天猫，不加拉起淘宝
//showParam.linkKey = @"taobao_scheme";
[[AlibcTradeSDK sharedInstance].tradeService show:self.navigationController page:page showParams:showParam taoKeParams:taoKeParams trackParam:nil tradeProcessSuccessCallback:nil tradeProcessFailedCallback:nil];
</code></pre> 
<p>打开淘宝会有三种模式，参数是 openType，是一个枚举，选择AlibcOpenTypeNative会打开淘宝的APP。</p> 
<p>typedef NS_ENUM(NSUInteger, AlibcOpenType) {<!-- --><br> /** 智能判断 <em>/<br> AlibcOpenTypeAuto,<br> /</em>* 强制跳手淘 <em>/<br> AlibcOpenTypeNative,<br> /</em>* 强制h5展示 */<br> AlibcOpenTypeH5<br> };</p> 
<p>打开淘宝页面可以两种形式，一种是用淘宝相关页面的URL去打开，一种是用淘宝的数据id去打开。<br> linkKey来确定打开的是天猫还是淘宝，要注意的是天猫的商品在淘宝APP都是存在的。这个参数不传默认打开淘宝。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/7fa762d3ba369ac7b7a96fa5f898eb55/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">链表头结点存在的意义</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/adc8184c8df7821456d7dea29e142153/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">线段树和树状数组</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 追风少年的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>