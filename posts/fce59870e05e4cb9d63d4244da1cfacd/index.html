<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>树莓派接入阿里云IOT平台1（Python模拟数据上传） - 追风少年的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="树莓派接入阿里云IOT平台1（Python模拟数据上传）" />
<meta property="og:description" content="树莓派接入阿里云IOT平台1（Python模拟数据上传） 主要是通过Python脚本模拟两个数据（温度和相对湿度）上传到阿里云，非常简单，只要有一个树莓派 即可，不需要其他传感器，学习完本文章，下一章将搭载一些传感器进行实战，非常有趣。
云平台开发 注册阿里云账号 使用个人淘宝账号或手机号，开通阿里云账号，并通过实名认证(可以用支付宝认证)
注册产品与设备 找到物联网平台
1选择设备管理，2选择产品，3 选择快速入门
开始体验
填写产品名和设备名
设备平台选择Linux，设备连接协议选择MQTT，开发工具包这里我选择Node.js
其中三元组我们后面将在树莓派用到，SDK我们直接在树莓派上下载即可，所以这里的“下载Llinux工具包”我们不用管它。
点击完成即可，下面三个步骤我们先不管。
然后再回到产品管理界面，点击查看
点击功能定义，编辑草稿，设置自己产品的具体功能，在这里我们要收到树莓派传来的温度和相对湿度数据，所以我们得定义这两个功能，不然是接收不了的。
点击自定义功能
根据以下表格，添加温度和相对湿度两个功能
添加完后一定要点击发布
然后再回到产品管理界面，点击设备管理。
进入设备管理界面，点击设备查看
进入以下界面，点击右上角的查看，我们就可以查看三元组啦！等一下要用到
树莓派端开发 更改Python的版本 我们选用3.X以上的版本，具体2.X行不行好像官方也没说，他们是推荐使用3.X以上的版本的，这里我们在树莓派上修改一下，因为树莓派是默认使用2.X的版本的。
在终端运行以下命令
sudo update-alternatives --install /usr/bin/python python /usr/bin/python2 100 sudo update-alternatives --install /usr/bin/python python /usr/bin/python3 150 sudo update-alternatives --config python 然后我们就可以看到一个界面
可以输入0，1，2去选择Python的
我输入0，然后回车
然后在终端输入以下命令可查看python的版本
python 退出python的编译环境按下ctrl&#43;d
以python3程序来模拟设备，建立连接，上报数据。 在桌面建立一个文件夹 aliyun-iot-demo-python
通过终端进入该文件夹,然后下载安装SDK
cd cd ./Desktop/aliyun-iot-demo-python pip install paho-mqtt #下载安装SDK 在aliyun-iot-demo-python文件夹内编写一个python脚本，这是官方的一个简单示例，我们需要填入我们的三元组，内容如下：
# -*- coding: utf-8 -*- import paho." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://zhuifengsn.github.io/posts/fce59870e05e4cb9d63d4244da1cfacd/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-10-05T14:38:39+08:00" />
<meta property="article:modified_time" content="2020-10-05T14:38:39+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="追风少年的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">追风少年的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">树莓派接入阿里云IOT平台1（Python模拟数据上传）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="IOT1Python_0"></a>树莓派接入阿里云IOT平台1（Python模拟数据上传）</h2> 
<p>主要是通过Python脚本模拟两个数据（温度和相对湿度）上传到阿里云，非常简单，只要有一个树莓派 即可，不需要其他传感器，学习完本文章，下一章将搭载一些传感器进行实战，非常有趣。</p> 
<h3><a id="_2"></a>云平台开发</h3> 
<h4><a id="_3"></a>注册阿里云账号</h4> 
<p>使用个人淘宝账号或手机号，开通阿里云账号，并通过实名认证(可以用支付宝认证)</p> 
<h4><a id="_5"></a>注册产品与设备</h4> 
<p>找到物联网平台<br> <img alt="在这里插入图片描述" src="https://images2.imgbox.com/b8/26/eEfmFKhS_o.png"></p> 
<p>1选择设备管理，2选择产品，3 选择快速入门<br> <img alt="在这里插入图片描述" src="https://images2.imgbox.com/5a/12/YPy5wx5M_o.png"><br> 开始体验<br> <img alt="在这里插入图片描述" src="https://images2.imgbox.com/ad/59/2wE3rnK6_o.png"><br> 填写产品名和设备名<br> <img alt="在这里插入图片描述" src="https://images2.imgbox.com/05/b5/2Q5RwDbh_o.png"><br> 设备平台选择Linux，设备连接协议选择MQTT，开发工具包这里我选择Node.js<br> <img alt="在这里插入图片描述" src="https://images2.imgbox.com/53/6b/cYKzo9OL_o.png"></p> 
<p>其中三元组我们后面将在树莓派用到，SDK我们直接在树莓派上下载即可，所以这里的“下载Llinux工具包”我们不用管它。<br> <img alt="在这里插入图片描述" src="https://images2.imgbox.com/91/3d/VMWK1qGu_o.png"><br> 点击完成即可，下面三个步骤我们先不管。</p> 
<p><img alt="在这里插入图片描述" src="https://images2.imgbox.com/f2/4a/OCsCnJme_o.png"><br> 然后再回到产品管理界面，点击查看<br> <img alt="在这里插入图片描述" src="https://images2.imgbox.com/a1/e4/OVzds6hU_o.png"><br> 点击功能定义，编辑草稿，设置自己产品的具体功能，在这里我们要收到树莓派传来的温度和相对湿度数据，所以我们得定义这两个功能，不然是接收不了的。<br> <img alt="在这里插入图片描述" src="https://images2.imgbox.com/89/e9/MMPRnIV5_o.png"><br> 点击自定义功能<br> <img alt="在这里插入图片描述" src="https://images2.imgbox.com/cd/c0/ytYHjkiB_o.png"><br> 根据以下表格，添加温度和相对湿度两个功能<br> <img alt="在这里插入图片描述" src="https://images2.imgbox.com/b9/5c/hzkEQmlS_o.png"><br> 添加完后一定要点击发布<br> <img alt="在这里插入图片描述" src="https://images2.imgbox.com/a6/e3/A7TXzaC8_o.png"></p> 
<p>然后再回到产品管理界面，点击设备管理。<br> <img alt="在这里插入图片描述" src="https://images2.imgbox.com/f1/02/Nu9Fr4Q5_o.png"><br> 进入设备管理界面，点击设备查看<br> <img alt="在这里插入图片描述" src="https://images2.imgbox.com/cf/e2/LcPjjPmT_o.png"><br> 进入以下界面，点击右上角的查看，我们就可以查看三元组啦！等一下要用到<br> <img alt="在这里插入图片描述" src="https://images2.imgbox.com/bb/f9/xQJpvLmJ_o.png"></p> 
<h3><a id="_41"></a>树莓派端开发</h3> 
<h4><a id="Python_42"></a>更改Python的版本</h4> 
<p>我们选用3.X以上的版本，具体2.X行不行好像官方也没说，他们是推荐使用3.X以上的版本的，这里我们在树莓派上修改一下，因为树莓派是默认使用2.X的版本的。<br> 在终端运行以下命令</p> 
<pre><code>sudo update-alternatives --install /usr/bin/python python /usr/bin/python2 100
sudo update-alternatives --install /usr/bin/python python /usr/bin/python3 150
sudo update-alternatives --config python
</code></pre> 
<p>然后我们就可以看到一个界面<br> 可以输入0，1，2去选择Python的<br> 我输入0，然后回车<br> <img alt="在这里插入图片描述" src="https://images2.imgbox.com/71/f6/ll6khc15_o.png"><br> 然后在终端输入以下命令可查看python的版本</p> 
<pre><code>python 
</code></pre> 
<p>退出python的编译环境按下ctrl+d</p> 
<h4><a id="python3_59"></a>以python3程序来模拟设备，建立连接，上报数据。</h4> 
<p>在桌面建立一个文件夹 aliyun-iot-demo-python<br> 通过终端进入该文件夹,然后下载安装SDK</p> 
<pre><code>cd
cd  ./Desktop/aliyun-iot-demo-python
pip install paho-mqtt         #下载安装SDK
</code></pre> 
<p>在aliyun-iot-demo-python文件夹内编写一个python脚本，这是官方的一个简单示例，我们需要填入我们的三元组，内容如下：</p> 
<pre><code># -*- coding: utf-8 -*-
import paho.mqtt.client as mqtt
import time
import hashlib
import hmac
import random
import json
#这个就是我们在阿里云注册产品和设备时的三元组啦
#把我们自己对应的三元组填进去即可
options = {
    'productKey':'你的productKey',
    'deviceName':'你的deviceName',
    'deviceSecret':'你的deviceSecret',
    'regionId':'cn-shanghai'
}

HOST = options['productKey'] + '.iot-as-mqtt.'+options['regionId']+'.aliyuncs.com'
PORT = 1883 
PUB_TOPIC = "/sys/" + options['productKey'] + "/" + options['deviceName'] + "/thing/event/property/post";


# The callback for when the client receives a CONNACK response from the server.
def on_connect(client, userdata, flags, rc):
    print("Connected with result code "+str(rc))
    # client.subscribe("the/topic")

# The callback for when a PUBLISH message is received from the server.
def on_message(client, userdata, msg):
    print(msg.topic+" "+str(msg.payload))

def hmacsha1(key, msg):
    return hmac.new(key.encode(), msg.encode(), hashlib.sha1).hexdigest()

def getAliyunIoTClient():
	timestamp = str(int(time.time()))
	CLIENT_ID = "paho.py|securemode=3,signmethod=hmacsha1,timestamp="+timestamp+"|"
	CONTENT_STR_FORMAT = "clientIdpaho.pydeviceName"+options['deviceName']+"productKey"+options['productKey']+"timestamp"+timestamp
	# set username/password.
	USER_NAME = options['deviceName']+"&amp;"+options['productKey']
	PWD = hmacsha1(options['deviceSecret'],CONTENT_STR_FORMAT)
	client = mqtt.Client(client_id=CLIENT_ID, clean_session=False)
	client.username_pw_set(USER_NAME, PWD)
	return client


if __name__ == '__main__':

	client = getAliyunIoTClient()
	client.on_connect = on_connect
	client.on_message = on_message
	
	client.connect(HOST, 1883, 300)
    
	payload_json = {
		'id': int(time.time()),
		'params': {
			'temperature': random.randint(20, 30),#随机温度
            'humidity': random.randint(40, 50)#随机相对湿度
		},
	    'method': "thing.event.property.post"
	}
	print('send data to iot server: ' + str(payload_json))

	client.publish(PUB_TOPIC,payload=str(payload_json),qos=1)
	client.loop_forever()
</code></pre> 
<p>修改完毕保存，我们运行该文件，若无错，去阿里云平台查看，是否有接收到数据。</p> 
<h3><a id="_136"></a>效果</h3> 
<p>去到设备管理界面，若看到设备成功在线，那么说明树莓派连接阿里云成功<br> <img alt="在这里插入图片描述" src="https://images2.imgbox.com/96/ae/GBc3XXeL_o.png"><br> 点击查看，再点击物理模型数据<br> <img alt="在这里插入图片描述" src="https://images2.imgbox.com/70/64/uZ4CPf8v_o.png"><br> 然后你就可以看到湿度和温度数据啦，还可以实时刷新数据喔<br> <img alt="在这里插入图片描述" src="https://images2.imgbox.com/8a/dc/QarRotBk_o.png">树莓派接入阿里云的基础篇到此结束啦，有问题的小伙伴下方留言，后面 会持续更新，接入一些传感器进行使用，想了解的小伙伴就关注我吧！</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/199f53f940ebe7f233b9f3a085a61a1f/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">SpringBoot(36) —— Shiro快速开始</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/4caf7d4ab957337ec1bad8f61009e285/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">NFS的安装和启动</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 追风少年的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>