<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>【操作系统】互斥：软件解决方法 - 追风少年的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="【操作系统】互斥：软件解决方法" />
<meta property="og:description" content="互斥：软件解决方法 算法一 算法思路 预留一个全局内存区域，并标记为turn。进程（P0或P1）想进入它的临界区执行时，要先检查turn的内容。若turn的值等于进程号，则该进程可以进入它的临界区；否则该进程被强制等待。等待进程重复地读取turn的值。直到被允许进入临界区。这一过程称为忙等待（busy waiting） 或 自旋等待（spin waiting），进程在获得临界区的访问权并完成访问后，必须为另一个进程更新turn的值。
P0 :
while(turn != 0) {/* busy waiting */} /* critical section */ turn = 1; P1 :
while(turn != 1) {/* busy waiting */} /* critical section */ turn = 0; 缺陷 进程必须严格交替（P0临界区执行完后才会更新turn值，使得P1跳出忙等待状态，同理P0也需等待P1临界区执行完）使用它们的临界区，因此执行的步调由两个进程较慢的进程决定。
例如：若P0在1小时内仅使用临界区1次，而P1要以1000次/小时的速率使用临界区，则P1就必须适应P0的节奏。 BUG 若一个进程终止，则另一个进程就会被永久阻塞。无论进程是在临界区内终止还是在临界区之外终止，都会发生这种情况。
例如：P0在执行到第二行代码（临界区内）时终止，此时turn值为0且此后不会被更新，因此P1将永久处于忙等待状态；P0在执行到第三行代码（临界区外）时终止，此时turn值为1，于是P1进入临界区，执行完后便将turn值置为0，而P0进程因为终止便不会再更新turn值，因此P1将永久处于忙等待状态。 算法二 算法一仅由一个共享的仲裁变量去实现进程间的互斥，因此进程之间必须严格交替执行，进程之间的依赖关系过强
算法二为每一个进程都配备了专门的”钥匙“，这里定义一个bool数组flag，flag[0]与P0关联，flag[1]与P1关联，每个进程可检查但不能改变另一个进程的flag值
算法思路 一个进程要进入临界区时，它会周期性地检查另一个进程的flag，直到其值为false，这表明另一个进程不在临界区内。检查进程立即设置自己的flag为true，进入自己的临界区。离开临界区时，将自己的flag设置为false。
P0 :
while(flag[1]) {/* busy waiting */} flag[0] = true; /* critical section */ flag[0] = false; P1 :" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://zhuifengsn.github.io/posts/36d73d130c346ca368b1021f132eb404/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-03-23T21:26:12+08:00" />
<meta property="article:modified_time" content="2021-03-23T21:26:12+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="追风少年的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">追风少年的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">【操作系统】互斥：软件解决方法</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h3><a id="_1"></a>互斥：软件解决方法</h3> 
<h4><a id="_3"></a>算法一</h4> 
<h5><a id="_5"></a>算法思路</h5> 
<p>预留一个全局内存区域，并标记为<code>turn</code>。进程（<code>P0</code>或<code>P1</code>）想进入它的临界区执行时，要先检查<code>turn</code>的内容。若<code>turn</code>的值等于进程号，则该进程可以进入它的临界区；否则该进程被强制等待。等待进程重复地读取<code>turn</code>的值。直到被允许进入临界区。这一过程称为<strong>忙等待（busy waiting）</strong> 或 <strong>自旋等待（spin waiting）</strong>，进程在获得临界区的访问权并完成访问后，必须为另一个进程更新<code>turn</code>的值。</p> 
<p><code>P0</code> :</p> 
<pre><code class="prism language-cpp"><span class="token keyword">while</span><span class="token punctuation">(</span>turn <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><span class="token comment">/* busy waiting */</span><span class="token punctuation">}</span>
<span class="token comment">/* critical section */</span>
turn <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
</code></pre> 
<p><code>P1</code> :</p> 
<pre><code class="prism language-cpp"><span class="token keyword">while</span><span class="token punctuation">(</span>turn <span class="token operator">!=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><span class="token comment">/* busy waiting */</span><span class="token punctuation">}</span>
<span class="token comment">/* critical section */</span>
turn <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
</code></pre> 
<h5><a id="_25"></a>缺陷</h5> 
<ol><li>进程必须<strong>严格交替</strong>（<code>P0</code>临界区执行完后才会更新<code>turn</code>值，使得<code>P1</code>跳出忙等待状态，同理<code>P0</code>也需等待<code>P1</code>临界区执行完）使用它们的临界区，因此执行的步调由两个进程较慢的进程决定。<br> 例如：若<code>P0</code>在1小时内仅使用临界区1次，而<code>P1</code>要以1000次/小时的速率使用临界区，则<code>P1</code>就必须适应<code>P0</code>的节奏。</li></ol> 
<h5><a id="BUG_30"></a>BUG</h5> 
<ol><li>若一个进程终止，则另一个进程就会被永久阻塞。无论进程是在临界区内终止还是在临界区之外终止，都会发生这种情况。<br> 例如：<code>P0</code>在执行到第二行代码（临界区内）时终止，此时<code>turn</code>值为<code>0</code>且此后不会被更新，因此<code>P1</code>将永久处于忙等待状态；<code>P0</code>在执行到第三行代码（临界区外）时终止，此时<code>turn</code>值为<code>1</code>，于是<code>P1</code>进入临界区，执行完后便将<code>turn</code>值置为<code>0</code>，而<code>P0</code>进程因为终止便不会再更新<code>turn</code>值，因此<code>P1</code>将永久处于忙等待状态。</li></ol> 
<h4><a id="_35"></a>算法二</h4> 
<p><strong>算法一</strong>仅由一个共享的仲裁变量去实现进程间的互斥，因此进程之间必须严格交替执行，进程之间的依赖关系过强</p> 
<p><strong>算法二</strong>为每一个进程都配备了专门的”钥匙“，这里定义一个<code>bool</code>数组<code>flag</code>，<code>flag[0]</code>与<code>P0</code>关联，<code>flag[1]</code>与<code>P1</code>关联，每个进程可检查但不能改变另一个进程的<code>flag</code>值</p> 
<h5><a id="_41"></a>算法思路</h5> 
<p>一个进程要进入临界区时，它会周期性地检查另一个进程的<code>flag</code>，直到其值为<code>false</code>，这表明另一个进程不在临界区内。检查进程立即设置自己的<code>flag</code>为<code>true</code>，进入自己的临界区。离开临界区时，将自己的<code>flag</code>设置为<code>false</code>。</p> 
<p><code>P0</code> :</p> 
<pre><code class="prism language-c"><span class="token keyword">while</span><span class="token punctuation">(</span>flag<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><span class="token comment">/* busy waiting */</span><span class="token punctuation">}</span>
flag<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> true<span class="token punctuation">;</span>
<span class="token comment">/* critical section */</span>
flag<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> false<span class="token punctuation">;</span>
</code></pre> 
<p><code>P1</code> :</p> 
<pre><code class="prism language-c"><span class="token keyword">while</span><span class="token punctuation">(</span>flag<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><span class="token comment">/* busy waiting */</span><span class="token punctuation">}</span>
flag<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> true<span class="token punctuation">;</span>
<span class="token comment">/* critical section */</span>
flag<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> false<span class="token punctuation">;</span>
</code></pre> 
<h5><a id="_63"></a>进步</h5> 
<ol><li>若一个进程在临界区外终止，包括设置<code>flag</code>代码时，则另一个进程不会被阻塞。<br> 例如：当<code>P1</code>在执行完第4行代码后终止，此后<code>flag[1]</code>将一直保持<code>false</code>，因此<code>P0</code>将永远不会进入忙等待状态即说明其不会被阻塞</li></ol> 
<h5><a id="BUG_68"></a>BUG</h5> 
<ol><li>若一个进程在临界区内，或在进入临界区之前已将<code>flag</code>设置为<code>true</code>时终止，则另一个进程就会永久阻塞</li><li><strong>没有保证互斥！！</strong><br> 例如：<code>P1</code>执行完第4行代码后，于是<code>P0</code>跳出忙等待状态，但<code>P0</code>还未来得及执行第二行代码（将<code>flag[0]</code>设置为<code>true</code>）<code>P1</code>便又进入了临界区，随后<code>P0</code>也进入临界区，便产生了访问冲突</li></ol> 
<p>下面采用Java多线程编程模拟<strong>算法二</strong>并验证<strong>BUG-2</strong></p> 
<pre><code class="prism language-java"><span class="token keyword">package</span> TEST<span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Multithreading</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        Process p0 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Process</span><span class="token punctuation">(</span><span class="token string">"P0"</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        Process p1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Process</span><span class="token punctuation">(</span><span class="token string">"P1"</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        p0<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        p1<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">Process</span> <span class="token keyword">extends</span> <span class="token class-name">Thread</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">int</span> var<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> var_right<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">boolean</span><span class="token punctuation">[</span><span class="token punctuation">]</span> flag <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">boolean</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> String name<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> cnt_test <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> No<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> No_other<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token function">Process</span><span class="token punctuation">(</span>String name<span class="token punctuation">,</span> <span class="token keyword">int</span> No<span class="token punctuation">,</span> <span class="token keyword">int</span> var_right<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>No <span class="token operator">=</span> No<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>var_right <span class="token operator">=</span> var_right<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>No_other <span class="token operator">=</span> <span class="token punctuation">(</span>No <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">2</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> cnt_test<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">while</span><span class="token punctuation">(</span>flag<span class="token punctuation">[</span>No_other<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> <span class="token comment">/* busy waiting */</span> <span class="token punctuation">}</span>
            flag<span class="token punctuation">[</span>No<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            <span class="token comment">/*--- critical section begin---*/</span>
            var <span class="token operator">=</span> var_right<span class="token punctuation">;</span>
            System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">+</span> <span class="token string">":"</span> <span class="token operator">+</span> <span class="token punctuation">(</span>var <span class="token operator">==</span> var_right<span class="token operator">?</span> var <span class="token operator">:</span> <span class="token string">"##"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">/*--- critical section end---*/</span>
            flag<span class="token punctuation">[</span>No<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>两个线程任务是，将公共变量<code>var</code>赋值为本线程对应正确的值<code>var_right</code>，并输出当前<code>var</code>的值，若两个线程保证互斥则<code>var</code>总是等于<code>var_right</code>（<em>Condition ‘var == var_right’ is always ‘true’</em>）即不会输出<code>##</code></p> 
<p>运行结果如下：</p> 
<pre><code>P0:0
P1:##
P0:0
P1:1
P0:0
P1:##
P0:0
P1:##
P0:0
P0:0
P0:0
P1:##
P1:##
P0:0
P1:1
P1:1
P0:##
P1:1
P1:1
P1:1
P0:##
P0:##
P1:1
P0:0
P1:1
P1:##
P0:0
P1:##
P0:0
P1:1
P1:##
P0:0
P1:1
P0:##
P1:1
P0:##
P1:1
P1:##
P0:0
P0:0
P1:##
P0:0
P1:1
P1:##
P0:0
P0:0
P1:##
P0:0
P1:1
P1:##
P0:0
P1:##
P0:0
P1:1
P1:##
P0:0
P1:##
P0:0
P1:1
P0:0
P1:1
P1:##
P0:0
P0:0
P0:0
P0:0
P0:0
P0:0
P0:0
P0:0
P0:0
P0:0
P0:0
P0:0
P1:1
P0:0
P1:1
P0:0
P0:0
P1:1
P1:1
P1:1
P0:0
P1:##
P1:1
P1:1
P1:1
P1:1
P1:1
P1:1
P1:1
P1:1
P1:1
P1:1
P1:1
P1:1
P1:1
P1:1
P1:##
P0:0
P1:1
P1:##
P0:0
P1:1
P1:##
P0:0
P1:1
P1:##
P0:0
P1:1
P1:1
P1:##
P0:0
P1:1
P1:1
P0:0
P1:##
P1:1
P1:1
P1:1
P1:1
P1:1
P1:1
P1:1
P1:1
P1:1
P1:1
P1:1
P1:1
P1:1
P1:1
P1:1
P1:##
P0:0
P0:0
P0:0
P0:0
P0:0
P0:0
P0:0
P0:0
P0:0
P0:0
P0:0
P0:0
P0:0
P0:0
P0:0
P0:0
P0:0
P0:0
P0:0
P0:0
P0:0
P0:0
P0:0
P0:0
P0:0
P0:0
P1:1
P0:##
P1:1
P1:1
P1:1
P1:1
P1:1
P1:1
P1:1
P1:1
P1:1
P1:1
P1:1
P1:##
P0:0
P1:1
P1:##
P0:0
P1:1
P1:1
P0:0
P0:0
P0:0
P0:0
P0:0
P0:0
P0:0
P0:0
P0:0
P0:0
P0:0
P0:0
P0:0
P0:0
P0:0
P0:0
P0:0
P0:0
P0:0
P0:0
P0:0

Process finished with exit code 0
</code></pre> 
<p>可见采用<strong>算法二</strong>两个线程之间发生了不少次的访问冲突（输出<code>##</code>）</p> 
<h4><a id="_329"></a>算法三</h4> 
<p><strong>算法二</strong>由于执行速率不匹配的原因，导致两个进程同时处在临界区的位置，所以算法二的方案失败</p> 
<p><strong>算法三</strong>通过简单地交换两条语句来解决这一问题</p> 
<h5><a id="_335"></a>算法思路</h5> 
<p>将控制其他进程持续忙等待的语句提到了检查<code>flag</code>值之前，确保了同一时刻只有一个进程进入临界区</p> 
<p><code>P0</code> :</p> 
<pre><code class="prism language-cpp">flag<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token keyword">while</span><span class="token punctuation">(</span>flag<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><span class="token comment">/* busy waiting */</span><span class="token punctuation">}</span>
<span class="token comment">/* critical section */</span>
flag<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
</code></pre> 
<p><code>P1</code> :</p> 
<pre><code class="prism language-cpp">flag<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token keyword">while</span><span class="token punctuation">(</span>flag<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><span class="token comment">/* busy waiting */</span><span class="token punctuation">}</span>
<span class="token comment">/* critical section */</span>
flag<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
</code></pre> 
<h5><a id="_357"></a>进步</h5> 
<ol><li>解决<strong>算法二</strong>造成的访问冲突问题，确保了互斥性</li></ol> 
<h5><a id="BUG_361"></a>BUG</h5> 
<ol><li>与<strong>算法二</strong>一样，某一进程在临界区内或在设置<code>flag</code>为<code>true</code>时终止，会引起其他进程永久阻塞</li><li>若每个进程在执行<code>while</code>语句前都将<code>flag</code>设置为<code>true</code>，则每个进程都会认为另一个进程已经进入临界区，进而引发<strong>死锁</strong><br> 例如：<code>P0</code>执行完第一行代码后还未来得及执行<code>while</code>语句，<code>P1</code>也执行完了第一行代码，此时<code>flag[0]</code>与<code>flag[1]</code>的值都为<code>true</code>，因此两个进程都无法跳出忙等待的状态，从而造成死锁</li></ol> 
<p>下面采用Java多线程编程模拟<strong>算法三</strong>并验证<strong>BUG-2</strong></p> 
<pre><code class="prism language-java"><span class="token keyword">package</span> TEST<span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Multithreading</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        Process p0 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Process</span><span class="token punctuation">(</span><span class="token string">"P0"</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        Process p1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Process</span><span class="token punctuation">(</span><span class="token string">"P1"</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        p0<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        p1<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">Process</span> <span class="token keyword">extends</span> <span class="token class-name">Thread</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">int</span> cnt_busy_wait <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">int</span> var<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> var_right<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">boolean</span><span class="token punctuation">[</span><span class="token punctuation">]</span> flag <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">boolean</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> String name<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> cnt_test <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> No<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> No_other<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token function">Process</span><span class="token punctuation">(</span>String name<span class="token punctuation">,</span> <span class="token keyword">int</span> No<span class="token punctuation">,</span> <span class="token keyword">int</span> var_right<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>No <span class="token operator">=</span> No<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>var_right <span class="token operator">=</span> var_right<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>No_other <span class="token operator">=</span> <span class="token punctuation">(</span>No <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">2</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> cnt_test<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            flag<span class="token punctuation">[</span>No<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            <span class="token keyword">while</span><span class="token punctuation">(</span>flag<span class="token punctuation">[</span>No_other<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token comment">/* busy waiting */</span>
                System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">+</span> <span class="token string">" BusyWaiting: "</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token operator">++</span>cnt_busy_wait<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span>cnt_busy_wait <span class="token operator">&gt;</span> <span class="token number">999</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token comment">/*--- critical section begin---*/</span>
            var <span class="token operator">=</span> var_right<span class="token punctuation">;</span>
            System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">+</span> <span class="token string">":"</span> <span class="token operator">+</span> <span class="token punctuation">(</span>var <span class="token operator">==</span> var_right<span class="token operator">?</span> var <span class="token operator">:</span> <span class="token string">"##"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">/*--- critical section end---*/</span>
            flag<span class="token punctuation">[</span>No<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>运行结果如下：</p> 
<pre><code>P0:0
P1 BusyWaiting: 1
P1 BusyWaiting: 3
P1 BusyWaiting: 4
P1 BusyWaiting: 5
P0 BusyWaiting: 2
P0 BusyWaiting: 7
P0 BusyWaiting: 8
P0 BusyWaiting: 9
P0 BusyWaiting: 10
P1 BusyWaiting: 6
P1 BusyWaiting: 12
P1 BusyWaiting: 13
P0 BusyWaiting: 11

 ... ...

P1 BusyWaiting: 995
P1 BusyWaiting: 996
P1 BusyWaiting: 997
P1 BusyWaiting: 998
P1 BusyWaiting: 999
P1 BusyWaiting: 1000
P0 BusyWaiting: 967

Process finished with exit code 0
</code></pre> 
<p>可见结果只被正确输出了一次，此后两线程皆处在忙等待状态，形成死锁</p> 
<h4><a id="_449"></a>算法四</h4> 
<p><strong>算法三</strong>中，一个进程在设置其状态时是不知道另一个进程的状态的。由于每一个进程坚持要进入临界区，导致死锁发生</p> 
<p><strong>算法四</strong>在算法三的基础上引入**“谦让”**的机制，在忙等待中随时重设<code>flag</code>，一定程度上避免了死锁发生</p> 
<h5><a id="_455"></a>算法思路</h5> 
<p>当出现死锁情况时（两者都进入忙等待状态），<code>P0</code>进程将<code>flag[0]</code>置为<code>false</code>并在该状态延迟1秒，<code>P1</code>便可在这1秒之内跳出忙等待状态，从而避免了死锁的情况</p> 
<p><code>P0</code> :</p> 
<pre><code class="prism language-cpp">flag<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token keyword">while</span><span class="token punctuation">(</span>flag<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    flag<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token function">delay</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// dalay 1 sec</span>
    flag<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">/* critical section */</span>
flag<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
</code></pre> 
<p><code>P1</code> :</p> 
<pre><code class="prism language-cpp">flag<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token keyword">while</span><span class="token punctuation">(</span>flag<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    flag<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token function">delay</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// dalay 1 sec</span>
    flag<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">/* critical section */</span>
flag<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
</code></pre> 
<h5><a id="_487"></a>进步</h5> 
<ol><li>一定程度的避免了死锁的出现</li></ol> 
<h5><a id="_491"></a>缺陷</h5> 
<ol><li>当两个进程自上而下的语句几乎同时被执行时，则两者都不会进入临界区。严格来说，这不是死锁，因为两个进程执行速率的相对变化会打破这种状况，允许其中一个进程进入临界区，这种状态称为<strong>活锁（livelock）</strong>（尽管该场景不会维持很长时间，但仍然是一种有可能发生的情形）</li></ol> 
<h4><a id="Dekker__495"></a>Dekker 算法</h4> 
<p><strong>算法四</strong>可能会出现 <strong>“互相谦让”</strong> 的情况</p> 
<p><strong>Dekker算法</strong>通过<code>turn</code>变量表示哪个进程有权进入它的临界区，避免了**“互相谦让”**的情况</p> 
<h5><a id="_501"></a>算法思路</h5> 
<p>当<code>P0</code>要进入它的临界区时，将其<code>flag</code>设置为<code>true</code>，然后检查<code>P1</code>的<code>flag</code>。若为<code>false</code>，<code>P0</code>可以立即进入它的临界区；否则，<code>P0</code>要检查<code>turn</code>，若发现<code>turn</code>为<code>0</code>，则<code>P0</code>要持续周期性地检查<code>P1</code>的<code>flag</code>。而<code>P1</code>需要延期执行并将<code>flag</code>设置为<code>false</code>，让<code>P0</code>执行。<code>P0</code>完成临界区执行后，将其<code>flag</code>设置为<code>false</code>以释放临界区，并将<code>turn</code>设置为<code>1</code>，把权力转交给<code>P1</code></p> 
<pre><code class="prism language-cpp"><span class="token keyword">bool</span> flag<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> turn<span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">P0</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        flag<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span>flag<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>turn <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                flag<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
                <span class="token keyword">while</span><span class="token punctuation">(</span>turn <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> <span class="token comment">/* busy waiting */</span> <span class="token punctuation">}</span>
                flag<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token comment">/* critical section */</span>
        turn <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
        flag<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">void</span> <span class="token function">P1</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        flag<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span>flag<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>turn <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                flag<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
                <span class="token keyword">while</span> <span class="token punctuation">(</span>turn <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> <span class="token comment">/* busy waiting */</span> <span class="token punctuation">}</span>
                flag<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token comment">/* critical section */</span>
        turn <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        flag<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    flag<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    flag<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    turn <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token function">parbegin</span><span class="token punctuation">(</span>P0<span class="token punctuation">,</span> P1<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// concurrent execution</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="Peterson__556"></a>Peterson 算法</h4> 
<p><strong>Dekker 算法</strong>解决了互斥问题，但复杂的程序很难实现且其正确性也很难证明。Peterson提出了一个简单且精致的算法。和前面一样，全局数组变量<code>flag</code>表明每个互斥进程的位置，全局变量<code>turn</code>解决同时发生的冲突。</p> 
<pre><code class="prism language-cpp"><span class="token keyword">bool</span> flag<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> turn<span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">P0</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        flag<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        turn <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token keyword">while</span><span class="token punctuation">(</span>flag<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> turn <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><span class="token comment">/* busy waiting */</span><span class="token punctuation">}</span>
        <span class="token comment">/* critical section */</span>
        flag<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">void</span> <span class="token function">P1</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        flag<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        turn <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword">while</span><span class="token punctuation">(</span>flag<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> turn <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><span class="token comment">/* busy waiting */</span><span class="token punctuation">}</span>
        <span class="token comment">/* critical section */</span>
        flag<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    flag<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    flag<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token function">parbegin</span><span class="token punctuation">(</span>P0<span class="token punctuation">,</span> P1<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// concurrent execution</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<blockquote> 
 <p>最后两种正确算法相关内容（验证、说明等）待更新… …</p> 
</blockquote>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/cd5f42196064c70b6c409e57e68b21ad/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">pandas知识点总结</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/90636c1a4daa233ce316ee3a0ebc1fc4/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">matlab 如何得到矩阵的 角向和 径向分布,波函数的角度分布图和概率径向分布图.ppt...</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 追风少年的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>