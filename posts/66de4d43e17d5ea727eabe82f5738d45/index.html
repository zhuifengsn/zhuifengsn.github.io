<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>转载：玩转大模型，让CodeShell跳跃于手机终端全攻略 - 追风少年的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="转载：玩转大模型，让CodeShell跳跃于手机终端全攻略" />
<meta property="og:description" content="转载：玩转大模型，让CodeShell跳跃于手机终端全攻略 背景 最近在Medium上阅读了一篇非常引人入胜的文章-“Unleashing the Potential of LLM: CodeShell’s Journey to Bringing Quantized Models to Mobile Endpoints”，该文详细介绍了如何在智能手机上部署多语言代码大模型CodeShell，颇具趣味。但出于众所周知的原因，很多人无法访问开源的github以及模型所在的huggingface。因此，我将文章翻译成中文并转载在这里，并将模型文件和运行环境一并打包上传到百度网盘，以供大家下载使用。
模型文件和模型运行环境(百度网盘): 下载链接
提取码: 2yur
Termux: 下载链接 提取码: ivlz
介绍 不久前，我发现了备受瞩目的开源大模型项目 CodeShell。该项目提供了在个人电脑CPU环境下部署 4 bit 量化模型的解决方案。这激发了我将这一解决方案移植到移动手机端的想法。本文将详细记录这一实施过程。
1. 环境准备 1. 1 下载并安装 Termux 下载 Termux 应用并安装：Termux Releases，安装后打开Termux，进入如下页面 1.2 准备基础环境 在 Termux 中执行以下命令：
$ pkg update $ pkg upgrade $ pkg install vim openssh openssl 建议将手机和电脑连接到同一网络，以便通过 SSH 更便捷地进行操作。
$ sshd $ ifconfig # 请记录一下手机的IP地址，例如：192.168.43.1 $ id # 请记录下 Android 平台下的用户名 $ passwd # 为手机的临时用户设置密码，方便在电脑上使用 SSH # 在电脑终端中执行 $ ssh -p 8022 ANDROID_USERNAME@192." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://zhuifengsn.github.io/posts/66de4d43e17d5ea727eabe82f5738d45/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-10-28T00:21:01+08:00" />
<meta property="article:modified_time" content="2023-10-28T00:21:01+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="追风少年的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">追风少年的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">转载：玩转大模型，让CodeShell跳跃于手机终端全攻略</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h3><a id="CodeShell_0"></a>转载：玩转大模型，让CodeShell跳跃于手机终端全攻略</h3> 
<h3><a id="_2"></a>背景</h3> 
<p>最近在Medium上阅读了一篇非常引人入胜的文章-<a href="https://medium.com/@aitkfan/unleashing-the-potential-of-llm-codeshells-journey-to-bringing-quantized-models-to-mobile-d5f9c9716bdb" rel="nofollow">“Unleashing the Potential of LLM: CodeShell’s Journey to Bringing Quantized Models to Mobile Endpoints”</a>，该文详细介绍了如何在智能手机上部署多语言代码大模型<code>CodeShell</code>，颇具趣味。但出于众所周知的原因，很多人无法访问开源的github以及模型所在的huggingface。因此，我将文章翻译成中文并转载在这里，并将模型文件和运行环境一并打包上传到百度网盘，以供大家下载使用。</p> 
<p>模型文件和模型运行环境(百度网盘): <a href="https://pan.baidu.com/s/1Nn3AMojnx6JE7k6q81-6vQ?pwd=2yur" rel="nofollow">下载链接</a><br> 提取码: 2yur</p> 
<p>Termux: <a href="https://pan.baidu.com/s/1zCECfI7fpcGg41Rof_jX_Q?pwd=ivlz" rel="nofollow">下载链接</a> 提取码: ivlz</p> 
<h3><a id="_11"></a>介绍</h3> 
<p>不久前，我发现了备受瞩目的开源大模型项目 <a href="https://github.com/WisdomShell/codeshell">CodeShell</a>。该项目提供了在个人电脑CPU环境下部署 <code>4 bit</code> 量化模型的解决方案。这激发了我将这一解决方案移植到移动手机端的想法。本文将详细记录这一实施过程。</p> 
<h3><a id="1__15"></a>1. 环境准备</h3> 
<h4><a id="1_1__Termux_17"></a>1. 1 下载并安装 Termux</h4> 
<ul><li>下载 Termux 应用并安装：<a href="https://github.com/termux/termux-app/releases">Termux Releases</a>，安装后打开Termux，进入如下页面</li></ul> 
<p><img src="https://images2.imgbox.com/41/31/y6N2rNdr_o.jpg" alt="在这里插入图片描述"></p> 
<h4><a id="12__24"></a>1.2 准备基础环境</h4> 
<p>在 Termux 中执行以下命令：</p> 
<pre><code class="prism language-bash">$ pkg update
$ pkg upgrade
$ pkg <span class="token function">install</span> <span class="token function">vim</span> openssh openssl
</code></pre> 
<p>建议将手机和电脑连接到同一网络，以便通过 SSH 更便捷地进行操作。</p> 
<pre><code class="prism language-bash">$ sshd 
$ <span class="token function">ifconfig</span> <span class="token comment"># 请记录一下手机的IP地址，例如：192.168.43.1</span>
$ <span class="token function">id</span> <span class="token comment"># 请记录下 Android 平台下的用户名</span>
$ <span class="token function">passwd</span> <span class="token comment"># 为手机的临时用户设置密码，方便在电脑上使用 SSH</span>
<span class="token comment"># 在电脑终端中执行</span>
$ <span class="token function">ssh</span> <span class="token parameter variable">-p</span> <span class="token number">8022</span> ANDROID_USERNAME@192.168.43.1
</code></pre> 
<h3><a id="2__45"></a>2. 安装并编译模型运行环境</h3> 
<p>在手机上的 Termux 应用或者电脑上的 SSH 窗口中，执行以下命令以安装和编译 <a href="https://github.com/WisdomShell/llama_cpp_for_codeshell">llama_cpp_for_codeshell</a> 及其相关支持环境：</p> 
<pre><code class="prism language-bash">$ pkg <span class="token function">install</span> clang <span class="token function">wget</span> <span class="token function">git</span> cmake
$ <span class="token function">apt</span> <span class="token function">install</span> libopenblas
$ <span class="token function">apt</span> <span class="token function">install</span> ocl-icd opencl-headers opencl-clhpp clinfo
$ <span class="token builtin class-name">cd</span>
$ <span class="token function">git</span> clone https://github.com/CNugteren/CLBlast.git
$ <span class="token builtin class-name">cd</span> ./CLBlast
$ cmake <span class="token builtin class-name">.</span>
$ <span class="token function">make</span>
$ <span class="token function">cp</span> libclblast.so* <span class="token variable">$PREFIX</span>/lib
</code></pre> 
<p>下载并编译开源项目 <code>llama_cpp_for_codeshell</code></p> 
<pre><code class="prism language-bash">$ <span class="token builtin class-name">cd</span>
$ <span class="token function">git</span> clone https://github.com/WisdomShell/llama_cpp_for_codeshell.git
$ <span class="token builtin class-name">cd</span> llama_cpp_for_codeshell
$ <span class="token function">cp</span> <span class="token punctuation">..</span>/CLBlast/include/clblast.h ./
$ <span class="token function">cp</span> <span class="token punctuation">..</span>/CLBlast/libclblast.so* <span class="token variable">$PREFIX</span>/lib
$ <span class="token function">cp</span> /data/data/com.termux/files/usr/include/openblas/cblas.h <span class="token builtin class-name">.</span>
$ <span class="token function">cp</span> /data/data/com.termux/files/usr/include/openblas/openblas_config.h <span class="token builtin class-name">.</span>
</code></pre> 
<p>修改 <code>Makefile </code>文件，确保在 <code>ifdef LLAMA_CLBLAST</code> 小节中，每个 <code>pkg-config </code>前<code>shell </code>后添加环境变量设置</p> 
<pre><code class="prism language-bash">$ <span class="token function">vim</span> Makefile
</code></pre> 
<p>修改结果为：<code>PKG_CONFIG_PATH=/data/data/com.termux/files/home/CLBlast &amp;&amp; pkg-config --cflags-only-I clblast OpenCL</code></p> 
<pre><code class="prism language-bash">$ cmake <span class="token builtin class-name">.</span>
$ <span class="token function">make</span> <span class="token assign-left variable">LLAMA_CLBLAST</span><span class="token operator">=</span><span class="token number">1</span>
<span class="token comment"># 设置 Termux 权限以便访问手机存储，以便下载和传输大文件</span>
$ termux-setup-storage
</code></pre> 
<p>注：可通过置顶的百度网盘下载模型和运行环境项目</p> 
<h3><a id="3__CodeShell__90"></a>3. 下载 CodeShell 量化模型文件</h3> 
<p>下载 CodeShell 量化模型文件并将其保存到 <code>$HOME/llama_cpp_for_codeshell/models</code> 目录。</p> 
<pre><code class="prism language-bash"><span class="token function">git</span> clone https://huggingface.co/WisdomShell/CodeShell-7B-Chat-int4/resolve/main/codeshell-chat-q4_0.gguf
</code></pre> 
<p>注：可通过置顶的百度网盘下载模型和运行环境项目</p> 
<h3><a id="4__100"></a>4. 运行模型</h3> 
<p>在 Termux 中执行以下命令，在<code> .bashrc</code> 中添加以下环境变量配置：</p> 
<pre><code class="prism language-bash">$ <span class="token builtin class-name">cd</span> llama_cpp_for_codeshell
$ <span class="token function">vim</span> .bashrc
</code></pre> 
<p>添加内容为：</p> 
<pre><code class="prism language-bash"><span class="token assign-left variable">GGML_OPENCL_PLATFORM</span><span class="token operator">=</span><span class="token number">0</span>
<span class="token assign-left variable">GGML_OPENCL_DEVICE</span><span class="token operator">=</span><span class="token number">0</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">LD_LIBRARY_PATH</span><span class="token operator">=</span>/vendor/lib64:/data/data/com.termux/files/usr/lib::/vendor/lib64/egl/
</code></pre> 
<p>然后执行以下命令：</p> 
<pre><code class="prism language-bash">$ <span class="token builtin class-name">source</span> .bashrc
$ ./bin/main <span class="token parameter variable">-m</span> ./models/codeshell-chat-q4_0.gguf <span class="token parameter variable">-i</span>
</code></pre> 
<p>可以在Termux中使用CodeShell模型进行问答</p> 
<p><img src="https://images2.imgbox.com/68/5b/byiH6TYb_o.jpg" alt="在这里插入图片描述"></p> 
<p><strong>注意:</strong> 请注意，根据您的手机性能，运行速度可能有所不同。在中文输入时，您可以长按 Termux 底部并向右滑动以获得更多选项。这些步骤将指导您在 Termux 中安装和运行 CodeShell 量化模型。请确保按照指南的每个步骤进行操作，以获得最佳结果。</p> 
<p>😗* 请注意，根据您的手机性能，运行速度可能有所不同。在中文输入时，您可以长按 Termux 底部并向右滑动以获得更多选项。这些步骤将指导您在 Termux 中安装和运行 CodeShell 量化模型。请确保按照指南的每个步骤进行操作，以获得最佳结果。</p> 
<p>我使用的是一部于2020年推出的内存为8GB的Android手机。经过实际验证，<code>codeshell-chat-q4_0.gguf</code>能够正常运行，尽管推理速度较慢，但也为测试手机性能提供了有效手段。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/6d6e22683cae5084bf0b36d80cb982ea/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">C# 使用Microsoft Edge WebView2的相关总结</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/dedb1a0f7d3db47e0eb4abb29a42b7d4/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">https 的 crt 和 key 证书生成</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 追风少年的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>