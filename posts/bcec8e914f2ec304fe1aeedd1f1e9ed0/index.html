<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>网站计数器 - 追风少年的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="网站计数器" />
<meta property="og:description" content="前言 主页计数器是用来记录页面曾经被访问次数的组件。它是一个比较简单的功能，但是实现起来却有许多实际问题要考虑。例如访问次数的记录如何存放？如果服务器关机，数据记录是否会丢失？等等问题都是需要我们考虑的。 目前的计数器主要是使用ASP技术制作，方法非常简单。但是很少有使用ASP.NET技术制作的计数器，原因主要是ASP.NET技术还未正式发布，同时支持.NET的服务器还很少导致的。本文讲述了如何利用ASP.NET技术，制作主页计数器。 设计构思 计数器的核心工作就是想办法将访问的次数记录下来，并且能够方便的读出数据记录。在此应用中，拟建立四个文件，一个是webform1.aspx，主要是用于显示访问次数记录，一个counter.txt文件用于存储访问次数记录，还有global.asax和global.asax.cs，这两个文件是核心文件，主要是负责响应事件和读写文件。因此，程序必须具有打开文件，读文件，累加数值，写文件等功能。同时，还需注意：在进行数值累加时，不能象ASP中的那样写成 application(“counter”)=application(“counter”)&#43;1 因为数值类型不能和对象做数学运算。 经过以上的思考，我们基本就可以编写代码了，但是在完成编写之前，还应了解以下的相关知识。 相关知识 1. Global.asax文件 Global.asax文件也称为ASP.NET应用程序文件，它一般被放在根目录下。此文件中的代码不产生用户界面，也不相应单个页面的请求。它主要是负责处理Application_Start，Application_End，Session_Start和Session_End事件的。 2. Application对象及其事件 Application 对象来自HttpApplictionStat 类。它可以在多个请求、连接之间共享公用信息，也可以在各个请求连接之间充当信息传递的管道。此对象的生命周期起于IIS开始运行并且有人开始连接时，终止于IIS关闭或者若干时间内无人连接（默认为20分钟）。当Application 对象的生命周期开始时，Application_Start 事件会被启动，当Application对象的生命周期结束时Application_End 事件会被启动。 3. Session对象及其事件 Session对象有着与Application类似的事件：Session_Start和Session_End事件。当有一个新用户访问应用程序时，就会立刻触发Session_Start事件。当某个用户停止了访问或者程序执行了Session.Abandon方法，就会触发Session_End事件。 4. Application和Session对象比较 Session对象与Application对象有些相似，但其作用域有更大的限制。Application对象是针对所有用户都生效，而Session对象则相反，每个用户都有自己的Session对象，它的生命周期起始于服务器产生对用户请求页面的相应，终止于用户断开与服务器的连接。Application对象不会象Session对象那样当一个新用户请求就触发事件，Application对象的事件只触发一次，就是在第一个用户的第一个请求时。一个Application_End事件肯定发生在Session_End事件之后，Application_End事件只有在服务器停止工作或Application_End事件卸载时才触发。 程序部分 首先建立一个文本文件counter.txt，打开文件输入一个大于0的整数作为访问记录的初始值。 下面我们就可以正式的编写计数器的程序了。 listing 1是webform1.aspx，主要是用于显示从文件中读出的访问次数的记录。由于在整个应用程序生命周期中，Application 对象都是有效的，所以在不同的页面中都可以对它进行存取，就像使用全局变量一样方便。 在代码中，使用&lt;%=Application[&#34;counter&#34;]%&gt;来表示访问次数记录。 程序代码如下: listing1 -----webform1.aspx----- &lt;%@ Page language=&#34;c#&#34; Src=&#34;WebForm1.aspx.cs&#34; Inherits=&#34;counter1.WebForm1&#34; %&gt; &lt;!DOCTYPE HTML PUBLIC &#34;-//W3C//DTD HTML 4.0 Transitional//EN&#34; &gt; &lt;HTML&gt; &lt;HEAD&gt; &lt;meta name=&#34;GENERATOR&#34; Content=&#34;Microsoft Visual Studio 7.0&#34;&gt; &lt;meta name=&#34;CODE_LANGUAGE&#34; Content=&#34;C#&#34;&gt; &lt;/HEAD&gt; &lt;body&gt; &lt;form id=&#34;Form1&#34; method=&#34;post&#34; runat=&#34;server&#34;&gt; &lt;FONT face=&#34;宋体&#34;&gt;您是第&lt;%=Application[&#34;counter&#34;]%&gt;位访问者！&lt;/FONT&gt; &lt;/form&gt; &lt;/body&gt; &lt;/HTML&gt; Listing 2和listing3是global." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://zhuifengsn.github.io/posts/bcec8e914f2ec304fe1aeedd1f1e9ed0/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2009-04-15T22:20:00+08:00" />
<meta property="article:modified_time" content="2009-04-15T22:20:00+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="追风少年的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">追风少年的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">网站计数器</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>前言 <br>   主页计数器是用来记录页面曾经被访问次数的组件。它是一个比较简单的功能，但是实现起来却有许多实际问题要考虑。例如访问次数的记录如何存放？如果服务器关机，数据记录是否会丢失？等等问题都是需要我们考虑的。 <br>   目前的计数器主要是使用ASP技术制作，方法非常简单。但是很少有使用ASP.NET技术制作的计数器，原因主要是ASP.NET技术还未正式发布，同时支持.NET的服务器还很少导致的。本文讲述了如何利用ASP.NET技术，制作主页计数器。 <br>   <br>   设计构思 <br>   计数器的核心工作就是想办法将访问的次数记录下来，并且能够方便的读出数据记录。在此应用中，拟建立四个文件，一个是webform1.aspx，主要是用于显示访问次数记录，一个counter.txt文件用于存储访问次数记录，还有global.asax和global.asax.cs，这两个文件是核心文件，主要是负责响应事件和读写文件。因此，程序必须具有打开文件，读文件，累加数值，写文件等功能。同时，还需注意：在进行数值累加时，不能象ASP中的那样写成 <br>   application(“counter”)=application(“counter”)+1 <br>   因为数值类型不能和对象做数学运算。 <br>   经过以上的思考，我们基本就可以编写代码了，但是在完成编写之前，还应了解以下的相关知识。 <br>   <br>   相关知识 <br>   1. Global.asax文件 <br>   Global.asax文件也称为ASP.NET应用程序文件，它一般被放在根目录下。此文件中的代码不产生用户界面，也不相应单个页面的请求。它主要是负责处理Application_Start，Application_End，Session_Start和Session_End事件的。 <br>   2. Application对象及其事件 <br>   Application 对象来自HttpApplictionStat 类。它可以在多个请求、连接之间共享公用信息，也可以在各个请求连接之间充当信息传递的管道。此对象的生命周期起于IIS开始运行并且有人开始连接时，终止于IIS关闭或者若干时间内无人连接（默认为20分钟）。当Application 对象的生命周期开始时，Application_Start 事件会被启动，当Application对象的生命周期结束时Application_End 事件会被启动。 <br>   3. Session对象及其事件 <br>   Session对象有着与Application类似的事件：Session_Start和Session_End事件。当有一个新用户访问应用程序时，就会立刻触发Session_Start事件。当某个用户停止了访问或者程序执行了Session.Abandon方法，就会触发Session_End事件。 <br>   4. Application和Session对象比较 <br>   Session对象与Application对象有些相似，但其作用域有更大的限制。Application对象是针对所有用户都生效，而Session对象则相反，每个用户都有自己的Session对象，它的生命周期起始于服务器产生对用户请求页面的相应，终止于用户断开与服务器的连接。Application对象不会象Session对象那样当一个新用户请求就触发事件，Application对象的事件只触发一次，就是在第一个用户的第一个请求时。一个Application_End事件肯定发生在Session_End事件之后，Application_End事件只有在服务器停止工作或Application_End事件卸载时才触发。 <br>   <br>   程序部分 <br>   首先建立一个文本文件counter.txt，打开文件输入一个大于0的整数作为访问记录的初始值。 <br>   下面我们就可以正式的编写计数器的程序了。 <br>   listing 1是webform1.aspx，主要是用于显示从文件中读出的访问次数的记录。由于在整个应用程序生命周期中，Application 对象都是有效的，所以在不同的页面中都可以对它进行存取，就像使用全局变量一样方便。 <br>   在代码中，使用&lt;%=Application["counter"]%&gt;来表示访问次数记录。 <br>   程序代码如下: <br>   listing1 -----webform1.aspx----- <br>   &lt;%@ Page language="c#" Src="WebForm1.aspx.cs" Inherits="counter1.WebForm1" %&gt; <br>   &lt;!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" &gt; <br>   &lt;HTML&gt; <br>    &lt;HEAD&gt; <br>    &lt;meta name="GENERATOR" Content="Microsoft Visual Studio 7.0"&gt; <br>    &lt;meta name="CODE_LANGUAGE" Content="C#"&gt; <br>    &lt;/HEAD&gt; <br>    &lt;body&gt; <br>    &lt;form id="Form1" method="post" runat="server"&gt; <br>    &lt;FONT face="宋体"&gt;您是第&lt;%=Application["counter"]%&gt;位访问者！&lt;/FONT&gt; <br>    &lt;/form&gt; <br>    &lt;/body&gt; <br>   &lt;/HTML&gt; <br>   Listing 2和listing3是global.asax和global.asax.cs文件代码，当执行webform1.aspx文件之前会执行它们。在global.asax.cs文件中，定义了一些事件和其响应代码，主要是用于读写文件和数值累加。 <br>   Listing 2 -----global.asax---- <br>   &lt;%@ Application Src="Global.asax.cs" Inherits="counter2.Global" %&gt; <br>   listing 3 -----global.asax.cs----- <br>   using System; <br>   using System.Collections; <br>   using System.ComponentModel; <br>   using System.Web; <br>   using System.Web.SessionState; <br>   using System.IO ; <br>   namespace counter2 <br>   { <br>    public class Global : System.Web.HttpApplication <br>    { <br>    protected void Application_Start(Object sender, EventArgs e) <br>    { <br>    uint count=0; <br>    StreamReader srd; <br>   //取得文件的实际路径 <br>    string file_path=Server.MapPath ("counter.txt"); <br>    //打开文件进行读取 <br>    srd=File.OpenText (file_path); <br>    while(srd.Peek ()!=-1) <br>    { <br>    string str=srd.ReadLine (); <br>    count=UInt32.Parse (str); <br>    } <br>    object obj=count; <br>    Application["counter"]=obj; <br>    srd.Close (); <br>    } <br>   <br>    protected void Session_Start(Object sender, EventArgs e) <br>    { <br>    Application.Lock (); <br>    //数值累加，注意这里使用了装箱（boxing） <br>    uint jishu=0; <br>    jishu=(uint)Application["counter"]; <br>    jishu=jishu+1; <br>    object obj=jishu; <br>    Application["counter"]=obj; <br>    //将数据记录写入文件 <br>    string file_path=Server.MapPath ("counter.txt"); <br>    StreamWriter fs=new StreamWriter(file_path,false); <br>    fs.WriteLine (jishu); <br>    fs.Close (); <br>    Application.UnLock (); <br>    } <br>    protected void Application_BeginRequest(Object sender, EventArgs e) <br>    { <br>    } <br>    protected void Application_EndRequest(Object sender, EventArgs e) <br>    { <br>    } <br>    protected void Session_End(Object sender, EventArgs e) <br>    { <br>    } <br>    protected void Application_End(Object sender, EventArgs e) <br>    { <br>    //装箱 <br>    uint js=0; <br>    js=(uint)Application["counter"]; <br>    //object obj=js; <br>    //Application["counter"]=js; <br>    //将数据记录写入文件 <br>    string file_path=Server.MapPath ("counter.txt"); <br>    StreamWriter fs=new StreamWriter(file_path,false); <br>    fs.WriteLine(js); <br>    fs.Close (); <br>    } <br>    } <br>   } <br>   <br>   小结 <br>   经过以上的讨论，一个简单的主页计数器就完成了。其核心就是以文本模式进行文件读写。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/e9bacf357a114e1264acf1e0a44b8c81/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">SQL UNIQUE 约束介绍</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/5bc186a708c0d117538dc97a79c5b73a/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">【VNC】Linux环境VNC服务安装、配置与使用</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 追风少年的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>