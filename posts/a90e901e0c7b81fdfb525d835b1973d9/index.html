<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>GROUP BY 使用方法详解 - 追风少年的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="GROUP BY 使用方法详解" />
<meta property="og:description" content="概述 group by是开发中经常用到的SQL语句，从字面意思来看就是根据哪个字段或者哪几个字段对查询到的数据进行分组统计，既然是分组统计那如何分组呢？所以group by通常都是和聚合函数还有having一起使用。
一、语法 select 聚合函数(字段1)，字段2 from 表名 where 条件 group by 字段2,字段3
或者
select 聚合函数(字段1)，字段2 from 表名 where 条件 group by 字段2,字段3 having 过滤条件
使用了group by 后，要求select出的结果字段都是可汇总的，否则就会出错。
group by 有一个原则,就是 select 后面的所有列中,没有使用聚合函数的列,必须出现在 group by 后面。
二、举个例子 CREATE TABLE Sales (commodity VARCHAR(50), region VARCHAR(50), salesVolume INT); INSERT INTO Sales VALUES (N&#39;电视机&#39;, N&#39;河北省&#39;, 10000); INSERT INTO Sales VALUES (N&#39;电视机&#39;, N&#39;山东省&#39;, 20000); INSERT INTO Sales VALUES (N&#39;电视机&#39;, N&#39;山东省&#39;, 30000); INSERT INTO Sales VALUES (N&#39;冰箱&#39;, N&#39;浙江省&#39;, 15000); SELECT * FROM Sales SELECT region,SUM(salesVolume) 销量 from Sales GROUP BY region 返回结果如下：" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://zhuifengsn.github.io/posts/a90e901e0c7b81fdfb525d835b1973d9/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-09-06T17:29:37+08:00" />
<meta property="article:modified_time" content="2023-09-06T17:29:37+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="追风少年的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">追风少年的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">GROUP BY 使用方法详解</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h3><a id="_0"></a>概述</h3> 
<p>group by是开发中经常用到的SQL语句，从字面意思来看就是根据哪个字段或者哪几个字段对查询到的数据进行分组统计，既然是分组统计那如何分组呢？所以group by通常都是和聚合函数还有having一起使用。</p> 
<h3><a id="_2"></a>一、语法</h3> 
<p>select 聚合函数(字段1)，字段2 from 表名 where 条件 group by 字段2,字段3<br> 或者<br> select 聚合函数(字段1)，字段2 from 表名 where 条件 group by 字段2,字段3 having 过滤条件<br> 使用了group by 后，要求select出的结果字段都是可汇总的，否则就会出错。<br> group by 有一个原则,就是 select 后面的所有列中,没有使用聚合函数的列,必须出现在 group by 后面。</p> 
<h3><a id="_8"></a>二、举个例子</h3> 
<pre><code class="prism language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> Sales <span class="token punctuation">(</span>commodity <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">,</span> region <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">,</span> salesVolume <span class="token keyword">INT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> Sales <span class="token keyword">VALUES</span> <span class="token punctuation">(</span>N<span class="token string">'电视机'</span><span class="token punctuation">,</span> N<span class="token string">'河北省'</span><span class="token punctuation">,</span> <span class="token number">10000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> Sales <span class="token keyword">VALUES</span> <span class="token punctuation">(</span>N<span class="token string">'电视机'</span><span class="token punctuation">,</span> N<span class="token string">'山东省'</span><span class="token punctuation">,</span> <span class="token number">20000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> Sales <span class="token keyword">VALUES</span> <span class="token punctuation">(</span>N<span class="token string">'电视机'</span><span class="token punctuation">,</span> N<span class="token string">'山东省'</span><span class="token punctuation">,</span> <span class="token number">30000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> Sales <span class="token keyword">VALUES</span> <span class="token punctuation">(</span>N<span class="token string">'冰箱'</span><span class="token punctuation">,</span> N<span class="token string">'浙江省'</span><span class="token punctuation">,</span> <span class="token number">15000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> Sales
</code></pre> 
<p><img src="https://images2.imgbox.com/db/28/kYsialjH_o.png" alt=""></p> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> region<span class="token punctuation">,</span><span class="token function">SUM</span><span class="token punctuation">(</span>salesVolume<span class="token punctuation">)</span> 销量 <span class="token keyword">from</span> Sales  <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> region
</code></pre> 
<p>返回结果如下：<br> <img src="https://images2.imgbox.com/01/7c/ELqm7NOY_o.png" alt=""></p> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> region<span class="token punctuation">,</span>commodity <span class="token punctuation">,</span><span class="token function">SUM</span><span class="token punctuation">(</span>salesVolume<span class="token punctuation">)</span> 销量 <span class="token keyword">from</span> Sales  <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> region<span class="token punctuation">,</span>commodity
</code></pre> 
<p>返回结果如下：<br> <img src="https://images2.imgbox.com/52/b1/ckZVeSLm_o.png" alt=""></p> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> region<span class="token punctuation">,</span>commodity <span class="token punctuation">,</span><span class="token function">SUM</span><span class="token punctuation">(</span>salesVolume<span class="token punctuation">)</span> 销量 <span class="token keyword">from</span> Sales  <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> region
</code></pre> 
<p>这句代码则是会报错：<br> <img src="https://images2.imgbox.com/97/1f/Sv11Mq4Y_o.png" alt=""></p> 
<h3><a id="wherehaving_35"></a>三、where和having的使用</h3> 
<h4><a id="1wheregroup_by_36"></a>1、where+group by</h4> 
<p>where 限定的条件查询会在group by 分组之前执行。</p> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> region<span class="token punctuation">,</span><span class="token function">SUM</span><span class="token punctuation">(</span>salesVolume<span class="token punctuation">)</span> 销量 <span class="token keyword">from</span> Sales <span class="token keyword">WHERE</span> commodity<span class="token operator">=</span><span class="token string">'电视机'</span> <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> region
</code></pre> 
<p>返回结果如下：<br> <img src="https://images2.imgbox.com/c3/08/JNenYnA6_o.png" alt=""></p> 
<h4><a id="2group_byhaving_43"></a>2、group by+having</h4> 
<p>having限定的条件查询会在group by分组之后查询。</p> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> region<span class="token punctuation">,</span><span class="token function">SUM</span><span class="token punctuation">(</span>salesVolume<span class="token punctuation">)</span> 销量 <span class="token keyword">from</span> Sales <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> region <span class="token keyword">HAVING</span> <span class="token function">SUM</span><span class="token punctuation">(</span>salesVolume<span class="token punctuation">)</span><span class="token operator">&gt;</span><span class="token number">10000</span>
</code></pre> 
<p>返回结果如下：<br> <img src="https://images2.imgbox.com/d3/64/6bCNdhVA_o.png" alt=""></p> 
<h4><a id="3wheregroup_byhaving_50"></a>3、where+group by+having</h4> 
<p>where和having在一起使用的时候，会先执行where的限定条件查询，最后再执行having的限定条件查询。</p> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> region<span class="token punctuation">,</span><span class="token function">SUM</span><span class="token punctuation">(</span>salesVolume<span class="token punctuation">)</span> 销量 <span class="token keyword">from</span> Sales <span class="token keyword">WHERE</span> commodity<span class="token operator">=</span><span class="token string">'电视机'</span> <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> region <span class="token keyword">HAVING</span> <span class="token function">SUM</span><span class="token punctuation">(</span>salesVolume<span class="token punctuation">)</span><span class="token operator">&gt;</span><span class="token number">10000</span>
</code></pre> 
<p>返回结果如下：<br> <img src="https://images2.imgbox.com/a6/8f/pug53s8y_o.png" alt=""></p> 
<h3><a id="_57"></a>四、聚合函数</h3> 
<p>常用的聚合函数有：count() 计数, sum() 求和 , avg() 求平均值, max() 求最大值, min()求最小值。</p> 
<h4><a id="_59"></a>实例如下：</h4> 
<h5><a id="1count__60"></a>1、count( )</h5> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> region<span class="token punctuation">,</span><span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> 记录数 <span class="token keyword">FROM</span> Sales <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> region
</code></pre> 
<p>返回结果：<br> <img src="https://images2.imgbox.com/6e/a9/o7xu4jwu_o.png" alt=""></p> 
<h5><a id="2avg__66"></a>2、avg( )</h5> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> region<span class="token punctuation">,</span><span class="token function">AVG</span><span class="token punctuation">(</span>salesVolume<span class="token punctuation">)</span> 平均销量 <span class="token keyword">FROM</span> Sales <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> region 
</code></pre> 
<p>返回结果：<br> <img src="https://images2.imgbox.com/39/53/KxDI22ui_o.png" alt=""></p> 
<h5><a id="3max__72"></a>3、max( )</h5> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> region<span class="token punctuation">,</span><span class="token function">MAX</span><span class="token punctuation">(</span>salesVolume<span class="token punctuation">)</span> 销售最多 <span class="token keyword">FROM</span> Sales <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> region 
</code></pre> 
<p>返回结果：<br> <img src="https://images2.imgbox.com/fa/73/XIDfs2HV_o.png" alt=""></p> 
<h5><a id="4min__78"></a>4、min( )</h5> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> region<span class="token punctuation">,</span><span class="token function">MIN</span><span class="token punctuation">(</span>salesVolume<span class="token punctuation">)</span> 销售最少 <span class="token keyword">FROM</span> Sales <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> region 
</code></pre> 
<p>返回结果：<br> <img src="https://images2.imgbox.com/69/8e/uQrqksxr_o.png" alt=""><br> 还有一些不经常使用的：count_big()和count()相同作用但返回值的数据类型不同，count()返回 ‘int’ ,count_big()返回 ‘bigint’ ,stdev()求标准偏差，stdevp()求总体标准偏差，var()求方差，varp()求总体统计方差等等这里就不尽数了。</p> 
<h3><a id="group_by_85"></a>五、group by的其他可用参数。</h3> 
<h4><a id="1group_by_rollup__86"></a>1、group by rollup( )</h4> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> region<span class="token punctuation">,</span><span class="token function">SUM</span><span class="token punctuation">(</span>salesVolume<span class="token punctuation">)</span>销量 <span class="token keyword">FROM</span> Sales <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> ROLLUP <span class="token punctuation">(</span>region <span class="token punctuation">)</span>
</code></pre> 
<p>返回结果如下：<br> <img src="https://images2.imgbox.com/9f/44/DCvUhTE1_o.png" alt=""><br> 这里比不加 rollup()的查询结果多了一行总计。</p> 
<h4><a id="2group_by_cube__93"></a>2、group by cube( )</h4> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> region<span class="token punctuation">,</span>commodity<span class="token punctuation">,</span><span class="token function">SUM</span><span class="token punctuation">(</span>salesVolume<span class="token punctuation">)</span>销量 <span class="token keyword">FROM</span> Sales <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> CUBE <span class="token punctuation">(</span>region<span class="token punctuation">,</span>commodity <span class="token punctuation">)</span>
</code></pre> 
<p>返回结果如下：<br> <img src="https://images2.imgbox.com/fc/f9/w1PXDsuu_o.png" alt=""><br> 添加cube()后不但增加了一行总计，还增加了每一组单项统计的合计。group by cube为所有可能的列组合创建组。 对于 group by cube (a, b)，结果具有 (a, b)、(NULL, b)、(a, NULL) 和 (NULL, NULL) 唯一值的组。</p> 
<h4><a id="3group_by_grouping_sets___100"></a>3、group by grouping sets ( )</h4> 
<p>grouping sets选项可将多个 group by子句组合到一个 group by 子句中。 其结果与针对指定的组执行 union all运算等效。<br> 例如：</p> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> region<span class="token punctuation">,</span>commodity<span class="token punctuation">,</span><span class="token function">SUM</span><span class="token punctuation">(</span>salesVolume<span class="token punctuation">)</span> 销量 <span class="token keyword">FROM</span> Sales
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> GROUPING SETS <span class="token punctuation">(</span> ROLLUP <span class="token punctuation">(</span>region<span class="token punctuation">,</span>commodity<span class="token punctuation">)</span><span class="token punctuation">,</span> CUBE <span class="token punctuation">(</span>region<span class="token punctuation">,</span>commodity<span class="token punctuation">)</span> <span class="token punctuation">)</span>
</code></pre> 
<p>返回结果与两个 group by语句的联合查询相同。</p> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> region<span class="token punctuation">,</span>commodity<span class="token punctuation">,</span><span class="token function">SUM</span><span class="token punctuation">(</span>salesVolume<span class="token punctuation">)</span> 销量
<span class="token keyword">FROM</span> Sales <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> ROLLUP <span class="token punctuation">(</span>region<span class="token punctuation">,</span>commodity<span class="token punctuation">)</span>
<span class="token keyword">UNION</span> <span class="token keyword">ALL</span>
<span class="token keyword">SELECT</span> region<span class="token punctuation">,</span>commodity<span class="token punctuation">,</span><span class="token function">SUM</span><span class="token punctuation">(</span>salesVolume<span class="token punctuation">)</span> 销量 
<span class="token keyword">FROM</span> Sales <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> CUBE <span class="token punctuation">(</span>region<span class="token punctuation">,</span>commodity<span class="token punctuation">)</span>
</code></pre> 
<p>返回结果如下：<br> <img src="https://images2.imgbox.com/1b/37/CHCPx4uC_o.png" alt=""><br> SQL 不会合并为 grouping sets 列表生成的重复组。 上例中，GROUPING SETS ( ROLLUP (region,commodity), CUBE (region,commodity) )，两个元素都返回总计行并且这两行都会列在结果中。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/8ef7ae61ded8a39436893cd4fa48d37b/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Java 数组删除一个元素</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/960a78d2a6cc9bdd41f80bbb93c383ee/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Task :app:compileDebugKotlin FAILED</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 追风少年的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>