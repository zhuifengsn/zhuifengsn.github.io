<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>spring ioc解决循环依赖为什么需要用三级缓存 - 追风少年的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="spring ioc解决循环依赖为什么需要用三级缓存" />
<meta property="og:description" content="spring ioc解决循环依赖为什么需要用三级缓存 aop动态代理循环依赖的处理机制为什么需要三级缓存 aop动态代理 是因为aop，而aop的核心是动态代理，
简单理解就是我们需要横切逻辑增强的对象，
实际上是生成一个代理对象操作被增强对象，而不是被代理对象本身。
有需要的可以看下：
spring框架源码一、什么是aop
所以A依赖B，如果B被aop代理，那么实际依赖的不是B对象，而是B的代理对象，
循环依赖的处理机制 在spring ioc的循环依赖问题
我们说过循环依赖的处理机制：
A和B互相依赖，
假如先去创建A，
A实例化后先把自己放入三级缓存，目的是为了提前暴露，
然后发现依赖B，
接着创建B，B依赖A，
B会去三级缓存中找A，使用并将A放入二级缓存，
B创建完后会把自己放入一级缓存，
A使用一级缓存中的B。
为什么需要三级缓存 将A从三级缓存放入二级缓存这里，会对A进行一些特殊处理，
具体来说就是如果A被aop代理了，就需要创建代理对象放入二级缓存，
三级缓存的作用就是在这一步，
为什么不一开始就创建代理对象呢？
因为这与设计原则相悖，
spring的设计原则是在bean初始化的最后阶段创建代理对象，
三级缓存是为了在被代理的bean被引用时提前创建代理对象，
而没有被引用的bean则还是在初始化的最后阶段创建代理对象。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://zhuifengsn.github.io/posts/79f440c7538680818d29681c2ee178af/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-12-07T21:37:13+08:00" />
<meta property="article:modified_time" content="2022-12-07T21:37:13+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="追风少年的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">追风少年的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">spring ioc解决循环依赖为什么需要用三级缓存</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>spring ioc解决循环依赖为什么需要用三级缓存</h4> 
 <ul><li><a href="#aop_2" rel="nofollow">aop动态代理</a></li><li><a href="#_11" rel="nofollow">循环依赖的处理机制</a></li><li><a href="#_25" rel="nofollow">为什么需要三级缓存</a></li></ul> 
</div> 
<p></p> 
<h2><a id="aop_2"></a>aop动态代理</h2> 
<p>是因为aop，而aop的核心是动态代理，<br> 简单理解就是我们需要横切逻辑增强的对象，<br> 实际上是生成一个代理对象操作被增强对象，而不是被代理对象本身。</p> 
<p>有需要的可以看下：<br> <a href="https://blog.csdn.net/qq_35549286/article/details/127158034">spring框架源码一、什么是aop</a></p> 
<p>所以A依赖B，如果B被aop代理，那么实际依赖的不是B对象，而是B的代理对象，</p> 
<h2><a id="_11"></a>循环依赖的处理机制</h2> 
<p>在<a href="https://blog.csdn.net/qq_35549286/article/details/128171692?">spring ioc的循环依赖问题</a><br> 我们说过循环依赖的处理机制：</p> 
<p>A和B互相依赖，</p> 
<p>假如先去创建A，<br> A实例化后先把自己放入三级缓存，目的是为了提前暴露，<br> 然后发现依赖B，<br> 接着创建B，B依赖A，<br> <em><strong>B会去三级缓存中找A，使用并将A放入二级缓存，</strong></em><br> B创建完后会把自己放入一级缓存，<br> A使用一级缓存中的B。</p> 
<h2><a id="_25"></a>为什么需要三级缓存</h2> 
<p>将A从三级缓存放入二级缓存这里，会对A进行一些特殊处理，<br> 具体来说就是如果A被aop代理了，就需要创建代理对象放入二级缓存，<br> 三级缓存的作用就是在这一步，</p> 
<p>为什么不一开始就创建代理对象呢？<br> 因为这与设计原则相悖，<br> spring的设计原则是在bean初始化的最后阶段创建代理对象，<br> 三级缓存是为了在被代理的bean被引用时提前创建代理对象，<br> 而没有被引用的bean则还是在初始化的最后阶段创建代理对象。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/e9ad794e77c61a2436dcdf7b98e78304/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">CAS原理分析，解决银行转账ABA难题</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/94182f84843f9fc85e2d9addd7d2ec01/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">51单片机的温控风扇设计</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 追风少年的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>