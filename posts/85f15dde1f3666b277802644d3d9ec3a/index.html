<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>labview入门到出家11(补充)——基于单片机和labview开发的虚拟示波器 - 追风少年的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="labview入门到出家11(补充)——基于单片机和labview开发的虚拟示波器" />
<meta property="og:description" content="之前有小伙伴提到需要虚拟示波器的资料，有些库还有文件丢失了，直接给的工程跑不起来，这里我把关键的地方讲解一下，大家可以自行开发。其实开发不难，只是有些点会耗点时间。虚拟示波器，顾名思义就是非实物的示波器，但也还是硬件（便携的采集设备）和软件（在电脑上显示和操作）的结合，和数字示波器相比，本质上区别不大，现在贵一些的数字示波器从功能上看，也很像一台计算机了)。今天要讲的只是低配的，简易版的虚拟示波器（在下当年的毕业设计）。下位机是基于STM32的ADC采集实现的信号抓取，然后通过串口传到上位机中显示。单片机的ADC和串口传输，注定了这虚拟示波器采集的波形频率不会太高，之前能在上位机上还原得比较好的波形频率是25Khz以下，如果大家有其他更快的采集(DSP,FPGA，NI采集卡)和数据上传的方式(USB等)，可以尝试一下，也期待你们的分享。下面大体对硬件(外围电路)，单片机程序(STM32)，和上位机程序(labview)三部分进行讲解。
1、硬件
硬件很简单，就是将输入到单片机的波形信号进行处理。因为我用的STM32的单片机，能检测到的电压值是0~3.3V，所以硬件部分就是把输入的交流信号先控制在-1.65V~1.65V之间，最后再通过电路将信号往上偏置1.65V就可以给单片机采集了。至于如何将信号放大放小，控制到可采集的电压范围呢，可以通过上位机发送串口数据给单片机，让单片机控制继电器（或者其他开关方式）切换运放端的电阻，达到更改运放倍数的方式，最后上位机呈现波形的时候加上放大缩小的倍数，就可以在上位机界面上还原波形信号了。我这里先采用了LM358的双电源运放芯片（交流信号，需要双电源运放芯片），后面因为LM358在高频输入的时候，运放输出的信号在零点处会失真，换了一款高频的运放芯片UA741，问题解决。双电源里面的负电压是通过LCL7660输出的。至于偏置电压，是我在multisim上面仿真出来的，实际测试后确实可以偏置，大家可以尝试使用1比1的运放后加偏置电压，也可以参考我的设计电路。附上完整电路图。
1-1：运放电路
这是直接用了毕业设计里面的图片，之前的文件不见了。应该能看懂吧 。运放采用的是最简单的负反馈放大电路。放大倍数Vout/Vin=R1/R2。
1-2：负电压电路
由于运放芯片想运放负极电压信号，需要采用双电源模式，必须为运放芯片提供负电压。所以本设计采用低功率，额定电压为5V的电源极性转换器ICL7660。ICL7660输入5V正电压，输出-5V电压。为LM358提供双电源。本设计采用ICL7660的基本负电压转换模式。
1-3：1.65V偏置电路（自己仿真实现的，实测可用）
2、单片机软件
这个直接用STM32的单片机ADC采集和串口例程，将数据分高4位和低8位的方式（单片机串口只能上传8位的数据），将12位的ADC数据通过串口分别传输给上位机，ADC采样率调到最高，串口通过DMA的方式，这样可以达到最高的采集速度。最后分别用两个for循环，循环往串口发送1000个低8位和1000个高4位数据。每次发送两组1000个数据的间隔你们可以自己定，我记得我应该间隔是100ms左右刷新一次数据，上位机整合两组数据后，一次显示1000个数据点。ADC和串口传输数据的可以在STM32的例程中找到，具体逻辑这里不再累述。不过还是附上当年写的几条程序吧。
1、连续读取1000个ADC数据；
2、拆分低8位和高4位；
3、向串口上传低8位数据；
4、向串口上传高4位数据；
3、上位机
上位机在整合两次接收的数据，直接调用Labview提供的信号分析函数，如单频测量函数，频谱测量函数以及幅值和电平测量函数。
3-1：读取串口数据
3-2：整合高4位，低8位位数据。右侧输出直接给到波形显示控件
3-3：波形控件
前面板-&gt;控件-&gt;新式-&gt;图形-&gt;波形图。
4、最终整合后的虚拟示波器效果
采集的信号范围为5HZ~25KHZ（STM32F1系列采样率最高为0.5MS/s），0.1V~16.5V的模拟信号；幅值误差低于5%，频率误差低于2%，能满足日常中大多信号/电压的信号采集与分析。希望对大家有所作用，也希望国内开源资源能越来越丰富吧。虽然一般技术不能给我们工程师带来多大的财富，但至少在某个年龄段，在追求一种引以为傲的技能的时候，能让我们感到充实，自豪，也是一种不错的人生体验呢！
原创不易，一键三连拉！" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://zhuifengsn.github.io/posts/85f15dde1f3666b277802644d3d9ec3a/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-07-11T12:33:00+08:00" />
<meta property="article:modified_time" content="2022-07-11T12:33:00+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="追风少年的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">追风少年的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">labview入门到出家11(补充)——基于单片机和labview开发的虚拟示波器</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p><span style="color:#4da8ee;">   <strong>之前有小伙伴提到需要虚拟示波器的资料，有些库还有文件丢失了，直接给的工程跑不起来，这里我把关键的地方讲解一下，大家可以自行开发。其实开发不难，只是有些点会耗点时间。</strong></span><span style="color:#fe2c24;"><strong>虚拟示波器</strong></span><span style="color:#4da8ee;"><strong>，顾名思义就是非实物的示波器，但也还是硬件（便携的采集设备）和软件（在电脑上显示和操作）的结合，</strong></span><strong><span style="color:#4da8ee;">和数字示波器相比，本质上区别不大，现在贵一些的数字示波器从功能上看，也很像一台计算机了)。今天要讲的只是低配的，简易版的虚拟示波器（在下当年的毕业设计）。下位机是基于STM32的ADC采集实现的信号抓取，然后通过串口传到上位机中显示。单片机的ADC和串口传输，注定了这虚拟示波器采集的波形频率不会太高，之前能在上位机上还原得比较好的波形频率是25Khz以下，如果大家有其他更快的采集(DSP,FPGA，NI采集卡)和数据上传的方式(USB等)，可以尝试一下，也期待你们的分享。下面大体</span><span style="color:#fe2c24;">对硬件(外围电路)，单片机程序(STM32)，和上位机程序(labview)三部分进行讲解</span><span style="color:#4da8ee;">。</span></strong></p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/e7/2d/XlXmaFkD_o.png"></p> 
<p><strong><span style="color:#38d8f0;">1、硬件</span></strong></p> 
<p><span style="color:#0d0016;">        硬件很简单，就是将输入到单片机的波形信号进行处理。因为我用的STM32的单片机，能检测到的电压值是0~3.3V，所以硬件部分就是把输入的交流信号先控制在-1.65V~1.65V之间，最后再通过电路将信号往上偏置1.65V就可以给单片机采集了。至于如何将信号放大放小，控制到可采集的电压范围呢，可以通过上位机发送串口数据给单片机，让单片机控制继电器（或者其他开关方式）切换运放端的电阻，达到更改运放倍数的方式，最后上位机呈现波形的时候加上放大缩小的倍数，就可以在上位机界面上还原波形信号了。我这里先采用了LM358的双电源运放芯片（交流信号，需要双电源运放芯片），后面因为LM358在高频输入的时候，运放输出的信号在零点处会失真，换了一款高频的运放芯片</span>UA741，问题解决。双电源里面的负电压是通过LCL7660输出的。至于偏置电压，是我在multisim上面仿真出来的，实际测试后确实可以偏置，大家可以尝试使用1比1的运放后加偏置电压，也可以参考我的设计电路。附上完整电路图。</p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/d0/b2/zrxHbhEu_o.jpg"></p> 
<p><u>1-1：运放电路</u></p> 
<p>这是直接用了毕业设计里面的图片，之前的文件不见了。应该能看懂吧 。运放采用的是最简单的负反馈放大电路。放大倍数Vout/Vin=R1/R2。</p> 
<p><img alt="" height="237" src="https://images2.imgbox.com/c4/06/WzxYvt3c_o.jpg" width="358"></p> 
<p><u>1-2：负电压电路</u></p> 
<p>由于运放芯片想运放负极电压信号，需要采用双电源模式，必须为运放芯片提供负电压。所以本设计采用低功率，额定电压为5V的电源极性转换器ICL7660。ICL7660输入5V正电压，输出-5V电压。为LM358提供双电源。本设计采用ICL7660的基本负电压转换模式。</p> 
<p><img alt="" height="192" src="https://images2.imgbox.com/eb/eb/vo7YMBpW_o.png" width="342"></p> 
<p><u>1-3：1.65V偏置电路（自己仿真实现的，实测可用）</u></p> 
<p> <img alt="" height="279" src="https://images2.imgbox.com/79/0d/5DQ9XIRu_o.png" width="241"></p> 
<p></p> 
<p><strong><span style="color:#38d8f0;">2、单片机软件</span></strong></p> 
<p><strong><span style="color:#38d8f0;">        </span></strong><span style="color:#0d0016;">这个直接用STM32的单片机ADC采集和串口例程，将数据分高4位和低8位的方式（单片机串口只能上传8位的数据），将12位的ADC数据通过串口分别传输给上位机，ADC采样率调到最高，串口通过DMA的方式，这样可以达到最高的采集速度。最后分别用两个for循环，循环往串口发送1000个低8位和1000个高4位数据。每次发送两组1000个数据的间隔你们可以自己定，我记得我应该间隔是100ms左右刷新一次数据，上位机整合两组数据后，一次显示1000个数据点。ADC和串口传输数据的可以在STM32的例程中找到，具体逻辑这里不再累述。不过还是附上当年写的几条程序吧。</span></p> 
<p><img alt="" height="198" src="https://images2.imgbox.com/0c/de/NaVPwaJ3_o.png" width="341"></p> 
<p>1、连续读取1000个ADC数据；</p> 
<p>2、拆分低8位和高4位；</p> 
<p>3、向串口上传低8位数据；</p> 
<p>4、向串口上传高4位数据；</p> 
<p></p> 
<p><strong><span style="color:#38d8f0;">3、上位机</span></strong></p> 
<p><span style="color:#0d0016;">        上位机在整合两次接收的数据，</span>直接调用Labview提供的信号分析函数，如单频测量函数，频谱测量函数以及幅值和电平测量函数。</p> 
<p><u>3-1：读取串口数据</u></p> 
<p><img alt="" height="354" src="https://images2.imgbox.com/67/2a/B5E7uXBF_o.png" width="884"></p> 
<p><u> 3-2：整合高4位，低8位位数据。右侧输出直接给到波形显示控件</u></p> 
<p><img alt="" height="306" src="https://images2.imgbox.com/b6/5b/gji2VGjd_o.png" width="636"></p> 
<p><u> 3-3：波形控件</u></p> 
<p>前面板-&gt;控件-&gt;新式-&gt;图形-&gt;波形图。</p> 
<p><img alt="" height="368" src="https://images2.imgbox.com/1d/10/sSBsZygC_o.png" width="452"></p> 
<p></p> 
<p><strong><span style="color:#38d8f0;">4、最终整合后的虚拟示波器效果</span></strong></p> 
<p><img alt="" height="522" src="https://images2.imgbox.com/28/1b/9wnrwRsE_o.png" width="968"></p> 
<p> 采集的信号范围为5HZ~25KHZ（STM32F1系列采样率最高为0.5MS/s），0.1V~16.5V的模拟信号；幅值误差低于5%，频率误差低于2%，能满足日常中大多信号/电压的信号采集与分析。希望对大家有所作用，也希望国内开源资源能越来越丰富吧。虽然一般技术不能给我们工程师带来多大的财富，但至少在某个年龄段，在追求一种引以为傲的技能的时候，能让我们感到充实，自豪，也是一种不错的人生体验呢！</p> 
<p><span style="color:#4da8ee;"><strong>原创不易，一键三连拉！</strong></span></p> 
<p></p> 
<p></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/a976ae58c21aad1b606c112681fccdc0/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">HC-05/06蓝牙模块的原理及使用方法</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/1cc196ea1d7be5374a9b8556af09effa/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">JAVA LIST、ARRAY 移除其中某一元素</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 追风少年的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>