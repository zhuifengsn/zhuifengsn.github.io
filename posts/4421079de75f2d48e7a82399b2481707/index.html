<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>pycharm 切换 python3.9 报错 ‘HTMLParser‘ object has no attribute ‘unescape‘ 解决 - 追风少年的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="pycharm 切换 python3.9 报错 ‘HTMLParser‘ object has no attribute ‘unescape‘ 解决" />
<meta property="og:description" content="有的bug，莫名其妙就好了…
推荐一个好东西：这大概是所有python程序员都会喜欢的惊喜吧！
python3.9 报错 “AttributeError: &#39;HTMLParser&#39; object has no attribute &#39;unescape&#39;” 异常分析解决。
一、问题描述 安装 python3.9 版本后，pycharm 中切换 python3.9 版本，创建虚拟环境报错：&#34;AttributeError: &#39;HTMLParser&#39; object has no attribute &#39;unescape&#39;&#34;。
Executed command: C:\Users\程序员的一天\AppData\Local\Temp\tmp41_yhcxspycharm-management\setuptools-40.8.0\setup.py install Error occurred: AttributeError: &#39;HTMLParser&#39; object has no attribute &#39;unescape&#39; Command output: Traceback (most recent call last): File &#34;C:\Users\程序员的一天\AppData\Local\Temp\tmp0mv4mj35pycharm-management\setuptools-40.8.0\setup.py&#34;, line 11, in &lt;module&gt; import setuptools File &#34;C:\Users\程序员的一天\AppData\Local\Temp\tmp0mv4mj35pycharm-management\setuptools-40.8.0\setuptools\__init__.py&#34;, line 20, in &lt;module&gt; from setuptools.dist import Distribution, Feature File &#34;C:\Users\程序员的一天\AppData\Local\Temp\tmp0mv4mj35pycharm-management\setuptools-40.8.0\setuptools\dist.py&#34;, line 35, in &lt;module&gt; from setuptools." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://zhuifengsn.github.io/posts/4421079de75f2d48e7a82399b2481707/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-10-27T17:56:56+08:00" />
<meta property="article:modified_time" content="2020-10-27T17:56:56+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="追风少年的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">追风少年的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">pycharm 切换 python3.9 报错 ‘HTMLParser‘ object has no attribute ‘unescape‘ 解决</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-tomorrow-night-eighties">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <blockquote> 
 <p>有的bug，莫名其妙就好了…</p> 
</blockquote> 
<blockquote> 
 <p>推荐一个好东西：<a href="https://mp.weixin.qq.com/s/QfTfbG94d5JVthKxwESTXg" rel="nofollow">这大概是所有python程序员都会喜欢的惊喜吧！</a></p> 
</blockquote> 
<p><code>python3.9</code> 报错 “<code>AttributeError: 'HTMLParser' object has no attribute 'unescape'</code>” 异常分析解决。</p> 
<h3><a id="_6"></a>一、问题描述</h3> 
<p>安装 <code>python3.9</code> 版本后，<code>pycharm</code> 中切换 <code>python3.9</code> 版本，创建虚拟环境报错："<code>AttributeError: 'HTMLParser' object has no attribute 'unescape'</code>"。</p> 
<pre><code>Executed command:
    C:\Users\程序员的一天\AppData\Local\Temp\tmp41_yhcxspycharm-management\setuptools-40.8.0\setup.py install

Error occurred:
    AttributeError: 'HTMLParser' object has no attribute 'unescape'

Command output:
Traceback (most recent call last):
  File "C:\Users\程序员的一天\AppData\Local\Temp\tmp0mv4mj35pycharm-management\setuptools-40.8.0\setup.py", line 11, in &lt;module&gt;
    import setuptools
  File "C:\Users\程序员的一天\AppData\Local\Temp\tmp0mv4mj35pycharm-management\setuptools-40.8.0\setuptools\__init__.py", line 20, in &lt;module&gt;
    from setuptools.dist import Distribution, Feature
  File "C:\Users\程序员的一天\AppData\Local\Temp\tmp0mv4mj35pycharm-management\setuptools-40.8.0\setuptools\dist.py", line 35, in &lt;module&gt;
    from setuptools.depends import Require
  File "C:\Users\程序员的一天\AppData\Local\Temp\tmp0mv4mj35pycharm-management\setuptools-40.8.0\setuptools\depends.py", line 7, in &lt;module&gt;
    from .py33compat import Bytecode
  File "C:\Users\程序员的一天\AppData\Local\Temp\tmp0mv4mj35pycharm-management\setuptools-40.8.0\setuptools\py33compat.py", line 55, in &lt;module&gt;
    unescape = getattr(html, 'unescape', html_parser.HTMLParser().unescape)
AttributeError: 'HTMLParser' object has no attribute 'unescape'

</code></pre> 
<p>查看官网 <code>python3.9</code> 的 <code>changelog</code>，发现 <code>HTMLParser.unescape</code> 属性被移除了，并且从 <code>python3.4</code> 开始就被弃用。</p> 
<p><img src="https://images2.imgbox.com/31/bd/ssyrPz12_o.png" alt="python3.9 changelog"></p> 
<p><code>pycharm</code> 创建虚拟环境时，会使用到 <code>setuptools</code>。而 <code>setuptools</code> 中，刚好使用了这个属性，所以，导致了"<code>AttributeError: 'HTMLParser' object has no attribute 'unescape'</code>"异常。</p> 
<p>经过各种分析、尝试，问题最终得到解决。记录下过程，避免更多人踩坑。</p> 
<h3><a id="_42"></a>二、解决方法</h3> 
<p>先给出解决方法，感兴趣的朋友，可以继续阅读后面的分析部分。</p> 
<p>解决这个问题，分两种情况：</p> 
<pre><code>1. 不通过 pycharm 编辑器，直接使用 python 解释器。
2. 在 pycharm 编辑器中使用 python 解释器。
</code></pre> 
<blockquote> 
 <p>我是在 <code>pycharm</code> 中使用 <code>python3.9</code> 触发报错，所以这里也单独提出来讨论讨论。</p> 
</blockquote> 
<h4><a id="21_python__54"></a>2.1、直接使用 python 解释器</h4> 
<p>不通过 <code>pycharm</code> 编辑器，直接使用 <code>python</code> 解释器。比如，在 <code>windows</code> 的 <code>cmd</code> ，或 <code>linux</code> 下的命令行中使用 <code>python</code>。</p> 
<p>解决方法：<strong>更新 <code>setuptools</code> 版本。</strong><br> 我以 <code>python3.9</code> 使用 <code>setuptools</code> 为例，测试如下。</p> 
<h6><a id="211setuptools__61"></a>2.1.1、<code>setuptools</code> 低版本触发报错</h6> 
<p>以 <code>setuptools-40.8.0</code> 为例，测试触发报错如下：</p> 
<p>第一步，使用 <code>python3.9</code> 下的 <code>pip</code> 卸载之前安装的 <code>setuptools</code>:</p> 
<pre><code>E:\soft\python\python39\install&gt;pip uninstall setuptools
</code></pre> 
<p>第二步，安装 <code>setuptools-40.8.0</code>：</p> 
<pre><code>E:\soft\python\python39\install&gt;pip install setuptools==40.8.0
Collecting setuptools==40.8.0
  Using cached setuptools-40.8.0-py2.py3-none-any.whl (575 kB)
Installing collected packages: setuptools
Successfully installed setuptools-40.8.0
</code></pre> 
<p>第三步，在 <code>python3.9</code> 中导入包触发报错：</p> 
<pre><code>E:\soft\python\python39\install&gt;python
Python 3.9.0 (tags/v3.9.0:9cf6752, Oct  5 2020, 15:34:40) [MSC v.1927 64 bit (AMD64)] on win32
Type "help", "copyright", "credits" or "license" for more information.
&gt;&gt;&gt; import setuptools
Traceback (most recent call last):
  File "&lt;stdin&gt;", line 1, in &lt;module&gt;
  File "E:\soft\python\python39\install\lib\site-packages\setuptools\__init__.py", line 20, in &lt;module&gt;
    from setuptools.dist import Distribution, Feature
  File "E:\soft\python\python39\install\lib\site-packages\setuptools\dist.py", line 35, in &lt;module&gt;
    from setuptools.depends import Require
  File "E:\soft\python\python39\install\lib\site-packages\setuptools\depends.py", line 7, in &lt;module&gt;
    from .py33compat import Bytecode
  File "E:\soft\python\python39\install\lib\site-packages\setuptools\py33compat.py", line 55, in &lt;module&gt;
    unescape = getattr(html, 'unescape', html_parser.HTMLParser().unescape)
AttributeError: 'HTMLParser' object has no attribute 'unescape'
</code></pre> 
<h6><a id="212setuptools__96"></a>2.1.2、<code>setuptools</code> 高版本解决报错</h6> 
<p>以 <code>setuptools-49.2.1</code> 为例，测试如下：</p> 
<p>第一步，卸载之前安装的 <code>setuptools</code>:</p> 
<pre><code>E:\soft\python\python39\install&gt;pip uninstall setuptools
Found existing installation: setuptools 40.8.0
Uninstalling setuptools-40.8.0:
  Would remove:
    e:\soft\python\python39\install\lib\site-packages\easy_install.py
    e:\soft\python\python39\install\lib\site-packages\pkg_resources\*
    e:\soft\python\python39\install\lib\site-packages\setuptools-40.8.0.dist-info\*
    e:\soft\python\python39\install\lib\site-packages\setuptools\*
    e:\soft\python\python39\install\scripts\easy_install-3.9.exe
    e:\soft\python\python39\install\scripts\easy_install.exe
Proceed (y/n)? y
  Successfully uninstalled setuptools-40.8.0
</code></pre> 
<p>第二步，安装 <code>setuptools==49.2.1</code>:</p> 
<pre><code>E:\soft\python\python39\install&gt;pip install setuptools==49.2.1
Collecting setuptools==49.2.1
  Using cached setuptools-49.2.1-py3-none-any.whl (789 kB)
Installing collected packages: setuptools
Successfully installed setuptools-49.2.1
</code></pre> 
<p>第三步，在 <code>python3.9</code> 中导入包：</p> 
<pre><code>E:\soft\python\python39\install&gt;python
Python 3.9.0 (tags/v3.9.0:9cf6752, Oct  5 2020, 15:34:40) [MSC v.1927 64 bit (AMD64)] on win32
Type "help", "copyright", "credits" or "license" for more information.
&gt;&gt;&gt; import setuptools
&gt;&gt;&gt; setuptools.__version__
'49.2.1'
&gt;&gt;&gt;
</code></pre> 
<blockquote> 
 <p>目前最新版本，应该是到 <code>setuptools-50.3.2</code> 了 。</p> 
</blockquote> 
<hr> 
<h4><a id="22_pycharm__python__136"></a>2.2、在 pycharm 中使用 python 解释器</h4> 
<p>在 <code>pycharm</code> 中创建 <code>python3.9</code> 虚拟环境报错，本质上也是使用了 <code>setuptools</code> 的低版本导致。<br> 我尝试过更新 <code>setuptools</code> 为更高的版本，但 <code>pycharm</code> 还是顽固的使用了 <code>setuptools-40.8.0</code>，如最开始的报错信息所示…</p> 
<p>我不知道是 <code>pycharm</code> 中的某些默认配置导致，还是 <code>pycharm</code> 的版本属性导致它使用了低版本的 <code>setuptools</code>，如果有朋友知道，欢迎告知。</p> 
<p>虽然，不知道 <code>pycharm</code> 中选择低版本 <code>setuptools</code> 的原因。这里，也简单提供两种解决方法吧~</p> 
<h6><a id="221virtualenv__144"></a>2.2.1、<code>virtualenv</code> 创建虚拟环境</h6> 
<p><code>virtualenv</code> 为应用提供隔离的 <code>Python</code> 运行环境，可以解决不同应用间多版本 <code>python</code> 的冲突问题。</p> 
<p>利用 <code>virtualenv</code> 创建虚拟环境后，<code>pycharm</code> 中创建虚拟环境时，选择已存在的虚拟环境，可以<strong>避开</strong>报错。</p> 
<p><strong>第一步：</strong> 确认 <code>python3.9</code> 对应的 <code>pip</code> 工具。<br> 如果没有配环境变量，可以直接从安装路径下打开 <code>cmd</code> 工具。一般在 <code>python</code> 安装目录下的 <code>Scripts</code> 文件夹内。使用 <code>pip -V</code> 可以查看 <code>pip</code> 对应的 <code>python</code> 版本。</p> 
<pre><code>E:\soft\python\python39\install&gt;pip -V
pip 20.2.4 from e:\soft\python\python39\install\lib\site-packages\pip (python 3.9)

</code></pre> 
<p><strong>第二步：</strong> 安装 <code>virtualenv</code>。</p> 
<pre><code>pip install virtualenv
</code></pre> 
<p><strong>第三步：</strong> 创建虚拟环境。<br> <code>virtualenv</code> 指令用于创建虚拟环境，后跟虚拟环境保存路径。</p> 
<pre><code>virtualenv E:\soft\python\python39\env
</code></pre> 
<blockquote> 
 <p>如果需要删除虚拟环境，直接删除对应文件夹即可。</p> 
</blockquote> 
<p><strong>第四步：</strong> <code>pycharm</code> 中选择已存在的虚拟环境。<br> "<code>File</code> --&gt; <code>Settings</code> --&gt; <code>Python Interpreter</code>"，进入对应界面。</p> 
<p><img src="https://images2.imgbox.com/52/c5/vK2TAovs_o.png" alt="pycharm中选择已存在虚拟环境"></p> 
<blockquote> 
 <p>这里，需要选择到虚拟环境中的 <code>python.exe</code>，否则 <code>OK</code> 键为灰色，无法点击。</p> 
</blockquote> 
<p>通过该方法，可以在原本报错的 <code>pycharm</code> 中创建 <code>python3.9</code> 虚拟环境。</p> 
<h6><a id="222pycharm__182"></a>2.2.2、<code>pycharm</code> 版本更换</h6> 
<p>报错版本为：<code>pycharm-community-2019.2.1</code>。<br> 下载安装最新版本：<code>pycharm-community-2020.2.3</code>。</p> 
<p>点击运行要安装的 <code>pycharm-community-2020.2.3.exe</code> 文件，会自动检测，提示卸载已安装的<code>pycharm</code>。</p> 
<p>为避免其他问题，卸载过程中，可以选择删除旧版本配置等。</p> 
<p><img src="https://images2.imgbox.com/39/b2/hNTLCckb_o.png" alt="卸载过程中选择删除缓存配置和已安装插件等"></p> 
<p>经过测试，使用最新版本 <code>pycharm</code> 可以成功创建 <code>python3.9</code> 虚拟环境。<br> 为了验证是否为 <code>pycharm</code> 的版本兼容问题，我卸载最新版本，重新安装旧版本 <code>pycharm</code> 后，依然报错！我<strong>猜测</strong>是固定的 <code>pycharm</code> 版本，使用了固定的某些 <code>setuptools</code> 版本，导致了兼容性报错。</p> 
<p>我也怀疑过是系统中多个版本 <code>python</code> 的环境变量顺序，导致<code>pycharm</code> 找到了错误的依赖项。尝试在环境变量中将 <code>python3.9</code> 相关值移动到最前面，依然不能解决问题。</p> 
<blockquote> 
 <p>看来，最新的 <code>python</code> 还是得配最新的 <code>pycharm</code>！<sub>编码界的爱情故事么…</sub></p> 
</blockquote> 
<h3><a id="_200"></a>三、原因分析</h3> 
<p>感兴趣的朋友，欢迎继续阅读。</p> 
<p>从 <code>Traceback</code> 报错日志中，可以看到，是在 <code>setuptools-40.8.0\setuptools\py33compat.py</code> 的55行， 执行 <code>unescape = getattr(html, 'unescape', html_parser.HTMLParser().unescape)</code> 时，抛出了 <code>AttributeError: 'HTMLParser' object has no attribute 'unescape'</code> 异常。</p> 
<p>可以肯定是由 <code>setuptools</code> 引起的报错。这里有一个关键的信息：<code>py33compat.py</code> 文件。<br> <code>pyXXcompat.py</code> 是 <code>setuptools</code> 兼容 <code>python</code> 版本相关的文件。</p> 
<p>进入到 <code>..\Lib\site-packages\setuptools</code> 查看 <code>setuptools-40.8.0</code> 的安装文件，可以看到，包含了 <code>py27compat.py</code> 、<code>py31compat.py</code> 、<code>py33compat.py</code> 。</p> 
<p><img src="https://images2.imgbox.com/26/df/WXz6nnbr_o.png" alt="setuptools-40.8.0兼容文件"></p> 
<p>进入到 <code>..\Lib\site-packages\setuptools</code> 查看 <code>setuptools-49.2.1</code> 的安装文件，可以看到，只包含了 <code>py34compat.py</code> 。</p> 
<p><img src="https://images2.imgbox.com/a7/4c/cEFY2WN9_o.png" alt="setuptools-49.2.1兼容文件"></p> 
<p>而我们从 <code>python3.9</code> 的 <code>changelog</code> 中，可以知道 <code>HTMLParser.unescape</code> 属性被移除了，并且从 <code>python3.4</code> 开始就被弃用了。</p> 
<p>所以，从兼容 <code>python3.4</code> 开始，<code>setuptools</code> 中就放弃了使用 <code>HTMLParser.unescape</code>。<br> 因此，只要包含 <code>py34compat.py</code> 文件的 <code>setuptools</code> 版本，就能兼容 <code>python3.9</code> 版本。</p> 
<p>END.</p> 
<blockquote> 
 <p>原创不易，点个赞呗！如果喜欢，可以打赏请作者喝奶茶哟：）</p> 
</blockquote> 
<blockquote> 
 <p>工作之余，喜欢写些东西，记录生活、总结技术。感兴趣的微信朋友，可以搜一搜：【<strong>程序员的一天</strong>】，欢迎关注、支持，谢谢！</p> 
</blockquote>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/3abd6cf74dfc6db6a82e268bc13d91fe/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">mysql主从架构与分库分表</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/dccbc4b1af0c07e4c3307a60b6a5bc5e/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">springcloud 超详细介绍</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 追风少年的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>