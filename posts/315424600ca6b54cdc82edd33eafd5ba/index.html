<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Linux文件系统原理分析（2）inode索引节点 - 追风少年的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Linux文件系统原理分析（2）inode索引节点" />
<meta property="og:description" content="文章目录 **一、inode是什么？****二、inode的内容****三、inode的大小****四、inode号码****五、目录文件****六、硬链接****七、软链接****八、inode的特殊作用****九、拓展软硬链接****1、硬链接****2、软链接** 一、inode是什么？ 理解inode，要从文件储存说起。
文件储存在硬盘上，硬盘的最小存储单位叫做”扇区”（Sector）。每个扇区储存512字节（相当于0.5KB）。
扇区（Sector）和块（Block）都是存储设备中的基本单位，但它们所表示的概念略有不同。
扇区是存储设备中最小的物理数据单位，通常大小为512字节或4KB。每个扇区都有一个唯一的地址（扇区号），用于标识其在磁盘上的位置。
块是操作系统进行文件系统管理的基本单位，通常大小为4KB或更大。块是一个逻辑上的概念，由一定数量的扇区组成。通过块，文件系统可以对存储设备进行逻辑划分，便于管理和读写数据。
在操作系统中，文件通常按照块的方式进行读写。当需要读取或写入一个文件时，操作系统会将文件分割成若干个块，并根据需要读取或写入相应数量的块。这些块实际上是由若干个扇区构成的。
文件数据都储存在”块”中，那么很显然，我们还必须找到一个地方储存文件的元信息，比如文件的创建者、文件的创建日期、文件的大小等等。这种储存文件元信息的区域就叫做inode，中文译名为”索引节点”。
每一个文件都有对应的inode，里面包含了与该文件有关的一些信息。
二、inode的内容 索引节点（Inode）是Unix/Linux文件系统中的一个重要概念，用于存储关于文件或目录的元数据信息。每个文件或目录在文件系统中都对应一个唯一的索引节点，索引节点中包含了该文件或目录的属性和指向数据块的指针等信息。
索引节点通常包含以下信息：
文件类型（regular file、directory、symbolic link等）文件大小文件权限（读、写、执行权限）拥有者和所属用户组创建时间、修改时间和访问时间链接计数（指向该索引节点的硬链接数量）数据块指针（用于指向存储文件内容的数据块） 通过索引节点，文件系统可以有效地管理文件和目录，包括定位文件数据块、维护文件属性、权限等信息。当应用程序需要访问文件时，操作系统会通过索引节点来查找文件的元数据信息，从而获取文件的相关属性和数据块指针。
另外，索引节点的链接计数是一个重要的概念。每个文件或目录的索引节点都有一个链接计数，用于记录指向该索引节点的硬链接数量。当创建一个文件的硬链接时，该文件的索引节点的链接计数会增加；当删除一个硬链接时，链接计数会减少。只有当链接计数减少到0时，文件的索引节点才会被释放，文件占用的存储空间才会被释放。
可以用stat命令，查看某个文件的inode信息：
$ stat f File: f Size: 0 Blocks: 0 IO Block: 4096 regular empty file Device: 10304h/66308d	Inode: 14976327 Links: 1 Access: (0664/-rw-rw-r--) Uid: ( 1000/ victory) Gid: ( 1000/ victory) Access: 2024-02-18 16:41:56.408716071 &#43;0800 Modify: 2024-02-18 16:41:56.408716071 &#43;0800 Change: 2024-02-18 16:41:56.408716071 &#43;0800 Birth: 2024-02-18 16:41:56.408716071 &#43;0800 总之，除了文件名以外的所有文件信息，都存在inode之中。至于为什么没有文件名，下文会有详细解释。
三、inode的大小 inode也会消耗硬盘空间，所以硬盘格式化的时候，操作系统自动将硬盘分成两个区域。一个是数据区，存放文件数据；另一个是inode区（inode table），存放inode所包含的信息。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://zhuifengsn.github.io/posts/315424600ca6b54cdc82edd33eafd5ba/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-02-18T17:06:31+08:00" />
<meta property="article:modified_time" content="2024-02-18T17:06:31+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="追风少年的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">追风少年的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Linux文件系统原理分析（2）inode索引节点</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><ul><li><a href="#inode_1" rel="nofollow">**一、inode是什么？**</a></li><li><a href="#inode_19" rel="nofollow">**二、inode的内容**</a></li><li><a href="#inode_53" rel="nofollow">**三、inode的大小**</a></li><li><a href="#inode_85" rel="nofollow">**四、inode号码**</a></li><li><a href="#_104" rel="nofollow">**五、目录文件**</a></li><li><a href="#_124" rel="nofollow">**六、硬链接**</a></li><li><a href="#_140" rel="nofollow">**七、软链接**</a></li><li><a href="#inode_152" rel="nofollow">**八、inode的特殊作用**</a></li><li><a href="#_164" rel="nofollow">**九、拓展软硬链接**</a></li><li><ul><li><a href="#1_166" rel="nofollow">**1、硬链接**</a></li><li><a href="#2_170" rel="nofollow">**2、软链接**</a></li></ul> 
  </li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h3><a id="inode_1"></a><strong>一、inode是什么？</strong></h3> 
<p>理解inode，要从文件储存说起。</p> 
<p>文件储存在硬盘上，硬盘的最小存储单位叫做”扇区”（Sector）。每个扇区储存512字节（相当于0.5KB）。</p> 
<p>扇区（Sector）和块（Block）都是存储设备中的基本单位，但它们所表示的概念略有不同。</p> 
<p>扇区是存储设备中最小的物理数据单位，通常大小为512字节或4KB。每个扇区都有一个唯一的地址（扇区号），用于标识其在磁盘上的位置。</p> 
<p><strong>块是操作系统进行文件系统管理的基本单位</strong>，通常大小为4KB或更大。块是一个逻辑上的概念，由一定数量的扇区组成。通过块，文件系统可以对存储设备进行逻辑划分，便于管理和读写数据。</p> 
<p>在操作系统中，文件通常按照块的方式进行读写。当需要读取或写入一个文件时，操作系统会将文件分割成若干个块，并根据需要读取或写入相应数量的块。这些块实际上是由若干个扇区构成的。</p> 
<p>文件数据都储存在”块”中，那么很显然，我们还必须找到一个地方储存文件的元信息，比如文件的创建者、文件的创建日期、文件的大小等等。这种储存文件元信息的区域就叫做inode，中文译名为”索引节点”。</p> 
<p>每一个文件都有对应的inode，里面包含了与该文件有关的一些信息。</p> 
<h3><a id="inode_19"></a><strong>二、inode的内容</strong></h3> 
<p>索引节点（Inode）是Unix/Linux文件系统中的一个重要概念，用于存储关于文件或目录的<strong>元数据信息</strong>。每个文件或目录在文件系统中都对应一个唯一的索引节点，索引节点中包含了该文件或目录的属性和指向数据块的指针等信息。</p> 
<p>索引节点通常包含以下信息：</p> 
<ol><li>文件类型（regular file、directory、symbolic link等）</li><li>文件大小</li><li>文件权限（读、写、执行权限）</li><li>拥有者和所属用户组</li><li>创建时间、修改时间和访问时间</li><li>链接计数（指向该索引节点的硬链接数量）</li><li>数据块指针（用于指向存储文件内容的数据块）</li></ol> 
<p>通过索引节点，文件系统可以有效地管理文件和目录，包括定位文件数据块、维护文件属性、权限等信息。当应用程序需要访问文件时，操作系统会通过索引节点来查找文件的元数据信息，从而获取文件的相关属性和数据块指针。</p> 
<p>另外，索引节点的链接计数是一个重要的概念。每个文件或目录的索引节点都有一个链接计数，用于记录指向该索引节点的硬链接数量。当创建一个文件的硬链接时，该文件的索引节点的链接计数会增加；当删除一个硬链接时，链接计数会减少。只有当链接计数减少到0时，文件的索引节点才会被释放，文件占用的存储空间才会被释放。</p> 
<p><strong>可以用stat命令，查看某个文件的inode信息：</strong></p> 
<pre><code class="prism language-shell">$ <span class="token function">stat</span> f                                               
  File: f
  Size: <span class="token number">0</span>         	Blocks: <span class="token number">0</span>          IO Block: <span class="token number">4096</span>   regular empty <span class="token function">file</span>
Device: 10304h/66308d	Inode: <span class="token number">14976327</span>    Links: <span class="token number">1</span>
Access: <span class="token punctuation">(</span>0664/-rw-rw-r--<span class="token punctuation">)</span>  Uid: <span class="token punctuation">(</span> <span class="token number">1000</span>/ victory<span class="token punctuation">)</span>   Gid: <span class="token punctuation">(</span> <span class="token number">1000</span>/ victory<span class="token punctuation">)</span>
Access: <span class="token number">2024</span>-02-18 <span class="token number">16</span>:41:56.408716071 +0800
Modify: <span class="token number">2024</span>-02-18 <span class="token number">16</span>:41:56.408716071 +0800
Change: <span class="token number">2024</span>-02-18 <span class="token number">16</span>:41:56.408716071 +0800
 Birth: <span class="token number">2024</span>-02-18 <span class="token number">16</span>:41:56.408716071 +0800
</code></pre> 
<p>总之，除了文件名以外的所有文件信息，都存在inode之中。至于为什么没有文件名，下文会有详细解释。</p> 
<h3><a id="inode_53"></a><strong>三、inode的大小</strong></h3> 
<p>inode也会消耗硬盘空间，所以硬盘格式化的时候，操作系统自动将硬盘分成两个区域。一个是数据区，存放文件数据；另一个是inode区（inode table），存放inode所包含的信息。</p> 
<p>每个inode节点的大小，一般是128字节或256字节。inode节点的总数，在格式化时就给定，一般是每1KB或每2KB就设置一个inode。假定在一块1GB的硬盘中，每个inode节点的大小为128字节，每1KB就设置一个inode，那么inode table的大小就会达到128MB，占整块硬盘的12.8%。</p> 
<p>查看每个硬盘分区的inode总数和已经使用的数量，可以使用df命令。</p> 
<pre><code class="prism language-shell">$ <span class="token function">df</span> <span class="token parameter variable">-ih</span>
Filesystem     Inodes IUsed IFree IUse% Mounted on
tmpfs            <span class="token number">4</span>.9M  <span class="token number">1</span>.3K  <span class="token number">4</span>.9M    <span class="token number">1</span>% /run
/dev/nvme1n1p2    15M  488K   15M    <span class="token number">4</span>% /
tmpfs            <span class="token number">4</span>.9M   <span class="token number">325</span>  <span class="token number">4</span>.9M    <span class="token number">1</span>% /dev/shm
tmpfs            <span class="token number">4</span>.9M     <span class="token number">4</span>  <span class="token number">4</span>.9M    <span class="token number">1</span>% /run/lock
efivarfs            <span class="token number">0</span>     <span class="token number">0</span>     <span class="token number">0</span>     - /sys/firmware/efi/efivars
/dev/nvme1n1p1      <span class="token number">0</span>     <span class="token number">0</span>     <span class="token number">0</span>     - /boot/efi
/dev/nvme0n1p1    60M  <span class="token number">2</span>.7M   57M    <span class="token number">5</span>% /home/victory/develop
tmpfs           1001K   <span class="token number">198</span> 1001K    <span class="token number">1</span>% /run/user/1000
</code></pre> 
<p>查看每个inode节点的大小，可以用如下命令：</p> 
<pre><code class="prism language-shell">$ <span class="token function">sudo</span> dumpe2fs <span class="token parameter variable">-h</span> /dev/sda1 <span class="token operator">|</span> <span class="token function">grep</span> <span class="token string">"Inode size"</span>
<span class="token punctuation">[</span>sudo<span class="token punctuation">]</span> password <span class="token keyword">for</span> victory: 
dumpe2fs <span class="token number">1.46</span>.5 <span class="token punctuation">(</span><span class="token number">30</span>-Dec-2021<span class="token punctuation">)</span>
Inode size:	          <span class="token number">256</span>
</code></pre> 
<p>由于每个文件都必须有一个inode，因此有可能发生inode已经用光，但是硬盘还未存满的情况。这时，就无法在硬盘上创建新文件。</p> 
<h3><a id="inode_85"></a><strong>四、inode号码</strong></h3> 
<p>每个inode都有一个号码，操作系统用inode号码来识别不同的文件。</p> 
<p>这里值得重复一遍，Unix/Linux系统内部不使用文件名，而使用inode号码来识别文件。对于系统来说，文件名只是inode号码便于识别的别称或者绰号。</p> 
<p>表面上，用户通过文件名，打开文件。实际上，系统内部这个过程分成三步：首先，系统找到这个文件名对应的inode号码；其次，通过inode号码，获取inode信息；最后，根据inode信息，找到文件数据所在的block，读出数据。</p> 
<p>使用ls -i命令，可以看到文件名对应的inode号码：</p> 
<pre><code class="prism language-shell">$ <span class="token function">ls</span> <span class="token parameter variable">-i</span> f    
<span class="token number">14976327</span> f
</code></pre> 
<h3><a id="_104"></a><strong>五、目录文件</strong></h3> 
<p>Unix/Linux系统中，目录（directory）也是一种文件。打开目录，实际上就是打开目录文件。</p> 
<p>目录文件的结构非常简单，就是一系列目录项（dirent）的列表。每个目录项，由两部分组成：所包含文件的文件名，以及该文件名对应的inode号码。</p> 
<p>ls命令只列出目录文件中的所有文件名：<br> <img src="https://images2.imgbox.com/f9/24/LP30fXWX_o.png" alt="在这里插入图片描述"></p> 
<p>增加-i选项可以列出所包含文件或目录的inode编号：</p> 
<p><img src="https://images2.imgbox.com/aa/a8/i03Q2S0B_o.png" alt="在这里插入图片描述"></p> 
<p>如果要查看文件的详细信息，就必须根据inode号码，访问inode节点，读取信息。<br> <img src="https://images2.imgbox.com/32/54/OZk2go82_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_124"></a><strong>六、硬链接</strong></h3> 
<p>一般情况下，文件名和inode号码是”一一对应”关系，每个inode号码对应一个文件名。但是，Unix/Linux系统允许，多个文件名指向同一个inode号码。</p> 
<p>这意味着，可以用不同的文件名访问同样的内容；对文件内容进行修改，会影响到所有文件名；但是，删除一个文件名，不影响另一个文件名的访问。这种情况就被称为”硬链接”（hard link）。</p> 
<p>ln命令可以创建硬链接：</p> 
<p><code>ln 源文件 目标文件</code></p> 
<p>运行上面这条命令以后，源文件与目标文件的inode号码相同，都指向同一个inode。inode信息中有一项叫做”链接数”，记录指向该inode的文件名总数，这时就会增加1。</p> 
<p>反过来，删除一个文件名，就会使得inode节点中的”链接数”减1。当这个值减到0，表明没有文件名指向这个inode，系统就会回收这个inode号码，以及其所对应block区域。</p> 
<p>这里顺便说一下目录文件的”链接数”。创建目录时，默认会生成两个目录项：”.”和”…”。前者的inode号码就是当前目录的inode号码，等同于当前目录的”硬链接”；后者的inode号码就是当前目录的父目录的inode号码，等同于父目录的”硬链接”。所以，任何一个目录的”硬链接”总数，总是等于2加上它的子目录总数（含隐藏目录）。</p> 
<h3><a id="_140"></a><strong>七、软链接</strong></h3> 
<p>除了硬链接以外，还有一种特殊情况。</p> 
<p>文件A和文件B的inode号码虽然不一样，但是文件A的内容是文件B的路径。读取文件A时，系统会自动将访问者导向文件B。因此，无论打开哪一个文件，最终读取的都是文件B。这时，文件A就称为文件B的”软链接”（soft link）或者”符号链接（symbolic link）。</p> 
<p>这意味着，文件A依赖于文件B而存在，如果删除了文件B，打开文件A就会报错：”No such file or directory”。这是软链接与硬链接最大的不同：文件A指向文件B的文件名，而不是文件B的inode号码，文件B的inode”链接数”不会因此发生变化。</p> 
<p>ln -s命令可以创建软链接。</p> 
<p><code>ln -s 源文文件或目录 目标文件或目录</code></p> 
<h3><a id="inode_152"></a><strong>八、inode的特殊作用</strong></h3> 
<p>由于inode号码与文件名分离，这种机制导致了一些Unix/Linux系统特有的现象。</p> 
<p>1. 有时，文件名包含特殊字符，无法正常删除。这时，直接删除inode节点，就能起到删除文件的作用。</p> 
<p>2. 移动文件或重命名文件，只是改变文件名，不影响inode号码。</p> 
<p>3. 打开一个文件以后，系统就以inode号码来识别这个文件，不再考虑文件名。因此，通常来说，系统无法从inode号码得知文件名。</p> 
<p>第3点使得软件更新变得简单，可以在不关闭软件的情况下进行更新，不需要重启。因为系统通过inode号码，识别运行中的文件，不通过文件名。更新的时候，新版文件以同样的文件名，生成一个新的inode，不会影响到运行中的文件。等到下一次运行这个软件的时候，文件名就自动指向新版文件，旧版文件的inode则被回收。</p> 
<h3><a id="_164"></a><strong>九、拓展软硬链接</strong></h3> 
<h4><a id="1_166"></a><strong>1、硬链接</strong></h4> 
<p>硬链接是通过索引节点进行的链接。在Linux中，多个文件指向同一个索引节点是允许的，像这样的链接就是硬链接。硬链接只能在同一文件系统中的文件之间进行链接，不能对目录进行创建。如果删除硬链接对应的源文件，则硬链接文件仍然存在，而且保存了原有的内容，这样可以起到防止因为误操作而错误删除文件的作用。由于硬链接是有着相同 inode 号仅文件名不同的文件，因此，删除一个硬链接文件并不影响其他有相同 inode 号的文件。</p> 
<h4><a id="2_170"></a><strong>2、软链接</strong></h4> 
<p>软链接（也叫符号链接）与硬链接不同，文件用户数据块中存放的内容是另一文件的路径名的指向。软链接就是一个普通文件，只是数据块内容有点特殊。软链接可对文件或目录创建。</p> 
<p>软链接主要应用于以下两个方面：一是方便管理，例如可以把一个复杂路径下的文件链接到一个简单路径下方便用户访问；另一方面就是解决文件系统磁盘空间不足的情况。例如某个文件文件系统空间已经用完了，但是现在必须在该文件系统下创建一个新的目录并存储大量的文件，那么可以把另一个剩余空间较多的文件系统中的目录链接到该文件系统中，这样就可以很好的解决空间不足问题。删除软链接并不影响被指向的文件，但若被指向的原文件被删除，则相关软连接就变成了死链接。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/098082a1e61e1c49d9d9b8b7425fafd1/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">微信小程序按需注入和用时注入</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/8a4aa0459672a66a62dc1d9f58171c29/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">华清远见嵌入式学习——驱动开发——作业1</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 追风少年的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>