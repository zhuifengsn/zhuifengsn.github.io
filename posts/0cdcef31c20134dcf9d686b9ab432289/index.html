<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>OpenHarmony分布式购物车案例展示~ - 追风少年的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="OpenHarmony分布式购物车案例展示~" />
<meta property="og:description" content="简介 分布式购物车demo 模拟的是我们购物时参加满减活动，进行拼单的场景；实现两人拼单时，其他一人添加商品到购物车，另外一人购物车列表能同步更新，且在购物车列表页面结算时，某一人结算对方也能实时知道结算金额和优惠金额。整个操作效果分为3个小动画，
拉起对方用户 添加商品到购物车列表 购物车列表勾选 demo效果（HH-SCDAYU200） 工程目录 完整的项目结构目录如下
├─entry\\src\\main │ │ config.json 应用配置文件 │ │ │ ├─ets │ │ └─MainAbility │ │ │ app.ets ets应用程序主入口 │ │ │ │ │ ├─model │ │ │ ArsData.ets // 初始化我的页面数据 │ │ │ CommonLog.ets // 日志类 │ │ │ GoodsData.ets // 初始化商品信息数据类 │ │ │ MenuData.ets // 初始化我的页面数据类 │ │ │ RemoteDeviceManager.ets // 分布式拉起设备管理类 │ │ │ ShoppingCartDistributedData.ets // 加入购物车分布式数据库 │ │ │ TotalSelectedDistributedData." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://zhuifengsn.github.io/posts/0cdcef31c20134dcf9d686b9ab432289/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-02-26T21:05:35+08:00" />
<meta property="article:modified_time" content="2024-02-26T21:05:35+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="追风少年的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">追风少年的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">OpenHarmony分布式购物车案例展示~</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h4><a id="_0"></a>简介</h4> 
<p>分布式购物车demo 模拟的是我们购物时参加满减活动，进行拼单的场景；实现两人拼单时，其他一人添加商品到购物车，另外一人购物车列表能同步更新，且在购物车列表页面结算时，某一人结算对方也能实时知道结算金额和优惠金额。整个操作效果分为3个小动画，</p> 
<ul><li>拉起对方用户</li></ul> 
<p><img src="https://images2.imgbox.com/98/59/TAO68XoL_o.gif" alt=""></p> 
<ul><li>添加商品到购物车列表</li></ul> 
<p><img src="https://images2.imgbox.com/82/74/7JJs8ZuM_o.gif" alt=""></p> 
<ul><li>购物车列表勾选</li></ul> 
<p><img src="https://images2.imgbox.com/c4/2c/r6ePu7f3_o.gif" alt=""></p> 
<ul><li>demo效果（HH-SCDAYU200）</li></ul> 
<p><img src="https://images2.imgbox.com/82/00/MuVhWQzF_o.gif" alt=""></p> 
<h4><a id="_20"></a>工程目录</h4> 
<p>完整的项目结构目录如下</p> 
<pre><code>├─entry\\src\\main
│          │  config.json  应用配置文件
│          │ 
│          ├─ets
│          │  └─MainAbility
│          │      │  app.ets  ets应用程序主入口
│          │      │ 
│          │      ├─model
│          │      │      ArsData.ets     // 初始化我的页面数据
│          │      │      CommonLog.ets   // 日志类
│          │      │      GoodsData.ets   // 初始化商品信息数据类
│          │      │      MenuData.ets    // 初始化我的页面数据类
│          │      │      RemoteDeviceManager.ets  // 分布式拉起设备管理类
│          │      │      ShoppingCartDistributedData.ets  // 加入购物车分布式数据库
│          │      │      TotalSelectedDistributedData.ets // 结算购物车分布式数据库
│          │      │ 
│          │      └─pages
│          │              DetailPage.ets   // 商品详情页面
│          │              HomePage.ets     // 应用首页
│          │              MyPage.ets       // 我的页面
│          │              ShoppingCartListPage.ets  // 购物车列表页面
│     └─resources // 静态资源目录
│         ├─base
│         │  ├─element
│         │  ├─graphic
│         │  ├─layout
│         │  ├─media // 存放媒体资源
│         │  └─profile
│         └─rawfile
</code></pre> 
<h4><a id="_56"></a>开发步骤</h4> 
<h5><a id="1_OpenHarmony_ETS_58"></a>1. 新建OpenHarmony ETS项目</h5> 
<p>在DevEco Studio中点击File -&gt; New Project -&gt;[Standard]Empty Ability-&gt;Next，Language 选择ETS语言，最后点击Finish即创建成功。</p> 
<p><img src="https://images2.imgbox.com/11/5c/4Eclc8he_o.png" alt=""></p> 
<h5><a id="2__64"></a>2. 编写商品展示主页面</h5> 
<p><img src="https://images2.imgbox.com/ab/95/pN4xvj7F_o.png" alt=""></p> 
<p>效果图如上可以分为两部分</p> 
<h6><a id="21_70"></a>2.1商品列表展示</h6> 
<p>1）首先在@entry组件入口build()中使用 <code>Tabs</code>作为容器，达到排行榜和推荐翻页的效果；</p> 
<p>2）再通过 <code>List</code> 包裹 <code>Row</code> 布局依次写入 <code>Column</code> 包裹的三个 <code>Text</code> 组件和 <code>Image</code> 组件；</p> 
<p>3）并通过 <code>Navigator</code> 组件实现点击商品跳转到商品详细页功能，页面跳转过程使用 <code>pageTransition</code> 转场动画</p> 
<pre><code>Tabs() {
       TabContent() {
         GoodsList({ goodsItems: this.goodsItems});
       }
       .tabBar("畅销榜")
       .backgroundColor(Color.White)

       TabContent() {
         GoodsList({ goodsItems: this.goodsItems});
       }
       .tabBar("推荐")
       .backgroundColor(Color.White)
     }
      Navigator({ target: 'pages/DetailPage' }) {
       Row({ space: '40lpx' }) {
         Column() {
           Text(this.goodsItem.title)
             .fontSize('28lpx')
           Text(this.goodsItem.content)
             .fontSize('20lpx')
           Text('￥' + this.goodsItem.price)
             .fontSize('28lpx')
             .fontColor(Color.Red)
         }
         .height('160lpx')
         .width('50%')
         .margin({ left: '20lpx' })
         .alignItems(HorizontalAlign.Start)

         Image(this.goodsItem.imgSrc)
           .objectFit(ImageFit.ScaleDown)
           .height('160lpx')
           .width('40%')
           .renderMode(ImageRenderMode.Original)
           .margin({ right: '20lpx', left: '20lpx' })

       }
       .height('180lpx')
       .alignItems(VerticalAlign.Center)
       .backgroundColor(Color.White)
     }
     .params({ goodsItem: this.goodsItem ,ShoppingCartsGoods:this.ShoppingCartsGoods})
     .margin({ left: '40lpx' })
   }
   // 转场动画使用系统提供的多种默认效果(平移、缩放、透明度等)
 pageTransition() {
   PageTransitionEnter({ duration: 1000 })
     .slide(SlideEffect.Left)
   PageTransitionExit({ duration: 1000  })
     .slide(SlideEffect.Right)
 }
</code></pre> 
<h6><a id="22_132"></a>2.2底部导航栏</h6> 
<p>1）通过 <code>Row</code> 包裹三个 <code>Image</code> 组件，并添加<code>onClick</code> 点击事件，修改 <code>@Consume</code> 修饰的变量，从而改变 <code>@Provide</code> 装饰的变量，再通过条件渲染展示不同的页面内容；</p> 
<pre><code>Flex() {
        Image(this.iconPath[0])
          .objectFit(ImageFit.Cover)
          .height('60lpx')
          .width('60lpx')
          .margin({left:'50lpx',right:'40lpx'})
          .onClick(() =&gt; {
            this.iconPath[0] = this.iconPathSelectsTmp[0]
            this.iconPath[1] = this.iconPathTmp[1]
            this.iconPath[2] = this.iconPathTmp[2]
            this.currentPage = 1
          })
        Image(this.iconPath[1])
          .objectFit(ImageFit.Cover)
          .height('60lpx')
          .width('60lpx')
          .margin({left:'40lpx',right:'40lpx'})
          .onClick(() =&gt; {
            this.iconPath[0] = this.iconPathTmp[0]
            this.iconPath[1] = this.iconPathSelectsTmp[1]
            this.iconPath[2] = this.iconPathTmp[2]
            this.currentPage = 2
            this.remoteData.putData("shopping_cart", this.ShoppingCartsGoods)
          })
        Image(this.iconPath[2])
          .objectFit(ImageFit.Cover)
          .height('60lpx')
          .width('60lpx')
          .margin({left:'40lpx',right:'50lpx'})
          .onClick(() =&gt; {
            this.iconPath[0] = this.iconPathTmp[0]
            this.iconPath[1] = this.iconPathTmp[1]
            this.iconPath[2] = this.iconPathSelectsTmp[2]
            this.currentPage = 3
          })
      }
    .margin({top:'20lpx'})
    }
      
      Column() {
          if (this.currentPage == 1) {
            Flex({ direction: FlexDirection.Row, justifyContent: FlexAlign.End }) {
              Image($r("app.media.icon_share"))
                .objectFit(ImageFit.Cover)
                .height('60lpx')
                .width('60lpx')
            }
            .width("100%")
            .margin({ top: '20lpx', right: '50lpx' })
            .onClick(() =&gt; {
              this.playerDialog.open()
            })

            GoodsHome({ goodsItems: this.goodsItems})
          }
          else if (this.currentPage == 3) {
            //我的
            MyInfo()
          }
        }
</code></pre> 
<h5><a id="3__199"></a>3. 编写商品详细页面</h5> 
<h6><a id="31_201"></a>3.1顶部滑动组件</h6> 
<p>1）滑动容器，提供切换子组件显示的能力；</p> 
<pre><code>Swiper() {
        ForEach(this.detailImages, item =&gt; {
          Image(item)
            .height('400lpx')
            .width('100%')
        })
      }
      .index(0)
      .autoPlay(true)
      .interval(3000)
      .indicator(true)
      .loop(true)
      .height('440lpx')
      .width('100%')
</code></pre> 
<h6><a id="32__222"></a>3.2 自定义弹框</h6> 
<p>1）通过 <strong>@CustomDialog</strong>装饰器来创建自定义弹窗，使用方式可参考 <code>自定义弹窗</code>；</p> 
<p>2）规则弹窗效果如下，弹窗组成由两个 <code>Text</code> 和两个 <code>Button</code> 竖向排列组成;</p> 
<p>所有我们可以在build()下使用 <code>Flex</code> 容器来包裹，组件代码如下：</p> 
<pre><code>@CustomDialog
struct CustomDialogExample {
  controller: CustomDialogController
  cancel: () =&gt; void
  confirm: () =&gt; void
  ShoppingCartsGoods: any[]

  build() {
    Flex() {
      Flex({ direction: FlexDirection.Column, justifyContent: FlexAlign.Center, alignItems: ItemAlign.Center }) {
        Text('加入购物车成功')
          .fontColor("#000000")
          .fontSize('40lpx')
          .margin({ top: '20lpx', bottom: "20lpx" })

        Flex({ justifyContent: FlexAlign.SpaceAround }) {
          Button('取消')
            .onClick(() =&gt; {
              this.controller.close()
              this.cancel()
            }).backgroundColor(0xffffff).fontColor(Color.Black)
          Button('确定')
            .onClick(() =&gt; {
              this.controller.close()
              this.confirm()
            }).backgroundColor(0xffffff).fontColor(Color.Red)
        }.margin({ bottom: "20lpx" })
      }
    }
    .height('200lpx')
  }
}
</code></pre> 
<p>​3）在@entry创建CustomDialogController对象并传入弹窗所需参数，后面可通过该对象open()和close()方法进行打开和关闭弹窗；</p> 
<pre><code>dialogController: CustomDialogController = new CustomDialogController({
    builder: CustomDialogExample({
      cancel: this.onCancel,
      confirm: this.onAccept,
      ShoppingCartsGoods: this.ShoppingCartsGoods
    }),
    cancel: this.existApp,
    autoCancel: true
  })
  onCancel() {
    CommonLog.info('Callback when the first button is clicked')
  }

  onAccept() {
    CommonLog.info('Callback when the second button is clicked')
    router.push({
      uri: "pages/HomePage",
      params: { dataList: this.ShoppingCartsGoods }
    })
  }

  existApp() {
    CommonLog.info('Click the callback in the blank area')
  }
</code></pre> 
<h5><a id="4__294"></a>4. 添加分布式流转</h5> 
<p>分布式流转需要在同一网络下通过 <code>DeviceManager组件</code> 进行设备间发现和认证，获取到可信设备的deviceId调用 <strong>featureAbility.startAbility</strong> ，即可把应用程序流转到另一设备。</p> 
<p>1）创建DeviceManager实例；</p> 
<p>2）调用实例的startDeviceDiscovery()，开始设备发现未信任设备；</p> 
<p>3）设置设备状态监听on(‘deviceFound’，callback),获取到未信任设备，并用discoverList变量进行维护；</p> 
<p>4）传入未信任设备参数，调用实例authenticateDevice方法，对设备进行PIN码认证；</p> 
<p>5）若是已信任设备，可通过实例的getTrustedDeviceListSync()方法来获取设备信息；</p> 
<p>6）将设备信息中的deviceId传入 `featureAbility.startAbility方法，实现流转；</p> 
<p>7）流转接收方可通过 featureAbility.getWant()获取到发送方携带的数据；</p> 
<p><strong>项目中将上面设备管理封装至RemoteDeviceManager，通过RemoteDeviceManager的四个方法来动态维护deviceList设备信息列表，实现分布式流转只需要在deviceList中获取deviceId，然后调用featureAbility.startAbility并携带数据，即可实现分布式流转。</strong></p> 
<p><img src="https://images2.imgbox.com/07/35/wrD0d2Wt_o.png" alt=""></p> 
<h5><a id="5_316"></a>5.分布式数据管理</h5> 
<p><code>分布式数据管理</code> 要求两个或多个设备在同一网络,才能监听到数据库的改变，从而渲染页面；开发步骤：</p> 
<p>1）创建一个KVManager对象实例，用于管理数据库对象；</p> 
<p>2）通过指定Options和storeId，创建并获取KVStore数据库，如下是参数说明；需要先通过createKVManager构建一个KVManager实例；</p> 
<table><thead><tr><th>参数名</th><th>类型</th><th>必填</th><th>说明</th></tr></thead><tbody><tr><td>storeId</td><td>string</td><td>是</td><td>数据库唯一标识符，长度不大于 MAX_STORE_ID_LENGTH。</td></tr><tr><td>options</td><td>Options</td><td>是</td><td>创建KVStore实例的配置信息。</td></tr></tbody></table> 
<p>3）KVStore数据库实例， KVStore.put提供增加数据的方法，如下是参数说明；</p> 
<table><thead><tr><th>参数名</th><th>类型</th><th>必填</th><th>说明</th></tr></thead><tbody><tr><td>key</td><td>string</td><td>是</td><td>要添加数据的key，不能为空且长度不大于 MAX_KEY_LENGTH 。</td></tr><tr><td>value</td><td>Uint8Array</td><td>string</td><td>number</td></tr><tr><td>callback</td><td>AsyncCallback</td><td>是</td><td>回调函数。</td></tr></tbody></table> 
<p>4） KVStore数据库实例，KVStore.on订阅指定类型的数据变更通知；一般监听远端设备变化，再进行相应操作达到分布式数据共享的效果；</p> 
<p><strong>本d项目通过storeId 值不同，创建了两个数据库，分别是ShoppingCartsInfo类和TotalData类，ShoppingCartsInfo应用添加商品到购物车，TotalData应用在购物车列表进行勾选结算；如下是TotalData类流程</strong></p> 
<p><img src="https://images2.imgbox.com/61/f7/PCIh25yU_o.png" alt=""></p> 
<p><strong>如下是ShoppingCartsInfo类流程</strong></p> 
<p><img src="https://images2.imgbox.com/05/14/DygyZheH_o.png" alt=""></p> 
<h4><a id="_347"></a>项目下载和导入</h4> 
<p>1）git下载</p> 
<pre><code>git clone https://gitee.com/openharmony-sig/knowledge_demo_shopping.git  --depth=1
</code></pre> 
<p>2）项目导入</p> 
<p>打开DevEco Studio,点击File-&gt;Open-&gt;下载路径/FA/Shopping/DistributedShoppingCart</p> 
<p><strong>为了能让大家更好的学习鸿蒙（HarmonyOS NEXT）开发技术，这边特意整理了《鸿蒙开发学习手册》（共计890页），希望对大家有所帮助：<a href="https://qr21.cn/FV7h05" rel="nofollow"><code>https://qr21.cn/FV7h05</code></a></strong></p> 
<h4><a id="httpsqr21cnFV7h05httpsqr21cnFV7h05_361"></a>《鸿蒙开发学习手册》：<a href="https://qr21.cn/FV7h05" rel="nofollow"><code>https://qr21.cn/FV7h05</code></a></h4> 
<p><strong>入门必看：<a href="https://qr21.cn/FV7h05" rel="nofollow"><code>https://qr21.cn/FV7h05</code></a></strong><br> 1.  应用开发导读(ArkTS)<br> 2.  ……</p> 
<p><img src="https://images2.imgbox.com/ac/87/rme84VbM_o.png" alt=""></p> 
<p><strong>HarmonyOS 概念：<a href="https://qr21.cn/FV7h05" rel="nofollow"><code>https://qr21.cn/FV7h05</code></a></strong></p> 
<ol><li>系统定义</li><li>技术架构</li><li>技术特性</li><li>系统安全</li></ol> 
<p><img src="https://images2.imgbox.com/50/e8/w3e4I9cO_o.png" alt=""></p> 
<p><strong>如何快速入门：<a href="https://qr21.cn/FV7h05" rel="nofollow"><code>https://qr21.cn/FV7h05</code></a></strong><br> 1.  基本概念<br> 2.  构建第一个ArkTS应用<br> 3.  构建第一个JS应用<br> 4.  ……</p> 
<p><img src="https://images2.imgbox.com/2d/b3/pQoKIl0f_o.png" alt=""></p> 
<p><strong>开发基础知识：<a href="https://qr21.cn/FV7h05" rel="nofollow"><code>https://qr21.cn/FV7h05</code></a></strong><br> 1.  应用基础知识<br> 2.  配置文件<br> 3.  应用数据管理<br> 4.  应用安全管理<br> 5.  应用隐私保护<br> 6.  三方应用调用管控机制<br> 7.  资源分类与访问<br> 8.  学习ArkTS语言<br> 9.  ……</p> 
<p><img src="https://images2.imgbox.com/cc/f5/fX3fLoqD_o.png" alt=""></p> 
<p><strong>基于ArkTS 开发：<a href="https://qr21.cn/FV7h05" rel="nofollow"><code>https://qr21.cn/FV7h05</code></a></strong><br> 1.  Ability开发<br> 2.  UI开发<br> 3.  公共事件与通知<br> 4.  窗口管理<br> 5.  媒体<br> 6.  安全<br> 7.  网络与链接<br> 8.  电话服务<br> 9.  数据管理<br> 10.  后台任务(Background Task)管理<br> 11.  设备管理<br> 12.  设备使用信息统计<br> 13.  DFX<br> 14.  国际化开发<br> 15.  折叠屏系列<br> 16.  ……</p> 
<p><img src="https://images2.imgbox.com/dc/89/WlTDyPF4_o.png" alt=""></p> 
<h3><a id="httpsqr21cnFV7h05httpsqr21cnFV7h05_419"></a>鸿蒙开发面试真题（含参考答案）：<a href="https://qr21.cn/FV7h05" rel="nofollow"><code>https://qr21.cn/FV7h05</code></a></h3> 
<p><img src="https://images2.imgbox.com/58/2a/XnCD2kFu_o.png" alt=""></p> 
<h3><a id="_423"></a>结语</h3> 
<p>不久前，华为在致敬鸿蒙开发者公开信中表示：</p> 
<p>“HarmonyOS 的辉煌属于每一位辛勤耕耘的开发者，你们是 HarmonyOS 走向成功的奠基者，更是信息技术产业繁荣发展的先行者。”</p> 
<p>事实上，鸿蒙系统生态能够在问世至今不到五年的时间里迅速壮大，并且在今年勇敢地迈向“纯原生”的新阶段，华为对开发人才的重视，可列为最重要的因素之一。如今就业市场上鸿蒙人才被“爆抢”，何尝不是行业规律对华为重视人才的一种“回报”？</p> 
<p>而让每一位开发人才都能够发光发亮，才能走出全新的生态之路，从而更进一步点亮我国信息技术产业发展的前路。#春招鸿蒙岗位需求是去年近3倍# #鸿蒙程序员平均月薪超1万8</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/da098afc70573361b8d65ef732708c0a/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">单片机精进之路-5矩阵键盘扫描</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/2d46d06554f4b6a4402ace305621785d/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">【机器学习科学库】全md文档笔记：Matplotlib详细使用方法（已分享，附代码）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 追风少年的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>