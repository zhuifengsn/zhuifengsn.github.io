<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>全局异常捕获工具类 - 追风少年的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="全局异常捕获工具类" />
<meta property="og:description" content="package com.test.commons.exception; import com.alibaba.fastjson.JSONObject; import com.epro.commons.response.ArgumentCode; import com.epro.commons.response.ResponseResult; import lombok.extern.slf4j.Slf4j; import org.springframework.util.StringUtils; import org.springframework.validation.BindException; import org.springframework.validation.BindingResult; import org.springframework.validation.FieldError; import org.springframework.validation.ObjectError; import org.springframework.web.bind.MethodArgumentNotValidException; import org.springframework.web.bind.annotation.ExceptionHandler; import org.springframework.web.bind.annotation.RestControllerAdvice; import javax.validation.ConstraintViolation; import javax.validation.ConstraintViolationException; import java.util.*; /** * @author * @description: TODO * @date 2021/11/3 10:43 */ @RestControllerAdvice @Slf4j public class RestExceptionHandler { /** * 处理Get请求的验证异常 * * @param result * @return com.flyduck.cms.vo.ApiResult */ @ExceptionHandler(BindException.class) public ResponseResult bindExceptionHandle(BindingResult result) { if (result.hasErrors()) { List&lt;ObjectError&gt; errors = result." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://zhuifengsn.github.io/posts/422b3afb5e5ae9f5151fa38921916e60/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-08-24T14:38:14+08:00" />
<meta property="article:modified_time" content="2022-08-24T14:38:14+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="追风少年的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">追风少年的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">全局异常捕获工具类</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <pre>package com.test.commons.exception;

import com.alibaba.fastjson.JSONObject;
import com.epro.commons.response.ArgumentCode;
import com.epro.commons.response.ResponseResult;
import lombok.extern.slf4j.Slf4j;
import org.springframework.util.StringUtils;
import org.springframework.validation.BindException;
import org.springframework.validation.BindingResult;
import org.springframework.validation.FieldError;
import org.springframework.validation.ObjectError;
import org.springframework.web.bind.MethodArgumentNotValidException;
import org.springframework.web.bind.annotation.ExceptionHandler;
import org.springframework.web.bind.annotation.RestControllerAdvice;

import javax.validation.ConstraintViolation;
import javax.validation.ConstraintViolationException;
import java.util.*;

/**
 * @author 
 * @description: TODO
 * @date 2021/11/3 10:43
 */
@RestControllerAdvice
@Slf4j
public class RestExceptionHandler {


    /**
     * 处理Get请求的验证异常
     *
     * @param result
     * @return com.flyduck.cms.vo.ApiResult
     */
    @ExceptionHandler(BindException.class)
    public ResponseResult bindExceptionHandle(BindingResult result) {

        if (result.hasErrors()) {
            List&lt;ObjectError&gt; errors = result.getAllErrors();
          /*  List&lt;String&gt; list = new ArrayList&lt;&gt;();
            errors.forEach(p -&gt;{
                FieldError fieldError = (FieldError) p;
                list.add(fieldError.getDefaultMessage());
            });*/
            HashSet&lt;ObjectError&gt; set = new HashSet&lt;&gt;(errors);
            if (!errors.isEmpty() &amp;&amp; !StringUtils.isEmpty(set.iterator().next().getDefaultMessage())) {
                return new ResponseResult(false, ArgumentCode.PARAMS_ERROR.getCode(), set.iterator().next().getDefaultMessage(), null);
            }

        }

        return new ResponseResult(ArgumentCode.PARAMS_ERROR);
    }

    /**
     * 处理Post请求的验证异常
     *
     * @param exception
     * @return com.flyduck.cms.vo.ApiResult
     */
    @ExceptionHandler(MethodArgumentNotValidException.class)
    public ResponseResult methodArgumentNotValidHandler(MethodArgumentNotValidException exception) {

        BindingResult result = exception.getBindingResult();
        if (result != null &amp;&amp; result.hasErrors()) {
            List&lt;ObjectError&gt; errors = result.getAllErrors();
            Set&lt;ObjectError&gt; set=new HashSet&lt;&gt;(errors);
            //ArrayList&lt;ObjectError&gt; objectErrors = new ArrayList&lt;&gt;(set);
            // 出现参数校验异常时,只需抛出第一条即可
            FieldError fieldError = (FieldError) set.iterator().next();
            if (!errors.isEmpty() &amp;&amp; !StringUtils.isEmpty(fieldError.getDefaultMessage())) {
                int errorCode = ArgumentCode.PARAMS_ERROR.getCode();
                String msg =  fieldError.getDefaultMessage();
                return new ResponseResult(false, errorCode, msg, null);
            }

        }

        return new ResponseResult(ArgumentCode.PARAMS_ERROR);
    }

    /**
     * 处理请求参数格式的验证异常
     *
     * @param exception
     * @return com.flyduck.cms.vo.ApiResult
     */
    @ExceptionHandler(ConstraintViolationException.class)
    public ResponseResult constraintViolationHandler(ConstraintViolationException exception) {
        Set&lt;ConstraintViolation&lt;?&gt;&gt; violations = exception.getConstraintViolations();
        if (violations.size() &gt; 0) {
            List&lt;String&gt; list = new ArrayList&lt;&gt;();
            for (ConstraintViolation&lt;?&gt; violation : violations) {
                list.add(violation.getMessage());
            }
            if (!list.isEmpty()) {
                return new ResponseResult(false, ArgumentCode.PARAMS_ERROR.getCode(), list.get(0), null);
            }
        }

        return new ResponseResult(ArgumentCode.PARAMS_ERROR);
    }

    @ExceptionHandler(CustomException.class)
    public ResponseResult exception(Exception e) {
        log.error("---------------------error:{}-------------------------", e.getMessage());
        Map map = JSONObject.parseObject(e.getMessage(), Map.class);
        return ResponseResult.create().msg((Integer) map.get("code"), (String) map.get("msg")).success((Boolean) map.get("success"));
    }

}
</pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/f9180de082d4b12297e8029e73b1c84a/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">LCD1602液晶显示屏</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/cc71b136013ea96c048ff26e87ca7c99/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">实现validation注解进行校验枚举值工具类</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 追风少年的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>