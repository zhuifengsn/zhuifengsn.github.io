<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>关于springboot集成activiti6.0 - 追风少年的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="关于springboot集成activiti6.0" />
<meta property="og:description" content="自学了一段时间的activiti，发现网上有很多的demo都用不起。找了很多，都比较失望。所以今天自己写一个简单的基于springboot的activiti项目。
ok，开始
首先，我们需要先创建一个springboot项目。下面这个pom依赖。
&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-data-jpa&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;com.alibaba&lt;/groupId&gt; &lt;artifactId&gt;druid&lt;/artifactId&gt; &lt;version&gt;1.1.9&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.activiti&lt;/groupId&gt; &lt;artifactId&gt;activiti-spring-boot-starter-basic&lt;/artifactId&gt; &lt;version&gt;6.0.0&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;com.google.guava&lt;/groupId&gt; &lt;artifactId&gt;guava&lt;/artifactId&gt; &lt;version&gt;24.0-jre&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;mysql&lt;/groupId&gt; &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt; &lt;version&gt;5.1.41&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.projectlombok&lt;/groupId&gt; &lt;artifactId&gt;lombok&lt;/artifactId&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;/dependency&gt; 这里注意一下 ，mysql的依赖包不应版本太高，否则无法自动建表。
然后在启动类上面加上这句话
@SpringBootApplication(exclude = SecurityAutoConfiguration.class) 接下来创建我们自己的流程文件，
在resource下面创建一个文件夹来存放对应的文件，当然这个命名随你喜好。
然后在配置文件里面加上
spring.datasource.type=com.alibaba.druid.pool.DruidDataSource spring.datasource.driver-class-name=com.mysql.jdbc.Driver spring.datasource.url=jdbc:mysql:///activitidb?serverTimezone=GMT%2B8 spring.datasource.username=root spring.datasource.password=123456 spring.jpa.hibernate.ddl-auto=update spring.jpa.show-sql=true #spring.activiti.history-level=full spring.activiti.database-schema-update=true #spring.activiti.check-process-definitions=false spring.activiti.process-definition-location-prefix=classpath:/processes/ 最后，来写一段简单的代码
private static final Logger LOGGER = LoggerFactory.getLogger(UserServiceImpl.class); @Autowired private IdentityService identityService; @Autowired private RuntimeService runtimeService; @Autowired private TaskService taskService; @Autowired private FormService formService; @Override public String submitMsg() { // identityService." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://zhuifengsn.github.io/posts/7413b73ae2a514655501d2102720bf8f/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2019-02-28T11:13:59+08:00" />
<meta property="article:modified_time" content="2019-02-28T11:13:59+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="追风少年的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">追风少年的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">关于springboot集成activiti6.0</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>自学了一段时间的activiti，发现网上有很多的demo都用不起。找了很多，都比较失望。所以今天自己写一个简单的基于springboot的activiti项目。</p> 
<p>ok，开始</p> 
<p>首先，我们需要先创建一个springboot项目。下面这个pom依赖。</p> 
<pre><code class="language-html hljs">&lt;dependency&gt;
    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
    &lt;artifactId&gt;spring-boot-starter-data-jpa&lt;/artifactId&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
    &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;
&lt;/dependency&gt;

&lt;dependency&gt;
    &lt;groupId&gt;com.alibaba&lt;/groupId&gt;
    &lt;artifactId&gt;druid&lt;/artifactId&gt;
    &lt;version&gt;1.1.9&lt;/version&gt;
&lt;/dependency&gt;

&lt;dependency&gt;
    &lt;groupId&gt;org.activiti&lt;/groupId&gt;
    &lt;artifactId&gt;activiti-spring-boot-starter-basic&lt;/artifactId&gt;
    &lt;version&gt;6.0.0&lt;/version&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
    &lt;groupId&gt;com.google.guava&lt;/groupId&gt;
    &lt;artifactId&gt;guava&lt;/artifactId&gt;
    &lt;version&gt;24.0-jre&lt;/version&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
    &lt;groupId&gt;mysql&lt;/groupId&gt;
    &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;
    &lt;version&gt;5.1.41&lt;/version&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
    &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;
    &lt;artifactId&gt;lombok&lt;/artifactId&gt;
    &lt;optional&gt;true&lt;/optional&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
    &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;
    &lt;scope&gt;test&lt;/scope&gt;
&lt;/dependency&gt;</code></pre> 
<p>这里注意一下 ，mysql的依赖包不应版本太高，否则无法自动建表。</p> 
<p>然后在启动类上面加上这句话</p> 
<pre><code class="language-html hljs">@SpringBootApplication(exclude = SecurityAutoConfiguration.class)
</code></pre> 
<p> </p> 
<p>接下来创建我们自己的流程文件，</p> 
<p><img alt="" class="has" height="96" src="https://images2.imgbox.com/38/2d/8BnPgUsj_o.png" width="390"></p> 
<p>在resource下面创建一个文件夹来存放对应的文件，当然这个命名随你喜好。</p> 
<p> </p> 
<p>然后在配置文件里面加上</p> 
<pre><code class="language-html hljs">spring.datasource.type=com.alibaba.druid.pool.DruidDataSource
spring.datasource.driver-class-name=com.mysql.jdbc.Driver
spring.datasource.url=jdbc:mysql:///activitidb?serverTimezone=GMT%2B8
spring.datasource.username=root
spring.datasource.password=123456
spring.jpa.hibernate.ddl-auto=update
spring.jpa.show-sql=true


#spring.activiti.history-level=full
spring.activiti.database-schema-update=true
#spring.activiti.check-process-definitions=false
spring.activiti.process-definition-location-prefix=classpath:/processes/

</code></pre> 
<p>最后，来写一段简单的代码</p> 
<pre><code class="language-html hljs">private static final Logger LOGGER = LoggerFactory.getLogger(UserServiceImpl.class);

@Autowired
private IdentityService identityService;

@Autowired
private RuntimeService runtimeService;

@Autowired
private TaskService taskService;


@Autowired
private FormService formService;

@Override
public String submitMsg() {
   // identityService.setAuthenticatedUserId("zhangsan");
    //获取当前执行的流程任务
    ProcessInstance processInstance = runtimeService.startProcessInstanceByKey("my-process");
    Task task = taskService.createTaskQuery().processInstanceId(processInstance.getId()).singleResult();
    LOGGER.info("task1 name = {}",task.getName());

    //完成第一个任务，为了让得到下面的usertask
    taskService.complete(task.getId());

    //获取当前处理人的节点
    List&lt;Task&gt; list = taskService.createTaskQuery()
            .processDefinitionKey("my-process")
            .taskCandidateUser("user1").list();
    for(Task task1:list)
    {
        LOGGER.info("user1处理的任务 = {}",task1.getName());
    }

    return null;
}</code></pre> 
<p>ok，然后在去访问对应的地址即可，控制层的代码我就不贴出来了  没什么意义。你也可以把这个写在单元测试类里面，还有就是我比较习惯手写一些简单的流程配置。所以格式是bpmn20.xml格式。</p> 
<p>最后，是对应的流程文件</p> 
<pre>&lt;?xml version="1.0" encoding="UTF-8"?&gt;

&lt;definitions xmlns="http://www.omg.org/spec/BPMN/20100524/MODEL"
   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:activiti="http://activiti.org/bpmn"
   xmlns:bpmndi="http://www.omg.org/spec/BPMN/20100524/DI" xmlns:omgdc="http://www.omg.org/spec/DD/20100524/DC"
   xmlns:omgdi="http://www.omg.org/spec/DD/20100524/DI" typeLanguage="http://www.w3.org/2001/XMLSchema"
   expressionLanguage="http://www.w3.org/1999/XPath" targetNamespace="http://www.activiti.org/test"&gt;

   &lt;process id="my-process"&gt;

      &lt;startEvent id="start" /&gt;

      &lt;sequenceFlow id="flow1" sourceRef="start" targetRef="someTask1" /&gt;

      &lt;userTask id="someTask1" name="User Task1"/&gt;   &lt;!--activiti:candidateGroups 候选组  activiti:candidateUsers 候选人--&gt;

      &lt;sequenceFlow id="flow2" sourceRef="someTask1" targetRef="someTask2" /&gt;


      &lt;userTask id="someTask2" name="User Task2"
              activiti:candidateGroups="group1"
              activiti:candidateUsers="user1,user2" /&gt;   &lt;!--activiti:candidateGroups 候选组  activiti:candidateUsers 候选人--&gt;

      &lt;sequenceFlow id="flow3" sourceRef="someTask2" targetRef="end" /&gt;

      &lt;endEvent id="end" /&gt;

   &lt;/process&gt;

&lt;/definitions&gt;</pre> 
<p> </p> 
<p> </p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/d39670f9d5d01e56af4477592893b526/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">数据结构实验 实验3 二叉树的遍历</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/21d70557a8a7dfa44846847b5407773e/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">算法学习笔记（使用追赶法解三对角方程组）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 追风少年的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>