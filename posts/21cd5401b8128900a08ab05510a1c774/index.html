<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>WPF 附加属性&#43;控件模板，完成自定义控件。建议观看HandyControl源码 - 追风少年的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="WPF 附加属性&#43;控件模板，完成自定义控件。建议观看HandyControl源码" />
<meta property="og:description" content="文章目录 相关连接前言需要实现的效果附加属性添加附加属性，以Test修改FontSize为例依赖属性使用触发器使用直接操控 结论 控件模板，在HandyControl的基础上面进行修改参考HandyControl的源码控件模板原型控件模板 结论 相关连接 WPF控件模板(6)
WPF 附加属性
WPF教程：附加属性
前言 今天说服了领导用WPF开发前端，原因就是开发相对来说比较方便，写小项目就不用前后端分离什么的了。反正就是有个机会写WPF了，真开心。我已经写了一年的Uniapp了
需要实现的效果 就是想写一个简单的变色控件。
附加属性 如果想知道附加属性，就得先了解依赖属性。详细的可以看我这篇文章
WPF 用户控件依赖属性赋值
添加附加属性，以Test修改FontSize为例 知道了依赖属性之后，我解释一下附加属性是什么意思。附加属性就是为了方便在原有的控件基础上面进行细微的修改。我们先保证编译通过
附加属性的快捷键是propa
简单给TextBox添加一个附加属性
public partial class TextBlockExtension { public static int GetTest(DependencyObject obj) { return (int)obj.GetValue(TestProperty); } public static void SetTest(DependencyObject obj, int value) { obj.SetValue(TestProperty, value); } // Using a DependencyProperty as the backing store for Test. This enables animation, styling, binding, etc... public static readonly DependencyProperty TestProperty = DependencyProperty." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://zhuifengsn.github.io/posts/21cd5401b8128900a08ab05510a1c774/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-02-26T17:39:56+08:00" />
<meta property="article:modified_time" content="2024-02-26T17:39:56+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="追风少年的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">追风少年的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">WPF 附加属性&#43;控件模板，完成自定义控件。建议观看HandyControl源码</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#_2" rel="nofollow">相关连接</a></li><li><a href="#_9" rel="nofollow">前言</a></li><li><a href="#_12" rel="nofollow">需要实现的效果</a></li><li><a href="#_17" rel="nofollow">附加属性</a></li><li><ul><li><a href="#TestFontSize_23" rel="nofollow">添加附加属性，以Test修改FontSize为例</a></li><li><a href="#_59" rel="nofollow">依赖属性使用</a></li><li><ul><li><a href="#_63" rel="nofollow">触发器使用</a></li><li><a href="#_97" rel="nofollow">直接操控</a></li></ul> 
   </li><li><a href="#_132" rel="nofollow">结论</a></li></ul> 
  </li><li><a href="#HandyControl_137" rel="nofollow">控件模板，在HandyControl的基础上面进行修改</a></li><li><ul><li><a href="#HandyControl_144" rel="nofollow">参考HandyControl的源码</a></li><li><a href="#_181" rel="nofollow">控件模板原型</a></li><li><a href="#_217" rel="nofollow">控件模板</a></li></ul> 
  </li><li><a href="#_316" rel="nofollow">结论</a></li></ul> 
</div> 
<p></p> 
<h2><a id="_2"></a>相关连接</h2> 
<blockquote> 
 <p><a href="https://www.cnblogs.com/zh7791/p/11421386.html" rel="nofollow">WPF控件模板(6)</a></p> 
</blockquote> 
<blockquote> 
 <p><a href="https://www.cnblogs.com/LXLR/p/15642635.html#:~:text=1%20WPF%E4%B8%AD%EF%BC%8C%E9%99%84%E5%8A%A0%E5%B1%9E%E6%80%A7%E7%BB%8F%E5%B8%B8%E7%94%A8%E4%BA%8E%E6%8E%A7%E4%BB%B6%E5%B1%9E%E6%80%A7%E3%80%82%202,%E9%99%84%E5%8A%A0%E5%B1%9E%E6%80%A7%E6%98%AF%E4%B8%80%E7%A7%8D%E4%BE%9D%E8%B5%96%E5%B1%9E%E6%80%A7%EF%BC%8C%E4%B8%8E%E4%BE%9D%E8%B5%96%E5%B1%9E%E6%80%A7%E4%B8%8D%E5%90%8C%E7%9A%84%E6%98%AF%EF%BC%8C%E9%99%84%E5%8A%A0%E5%B1%9E%E6%80%A7%E8%A2%AB%E5%BA%94%E7%94%A8%E7%9A%84%E7%B1%BB%E4%B8%8D%E6%98%AF%E5%AE%9A%E4%B9%89%E9%99%84%E5%8A%A0%E5%B1%9E%E6%80%A7%E7%9A%84%E7%B1%BB%E3%80%82%20%E5%8D%B3%E7%BB%99%E4%BB%BB%E4%BD%95%E9%9C%80%E8%A6%81%E7%9A%84%E6%8E%A7%E4%BB%B6%EF%BC%88%E7%B1%BB%EF%BC%89%E6%8F%90%E4%BE%9B%E8%AF%A5%E5%B1%9E%E6%80%A7%E7%9A%84%E4%BD%BF%E7%94%A8%E5%85%A5%E5%8F%A3%E3%80%82%203%20%E6%9F%90%E4%B8%AA%E4%BE%9D%E8%B5%96%E5%B1%9E%E6%80%A7%E6%9C%AC%E6%9D%A5%E4%B8%8D%E5%B1%9E%E4%BA%8E%E6%9F%90%E4%B8%AA%E5%AF%B9%E8%B1%A1%EF%BC%8C%E4%BD%86%E7%94%B1%E4%BA%8E%E6%9F%90%E7%A7%8D%E9%9C%80%E6%B1%82%EF%BC%8C%E8%AF%A5%E5%AF%B9%E8%B1%A1%E9%9C%80%E8%A6%81%E8%BF%99%E4%B8%AA%E4%BE%9D%E8%B5%96%E5%B1%9E%E6%80%A7%EF%BC%8C%E8%BF%99%E6%97%B6%E5%B0%B1%E9%9C%80%E8%A6%81%E5%B0%86%E8%AF%A5%E4%BE%9D%E8%B5%96%E5%B1%9E%E6%80%A7%E5%AE%9A%E4%B9%89%E4%B8%BA%E9%99%84%E5%8A%A0%E5%B1%9E%E6%80%A7%E3%80%82" rel="nofollow">WPF 附加属性</a></p> 
</blockquote> 
<blockquote> 
 <p><a href="https://www.cnblogs.com/dotnet261010/p/6286976.html" rel="nofollow">WPF教程：附加属性</a></p> 
</blockquote> 
<h2><a id="_9"></a>前言</h2> 
<p>今天说服了领导用WPF开发前端，原因就是开发相对来说比较方便，写小项目就不用前后端分离什么的了。反正就是有个机会写WPF了，真开心。我已经写了一年的Uniapp了</p> 
<h2><a id="_12"></a>需要实现的效果</h2> 
<p>就是想写一个简单的变色控件。<br> <img src="https://images2.imgbox.com/98/23/ErVw9C6G_o.gif" alt="在这里插入图片描述"></p> 
<h2><a id="_17"></a>附加属性</h2> 
<p>如果想知道附加属性，就得先了解依赖属性。详细的可以看我这篇文章</p> 
<blockquote> 
 <p><a href="https://blog.csdn.net/qq_44695769/article/details/133888200?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522170892925716800197043620%2522%252C%2522scm%2522%253A%252220140713.130102334.pc%255Fblog.%2522%257D&amp;request_id=170892925716800197043620&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~blog~first_rank_ecpm_v1~rank_v31_ecpm-1-133888200-null-null.nonecase&amp;utm_term=%E4%BE%9D%E8%B5%96%E5%B1%9E%E6%80%A7&amp;spm=1018.2226.3001.4450">WPF 用户控件依赖属性赋值</a></p> 
</blockquote> 
<h3><a id="TestFontSize_23"></a>添加附加属性，以Test修改FontSize为例</h3> 
<p>知道了依赖属性之后，我解释一下附加属性是什么意思。附加属性就是为了方便在原有的控件基础上面进行细微的修改。我们先保证编译通过</p> 
<p>附加属性的快捷键是propa</p> 
<p>简单给TextBox添加一个附加属性</p> 
<pre><code class="prism language-csharp">    <span class="token keyword">public</span> <span class="token keyword">partial</span> <span class="token keyword">class</span> <span class="token class-name">TextBlockExtension</span>
    <span class="token punctuation">{<!-- --></span>



        <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> <span class="token function">GetTest</span><span class="token punctuation">(</span><span class="token class-name">DependencyObject</span> obj<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>obj<span class="token punctuation">.</span><span class="token function">GetValue</span><span class="token punctuation">(</span>TestProperty<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">SetTest</span><span class="token punctuation">(</span><span class="token class-name">DependencyObject</span> obj<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">int</span></span> <span class="token keyword">value</span><span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            obj<span class="token punctuation">.</span><span class="token function">SetValue</span><span class="token punctuation">(</span>TestProperty<span class="token punctuation">,</span> <span class="token keyword">value</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// Using a DependencyProperty as the backing store for Test.  This enables animation, styling, binding, etc...</span>
        <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">readonly</span> <span class="token class-name">DependencyProperty</span> TestProperty <span class="token operator">=</span>
            DependencyProperty<span class="token punctuation">.</span><span class="token function">RegisterAttached</span><span class="token punctuation">(</span><span class="token string">"Test"</span><span class="token punctuation">,</span> <span class="token keyword">typeof</span><span class="token punctuation">(</span><span class="token type-expression class-name"><span class="token keyword">int</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">typeof</span><span class="token punctuation">(</span><span class="token type-expression class-name">TextBox</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">PropertyMetadata</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        
    <span class="token punctuation">}</span>
</code></pre> 
<p>这样我们就能编译通过了。</p> 
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>TextBlock</span> <span class="token attr-name">Text</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>用户<span class="token punctuation">"</span></span>  <span class="token attr-name"><span class="token namespace">wpfEx:</span>TextBlockExtension.Test</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>2<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
</code></pre> 
<p><img src="https://images2.imgbox.com/dc/c4/tve1ALOy_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_59"></a>依赖属性使用</h3> 
<p>依赖属性有两种使用方法</p> 
<h4><a id="_63"></a>触发器使用</h4> 
<p>样式定义</p> 
<pre><code class="prism language-xml">    <span class="token comment">&lt;!--一个简单的FontSize修改--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Style</span> <span class="token attr-name"><span class="token namespace">x:</span>Key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>UserSelection<span class="token punctuation">"</span></span>
           <span class="token attr-name">TargetType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>TextBlock<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css">
        &lt;!--因为Triggers只有等于判断，所以这里简单写了一下--&gt;
        &lt;Style.Triggers&gt;
            &lt;Trigger Property=<span class="token string">"wpfEx:TextBlockExtension.Test"</span>
                     Value=<span class="token string">"10"</span>&gt;
                &lt;Setter Property=<span class="token string">"FontSize"</span>
                        Value=<span class="token string">"10"</span> /&gt;
            &lt;/Trigger&gt;
            &lt;Trigger Property=<span class="token string">"wpfEx:TextBlockExtension.Test"</span>
                     Value=<span class="token string">"20"</span>&gt;
                &lt;Setter Property=<span class="token string">"FontSize"</span>
                        Value=<span class="token string">"20"</span> /&gt;
            &lt;/Trigger&gt;
        &lt;/Style.Triggers&gt;
    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Style</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>简单使用</p> 
<pre><code class="prism language-xml"> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>TextBlock</span> <span class="token attr-name">Text</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>用户<span class="token punctuation">"</span></span>
            <span class="token attr-name"><span class="token namespace">wpfEx:</span>TextBlockExtension.Test</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>10<span class="token punctuation">"</span></span> <span class="token special-attr"><span class="token attr-name">Style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value css language-css"><span class="token punctuation">{<!-- --></span>StaticResource UserSelection<span class="token punctuation">}</span></span><span class="token punctuation">"</span></span></span><span class="token punctuation">&gt;</span></span>
     
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>TextBlock</span><span class="token punctuation">&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>TextBlock</span> <span class="token attr-name">Text</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>用户<span class="token punctuation">"</span></span>
            <span class="token attr-name"><span class="token namespace">wpfEx:</span>TextBlockExtension.Test</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>20<span class="token punctuation">"</span></span>
            <span class="token special-attr"><span class="token attr-name">Style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value css language-css"><span class="token punctuation">{<!-- --></span>StaticResource UserSelection<span class="token punctuation">}</span></span><span class="token punctuation">"</span></span></span><span class="token punctuation">&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>TextBlock</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p><img src="https://images2.imgbox.com/4e/e3/CYi5L3Ak_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_97"></a>直接操控</h4> 
<p>附加属性修改</p> 
<pre><code class="prism language-csharp"><span class="token comment">//如果想直接操控元素，得在PropertyMetadata进行操控。记得设置初始值</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">readonly</span> <span class="token class-name">DependencyProperty</span> TestProperty <span class="token operator">=</span>
    DependencyProperty<span class="token punctuation">.</span><span class="token function">RegisterAttached</span><span class="token punctuation">(</span><span class="token string">"Test"</span><span class="token punctuation">,</span> <span class="token keyword">typeof</span><span class="token punctuation">(</span><span class="token type-expression class-name"><span class="token keyword">int</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">typeof</span><span class="token punctuation">(</span><span class="token type-expression class-name">TextBox</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">PropertyMetadata</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> e<span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token comment">//s是控件本身，</span>
        <span class="token class-name"><span class="token keyword">var</span></span> mdp <span class="token operator">=</span> s <span class="token keyword">as</span> <span class="token class-name">TextBlock</span><span class="token punctuation">;</span>
        <span class="token comment">//如果控件是该元素的父组件，类似于Grid和DockPanel，就使用Parent来寻找，这里不展开</span>
        <span class="token comment">//var mdpParent = (s as FrameworkElement).Parent as TextBlock;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>mdp <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> e<span class="token punctuation">.</span>NewValue <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            mdp<span class="token punctuation">.</span>FontSize <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>e<span class="token punctuation">.</span>NewValue<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<pre><code class="prism language-xml"><span class="token comment">&lt;!--如果想要预览生效需要重新编译一下--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>TextBlock</span> <span class="token attr-name">Text</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>用户<span class="token punctuation">"</span></span>
           <span class="token attr-name"><span class="token namespace">wpfEx:</span>TextBlockExtension.Test</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>15<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>TextBlock</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>TextBlock</span> <span class="token attr-name">Text</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>用户<span class="token punctuation">"</span></span>
           <span class="token attr-name"><span class="token namespace">wpfEx:</span>TextBlockExtension.Test</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>20<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>TextBlock</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!--因为我们设置了默认值为10，所以这里是10--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>TextBlock</span> <span class="token attr-name">Text</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>用户<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>TextBlock</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!--优先级还是依赖属性高，所以这里是30而不是默认值10--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>TextBlock</span> <span class="token attr-name">Text</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>用户<span class="token punctuation">"</span></span> <span class="token attr-name">FontSize</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>30<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>TextBlock</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p><img src="https://images2.imgbox.com/84/cd/kk0kdvfm_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_132"></a>结论</h3> 
<p>附加属性和依赖属性差不多，就是声明麻烦一点。因为Get,Set是需要额外写的。</p> 
<h2><a id="HandyControl_137"></a>控件模板，在HandyControl的基础上面进行修改</h2> 
<p>控件模板一般用于按钮，我们只要会按钮的控件模板就可以了。</p> 
<blockquote> 
 <p><a href="https://www.cnblogs.com/zh7791/p/11421386.html" rel="nofollow">WPF控件模板(6)</a></p> 
</blockquote> 
<h3><a id="HandyControl_144"></a>参考HandyControl的源码</h3> 
<blockquote> 
 <p><a href="https://handyorg.github.io/handycontrol/tnx/" rel="nofollow">HandyControl 页面</a></p> 
</blockquote> 
<p>HandyControl的Button有IconButton的样式源码。看一下还是挺有收获的。</p> 
<p><img src="https://images2.imgbox.com/62/f5/jRVLrAHC_o.png" alt="在这里插入图片描述"><br> 参考样式代码</p> 
<pre><code class="prism language-xml"> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Style</span> <span class="token attr-name"><span class="token namespace">x:</span>Key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ButtonDashedBaseStyle<span class="token punctuation">"</span></span> <span class="token attr-name">BasedOn</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{StaticResource ButtonBaseStyle}<span class="token punctuation">"</span></span> <span class="token attr-name">TargetType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Button<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css">
     &lt;Setter Property=<span class="token string">"Background"</span> Value=<span class="token string">"Transparent"</span>/&gt;
     &lt;Setter Property=<span class="token string">"Template"</span>&gt;
         &lt;Setter.Value&gt;
             &lt;ControlTemplate TargetType=<span class="token string">"Button"</span>&gt;
                 &lt;<span class="token property">hc</span><span class="token punctuation">:</span>DashedBorder BorderDashArray=<span class="token string">"3,2"</span> BorderThickness=<span class="token string">"{TemplateBinding BorderThickness}"</span> BorderBrush=<span class="token string">"{TemplateBinding BorderBrush}"</span> Background=<span class="token string">"Transparent"</span> CornerRadius=<span class="token string">"{Binding Path=(hc:BorderElement.CornerRadius),RelativeSource={RelativeSource TemplatedParent}}"</span>&gt;
                     &lt;StackPanel Orientation=<span class="token string">"Horizontal"</span> HorizontalAlignment=<span class="token string">"{TemplateBinding HorizontalContentAlignment}"</span> VerticalAlignment=<span class="token string">"{TemplateBinding VerticalContentAlignment}"</span> Margin=<span class="token string">"{TemplateBinding Padding}"</span>&gt;
                         &lt;Path <span class="token property">x</span><span class="token punctuation">:</span>Name=<span class="token string">"PathMain"</span> Width=<span class="token string">"{TemplateBinding hc:IconElement.Width}"</span> Height=<span class="token string">"{TemplateBinding hc:IconElement.Height}"</span> Fill=<span class="token string">"{TemplateBinding Foreground}"</span> SnapsToDevicePixels=<span class="token string">"True"</span> Stretch=<span class="token string">"Uniform"</span> Data=<span class="token string">"{TemplateBinding hc:IconElement.Geometry}"</span>/&gt;
                         &lt;ContentPresenter <span class="token property">x</span><span class="token punctuation">:</span>Name=<span class="token string">"ContentPresenterMain"</span> RecognizesAccessKey=<span class="token string">"True"</span> VerticalAlignment=<span class="token string">"Center"</span> Margin=<span class="token string">"6,0,0,0"</span> SnapsToDevicePixels=<span class="token string">"{TemplateBinding SnapsToDevicePixels}"</span>/&gt;
                     &lt;/StackPanel&gt;
                 &lt;/<span class="token property">hc</span><span class="token punctuation">:</span>DashedBorder&gt;
                 &lt;ControlTemplate.Triggers&gt;
                     &lt;Trigger Property=<span class="token string">"Content"</span> Value=<span class="token string">"{x:Null}"</span>&gt;
                         &lt;Setter Property=<span class="token string">"Visibility"</span> Value=<span class="token string">"Collapsed"</span> TargetName=<span class="token string">"ContentPresenterMain"</span>/&gt;
                     &lt;/Trigger&gt;
                     &lt;Trigger Property=<span class="token string">"hc:IconElement.Geometry"</span> Value=<span class="token string">"{x:Null}"</span>&gt;
                         &lt;Setter Property=<span class="token string">"Visibility"</span> Value=<span class="token string">"Collapsed"</span> TargetName=<span class="token string">"PathMain"</span>/&gt;
                         &lt;Setter Property=<span class="token string">"Margin"</span> Value=<span class="token string">"0"</span> TargetName=<span class="token string">"ContentPresenterMain"</span>/&gt;
                     &lt;/Trigger&gt;
                 &lt;/ControlTemplate.Triggers&gt;
             &lt;/ControlTemplate&gt;
         &lt;/Setter.Value&gt;
     &lt;/Setter&gt;
 </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Style</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p><img src="https://images2.imgbox.com/f2/8c/BZm3S19O_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_181"></a>控件模板原型</h3> 
<p>我们想写一个控件模板，如果不是很熟练，我们就先把控件模板的原型写出来，这样更利于理解。</p> 
<pre><code class="prism language-xml"> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>DockPanel</span><span class="token punctuation">&gt;</span></span>
     <span class="token comment">&lt;!--这里仿照HandyControl，使用Gemotery。IconPacks怎么转Gemotery可以看我的文章--&gt;</span>


     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Border</span> <span class="token attr-name">DockPanel.Dock</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Top<span class="token punctuation">"</span></span>
             <span class="token attr-name">Width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>50<span class="token punctuation">"</span></span>
             <span class="token attr-name">Height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>50<span class="token punctuation">"</span></span>
             <span class="token attr-name">CornerRadius</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>25<span class="token punctuation">"</span></span>
             <span class="token attr-name">Background</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>DeepSkyBlue<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Path</span> <span class="token attr-name">Data</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{wpfEx:MaterialGeometry Kind=BellRing}<span class="token punctuation">"</span></span>
               <span class="token attr-name">HorizontalAlignment</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Stretch<span class="token punctuation">"</span></span>
               <span class="token attr-name">VerticalAlignment</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Stretch<span class="token punctuation">"</span></span>
               <span class="token attr-name">SnapsToDevicePixels</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>True<span class="token punctuation">"</span></span>
               <span class="token attr-name">Stretch</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Uniform<span class="token punctuation">"</span></span>
               <span class="token attr-name">Width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>25<span class="token punctuation">"</span></span>
               <span class="token attr-name">Height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>25<span class="token punctuation">"</span></span>
               <span class="token attr-name">Fill</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>White<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Border</span><span class="token punctuation">&gt;</span></span>

     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>TextBlock</span> <span class="token attr-name">Text</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>TIM登录<span class="token punctuation">"</span></span>
                <span class="token attr-name">HorizontalAlignment</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Center<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>DockPanel</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p><img src="https://images2.imgbox.com/5c/fa/HhTwaCZB_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_217"></a>控件模板</h3> 
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Style</span> <span class="token attr-name"><span class="token namespace">x:</span>Key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>UserSelection<span class="token punctuation">"</span></span>
       <span class="token attr-name">TargetType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>RadioButton<span class="token punctuation">"</span></span>
       <span class="token attr-name">BasedOn</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{StaticResource {x:Type RadioButton}}<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css">
    &lt;Setter Property=<span class="token string">"Template"</span>&gt;
        &lt;Setter.Value&gt;
            &lt;!--先按照之前的样式粘贴一下--&gt;
            &lt;ControlTemplate TargetType=<span class="token string">"RadioButton"</span>&gt;
                &lt;DockPanel&gt;
                    &lt;Border DockPanel.Dock=<span class="token string">"Top"</span>
                            Width=<span class="token string">"50"</span>
                            Height=<span class="token string">"50"</span>
                            CornerRadius=<span class="token string">"25"</span>
                            Background=<span class="token string">"DeepSkyBlue"</span>&gt;
                        &lt;Path Data=<span class="token string">"{wpfEx:MaterialGeometry Kind=BellRing}"</span>
                              HorizontalAlignment=<span class="token string">"Stretch"</span>
                              VerticalAlignment=<span class="token string">"Stretch"</span>
                              SnapsToDevicePixels=<span class="token string">"True"</span>
                              Stretch=<span class="token string">"Uniform"</span>
                              Width=<span class="token string">"25"</span>
                              Height=<span class="token string">"25"</span>
                              Fill=<span class="token string">"White"</span> /&gt;
                    &lt;/Border&gt;
                    &lt;ContentPresenter <span class="token property">x</span><span class="token punctuation">:</span>Name=<span class="token string">"ContentPresenterMain"</span>
                                      RecognizesAccessKey=<span class="token string">"True"</span>
                                      VerticalAlignment=<span class="token string">"Center"</span>
                                      Margin=<span class="token string">"6,0,0,0"</span>
                                      SnapsToDevicePixels=<span class="token string">"{TemplateBinding SnapsToDevicePixels}"</span> /&gt;
                &lt;/DockPanel&gt;
            &lt;/ControlTemplate&gt;
        &lt;/Setter.Value&gt;
    &lt;/Setter&gt;
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Style</span><span class="token punctuation">&gt;</span></span>

</code></pre> 
<p><img src="https://images2.imgbox.com/6e/83/xJ2pJ0Kj_o.png" alt="在这里插入图片描述"></p> 
<p>然后里面能绑定的就绑定。也是照着HandyControl改的。注意这里的Banding用的是TemplateBinding</p> 
<p><img src="https://images2.imgbox.com/eb/93/WbjkmFBK_o.png" alt="在这里插入图片描述"></p> 
<p>修改好的效果</p> 
<pre><code class="prism language-xml"><span class="token comment">&lt;!--一个简单的FontSize修改--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Style</span> <span class="token attr-name"><span class="token namespace">x:</span>Key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>UserSelection<span class="token punctuation">"</span></span>
       <span class="token attr-name">TargetType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>RadioButton<span class="token punctuation">"</span></span>
       <span class="token attr-name">BasedOn</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{StaticResource {x:Type RadioButton}}<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css">
    &lt;Setter Property=<span class="token string">"Template"</span>&gt;
        &lt;Setter.Value&gt;
            &lt;!--先按照之前的样式粘贴一下--&gt;
            &lt;ControlTemplate TargetType=<span class="token string">"RadioButton"</span>&gt;
                &lt;DockPanel&gt;
                    &lt;Border DockPanel.Dock=<span class="token string">"Top"</span>
                            Width=<span class="token string">"{TemplateBinding hc:IconElement.Width}"</span>
                            Height=<span class="token string">"{TemplateBinding hc:IconElement.Height}"</span>
                            CornerRadius=<span class="token string">"25"</span>
                            Background=<span class="token string">"{TemplateBinding Foreground}"</span>&gt;
                        &lt;Path Data=<span class="token string">"{TemplateBinding hc:IconElement.Geometry}"</span>
                              HorizontalAlignment=<span class="token string">"Stretch"</span>
                              VerticalAlignment=<span class="token string">"Stretch"</span>
                              SnapsToDevicePixels=<span class="token string">"True"</span>
                              Stretch=<span class="token string">"Uniform"</span>
                              Width=<span class="token string">"25"</span>
                              Height=<span class="token string">"25"</span>
                              Fill=<span class="token string">"{TemplateBinding Background}"</span> /&gt;
                    &lt;/Border&gt;
                    &lt;ContentPresenter <span class="token property">x</span><span class="token punctuation">:</span>Name=<span class="token string">"ContentPresenterMain"</span>
                                      RecognizesAccessKey=<span class="token string">"True"</span>
                                      VerticalAlignment=<span class="token string">"Center"</span>
                                        
                                      Margin=<span class="token string">"6,0,0,0"</span>
                                      SnapsToDevicePixels=<span class="token string">"{TemplateBinding SnapsToDevicePixels}"</span> /&gt;
                &lt;/DockPanel&gt;
            &lt;/ControlTemplate&gt;
        &lt;/Setter.Value&gt;
    &lt;/Setter&gt;
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Style</span><span class="token punctuation">&gt;</span></span>

</code></pre> 
<p>简单使用</p> 
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>RadioButton</span> <span class="token attr-name">Content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>TIM登录<span class="token punctuation">"</span></span>
             <span class="token attr-name">GroupName</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>UserSelect<span class="token punctuation">"</span></span>
             <span class="token special-attr"><span class="token attr-name">Style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value css language-css"><span class="token punctuation">{<!-- --></span>StaticResource UserSelection<span class="token punctuation">}</span></span><span class="token punctuation">"</span></span></span>
             <span class="token attr-name">Foreground</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>DeepSkyBlue<span class="token punctuation">"</span></span>
             <span class="token attr-name">Background</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>White<span class="token punctuation">"</span></span>
             <span class="token attr-name"><span class="token namespace">hc:</span>IconElement.Geometry</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{wpfEx:MaterialGeometry Kind=AbTesting}<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>

</code></pre> 
<p><img src="https://images2.imgbox.com/c7/07/td8NOU5Z_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="_316"></a>结论</h2> 
<p>HandyControl的源码看了真的是打开眼界，但是WPF的Xaml有一个无法在内部简单计算的问题。比如我想Witdh=Height = CornerRadius*2。我可能就要写个触发器了。我后面回去测试一下有没有方法可以在Xaml里面简单计算的。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/6f8ba1a7a7aa900d7037b9d1c37d3ad0/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">安防视频监控平台EasyNVR级联视频上云管理平台EasyNVS，出现报错“i/o deadline reached”该如何解决？</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/98aa255afa1abb5aa0edeb950cfd513e/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">2024.2.27 模拟实现 RabbitMQ —— 网络通信设计（客户端）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 追风少年的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>