<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>ä¸€æ–‡æ•™ä½ ææ‡‚Redisé›†ç¾¤ - è¿½é£å°‘å¹´çš„åšå®¢</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="ä¸€æ–‡æ•™ä½ ææ‡‚Redisé›†ç¾¤" />
<meta property="og:description" content="ä¸€ã€Redisä¸»ä» 1.1ã€æ­å»ºä¸»ä»æ¶æ„ å•èŠ‚ç‚¹çš„Redisçš„å¹¶å‘èƒ½åŠ›æ˜¯æœ‰ä¸Šé™çš„ï¼Œè¦è¿›ä¸€æ­¥çš„æé«˜Redisçš„å¹¶å‘èƒ½åŠ›ï¼Œæ®éœ€è¦å¤§å®¶ä¸»ä»é›†ç¾¤ï¼Œå®ç°è¯»å†™åˆ†ç¦»ã€‚
å…±åŒ…å«ä¸‰ä¸ªå®ä¾‹ï¼Œç”±äºèµ„æºæœ‰é™ï¼Œæ‰€ä»¥åœ¨ä¸€å°è™šæ‹Ÿæœºä¸Šï¼Œå¼€å¯å¤šä¸ªredisçš„å®ä¾‹ï¼Œç«¯å£ä¸åŒï¼Œä¸‹é¢æ˜¯å…·ä½“çš„é…ç½®
IPPORTè§’è‰²192.168.152.1337001master192.168.152.1337002slave/replica192.168.152.1337003slave/replica ç¬¬ä¸€æ­¥ï¼šå‡†å¤‡å®ä¾‹å’Œé…ç½® è¦åœ¨åŒä¸€å°è™šæ‹Ÿæœºä¸Šå¼€å¯ä¸‰ä¸ªrediså®ä¾‹ï¼Œå°±å¿…é¡»è¦å‡†å¤‡ä¸‰åˆ†ä¸åŒçš„redis.confçš„é…ç½®æ–‡ä»¶ï¼Œä¸ºäº†æ–¹ä¾¿ç®¡ç†ï¼Œè¿™é‡Œåˆ›å»ºä¸‰ä¸ªæ–‡ä»¶å¤¹ï¼Œå­˜æ”¾ä¸åŒçš„é…ç½®æ–‡ä»¶
åˆ›å»ºç›®å½• åˆ›å»ºå‡ºä¸‰ä¸ªåˆ†åˆ«ä»¥ç«¯å£å·å‘½åçš„æ–‡ä»¶å¤¹7001ï¼Œ7002ï¼Œ7003
# è¿›å…¥redisçš„æŒ‰ç…§ç›®å½• cd /usr/local/bin # åˆ›å»ºç›®å½• mkdir -p 7001 7002 7003 ll å¦‚å›¾ï¼š
ä¿®æ”¹é…ç½®æ–‡ä»¶ ä¿®æ”¹redis.confçš„é…ç½®æ–‡ä»¶ï¼Œå°†å…¶ä¸­çš„æŒä¹…åŒ–æ¨¡å¼æ”¹ä¸ºå¼€å¯rdbï¼Œå…³é—­aofï¼Œå¹¶æŒ‡å®šipï¼Œç«¯å£ã€‚
å…¶ä¸­å¦‚æœæƒ³è¦ç”¨redisçš„å¯è§†åŒ–è¿æ¥å·¥å…·é“¾æ¥ï¼Œè¿˜éœ€è¦å…³é—­ä¿æŠ¤æ¨¡å¼protected-mode no
# å…³é—­aof appendonly no æ€è€ƒï¼šä¸ºä»€ä¹ˆè¦å¼€å¯rdbæ¨¡å¼ï¼Œå…³é—­aofå‘¢â“
æ‹·è´é…ç½®æ–‡ä»¶åˆ°7001ï¼Œ7002ï¼Œ7003 #æ–¹å¼ä¸€ï¼šé€ä¸ªæ‹·è´ cp /opt/redis-5/redis.conf ./7001/ cp /opt/redis-5/redis.conf ./7002/ cp /opt/redis-5/redis.conf ./7003/ #æ–¹å¼äºŒï¼šç®¡é“æ“ä½œ echo 7001 7002 7003 | xargs -t -n 1 cp redis-5/redis.conf ä¿®æ”¹ç«¯å£ï¼Œæ•°æ®ä¿å­˜ç›®å½• sed -i -e &#39;s/6379/7001/g&#39; -e &#39;s/dir .\//dir \/usr\/local\/bin\/7001\//g&#39; ./7001/redis.conf sed -i -e &#39;s/6379/7002/g&#39; -e &#39;s/dir ." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://zhuifengsn.github.io/posts/8bab87ede709be13e84a56cfa7e54ce5/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-10-05T21:32:12+08:00" />
<meta property="article:modified_time" content="2023-10-05T21:32:12+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="è¿½é£å°‘å¹´çš„åšå®¢" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">è¿½é£å°‘å¹´çš„åšå®¢</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">ä¸€æ–‡æ•™ä½ ææ‡‚Redisé›†ç¾¤</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-github-gist">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="Redis_1"></a>ä¸€ã€Redisä¸»ä»</h2> 
<h3><a id="11_3"></a>1.1ã€æ­å»ºä¸»ä»æ¶æ„</h3> 
<p>å•èŠ‚ç‚¹çš„Redisçš„å¹¶å‘èƒ½åŠ›æ˜¯æœ‰ä¸Šé™çš„ï¼Œè¦è¿›ä¸€æ­¥çš„æé«˜Redisçš„å¹¶å‘èƒ½åŠ›ï¼Œæ®éœ€è¦å¤§å®¶ä¸»ä»é›†ç¾¤ï¼Œå®ç°è¯»å†™åˆ†ç¦»ã€‚</p> 
<p><img src="https://images2.imgbox.com/94/a3/PkzVMWs9_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<p>å…±åŒ…å«ä¸‰ä¸ªå®ä¾‹ï¼Œç”±äºèµ„æºæœ‰é™ï¼Œæ‰€ä»¥åœ¨ä¸€å°è™šæ‹Ÿæœºä¸Šï¼Œå¼€å¯å¤šä¸ªredisçš„å®ä¾‹ï¼Œç«¯å£ä¸åŒï¼Œä¸‹é¢æ˜¯å…·ä½“çš„é…ç½®</p> 
<table><thead><tr><th>IP</th><th>PORT</th><th>è§’è‰²</th></tr></thead><tbody><tr><td>192.168.152.133</td><td>7001</td><td>master</td></tr><tr><td>192.168.152.133</td><td>7002</td><td>slave/replica</td></tr><tr><td>192.168.152.133</td><td>7003</td><td>slave/replica</td></tr></tbody></table> 
<h4><a id="_18"></a>ç¬¬ä¸€æ­¥ï¼šå‡†å¤‡å®ä¾‹å’Œé…ç½®</h4> 
<p>è¦åœ¨åŒä¸€å°è™šæ‹Ÿæœºä¸Šå¼€å¯ä¸‰ä¸ªrediså®ä¾‹ï¼Œå°±å¿…é¡»è¦å‡†å¤‡ä¸‰åˆ†ä¸åŒçš„redis.confçš„é…ç½®æ–‡ä»¶ï¼Œä¸ºäº†æ–¹ä¾¿ç®¡ç†ï¼Œè¿™é‡Œåˆ›å»ºä¸‰ä¸ªæ–‡ä»¶å¤¹ï¼Œå­˜æ”¾ä¸åŒçš„é…ç½®æ–‡ä»¶</p> 
<ol><li><strong>åˆ›å»ºç›®å½•</strong></li></ol> 
<p>åˆ›å»ºå‡ºä¸‰ä¸ªåˆ†åˆ«ä»¥ç«¯å£å·å‘½åçš„æ–‡ä»¶å¤¹7001ï¼Œ7002ï¼Œ7003</p> 
<pre><code class="prism language-shell"><span class="token comment"># è¿›å…¥redisçš„æŒ‰ç…§ç›®å½•</span>
<span class="token builtin class-name">cd</span> /usr/local/bin
<span class="token comment"># åˆ›å»ºç›®å½•</span>
<span class="token function">mkdir</span> <span class="token parameter variable">-p</span> <span class="token number">7001</span> <span class="token number">7002</span> <span class="token number">7003</span>
ll
</code></pre> 
<p>å¦‚å›¾ï¼š</p> 
<p><img src="https://images2.imgbox.com/1e/14/WXFQP5iC_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<ol start="2"><li><strong>ä¿®æ”¹é…ç½®æ–‡ä»¶</strong></li></ol> 
<p>ä¿®æ”¹redis.confçš„é…ç½®æ–‡ä»¶ï¼Œå°†å…¶ä¸­çš„æŒä¹…åŒ–æ¨¡å¼æ”¹ä¸ºå¼€å¯rdbï¼Œå…³é—­aofï¼Œå¹¶æŒ‡å®šipï¼Œç«¯å£ã€‚</p> 
<blockquote> 
 <p>å…¶ä¸­å¦‚æœæƒ³è¦ç”¨redisçš„å¯è§†åŒ–è¿æ¥å·¥å…·é“¾æ¥ï¼Œè¿˜éœ€è¦å…³é—­ä¿æŠ¤æ¨¡å¼<code>protected-mode no</code></p> 
</blockquote> 
<pre><code class="prism language-shell"><span class="token comment"># å…³é—­aof</span>
appendonly no
</code></pre> 
<p>æ€è€ƒï¼šä¸ºä»€ä¹ˆè¦å¼€å¯rdbæ¨¡å¼ï¼Œå…³é—­aofå‘¢â“</p> 
<ol start="3"><li>æ‹·è´é…ç½®æ–‡ä»¶åˆ°7001ï¼Œ7002ï¼Œ7003</li></ol> 
<pre><code class="prism language-shell"><span class="token comment">#æ–¹å¼ä¸€ï¼šé€ä¸ªæ‹·è´</span>
<span class="token function">cp</span> /opt/redis-5/redis.conf ./7001/
<span class="token function">cp</span> /opt/redis-5/redis.conf ./7002/
<span class="token function">cp</span> /opt/redis-5/redis.conf ./7003/
<span class="token comment">#æ–¹å¼äºŒï¼šç®¡é“æ“ä½œ</span>
<span class="token builtin class-name">echo</span> <span class="token number">7001</span> <span class="token number">7002</span> <span class="token number">7003</span> <span class="token operator">|</span> <span class="token function">xargs</span> <span class="token parameter variable">-t</span> <span class="token parameter variable">-n</span> <span class="token number">1</span> <span class="token function">cp</span> redis-5/redis.conf
</code></pre> 
<ol start="4"><li>ä¿®æ”¹ç«¯å£ï¼Œæ•°æ®ä¿å­˜ç›®å½•</li></ol> 
<pre><code class="prism language-shell"><span class="token function">sed</span> <span class="token parameter variable">-i</span> <span class="token parameter variable">-e</span> <span class="token string">'s/6379/7001/g'</span> <span class="token parameter variable">-e</span> <span class="token string">'s/dir .\//dir \/usr\/local\/bin\/7001\//g'</span> ./7001/redis.conf
<span class="token function">sed</span> <span class="token parameter variable">-i</span> <span class="token parameter variable">-e</span> <span class="token string">'s/6379/7002/g'</span> <span class="token parameter variable">-e</span> <span class="token string">'s/dir .\//dir \/usr\/local\/bin\/7002\//g'</span> ./7002/redis.conf
<span class="token function">sed</span> <span class="token parameter variable">-i</span> <span class="token parameter variable">-e</span> <span class="token string">'s/6379/7003/g'</span> <span class="token parameter variable">-e</span> <span class="token string">'s/dir .\//dir \/usr\/local\/bin\/7003\//g'</span> ./7003/redis.conf
</code></pre> 
<blockquote> 
 <p>daemonize noï¼šè¡¨ç¤ºä¸åå°å¯åŠ¨ï¼Œå®é™…ç”Ÿäº§éœ€è¦ä¿®æ”¹ä¸ºyesï¼Œè¿™é‡Œä¸ºäº†æ–¹ä¾¿è§‚å¯Ÿæ—¥å¿—ï¼Œæš‚æ—¶å…³é—­</p> 
</blockquote> 
<ol start="5"><li>ä¿®æ”¹æ¯ä¸ªå®ä¾‹çš„å£°æ˜IP</li></ol> 
<p>è™šæ‹Ÿæœºæœ¬èº«å­˜åœ¨å¤šä¸ªipï¼Œä¸ºäº†é¿å…æ··æ·†ï¼Œæˆ‘ä»¬éœ€è¦åœ¨é…ç½®æ–‡ä»¶çš„ç¬¬ä¸€è¡Œï¼Œå£°æ˜æ¯ä¸ªå®ä¾‹çš„IP</p> 
<pre><code class="prism language-shell"><span class="token function">sed</span> <span class="token parameter variable">-i</span> <span class="token string">'1a replica-announce-ip 192.168.152.133'</span> ./7001/redis.conf
<span class="token function">sed</span> <span class="token parameter variable">-i</span> <span class="token string">'1a replica-announce-ip 192.168.152.133'</span> ./7002/redis.conf
<span class="token function">sed</span> <span class="token parameter variable">-i</span> <span class="token string">'1a replica-announce-ip 192.168.152.133'</span> ./7003/redis.conf
</code></pre> 
<h4><a id="redis_87"></a>ç¬¬äºŒæ­¥ï¼šå¯åŠ¨rediså®ä¾‹</h4> 
<p>æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤</p> 
<pre><code class="prism language-shell">redis-server ./7001/redis.conf
redis-server ./7002/redis.conf
redis-server ./7003/redis.conf
</code></pre> 
<p><img src="https://images2.imgbox.com/c1/a2/rohZp5fa_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<h4><a id="_100"></a>ç¬¬ä¸‰æ­¥ï¼šæ„å»ºä¸»ä»å…³ç³»</h4> 
<p>å®Œæˆä¸Šé¢çš„æ“ä½œä¹‹åï¼Œå…¶å®è¿˜æ²¡æœ‰å®Œæˆä¸»ä»çš„æ­å»ºï¼Œå› ä¸ºè¿™æ ·åªæ˜¯å¯åŠ¨ä¸‰ä¸ªå•ç‹¬çš„rediså®ä¾‹ï¼Œè¿™ä¸‰ä¸ªrediså®ä¾‹ä¹‹é—´æ²¡æœ‰ä»»ä½•çš„è”ç³»ã€‚éœ€è¦åœ¨ä»èŠ‚ç‚¹ä¸‹æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š</p> 
<pre><code class="prism language-shell"><span class="token comment"># æ–¹å¼ä¸€ï¼šæ°¸ä¹…ä¿®æ”¹</span>
åœ¨redis.confæ–‡ä»¶é‡Œæ·»åŠ slaveof masterIp masterPort
åªè¦æ·»åŠ äº†è¿™è¡Œå‘½ä»¤çš„rediså®ä¾‹å°±ä¼šæˆä¸ºè¢«æ·»åŠ çš„masterIpçš„ä»èŠ‚ç‚¹

<span class="token comment"># æ–¹å¼äºŒï¼Œä¸´æ—¶ä¿®æ”¹ï¼Œé‡å¯åå°†å¤±æ•ˆ</span>
<span class="token comment"># è¿›å…¥redis-cliå®¢æˆ·ç«¯ï¼Œæ‰§è¡Œslaveof</span>
slaveof ä¸»èŠ‚ç‚¹IP ä¸»èŠ‚ç‚¹ç«¯å£
</code></pre> 
<p><img src="https://images2.imgbox.com/85/8b/jfrk97md_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<p>è§‚å¯Ÿæ—¥å¿—å˜åŒ–ï¼š</p> 
<p><img src="https://images2.imgbox.com/a9/17/7a7cVZHQ_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<h3><a id="12_124"></a>1.2ã€ä¸»ä»åŒæ­¥åŸç†</h3> 
<h4><a id="_126"></a>å…¨é‡åŒæ­¥</h4> 
<h5><a id="_128"></a>æ•°æ®åŒæ­¥å›¾è§£</h5> 
<p><strong>æ•°æ®åŒæ­¥åŸç†</strong></p> 
<p>Redisä¸»ä»çš„ç¬¬ä¸€æ¬¡æ•°æ®åŒæ­¥æ˜¯å…¨é‡åŒæ­¥ï¼š</p> 
<p><img src="https://images2.imgbox.com/47/85/mxC4nZTo_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<h5><a id="_136"></a>å¦‚ä½•åˆ¤æ–­æ˜¯å¦æ˜¯ç¬¬ä¸€æ¬¡</h5> 
<p>é‚£ä¹ˆç”±ä¸Šå›¾æˆ‘ä»¬å¯ä»¥çŸ¥é“masterå¿…é¡»è¦å¯¹å‘æ¥çš„slaveèŠ‚ç‚¹è¿›è¡Œåˆ¤æ–­ï¼Œçœ‹æ˜¯ä¸æ˜¯ç¬¬ä¸€æ¬¡ï¼Œå¦‚æœæ˜¯ç¬¬ä¸€æ¬¡ï¼Œéœ€è¦åšå…¨é‡åŒæ­¥æ•°æ®ï¼Œé‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Ÿmasteræ€ä¹ˆçŸ¥é“æ˜¯ä¸æ˜¯ç¬¬ä¸€æ¬¡å‘¢ï¼Ÿï¼Ÿï¼Ÿ</p> 
<p>è¿™é‡Œå°±æ¶‰åŠåˆ°äº†ä¸¤ä¸ªæ¦‚å¿µï¼š</p> 
<ul><li> <p><strong>Replication Id:</strong> ç®€ç§°replidï¼Œæ˜¯æ•°æ®é›†çš„æ ‡è®°ï¼Œidä¸€è‡´åˆ™è¯´æ˜æ˜¯åŒä¸€ä¸ªæ•°æ®é›†ï¼Œæ¯ä¸€ä¸ªmasteréƒ½æœ‰å”¯ä¸€çš„replidï¼Œslaveåˆ™ä¼šç»§æ‰¿masterçš„replidã€‚</p> </li><li> <p>**offsetï¼š**éšç€repl_back_logä¸­åœ°æ•°æ®é‡çš„å¢å¤§è€Œå¢åŠ ï¼Œslaveå®ŒæˆåŒæ­¥æ—¶ä¹Ÿä¼šè®°å½•å½“å‰åœ°offsetï¼Œæ‰€ä»¥slaveåœ°offsetåç§»é‡ä¸€å®šæ˜¯å°äºç­‰äºï¼Œmasteråœ°offsetã€‚</p> </li></ul> 
<p><img src="https://images2.imgbox.com/36/42/LcWjqurf_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<blockquote> 
 <p>ç­”æ¡ˆæ˜¯Replidï¼Œå› ä¸ºslaveåœ¨æˆæˆä¸ºmasteråœ°ä»èŠ‚ç‚¹ä¹‹å‰ï¼Œè‡ªå·±ä¹Ÿæ˜¯masterï¼Œä¹Ÿæœ‰è‡ªå·±çš„replidï¼Œæ•…replidæ˜¯å”¯ä¸€çš„ã€‚</p> 
</blockquote> 
<h5><a id="_151"></a>æ—¥å¿—åˆ†æ</h5> 
<p>æ¥ä¸‹æ¥æˆ‘ä»¬çœ‹ä¸‹æ—¥å¿—è¿›è¡Œè¿›ä¸€æ­¥çš„åˆ†æï¼š</p> 
<p>ã€æ­¥éª¤ä¸€ã€‘ï¼š</p> 
<p><img src="https://images2.imgbox.com/6c/e1/jtMqR9lZ_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<p>ã€æ­¥éª¤äºŒã€‘ï¼š</p> 
<p><img src="https://images2.imgbox.com/13/73/7udzPPJu_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<p>ã€æ­¥éª¤ä¸‰ã€‘ï¼š</p> 
<p>ç”±äºæ˜¯ç¬¬ä¸€æ¬¡ï¼Œæ‰€ä»¥æ²¡æœ‰offsetï¼Œæ•…æ²¡æœ‰æ—¥å¿—ï¼Œä½†æ˜¯redisåå°ä¼šç›‘æ§</p> 
<h4><a id="_169"></a>å¢é‡åŒæ­¥</h4> 
<h5><a id="_171"></a>å¢é‡åŒæ­¥å›¾è§£</h5> 
<p><img src="https://images2.imgbox.com/de/13/YPlcKq4J_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<p>å¢é‡åŒæ­¥åœ°å…³é”®å°±æ˜¯repl_baklogï¼Œä¸Šé¢è®²è¿‡ä¸€ä¸ªæ¦‚å¿µoffsetï¼Œä»–è®°å½•çš„æ˜¯ä¸»ä»èŠ‚ç‚¹åŒæ­¥çš„èŠ‚ç‚¹ä¿¡æ¯ï¼Œä¹Ÿå°±æ˜¯è¯´å‡å¦‚slaveå®•æœºäº†ï¼Œä½†æ˜¯è¿™ä¸ªæ—¶å€™masterè¿˜æŒç»­åœ°å¾€é‡Œé¢å†™æ•°æ®ï¼Œè¿™ä¸ªæ—¶å€™slaveåœ°offsetä¸€ç›´æ²¡æœ‰å¢åŠ ï¼Œè€Œmasteråœ°offsetä¸€ç›´åœ¨å¢åŠ ã€‚å½“æˆ‘ä»¬åœ°slaveé‡æ–°æ¢å¤çš„æ—¶å€™ï¼Œslaveåœ°offsetä¸masteråœ°offsetçš„å·®å€¼ï¼Œå°±æ˜¯slaveéœ€è¦åšå¢é‡åŒæ­¥çš„æ•°æ®ã€‚</p> 
<blockquote> 
 <p><strong>é‚£ä¹ˆrepl_baklogæ˜¯æ€ä¹ˆå®ç°è®°å½•çš„æ“ä½œå‘¢ï¼Ÿ</strong></p> 
 <p>åŸç†å°±å¦‚ä¸Šå›¾å·¦ä¸‹è§’æ‰€ç¤ºï¼š</p> 
 <p><code>repl_baklog</code>æ•°æ®ç»“æ„å®é™…ä¸Šå°±æ˜¯ä¸€ä¸ªç¯å½¢æ•°ç»„ï¼Œç»¿è‰²çš„éƒ¨åˆ†ä»£è¡¨slaveçš„offsetï¼Œè€Œçº¢è‰²çš„éƒ¨åˆ†ä»£è¡¨éœ€è¦åŒæ­¥çš„æ•°æ®ï¼Œä¹Ÿå°±æ˜¯masterçš„offsetä¸slaveçš„offsetçš„å·®å€¼ï¼Œæˆ‘ä»¬å®é™…è¦å…³æ³¨çš„ä¹Ÿå°±æ˜¯è¿™éƒ¨åˆ†ã€‚</p> 
</blockquote> 
<h5><a id="_184"></a>ä»€ä¹ˆæ—¶å€™æ— æ³•å¢é‡åŒæ­¥</h5> 
<p><img src="https://images2.imgbox.com/74/86/K4pWklTR_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<p>ç”±äºæ˜¯ä¸€ä¸ªç¯å½¢çš„æ•°æ®ç»“æ„ï¼Œæ‰€ä»¥ä¸€æ—¦masterçš„offsetè¦†ç›–æ‰slaveå®•æœºå‰çš„offsetä½ç½®ï¼Œé‚£ä¹ˆæ­¤æ—¶å°±æ— æ³•å®ç°å¢é‡åŒæ­¥ã€‚</p> 
<h5><a id="_191"></a>å¦‚ä½•ä¼˜åŒ–ä¸»ä»é›†ç¾¤</h5> 
<p><img src="https://images2.imgbox.com/f3/b5/3HuWlGRe_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<h2><a id="Redis_196"></a>äºŒã€Rediså“¨å…µ</h2> 
<blockquote> 
 <p>ğŸ¤”æ€è€ƒï¼š</p> 
 <ul><li>slaveèŠ‚ç‚¹å®•æœºæ¢å¤åå¯ä»¥æ‰¾masterèŠ‚ç‚¹æ•°æ®åŒæ­¥ï¼Œ</li><li>é‚£masterèŠ‚ç‚¹å®•æœºäº†å‘¢ï¼Œæ€ä¹ˆåŠï¼Ÿ</li></ul> 
</blockquote> 
<h3><a id="21_203"></a>2.1ã€å“¨å…µçš„ä½œç”¨ä¸åŸç†</h3> 
<h4><a id="_205"></a>å“¨å…µçš„ä½œç”¨</h4> 
<p>Redisæä¾›äº†å“¨å…µæ¨¡å¼ï¼ˆSentinelï¼‰ï¼Œå…¶ä¸»è¦çš„ä½œç”¨å°±æ˜¯ç›‘æ§ä¸»ä»é›†ç¾¤ï¼Œç”¨äºè‡ªåŠ¨çš„æ•…éšœæ£€æµ‹ä¸æ¢å¤ï¼Œä»¥åŠé€šçŸ¥ã€‚</p> 
<p><img src="https://images2.imgbox.com/66/19/f38HwJPa_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<h4><a id="_212"></a>æœåŠ¡çŠ¶æ€ç›‘æ§</h4> 
<p><img src="https://images2.imgbox.com/fe/45/OIOIakCt_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<h4><a id="Master_217"></a>é€‰ä¸¾æ–°çš„Master</h4> 
<p><img src="https://images2.imgbox.com/e3/1b/BBvSGszy_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<h4><a id="_222"></a>æ•…éšœè½¬ç§»åŸç†</h4> 
<p><img src="https://images2.imgbox.com/d0/c9/17nIjfhi_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<blockquote> 
 <p><strong>âš“ï¸æ³¨æ„ï¼š</strong></p> 
 <p>å½“åŸmasterå®•æœºåï¼Œsentinelä¼šé€‰ä¸¾å‡ºæ–°çš„masterï¼ŒåŒæ—¶ä¼šå¼ºåˆ¶ä¿®æ”¹masterèŠ‚ç‚¹çš„redis.confé…ç½®æ–‡ä»¶ï¼Œæ·»åŠ ä¸€è¡Œï¼š<strong><code>slaveof &lt;æ–°çš„masterip&gt; &lt;æ–°çš„masterç«¯å£&gt;</code></strong></p> 
 <p>æ•…ï¼Œå¦‚æœé‡æ–°ä½¿ç”¨åŸç†çš„redis.confå¯åŠ¨ä¸»ä»ï¼Œå°±æ— æ³•å®ç°ä¸»ä»çš„æ­å»ºã€‚</p> 
</blockquote> 
<h3><a id="22_235"></a>2.2ã€æ­å»ºå“¨å…µé›†ç¾¤</h3> 
<table><thead><tr><th>èŠ‚ç‚¹</th><th>PORT</th><th>è§’è‰²</th></tr></thead><tbody><tr><td>sentinel1</td><td>27001</td><td>master</td></tr><tr><td>sentinel2</td><td>27002</td><td>slave/replica</td></tr><tr><td>sentinel3</td><td>27003</td><td>slave/replica</td></tr></tbody></table> 
<h4><a id="_245"></a>ç¬¬ä¸€æ­¥ï¼šå‡†å¤‡å®ä¾‹å’Œé…ç½®</h4> 
<p>å¿…é¡»è¦å‡†å¤‡ä¸‰åˆ†ä¸åŒçš„sentinel.confçš„é…ç½®æ–‡ä»¶ï¼Œä¸ºäº†æ–¹ä¾¿ç®¡ç†ï¼Œè¿™é‡Œåˆ›å»ºä¸‰ä¸ªæ–‡ä»¶å¤¹ï¼Œå­˜æ”¾ä¸åŒçš„é…ç½®æ–‡ä»¶ï¼šsentinel27001 sentinel27002 sentinel27003</p> 
<ol><li><strong>åˆ›å»ºç›®å½•</strong></li></ol> 
<p>åˆ›å»ºå‡ºä¸‰ä¸ªåˆ†åˆ«ä»¥ç«¯å£å·å‘½åçš„æ–‡ä»¶å¤¹7001ï¼Œ7002ï¼Œ7003</p> 
<pre><code class="prism language-shell"><span class="token comment"># è¿›å…¥redisçš„æŒ‰ç…§ç›®å½•</span>
<span class="token builtin class-name">cd</span> /usr/local/bin
<span class="token comment"># åˆ›å»ºç›®å½•</span>
<span class="token function">mkdir</span> <span class="token parameter variable">-p</span> sentinel27001 sentinel27002 sentinel27003
ll
</code></pre> 
<p>å¦‚å›¾ï¼š</p> 
<p><img src="https://images2.imgbox.com/99/7e/GbjdZtgF_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<ol start="2"><li><strong>ä¿®æ”¹é…ç½®æ–‡ä»¶</strong></li></ol> 
<p>sentinel.confçš„é…ç½®æ–‡ä»¶ï¼Œ</p> 
<pre><code class="prism language-shell"><span class="token function">vim</span> ./sentinel27001/sentinel.conf

port <span class="token number">27001</span>
sentinel announce-ip <span class="token number">192.168</span>.152.133
<span class="token comment"># å®¢è§‚ä¸‹çº¿æ•°ç›® 2å°sentineléƒ½è®¤ä¸ºä¸‹çº¿åˆ™è®¤ä¸ºä¸»ç®¡ä¸‹çº¿</span>
<span class="token comment"># mymaster ä¸ºsentinelçš„åå­—ï¼Œéšæ„ï¼Œä½†æ˜¯å‰åé¡»ä¿æŒä¸€è‡´</span>
<span class="token comment"># 192.168.152.133 7001 ä¸ºmasterä¸»èŠ‚ç‚¹çš„ipï¼Œç«¯å£</span>
sentinel monitor mymaster <span class="token number">192.168</span>.152.133 <span class="token number">7001</span> <span class="token number">2</span>
sentinel down-after-milliseconds mymaster <span class="token number">5000</span>
sentinel failover-timeout mymaster <span class="token number">60000</span>
<span class="token function">dir</span> <span class="token string">"/usr/local/bin/sentinel27001"</span>
</code></pre> 
<ol start="3"><li>æ‹·è´é…ç½®æ–‡ä»¶åˆ°sentinel27002ï¼Œsentinel27003</li></ol> 
<pre><code class="prism language-shell"><span class="token comment">#æ–¹å¼äºŒï¼šç®¡é“æ“ä½œ</span>
<span class="token builtin class-name">echo</span> sentinel27002 sentinel27003 <span class="token operator">|</span> <span class="token function">xargs</span> <span class="token parameter variable">-t</span> <span class="token parameter variable">-n</span> <span class="token number">1</span> <span class="token function">cp</span> ./sentinel27001/sentinel.conf
</code></pre> 
<ol start="4"><li>ä¿®æ”¹ç«¯å£ï¼Œæ•°æ®ä¿å­˜ç›®å½•</li></ol> 
<pre><code class="prism language-shell"><span class="token function">sed</span> <span class="token parameter variable">-i</span> <span class="token parameter variable">-e</span> <span class="token string">'s/27001/27002/g'</span> <span class="token parameter variable">-e</span> <span class="token string">'s/sentinel27001/sentinel27002/g'</span> ./sentinel27002/sentinel.conf
<span class="token function">sed</span> <span class="token parameter variable">-i</span> <span class="token parameter variable">-e</span> <span class="token string">'s/27001/27003/g'</span> <span class="token parameter variable">-e</span> <span class="token string">'s/sentinel27001/sentinel27003/g'</span> ./sentinel27003/sentinel.conf
</code></pre> 
<blockquote> 
 <p>daemonize noï¼šè¡¨ç¤ºä¸åå°å¯åŠ¨ï¼Œå®é™…ç”Ÿäº§éœ€è¦ä¿®æ”¹ä¸ºyesï¼Œè¿™é‡Œä¸ºäº†æ–¹ä¾¿è§‚å¯Ÿæ—¥å¿—ï¼Œæš‚æ—¶å…³é—­</p> 
</blockquote> 
<ol start="5"><li>ä¿®æ”¹æ¯ä¸ªå®ä¾‹çš„å£°æ˜IP</li></ol> 
<p>è™šæ‹Ÿæœºæœ¬èº«å­˜åœ¨å¤šä¸ªipï¼Œä¸ºäº†é¿å…æ··æ·†ï¼Œæˆ‘ä»¬éœ€è¦åœ¨é…ç½®æ–‡ä»¶çš„ç¬¬ä¸€è¡Œï¼Œå£°æ˜æ¯ä¸ªå®ä¾‹çš„IP</p> 
<pre><code class="prism language-shell"><span class="token function">sed</span> <span class="token parameter variable">-i</span> <span class="token string">'1a replica-announce-ip 192.168.152.133'</span> ./7001/redis.conf
<span class="token function">sed</span> <span class="token parameter variable">-i</span> <span class="token string">'1a replica-announce-ip 192.168.152.133'</span> ./7002/redis.conf
<span class="token function">sed</span> <span class="token parameter variable">-i</span> <span class="token string">'1a replica-announce-ip 192.168.152.133'</span> ./7003/redis.conf
</code></pre> 
<h4><a id="sentinel_310"></a>ç¬¬äºŒæ­¥ï¼šå¯åŠ¨sentinelå®ä¾‹</h4> 
<p>æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤</p> 
<pre><code class="prism language-shell">redis-sentinel ./sentinel27001/sentinel.conf
redis-sentinel ./sentinel27002/sentinel.conf
redis-sentinel ./sentinel27003/sentinel.conf
</code></pre> 
<p><img src="https://images2.imgbox.com/81/c0/WGZ3zni8_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<h4><a id="master_323"></a>ç¬¬ä¸‰æ­¥ï¼šæ¨¡æ‹Ÿmasterå®•æœº</h4> 
<p><img src="https://images2.imgbox.com/d9/3d/XOo1LZ5y_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<p>å“¨å…µæœåŠ¡ç›‘æ§7001çŠ¶æ€ï¼Œå¹¶å®Œæˆæ–°çš„sentinel-leaderçš„é€‰ä¸¾ï¼Œå¹¶æœ€ç»ˆç”±é€‰ä¸¾å‡ºæ¥çš„sentinel-leaderå®Œæˆæ•…éšœæ¢å¤</p> 
<p><img src="https://images2.imgbox.com/0b/9f/ojvPH8EJ_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<p>ç”±é€‰ä¸¾å‡ºæ¥çš„27001å“¨å…µé€‰ä¸¾å‡º7003èŠ‚ç‚¹ï¼Œæˆä¸ºæ–°çš„masterï¼Œå¹¶å‘7003å‘é€äº†ä¸€ä¸ªslaveof-nooneçš„å‘½ä»¤ã€èµ·æ¥ï¼Œä¸æ„¿åšå¥´éš¶çš„äººã€‘ï¼Œä½¿å¾—7003æˆä¸ºæ–°çš„master</p> 
<p><img src="https://images2.imgbox.com/43/d4/3FPmDvMh_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<p><img src="https://images2.imgbox.com/c3/44/GgoyiEuv_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<p>å‘7001å‘èµ·reconfå‘½ä»¤<br> <img src="https://images2.imgbox.com/8f/78/CO8259Ks_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<p>æ¢å¤7001èŠ‚ç‚¹åï¼Œåœ°ä½å˜æˆäº†slaveï¼Œå¹¶å®ç°äº†ä¸€æ¬¡å…¨é‡åŒæ­¥æ•°æ®7003</p> 
<p><img src="https://images2.imgbox.com/1d/79/hOJahVoe_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<h3><a id="23RedisTemplate_350"></a>2.3ã€RedisTemplateçš„å“¨å…µæ¨¡å¼</h3> 
<p>SpringBootä¸ºè®¿é—®Redisï¼Œæä¾›äº†ä¸€ä¸ªRedisTemplateçš„åŒ…ï¼Œé›†æˆäº†Lettuceå’ŒJedisä¸¤ç§Javaè®¿é—®Redisçš„å®¢æˆ·ç«¯ï¼Œæ¥ä¸‹æ¥ï¼Œè®©æˆ‘ä»¬æ¥ä½¿ç”¨ä¸€ä¸‹ï¼š</p> 
<p>ã€å¼•å…¥ä¾èµ–ã€‘</p> 
<pre><code class="prism language-xml">		<span class="token comment">&lt;!-- redisæ ¸å¿ƒä¾èµ– --&gt;</span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-data-redis<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

		<span class="token comment">&lt;!-- å¯¹è±¡æ± æ¡†æ¶ï¼Œredisä¾èµ– --&gt;</span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.commons<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>commons-pool2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
		<span class="token comment">&lt;!-- åºåˆ—åŒ– --&gt;</span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>fastjson<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.2.73<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>application.yml</p> 
<pre><code class="prism language-yml"><span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">9088</span>
<span class="token comment"># å¼€å¯redisçš„æ—¥å¿—</span>
<span class="token key atrule">logging</span><span class="token punctuation">:</span>
  <span class="token key atrule">level</span><span class="token punctuation">:</span>
    <span class="token key atrule">'[io.lettuce.core]'</span><span class="token punctuation">:</span> debug
  <span class="token key atrule">pattern</span><span class="token punctuation">:</span>
    <span class="token key atrule">dateformat</span><span class="token punctuation">:</span> MM<span class="token punctuation">-</span>dd HH<span class="token punctuation">:</span>mm<span class="token punctuation">:</span>ss<span class="token punctuation">:</span>SSS
<span class="token comment"># redisé…ç½®ä¿¡æ¯</span>
<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">redis</span><span class="token punctuation">:</span>
    <span class="token key atrule">sentinel</span><span class="token punctuation">:</span>
      <span class="token key atrule">master</span><span class="token punctuation">:</span> mymaster
      <span class="token key atrule">nodes</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> 192.168.152.133<span class="token punctuation">:</span><span class="token number">27001</span>
        <span class="token punctuation">-</span> 192.168.152.133<span class="token punctuation">:</span><span class="token number">27002</span>
        <span class="token punctuation">-</span> 192.168.152.133<span class="token punctuation">:</span><span class="token number">27003</span>
</code></pre> 
<p>ã€redisConfigé…ç½®ç±»ã€‘</p> 
<pre><code class="prism language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span></span><span class="token class-name">AutoConfigureBefore</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span>data<span class="token punctuation">.</span>redis<span class="token punctuation">.</span></span><span class="token class-name">LettuceClientConfigurationBuilderCustomizer</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span>data<span class="token punctuation">.</span>redis<span class="token punctuation">.</span></span><span class="token class-name">RedisAutoConfiguration</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Bean</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Configuration</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>redis<span class="token punctuation">.</span>connection<span class="token punctuation">.</span></span><span class="token class-name">RedisConnectionFactory</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>redis<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">RedisTemplate</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>redis<span class="token punctuation">.</span>serializer<span class="token punctuation">.</span></span><span class="token class-name">Jackson2JsonRedisSerializer</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>redis<span class="token punctuation">.</span>serializer<span class="token punctuation">.</span></span><span class="token class-name">StringRedisSerializer</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>lettuce<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">ReadFrom</span></span><span class="token punctuation">;</span>

<span class="token comment">/**
* @ClassName: RedisConfig
* @Description: Redisé…ç½®ç±»
* @author weiyongpeng
* @date 2023å¹´10æœˆ5æ—¥ ä¸‹åˆ12:37:19
 */</span>
<span class="token annotation punctuation">@Configuration</span>
<span class="token annotation punctuation">@AutoConfigureBefore</span><span class="token punctuation">(</span><span class="token class-name">RedisAutoConfiguration</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RedisConfig</span> <span class="token punctuation">{<!-- --></span>

    <span class="token comment">/**
     * æ–¹æ³•æè¿°ï¼š åˆå§‹åŒ–redisè¿æ¥
     * @param factory redisè¿æ¥å·¥å‚
     * @return {@link RedisTemplate}
     */</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">RedisTemplate</span> <span class="token function">redisTemplate</span><span class="token punctuation">(</span><span class="token class-name">RedisConnectionFactory</span> factory<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// æ–°å»ºredisTemplateå¯¹è±¡</span>
        <span class="token class-name">RedisTemplate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> template <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RedisTemplate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// è®¾ç½®å·¥å‚</span>
        template<span class="token punctuation">.</span><span class="token function">setConnectionFactory</span><span class="token punctuation">(</span>factory<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//åºåˆ—åŒ–é…ç½®</span>
        <span class="token class-name">Jackson2JsonRedisSerializer</span> jackson2JsonRedisSerializer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Jackson2JsonRedisSerializer</span><span class="token punctuation">(</span><span class="token class-name">Object</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">StringRedisSerializer</span> stringRedisSerializer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringRedisSerializer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//1ï¼Œç”¨StringRedisSerializerè¿›è¡Œåºåˆ—åŒ–çš„å€¼ï¼Œåœ¨Javaå’ŒRedisä¸­ä¿å­˜çš„å†…å®¹æ˜¯ä¸€æ ·çš„</span>
		<span class="token comment">//2ï¼Œç”¨Jackson2JsonRedisSerializerè¿›è¡Œåºåˆ—åŒ–çš„å€¼ï¼Œåœ¨Redisä¸­ä¿å­˜çš„å†…å®¹ï¼Œæ¯”Javaä¸­å¤šäº†ä¸€å¯¹åŒå¼•å·ã€‚</span>
		<span class="token comment">//3ï¼Œç”¨JdkSerializationRedisSerializerè¿›è¡Œåºåˆ—åŒ–çš„å€¼ï¼Œå¯¹äºKey-Valueçš„Valueæ¥è¯´ï¼Œæ˜¯åœ¨Redisä¸­æ˜¯ä¸å¯è¯»çš„ã€‚å¯¹äºHashçš„Valueæ¥è¯´ï¼Œæ¯”Javaçš„å†…å®¹å¤šäº†ä¸€äº›å­—ç¬¦ã€‚</span>
		<span class="token comment">//å¦‚æœKeyçš„Serializerä¹Ÿç”¨å’ŒValueç›¸åŒçš„Serializerçš„è¯ï¼Œåœ¨Redisä¸­ä¿å­˜çš„å†…å®¹å’Œä¸Šé¢Valueçš„å·®å¼‚æ˜¯ä¸€æ ·çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¿å­˜æ—¶ï¼Œåªç”¨StringRedisSerializerè¿›è¡Œåºåˆ—åŒ–</span>
        <span class="token comment">// keyé‡‡ç”¨Stringçš„åºåˆ—åŒ–æ–¹å¼</span>
        template<span class="token punctuation">.</span><span class="token function">setKeySerializer</span><span class="token punctuation">(</span>stringRedisSerializer<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// valueåºåˆ—åŒ–æ–¹å¼é‡‡ç”¨jackson</span>
        template<span class="token punctuation">.</span><span class="token function">setValueSerializer</span><span class="token punctuation">(</span>stringRedisSerializer<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// hashçš„keyä¹Ÿé‡‡ç”¨Stringçš„åºåˆ—åŒ–æ–¹å¼</span>
        template<span class="token punctuation">.</span><span class="token function">setHashKeySerializer</span><span class="token punctuation">(</span>stringRedisSerializer<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// hashçš„valueåºåˆ—åŒ–æ–¹å¼é‡‡ç”¨jackson</span>
        template<span class="token punctuation">.</span><span class="token function">setHashValueSerializer</span><span class="token punctuation">(</span>stringRedisSerializer<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// è¿”å›redisTemplateå¯¹è±¡</span>
        <span class="token keyword">return</span> template<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">/**
    * æè¿°ï¼šé…ç½®è¯»å†™åˆ†ç¦»
    * @Title: configurationBuilderCustomizer
    * @return
    * @author weiyongpeng
    * @date  2023å¹´10æœˆ5æ—¥ ä¸Šåˆ10:20:57
     */</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">LettuceClientConfigurationBuilderCustomizer</span> <span class="token function">configurationBuilderCustomizer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// REPLICA_PERFEREDï¼šè¡¨ç¤ºä¼˜å…ˆä»ä»èŠ‚ç‚¹è¯»å–æ•°æ®ï¼Œå½“ä»èŠ‚ç‚¹éƒ½æŒ‚æ‰ï¼Œæ‰å»è¯»master</span>
    	<span class="token keyword">return</span> configurate <span class="token operator">-&gt;</span> configurate<span class="token punctuation">.</span><span class="token function">readFrom</span><span class="token punctuation">(</span><span class="token class-name">ReadFrom</span><span class="token punctuation">.</span><span class="token constant">REPLICA_PREFERRED</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h2><a id="Redis_468"></a>ä¸‰ã€Redisåˆ†ç‰‡é›†ç¾¤</h2> 
<h3><a id="31_470"></a>3.1ã€æ­å»ºåˆ†ç‰‡é›†ç¾¤</h3> 
<p>é¦–å…ˆåœ¨æ­å»ºRedisåˆ†ç‰‡é›†ç¾¤ä¹‹å‰ï¼Œå…ˆäº†è§£ä¸‹åˆ†ç‰‡é›†ç¾¤å¯ä»¥è§£å†³å“¨å…µå’Œä¸»ä»æ— æ³•è§£å†³çš„é‚£äº›é—®é¢˜ï¼Œä»¥åŠåˆ†ç‰‡å¼é›†ç¾¤çš„ç‰¹å¾ï¼š</p> 
<p><img src="https://images2.imgbox.com/8e/b3/kS49DU2O_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<blockquote> 
 <p>**ğŸ”¥æ³¨æ„ï¼š**åœ¨ä½¿ç”¨RedisTemplateè®¿é—®åˆ†ç‰‡é›†ç¾¤çš„æ—¶å€™ï¼Œå°±ä¸éœ€è¦æŒ‡å®šä¸»ä»å…³ç³»ï¼Œå¯ä»¥è®¿é—®ä»»æ„ä¸€å°èŠ‚ç‚¹ï¼Œredisä¼šå®ç°è‡ªåŠ¨çš„è·¯ç”±è½¬å‘æœºåˆ¶</p> 
</blockquote> 
<p>å…±åŒ…å«å…­ä¸ªå®ä¾‹ï¼Œç”±äºèµ„æºæœ‰é™ï¼Œæ‰€ä»¥åœ¨ä¸€å°è™šæ‹Ÿæœºä¸Šï¼Œå¼€å¯å¤šä¸ªredisçš„å®ä¾‹ï¼Œç«¯å£ä¸åŒï¼Œä¸‹é¢æ˜¯å…·ä½“çš„é…ç½®</p> 
<table><thead><tr><th>IP</th><th>PORT</th><th>è§’è‰²</th></tr></thead><tbody><tr><td>192.168.152.133</td><td>7001</td><td>master</td></tr><tr><td>192.168.152.133</td><td>7002</td><td>master</td></tr><tr><td>192.168.152.133</td><td>7003</td><td>master</td></tr><tr><td>192.168.152.133</td><td>8001</td><td>slave</td></tr><tr><td>192.168.152.133</td><td>8002</td><td>slave</td></tr><tr><td>192.168.152.133</td><td>8003</td><td>slave</td></tr></tbody></table> 
<h4><a id="_490"></a>ç¬¬ä¸€æ­¥ï¼šå‡†å¤‡å®ä¾‹å’Œé…ç½®</h4> 
<p>ä¸ºäº†å®Œæˆ3ä¸»3ä»çš„redisåˆ†ç‰‡é›†ç¾¤çš„æ­å»ºï¼Œå¿…é¡»è¦å‡†å¤‡å…­ä»½ä¸åŒçš„redis.confçš„é…ç½®æ–‡ä»¶ï¼Œä¸ºäº†æ–¹ä¾¿ç®¡ç†ï¼Œè¿™é‡Œåˆ›å»ºå…­ä¸ªæ–‡ä»¶å¤¹ï¼Œå­˜æ”¾ä¸åŒçš„é…ç½®æ–‡ä»¶ï¼šcluster7001 cluster7002 cluster7003 cluster8001 cluster8002 cluster8003</p> 
<ol><li><strong>åˆ›å»ºç›®å½•</strong></li></ol> 
<p>åˆ›å»ºå‡ºä¸‰ä¸ªåˆ†åˆ«ä»¥ç«¯å£å·å‘½åçš„æ–‡ä»¶å¤¹cluster7001 cluster7002 cluster7003 cluster8001 cluster8002 cluster8003</p> 
<pre><code class="prism language-shell"><span class="token comment"># è¿›å…¥redisçš„æŒ‰ç…§ç›®å½•</span>
<span class="token builtin class-name">cd</span> /usr/local/bin
<span class="token comment"># åˆ›å»ºç›®å½•</span>
<span class="token function">mkdir</span> <span class="token parameter variable">-p</span> cluster7001 cluster7002 cluster7003 cluster8001 cluster8002 cluster8003
ll
</code></pre> 
<p>å¦‚å›¾ï¼š<br> <img src="https://images2.imgbox.com/3f/1d/kqppKaBr_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<ol start="2"><li><strong>ä¿®æ”¹é…ç½®æ–‡ä»¶</strong></li></ol> 
<p>é‡æ–°ç”Ÿæˆredis.confçš„é…ç½®æ–‡ä»¶ï¼Œ</p> 
<pre><code class="prism language-shell"><span class="token function">vim</span> ./cluster7001/redis.conf

port <span class="token number">7001</span>
<span class="token comment"># å¼€å¯é›†ç¾¤åŠŸèƒ½</span>
cluster-enabled <span class="token function">yes</span>
<span class="token comment"># é›†ç¾¤çš„é…ç½®æ–‡ä»¶åç§°ï¼Œä¸éœ€è¦æˆ‘ä»¬åˆ›å»ºï¼Œéœ€è¦redisè‡ªå·±ç»´æŠ¤</span>
cluster-config-file /usr/local/bin/cluster7001/nodes.conf
<span class="token comment"># èŠ‚ç‚¹å¿ƒè·³è¶…æ—¶é“¾æ¥æ—¶é—´</span>
cluster-node-timeout <span class="token number">5000</span>
<span class="token comment"># æŒä¹…åŒ–æ•°æ®æ–‡ä»¶å­˜æ”¾è·¯å¾„</span>
<span class="token function">dir</span> <span class="token string">"/usr/local/bin/cluster7001"</span>
<span class="token comment"># ç»‘å®šåœ°å€</span>
<span class="token builtin class-name">bind</span> <span class="token number">192.168</span>.152.133
<span class="token comment"># å¼€å¯åå°è¿è¡Œ</span>
daemonize <span class="token function">yes</span>
<span class="token comment"># å£°æ˜IP</span>
replica-announce-ip <span class="token number">192.168</span>.152.133
<span class="token comment"># ä¿æŠ¤æ¨¡å¼å…³é—­</span>
protected-mode no
<span class="token comment"># æ—¥å¿—æ–‡ä»¶è·¯å¾„</span>
logfile <span class="token string">"/usr/local/bin/cluster7001/cluster.log"</span>
</code></pre> 
<ol start="3"><li>æ‹·è´é…ç½®æ–‡ä»¶åˆ°cluster7002 cluster7003 cluster8001ï¼Œcluster8002 cluster8003</li></ol> 
<pre><code class="prism language-shell"><span class="token comment">#æ–¹å¼äºŒï¼šç®¡é“æ“ä½œ</span>
<span class="token builtin class-name">echo</span> cluster7002 cluster7003 cluster8001 cluster8002 cluster8003 <span class="token operator">|</span> <span class="token function">xargs</span> <span class="token parameter variable">-t</span> <span class="token parameter variable">-n</span> <span class="token number">1</span> <span class="token function">cp</span> ./cluster7001/redis.conf
</code></pre> 
<ol start="4"><li>ä¿®æ”¹ç«¯å£ï¼Œæ•°æ®ä¿å­˜ç›®å½•</li></ol> 
<pre><code class="prism language-shell"><span class="token builtin class-name">printf</span> <span class="token string">'%s\n'</span> cluster7002 cluster7003 cluster8001 cluster8002 cluster8003 <span class="token operator">|</span> <span class="token function">xargs</span> -I<span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span> <span class="token parameter variable">-t</span> <span class="token function">sed</span> <span class="token parameter variable">-i</span> <span class="token string">'s/cluster7001/{}/g'</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>/redis.conf
</code></pre> 
<blockquote> 
 <p>daemonize noï¼šè¡¨ç¤ºä¸åå°å¯åŠ¨ï¼Œå®é™…ç”Ÿäº§éœ€è¦ä¿®æ”¹ä¸ºyesï¼Œè¿™é‡Œä¸ºäº†æ–¹ä¾¿è§‚å¯Ÿæ—¥å¿—ï¼Œæš‚æ—¶å…³é—­</p> 
</blockquote> 
<h4><a id="_555"></a>ç¬¬äºŒæ­¥ï¼šå¯åŠ¨</h4> 
<p>æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤</p> 
<pre><code class="prism language-shell"><span class="token builtin class-name">cd</span> /usr/local/bin

<span class="token builtin class-name">printf</span> <span class="token string">'%s\n'</span> cluster7001 cluster7002 cluster7003 cluster8001 cluster8002 cluster8003 <span class="token operator">|</span> <span class="token function">xargs</span> -I<span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span> <span class="token parameter variable">-t</span>  redis-server ./<span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>/redis.conf
</code></pre> 
<p><img src="https://images2.imgbox.com/62/43/4bfAAATE_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<blockquote> 
 <p><strong>ğŸ”¥æ³¨æ„</strong>ï¼Œæ­¤æ—¶è¿˜æ²¡æœ‰å®Œæˆé›†ç¾¤çš„é…ç½®ï¼Œå› ä¸ºè¿™ä¸ªæ—¶å€™6å°rediså®ä¾‹è¯æ²¡æœ‰å½¢æˆä»»ä½•çš„å…³è”å…³ç³»ã€‚</p> 
</blockquote> 
<h4><a id="_570"></a>ç¬¬ä¸‰æ­¥ï¼šåˆ›å»ºé›†ç¾¤</h4> 
<p>é’ˆå¯¹redis5.xä¹‹åçš„æŠŠç‰ˆæœ¬ï¼Œæ‰§è¡Œä¸‹è¿°å‘½ä»¤ï¼š</p> 
<pre><code class="prism language-shell">redis-cli <span class="token parameter variable">--cluster</span> create --cluster-replicas <span class="token number">1</span> <span class="token number">192.168</span>.152.133:7001 <span class="token number">192.168</span>.152.133:7002 <span class="token number">192.168</span>.152.133:7003 <span class="token number">192.168</span>.152.133:8001 <span class="token number">192.168</span>.152.133:8002 <span class="token number">192.168</span>.152.133:8003
</code></pre> 
<p><strong>å‘½ä»¤è¯´æ˜</strong></p> 
<ul><li><code>redis-cli --cluster</code>æˆ–è€…<code>./redis-trib.rb</code> ï¼šä»£è¡¨é›†ç¾¤æ“ä½œå‘½ä»¤</li><li><code>create</code>ï¼šä»£è¡¨åˆ›å»ºé›†ç¾¤</li><li><code>--replicas 1</code>æˆ–è€…<code>--cluster-replicas 1</code>ï¼šä»£è¡¨é›†ç¾¤ä¸­æ¯ä¸ªmasterçš„å‰¯æœ¬ä¸ªæ•°ä¸º1ï¼Œmaster+slaveçš„æ¯”ä¾‹å°±æ˜¯2ï¼Œé‚£ä¹ˆ<code>æ€»èŠ‚ç‚¹æ•°â—(master+salveçš„æ¯”ä¾‹)</code> å°±æ˜¯å½“å‰masterä¸ªæ•°ï¼Œé‚£ä¹ˆå…¶ä½™çš„å°±æ˜¯salve</li></ul> 
<p><img src="https://images2.imgbox.com/04/66/dM7tGicK_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<p><img src="https://images2.imgbox.com/ce/2e/f4QlnA10_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<blockquote> 
 <p>è‡ªæ­¤é›†ç¾¤åˆ›å»ºå®Œæ¯•ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¦‚ä½•æŸ¥çœ‹é›†ç¾¤çš„çŠ¶æ€å‘¢ï¼Ÿ</p> 
 <p><code>redis-cli -p 7001 -h 192.168.152.133 cluster nodes</code></p> 
</blockquote> 
<p><img src="https://images2.imgbox.com/d3/4a/GcwqMDqm_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<h3><a id="32_596"></a>3.2ã€æ•£åˆ—æ’æ§½åŸç†</h3> 
<p>Redisä¼šæŠŠæ¯ä¸€ä¸ªMasterèŠ‚ç‚¹æ˜ å°„åˆ°0-16383ä¹‹é—´å…±16384ä¸ªæ’æ§½(hash solt)ä¸Šï¼Œ<strong>æŸ¥çœ‹é›†ç¾¤ä¿¡æ¯æ—¶å°±èƒ½çœ‹åˆ°ï¼š</strong></p> 
<p><img src="https://images2.imgbox.com/01/e2/ukTgCKmR_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<p>è¿™äº›çš„soltsæ€»å’Œæ­£å¥½æ˜¯16384ã€‚</p> 
<p>ä¸ºä»€ä¹ˆè¦ä½¿ç”¨æ’æ§½å‘¢ï¼ŸåŸå› å¾ˆç®€å•ï¼š</p> 
<p>**<code>å› ä¸ºredisçš„èŠ‚ç‚¹æ—¶æœ‰å¯èƒ½å®•æœºçš„ï¼Œæ‰€ä»¥redisçš„keyå¹¶ä¸æ˜¯ä¸èŠ‚ç‚¹æ‰€ç»‘å®šçš„ï¼Œè€Œæ˜¯ä¸æ’æ§½ç»‘å®šã€‚</code>**redisä¼šæ ¹æ®keyçš„æœ‰æ•ˆéƒ¨åˆ†è®¡ç®—æ’æ§½ï¼Œåˆ†ä¸¤ç§æƒ…å†µï¼š</p> 
<ol><li>keyä¸­åŒ…å«{}ï¼Œä¸”{}ä¸­è‡³å°‘æœ‰ä¸€ä¸ªå­—ç¬¦ï¼Œ{}ä¸­çš„éƒ¨åˆ†å°±æ˜¯æœ‰æ•ˆéƒ¨åˆ†</li><li>keyä¸­ä¸åŒ…å«{}ï¼Œæ•´ä¸ªkeyä½œä¸ºæœ‰æ•ˆéƒ¨åˆ†</li></ol> 
<p><img src="https://images2.imgbox.com/41/63/TbYUAJoU_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<blockquote> 
 <p>**ğŸ”¥æ³¨æ„ï¼š<strong>åœ¨é›†ç¾¤æ¨¡å¼ä¸‹ï¼Œå¿…é¡»ä½¿ç”¨</strong><code>-c</code>**å‚æ•°é“¾æ¥redis-cli</p> 
</blockquote> 
<p><img src="https://images2.imgbox.com/aa/36/MY7Ggun9_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<p><img src="https://images2.imgbox.com/0b/5f/V98h42fg_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<p>æ‰€ä»¥è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬è¯´ï¼Œè®¿é—®é›†ç¾¤çš„ä»»æ„ä¸€ä¸ªèŠ‚ç‚¹ï¼Œéƒ½å¯ä»¥ï¼Œå› ä¸ºä»–ä»¬æ˜¯é€šè¿‡æ§½çš„å€¼è‡ªåŠ¨åˆ‡æ¢ã€‚</p> 
<h5><a id="_625"></a>æ€»ç»“</h5> 
<ol><li>å¦‚ä½•å°†åŒä¸€ç±»çš„æ•°æ®å›ºå®šä¿å­˜åœ¨åŒä¸€ä¸ªRediså®ä¾‹ä¸­ï¼Ÿ</li></ol> 
<p>è¿™ä¸€ç±»æ•°æ®ä½¿ç”¨åŒæ ·çš„keyæœ‰æ•ˆéƒ¨åˆ†ï¼Œä¾‹å¦‚keyéƒ½ä»¥{typeid}ä½œä¸ºå‰ç¼€</p> 
<h3><a id="33_631"></a>3.3ã€é›†ç¾¤ä¼¸ç¼©</h3> 
<h5><a id="_633"></a>æ·»åŠ ä¸€ä¸ªèŠ‚ç‚¹åˆ°é›†ç¾¤</h5> 
<p><img src="https://images2.imgbox.com/3a/b6/80Yp3YC8_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<p><img src="https://images2.imgbox.com/cf/bd/po7zn7nY_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@localhost bin<span class="token punctuation">]</span><span class="token comment"># mkdir -p cluster7004</span>
<span class="token punctuation">[</span>root@localhost bin<span class="token punctuation">]</span><span class="token comment"># cp ./cluster7001/redis.conf ./cluster7004/</span>
<span class="token punctuation">[</span>root@localhost bin<span class="token punctuation">]</span><span class="token comment"># sed -i 's/7001/7004/g' ./cluster7004/redis.conf</span>
<span class="token punctuation">[</span>root@localhost bin<span class="token punctuation">]</span><span class="token comment"># redis-server ./cluster7004/redis.conf</span>
<span class="token punctuation">[</span>root@localhost bin<span class="token punctuation">]</span><span class="token comment"># ps -ef | grep redis</span>
root      <span class="token number">10717</span>      <span class="token number">1</span>  <span class="token number">0</span> <span class="token number">16</span>:05 ?        00:00:04 redis-server <span class="token number">192.168</span>.152.133:7001 <span class="token punctuation">[</span>cluster<span class="token punctuation">]</span>
root      <span class="token number">10722</span>      <span class="token number">1</span>  <span class="token number">0</span> <span class="token number">16</span>:05 ?        00:00:04 redis-server <span class="token number">192.168</span>.152.133:7002 <span class="token punctuation">[</span>cluster<span class="token punctuation">]</span>
root      <span class="token number">10724</span>      <span class="token number">1</span>  <span class="token number">0</span> <span class="token number">16</span>:05 ?        00:00:04 redis-server <span class="token number">192.168</span>.152.133:7003 <span class="token punctuation">[</span>cluster<span class="token punctuation">]</span>
root      <span class="token number">10732</span>      <span class="token number">1</span>  <span class="token number">0</span> <span class="token number">16</span>:05 ?        00:00:04 redis-server <span class="token number">192.168</span>.152.133:8001 <span class="token punctuation">[</span>cluster<span class="token punctuation">]</span>
root      <span class="token number">10734</span>      <span class="token number">1</span>  <span class="token number">0</span> <span class="token number">16</span>:05 ?        00:00:04 redis-server <span class="token number">192.168</span>.152.133:8002 <span class="token punctuation">[</span>cluster<span class="token punctuation">]</span>
root      <span class="token number">10739</span>      <span class="token number">1</span>  <span class="token number">0</span> <span class="token number">16</span>:05 ?        00:00:04 redis-server <span class="token number">192.168</span>.152.133:8003 <span class="token punctuation">[</span>cluster<span class="token punctuation">]</span>
root      <span class="token number">11285</span>      <span class="token number">1</span>  <span class="token number">0</span> <span class="token number">16</span>:48 ?        00:00:00 redis-server <span class="token number">192.168</span>.152.133:7004 <span class="token punctuation">[</span>cluster<span class="token punctuation">]</span>
root      <span class="token number">11290</span>   <span class="token number">9739</span>  <span class="token number">0</span> <span class="token number">16</span>:48 pts/0    00:00:00 <span class="token function">grep</span> <span class="token parameter variable">--color</span><span class="token operator">=</span>auto redis
<span class="token punctuation">[</span>root@localhost bin<span class="token punctuation">]</span><span class="token comment">#</span>
</code></pre> 
<p>å¯åŠ¨å®Œåï¼ŒæŸ¥çœ‹æ­¤æ—¶çš„7004çš„é›†ç¾¤ä¿¡æ¯</p> 
<p><img src="https://images2.imgbox.com/fa/af/cDaG5UQT_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±è¦ä½¿ç”¨add-nodeæ·»åŠ åˆ°é›†ç¾¤ä¸­</p> 
<pre><code class="prism language-shell">redis-cli <span class="token parameter variable">--cluster</span> add-node <span class="token number">192.168</span>.152.133:7004 <span class="token number">192.168</span>.152.133:7001
</code></pre> 
<p><img src="https://images2.imgbox.com/2d/c6/LhWTKvEV_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<p>ä½†æ˜¯ï¼Œæˆ‘ä»¬è¿™ä¸ªæ—¶å€™æŸ¥çœ‹ä¸€ä¸‹redis7004çš„é›†ç¾¤ä¿¡æ¯å‘ç°ï¼Œæ–°å¢çš„7004æ²¡æœ‰æ’æ§½åˆ†é…</p> 
<p><img src="https://images2.imgbox.com/86/65/KnP2P74I_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<p>ä½¿ç”¨reshardå®ç°æ’æ§½çš„é‡æ–°åˆ†é…</p> 
<pre><code class="prism language-shell">redis-cli <span class="token parameter variable">--cluster</span> reshard <span class="token number">192.168</span>.152.133:7001 <span class="token comment"># è¡¨ç¤ºé‡æ–°åˆ†é…7001çš„æ’æ§½</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/bd/34/cgM6fTOD_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<p>åˆ†é…å®ŒåæŸ¥çœ‹7004çš„é›†ç¾¤çŠ¶æ€ï¼Œå‘ç°å·²ç»å®ç°ç±»åˆ†é…</p> 
<p><img src="https://images2.imgbox.com/4c/43/Rxg74gPN_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<p><img src="https://images2.imgbox.com/67/07/TKBjwhJ7_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<h3><a id="34_694"></a>3.4ã€æ•…éšœè½¬ç§»</h3> 
<h5><a id="_696"></a>è‡ªåŠ¨æ•…éšœè½¬ç§»</h5> 
<p><img src="https://images2.imgbox.com/9f/81/ti3cnWoG_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<h5><a id="_701"></a>æ‰‹åŠ¨æ•…éšœè½¬ç§»</h5> 
<p><img src="https://images2.imgbox.com/5e/82/u8x3YeR1_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<h3><a id="35RedisTemplate_705"></a>3.5ã€RedisTemplateè®¿é—®åˆ†ç‰‡é›†ç¾¤</h3> 
<pre><code class="prism language-yml"><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">redis</span><span class="token punctuation">:</span>
    <span class="token key atrule">cluster</span><span class="token punctuation">:</span>
      <span class="token comment"># é›†ç¾¤èŠ‚ç‚¹</span>
      <span class="token key atrule">nodes</span><span class="token punctuation">:</span> 
        <span class="token punctuation">-</span> 192.168.152.133<span class="token punctuation">:</span><span class="token number">7001</span>
        <span class="token punctuation">-</span> 192.168.152.133<span class="token punctuation">:</span><span class="token number">7002</span> 
        <span class="token punctuation">-</span> 192.168.152.133<span class="token punctuation">:</span><span class="token number">7003</span> 
        <span class="token punctuation">-</span> 192.168.152.133<span class="token punctuation">:</span><span class="token number">8001</span> 
        <span class="token punctuation">-</span> 192.168.152.133<span class="token punctuation">:</span><span class="token number">8002</span> 
        <span class="token punctuation">-</span> 192.168.152.133<span class="token punctuation">:</span><span class="token number">8003</span>
      <span class="token comment"># æœ€å¤§é‡å®šå‘æ¬¡æ•°</span>
      <span class="token key atrule">max-redirects</span><span class="token punctuation">:</span> <span class="token number">5</span>
</code></pre> 
<p>å…¶ä½™é…ç½®å’Œå“¨å…µä¸€è‡´ï¼Œåªéœ€è¦ä¿®æ”¹application.ymlæ–‡ä»¶å³å¯</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/4e0ad3aa0f42c8ea61348a4d6b1e992f/" rel="prev">
			<span class="pager__subtitle">Â«&thinsp;Previous</span>
			<p class="pager__title">Spring Bootï¼šå®ç°ä¸æ•°æ®åº“çš„è¿æ¥</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/a4f670859b16ea57d4a2e5ea985fe9e7/" rel="next">
			<span class="pager__subtitle">Next&thinsp;Â»</span>
			<p class="pager__title">å› å­åˆ†æ FA | Factor Analysis</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 è¿½é£å°‘å¹´çš„åšå®¢.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>