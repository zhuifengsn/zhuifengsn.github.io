<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>使用过滤器与cookie实现记住用户登录状态，自动登录功能 - 追风少年的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="使用过滤器与cookie实现记住用户登录状态，自动登录功能" />
<meta property="og:description" content="一、思路： 用户首次登录并选择了记住登录状态，向服务器发出登录请求，服务器收到请求后验证登录信息，如果用户信息认证成功，服务器将用户的登录信息存入cookie并响应给浏览器，接下来每次浏览器向服务器发出访问资源请求时，都会附带cookie信息，服务器认证cookie中的用户登录信息，如果成功则放行，否则让客户端删除cookie，重新登录认证。
二、流程图 三、代码实现 1、创建LoginServlet，获取用户输入的信息 //处理乱码问题 request.setCharacterEncoding(&#34;utf-8&#34;); //获取用户输入的信息 String username = request.getParameter(&#34;username&#34;); String password = request.getParameter(&#34;password&#34;); //获取用户是否选择记住登录状态，如果auto为null则未选择 String auto = request.getParameter(&#34;auto&#34;); 2、用户信息校验，以用户输入的信息作为参数，调用业务逻辑层的用户登录方法获取用户，该部分代码省略，此处代码采用将用户名和密码写死的方式认证 if (&#34;admin&#34;.equals(username)&amp;&amp;&#34;888&#34;.equals(password)){ //用户登录信息正确，执行后续的代码 //如果是从数据库中获取的用户，则将用户对象放入域中 request.getSession().setAttribute(&#34;username&#34;, username); } 3、将用户的信息保存到cookie中并重定向到资源页面 if (&#34;admin&#34;.equals(username)&amp;&amp;&#34;888&#34;.equals(password)){ //用户登录信息正确，执行后续的代码 //如果是从数据库中获取的用户，则将用户对象放入session域中 request.getSession().setAttribute(&#34;username&#34;, username); //判断用户是否选择记住登录状态 if (auto!=null){ //将用户名与密码进行拼接 String userinfo = username&#43;&#34;#&#34;&#43;password; //通过Base64编码进行信息加密 userinfo = Base64.getEncoder().encodeToString(userinfo.getBytes(&#34;utf-8&#34;)); //创建名为&#34;userinfo&#34;的cookie Cookie cookie = new Cookie(&#34;userinfo&#34;,userinfo); //设置回传路径 cookie.setPath(request.getContextPath()); //设置cookie的有效期 cookie.setMaxAge(60*60*24*7); //设置HttpOnly，使js脚本将无法读取到cookie信息，防止跨站脚本攻击 cookie.setHttpOnly(true); //将cookie存入响应中 response.addCookie(cookie); } //重定向到访问资源 response.sendRedirect(request.getContextPath()&#43;&#34;/index.jsp&#34;); } 4、创建过滤器，拦截路径设置为资源路径，过滤资源的访问请求 (1) 从session域获取用户，如果存在，则说明当前会话是登录状态，过滤器放行 //将请求和响应强转成HttpServletRequest类型 HttpServletRequest req = (HttpServletRequest)request; HttpServletResponse resp = (HttpServletResponse)response; //从session域获取用户 String username = (String) req." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://zhuifengsn.github.io/posts/250e7fd8bba5a5b45ea12743d6ae64e0/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-09-07T23:12:52+08:00" />
<meta property="article:modified_time" content="2021-09-07T23:12:52+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="追风少年的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">追风少年的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">使用过滤器与cookie实现记住用户登录状态，自动登录功能</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-github-gist">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h3><a id="_0"></a>一、思路：</h3> 
<p>用户首次登录并选择了记住登录状态，向服务器发出登录请求，服务器收到请求后验证登录信息，如果用户信息认证成功，服务器将用户的登录信息存入cookie并响应给浏览器，接下来每次浏览器向服务器发出访问资源请求时，都会附带cookie信息，服务器认证cookie中的用户登录信息，如果成功则放行，否则让客户端删除cookie，重新登录认证。</p> 
<h3><a id="_3"></a>二、流程图</h3> 
<p><img src="https://images2.imgbox.com/d4/33/gvoCwqFF_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_8"></a>三、代码实现</h3> 
<pre><code>1、创建LoginServlet，获取用户输入的信息
</code></pre> 
<pre><code class="prism language-java">		<span class="token comment">//处理乱码问题</span>
        request<span class="token punctuation">.</span><span class="token function">setCharacterEncoding</span><span class="token punctuation">(</span><span class="token string">"utf-8"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//获取用户输入的信息</span>
        <span class="token class-name">String</span> username <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token string">"username"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> password <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token string">"password"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//获取用户是否选择记住登录状态，如果auto为null则未选择</span>
        <span class="token class-name">String</span> auto <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token string">"auto"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<pre><code>2、用户信息校验，以用户输入的信息作为参数，调用业务逻辑层的用户登录方法获取用户，该部分代码省略，此处代码采用将用户名和密码写死的方式认证
</code></pre> 
<pre><code class="prism language-java"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">"admin"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>username<span class="token punctuation">)</span><span class="token operator">&amp;&amp;</span><span class="token string">"888"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>password<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
	<span class="token comment">//用户登录信息正确，执行后续的代码</span>
	<span class="token comment">//如果是从数据库中获取的用户，则将用户对象放入域中</span>
	request<span class="token punctuation">.</span><span class="token function">getSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"username"</span><span class="token punctuation">,</span> username<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<pre><code>3、将用户的信息保存到cookie中并重定向到资源页面
</code></pre> 
<pre><code class="prism language-java"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">"admin"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>username<span class="token punctuation">)</span><span class="token operator">&amp;&amp;</span><span class="token string">"888"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>password<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
	<span class="token comment">//用户登录信息正确，执行后续的代码</span>
	<span class="token comment">//如果是从数据库中获取的用户，则将用户对象放入session域中</span>
	request<span class="token punctuation">.</span><span class="token function">getSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"username"</span><span class="token punctuation">,</span> username<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">//判断用户是否选择记住登录状态</span>
    	<span class="token keyword">if</span> <span class="token punctuation">(</span>auto<span class="token operator">!=</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    		<span class="token comment">//将用户名与密码进行拼接</span>
            <span class="token class-name">String</span> userinfo <span class="token operator">=</span> username<span class="token operator">+</span><span class="token string">"#"</span><span class="token operator">+</span>password<span class="token punctuation">;</span>
            <span class="token comment">//通过Base64编码进行信息加密</span>
            userinfo <span class="token operator">=</span> <span class="token class-name">Base64</span><span class="token punctuation">.</span><span class="token function">getEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">encodeToString</span><span class="token punctuation">(</span>userinfo<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token string">"utf-8"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//创建名为"userinfo"的cookie</span>
            <span class="token class-name">Cookie</span> cookie <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Cookie</span><span class="token punctuation">(</span><span class="token string">"userinfo"</span><span class="token punctuation">,</span>userinfo<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//设置回传路径</span>
            cookie<span class="token punctuation">.</span><span class="token function">setPath</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span><span class="token function">getContextPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//设置cookie的有效期</span>
            cookie<span class="token punctuation">.</span><span class="token function">setMaxAge</span><span class="token punctuation">(</span><span class="token number">60</span><span class="token operator">*</span><span class="token number">60</span><span class="token operator">*</span><span class="token number">24</span><span class="token operator">*</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//设置HttpOnly，使js脚本将无法读取到cookie信息，防止跨站脚本攻击</span>
            cookie<span class="token punctuation">.</span><span class="token function">setHttpOnly</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//将cookie存入响应中</span>
            response<span class="token punctuation">.</span><span class="token function">addCookie</span><span class="token punctuation">(</span>cookie<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token comment">//重定向到访问资源</span>
		response<span class="token punctuation">.</span><span class="token function">sendRedirect</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span><span class="token function">getContextPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">"/index.jsp"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
</code></pre> 
<pre><code>4、创建过滤器，拦截路径设置为资源路径，过滤资源的访问请求

	(1) 从session域获取用户，如果存在，则说明当前会话是登录状态，过滤器放行
</code></pre> 
<pre><code class="prism language-java"><span class="token comment">//将请求和响应强转成HttpServletRequest类型</span>
<span class="token class-name">HttpServletRequest</span> req <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span><span class="token punctuation">)</span>request<span class="token punctuation">;</span>
<span class="token class-name">HttpServletResponse</span> resp <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">HttpServletResponse</span><span class="token punctuation">)</span>response<span class="token punctuation">;</span>
<span class="token comment">//从session域获取用户</span>
<span class="token class-name">String</span> username <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> req<span class="token punctuation">.</span><span class="token function">getSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">"username"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>username<span class="token operator">!=</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
		<span class="token comment">//放行</span>
		chain<span class="token punctuation">.</span><span class="token function">doFilter</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
</code></pre> 
<pre><code>(2)认证cookie中的用户信息，如果认证成功则放行，失败则删除cookie(通过创建新的cookie放到resqonse中发给客户端的方式删除)
</code></pre> 
<pre><code class="prism language-java"><span class="token comment">//在请求中获取cookie（浏览器发过来不止一个cookie）</span>
<span class="token class-name">Cookie</span><span class="token punctuation">[</span><span class="token punctuation">]</span> cookies <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token function">getCookies</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">//如果没有cookie，不放行</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>cookies<span class="token operator">!=</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        	<span class="token comment">//遍历cookies，查找名为"userinfo"的cookie，若不存在，则不放行</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Cookie</span> cookie <span class="token operator">:</span> cookies<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>cookie<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">"userinfo"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
                    <span class="token class-name">String</span> value <span class="token operator">=</span> cookie<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token comment">//对该cookie的值进行解密</span>
                    <span class="token class-name">String</span> userinfo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span><span class="token class-name">Base64</span><span class="token punctuation">.</span><span class="token function">getDecoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">decode</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"utf-8"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token comment">//将用户信息字符串拆分</span>
                    <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> userinfos <span class="token operator">=</span> userinfo<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">"#"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token comment">//如果拆分后的字符串数组为空或者长度不等于2，则说明cookie有问题，删除cookie</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>userinfos<span class="token operator">!=</span><span class="token keyword">null</span><span class="token operator">&amp;&amp;</span>userinfos<span class="token punctuation">.</span>length<span class="token operator">==</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
                    	<span class="token comment">//调用业务逻辑层的用户登录方法获取用户，该部分代码省略，此处代码采用将用户名和密码写死的方式认证，采用写死的形式认证</span>
                        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">"admin"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>userinfos<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">&amp;&amp;</span><span class="token string">"888"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>userinfos<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
                        	<span class="token comment">//认证成功，将用户名放入session域中</span>
                            req<span class="token punctuation">.</span><span class="token function">getSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"username"</span><span class="token punctuation">,</span> userinfos<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token comment">//放行</span>
                            chain<span class="token punctuation">.</span><span class="token function">doFilter</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token keyword">return</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span>
                    <span class="token comment">//cookie存在问题或认证信息错误，删除cookie</span>
                    <span class="token comment">//创建新的cookie</span>
                    <span class="token class-name">Cookie</span> deleteCookie <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Cookie</span><span class="token punctuation">(</span><span class="token string">"userinfo"</span><span class="token punctuation">,</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token comment">//设置回传路径</span>
                    deleteCookie<span class="token punctuation">.</span><span class="token function">setPath</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span><span class="token function">getContextPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token comment">//设置过期时间为0（浏览器读到后删除cookie）</span>
                    deleteCookie<span class="token punctuation">.</span><span class="token function">setMaxAge</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token comment">//将cookie存进响应中</span>
                    resp<span class="token punctuation">.</span><span class="token function">addCookie</span><span class="token punctuation">(</span>deleteCookie<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/b50a4db0aef7e070fe9e027ea1d29b8f/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Python实现Excel和TXT文件格式的转换</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/beee1a0bd38b07d7fcc4ec685afb512e/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">C# 超详细的WebService创建、发布与调用（VS2019）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 追风少年的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>