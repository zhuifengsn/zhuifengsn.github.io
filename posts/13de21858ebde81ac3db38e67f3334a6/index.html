<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Centos7下安装、配置Redis5.0.3以及redis详解 - 追风少年的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Centos7下安装、配置Redis5.0.3以及redis详解" />
<meta property="og:description" content="一、安装 1.官网下载Redis
Redis官网(有时候需要翻墙)
2.上传下载好的包到Centos上并解压（本人上传到了usr/local目录下）
3.进入redis-5.0.3目录里，执行编译命令
&lt;span style=&#34;color:#000000&#34;&gt;&lt;code&gt;make &lt;/code&gt;&lt;/span&gt; 1 4.编译完成之后，将redis安装到指定目录
&lt;span style=&#34;color:#000000&#34;&gt;&lt;code&gt;make PREFIX=/usr/local/redis install &lt;/code&gt;&lt;/span&gt; 1 5.此时/usr/local/redis下生成了一个bin目录
至此安装完成；
二、启动 1.启动方式一
前台启动,不推荐使用，进入/usr/local/redis/bin里执行启动命令(默认端口号:6379)
&lt;span style=&#34;color:#000000&#34;&gt;&lt;code&gt;./redis-server &lt;/code&gt;&lt;/span&gt; 1 2.启动方式二
后台启动，推荐使用，将redis-5.0.3目录下的redis.conf文件复制到 /usr/local/redis/bin 下
&lt;span style=&#34;color:#000000&#34;&gt;&lt;code&gt;cp redis.conf /usr/local/redis/bin/ &lt;/code&gt;&lt;/span&gt; 1 修改redis.conf 设置为后台启动，将daemonize no改为daemonize yes即可(redis.conf文件内容较多，全局搜索：/daemonize 然后回车，再不断敲N即可)
启动Redis：进入/usr/local/redis/bin目录，执行下边命令
&lt;span style=&#34;color:#000000&#34;&gt;&lt;code&gt;./redis-server /usr/local/redis/bin/redis.conf 由于redis.conf与redis-serve在同一级目录，所以执行下边命令即可 ./redis-server redis.conf &lt;/code&gt;&lt;/span&gt; 123 关闭Redis：进入/usr/local/redis/bin目录，执行下边命令
&lt;span style=&#34;color:#000000&#34;&gt;&lt;code&gt;./redis-cli shutdown &lt;/code&gt;&lt;/span&gt; 1 3.查看redis进程：
&lt;span style=&#34;color:#000000&#34;&gt;&lt;code&gt;ps -ef | grep -i redis &lt;/code&gt;&lt;/span&gt; 1 看到如下信息：
&lt;span style=&#34;color:#000000&#34;&gt;&lt;code&gt;root 1218 1 0 12:04 ?" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://zhuifengsn.github.io/posts/13de21858ebde81ac3db38e67f3334a6/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-02-23T09:02:19+08:00" />
<meta property="article:modified_time" content="2021-02-23T09:02:19+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="追风少年的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">追风少年的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Centos7下安装、配置Redis5.0.3以及redis详解</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h2 style="margin-left:0px;"><strong><span style="color:#4f4f4f;">一、安装</span></strong></h2> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">1.官网下载Redis<br><a href="http://www.redis.cn/" rel="nofollow">Redis官网(有时候需要翻墙)</a><br><img alt="在这里插入图片描述" src="https://images2.imgbox.com/c5/55/SxfBX9TU_o.png"><br> 2.上传下载好的包到Centos上并解压（本人上传到了usr/local目录下）<br><img alt="在这里插入图片描述" src="https://images2.imgbox.com/e1/41/WnlRJcQP_o.png"><br> 3.进入redis-5.0.3目录里，执行编译命令</span></p> 
<pre class="has" style="margin-left:0px;"><code class="language-prettyprint">&lt;span style="color:#000000"&gt;&lt;code&gt;make
&lt;/code&gt;&lt;/span&gt;</code></pre> 
<ul style="margin-left:0px;"><li>1</li></ul> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">4.编译完成之后，将redis安装到指定目录</span></p> 
<pre class="has" style="margin-left:0px;"><code class="language-prettyprint">&lt;span style="color:#000000"&gt;&lt;code&gt;make PREFIX=/usr/local/redis install
&lt;/code&gt;&lt;/span&gt;</code></pre> 
<ul style="margin-left:0px;"><li>1</li></ul> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">5.此时/usr/local/redis下生成了一个bin目录<br><img alt="在这里插入图片描述" src="https://images2.imgbox.com/d7/94/RcRyS1vZ_o.png"><br> 至此安装完成；</span></p> 
<h2 style="margin-left:0px;"><strong><span style="color:#4f4f4f;"><a name="t1"></a><a id="_19"></a>二、启动</span></strong></h2> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">1.启动方式一<br> 前台启动,不推荐使用，进入/usr/local/redis/bin里执行启动命令(默认端口号:6379)</span></p> 
<pre class="has" style="margin-left:0px;"><code class="language-prettyprint">&lt;span style="color:#000000"&gt;&lt;code&gt;./redis-server
&lt;/code&gt;&lt;/span&gt;</code></pre> 
<ul style="margin-left:0px;"><li>1</li></ul> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">2.启动方式二<br> 后台启动，推荐使用，将redis-5.0.3目录下的redis.conf文件复制到 /usr/local/redis/bin 下</span></p> 
<pre class="has" style="margin-left:0px;"><code class="language-prettyprint">&lt;span style="color:#000000"&gt;&lt;code&gt;cp redis.conf /usr/local/redis/bin/
&lt;/code&gt;&lt;/span&gt;</code></pre> 
<ul style="margin-left:0px;"><li>1</li></ul> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">修改redis.conf 设置为后台启动，将daemonize no改为daemonize yes即可(redis.conf文件内容较多，全局搜索：/daemonize 然后回车，再不断敲N即可)<br><img alt="在这里插入图片描述" src="https://images2.imgbox.com/ec/da/PtdvrFr3_o.png"><br> 启动Redis：进入/usr/local/redis/bin目录，执行下边命令</span></p> 
<pre class="has" style="margin-left:0px;"><code class="language-prettyprint">&lt;span style="color:#000000"&gt;&lt;code&gt;./redis-server /usr/local/redis/bin/redis.conf
由于redis.conf与redis-serve在同一级目录，所以执行下边命令即可
./redis-server redis.conf
&lt;/code&gt;&lt;/span&gt;</code></pre> 
<ul style="margin-left:0px;"><li>1</li><li>2</li><li>3</li></ul> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">关闭Redis：进入/usr/local/redis/bin目录，执行下边命令</span></p> 
<pre class="has" style="margin-left:0px;"><code class="language-prettyprint">&lt;span style="color:#000000"&gt;&lt;code&gt;./redis-cli shutdown
&lt;/code&gt;&lt;/span&gt;</code></pre> 
<ul style="margin-left:0px;"><li>1</li></ul> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">3.查看redis进程：</span></p> 
<pre class="has" style="margin-left:0px;"><code class="language-prettyprint">&lt;span style="color:#000000"&gt;&lt;code&gt;ps -ef | grep -i redis
&lt;/code&gt;&lt;/span&gt;</code></pre> 
<ul style="margin-left:0px;"><li>1</li></ul> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">看到如下信息：</span></p> 
<pre class="has" style="margin-left:0px;"><code class="language-prettyprint">&lt;span style="color:#000000"&gt;&lt;code&gt;root       1218      1  0 12:04 ?        00:00:00 /usr/local/redis/bin/redis-server 127.0.0.1:6379
root       1257   1186  0 12:11 pts/0    00:00:00 grep --color=auto -i redis
&lt;/code&gt;&lt;/span&gt;</code></pre> 
<ul style="margin-left:0px;"><li>1</li><li>2</li></ul> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">可以杀死Redis进程：</span></p> 
<pre class="has" style="margin-left:0px;"><code class="language-prettyprint">&lt;span style="color:#000000"&gt;&lt;code&gt;kill -9 1218
&lt;/code&gt;&lt;/span&gt;</code></pre> 
<ul style="margin-left:0px;"><li>1</li></ul> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">4.客户端操作<br> 进入 /usr/local/redis/bin/目录：</span></p> 
<pre class="has" style="margin-left:0px;"><code class="language-prettyprint">&lt;span style="color:#000000"&gt;&lt;code&gt;./redis-cli
&lt;/code&gt;&lt;/span&gt;</code></pre> 
<ul style="margin-left:0px;"><li>1</li></ul> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">此时就可以设置值并取值了：<br><img alt="在这里插入图片描述" src="https://images2.imgbox.com/4b/41/l1cBxAD7_o.png"></span></p> 
<h2 style="margin-left:0px;"><strong><span style="color:#4f4f4f;"><a name="t2"></a><a id="_65"></a>三、配置</span></strong></h2> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">1.允许远程连接Redis<br> redis 默认只允许自己的电脑（127.0.0.1）连接。如果想要其他电脑进行远程连接，将配置文件 redis.conf 中的 bind 127.0.0.1 注释掉(之前没注释，需要改为将其注释掉，默认只能连接本地)。<br><img alt="在这里插入图片描述" src="https://images2.imgbox.com/65/b9/RfHGWNdH_o.png"><br> 找到配置文件redis.conf中protected mode，默认protected mode yes，需要将其改为protected mode no<br><img alt="在这里插入图片描述" src="https://images2.imgbox.com/eb/20/5dlVKYng_o.png"><br> 此时，远程就可以连接Redis了；<br><strong>redis自带客户端连接远程redis服务端：</strong></span></p> 
<pre class="has" style="margin-left:0px;"><code class="language-prettyprint">&lt;span style="color:#000000"&gt;&lt;code&gt;# 进入到redis安装目录的bin目录里，执行如下命令
./redis-cli -h 192.168.237.129 -p 6379
&lt;/code&gt;&lt;/span&gt;</code></pre> 
<ul style="margin-left:0px;"><li>1</li><li>2</li></ul> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">连接上以后就可以向服务端发送命令了，Redis提供了PING命令来测试客户端与Redis的连接是否正常，如果连接正常会收到回复PONG<br><img alt="在这里插入图片描述" src="https://images2.imgbox.com/3e/fe/ZEfWuHbG_o.png"><br> 使用set和get可以向redis设置数据、获取数据：<br><img alt="在这里插入图片描述" src="https://images2.imgbox.com/41/99/clExEO21_o.png"><br> del删除指定key的内容：</span></p> 
<pre class="has" style="margin-left:0px;"><code class="language-prettyprint">&lt;span style="color:#000000"&gt;&lt;code&gt;del name
&lt;/code&gt;&lt;/span&gt;</code></pre> 
<ul style="margin-left:0px;"><li>1</li></ul> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">查看当前库中所有的key值：</span></p> 
<pre class="has" style="margin-left:0px;"><code class="language-prettyprint">&lt;span style="color:#000000"&gt;&lt;code&gt;key  *
&lt;/code&gt;&lt;/span&gt;</code></pre> 
<ul style="margin-left:0px;"><li>1</li></ul> 
<h2 style="margin-left:0px;"><strong><span style="color:#4f4f4f;"><a name="t3"></a><a id="SpringBootRedis_92"></a>四、SpringBoot连接并操作Redis</span></strong></h2> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">1、引入依赖</span></p> 
<pre class="has" style="margin-left:0px;"><code class="language-prettyprint">&lt;span style="color:#000000"&gt;&lt;code&gt; &lt;!--Redis依赖--&gt;
&lt;dependency&gt;
   &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
   &lt;artifactId&gt;spring-boot-starter-data-redis&lt;/artifactId&gt;
&lt;/dependency&gt;
&lt;/code&gt;&lt;/span&gt;</code></pre> 
<ul style="margin-left:0px;"><li>1</li><li>2</li><li>3</li><li>4</li><li>5</li></ul> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">2、配置文件里配置redis</span></p> 
<pre class="has" style="margin-left:0px;"><code class="language-prettyprint">&lt;span style="color:#000000"&gt;&lt;code&gt;spring:
  application:
    name: order-service
  redis:
    database: 0
    #远程redis地址
    host: 192.168.237.128
    #redis默认端口就是6379
    port: 6379
    timeout: 2000
&lt;/code&gt;&lt;/span&gt;</code></pre> 
<ul style="margin-left:0px;"><li>1</li><li>2</li><li>3</li><li>4</li><li>5</li><li>6</li><li>7</li><li>8</li><li>9</li><li>10</li></ul> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">3、使用RedisTemplate操作Redis</span></p> 
<pre class="has" style="margin-left:0px;"><code class="language-prettyprint">&lt;span style="color:#000000"&gt;&lt;code class="language-java"&gt;&lt;span style="color:#999999"&gt;@Autowired&lt;/span&gt;
&lt;span style="color:#c678dd"&gt;private&lt;/span&gt; StringRedisTemplate redisTemplate&lt;span style="color:#999999"&gt;;&lt;/span&gt;
&lt;span style="color:#999999"&gt;.&lt;/span&gt;&lt;span style="color:#999999"&gt;.&lt;/span&gt;&lt;span style="color:#999999"&gt;.&lt;/span&gt;&lt;span style="color:#999999"&gt;.&lt;/span&gt;&lt;span style="color:#999999"&gt;.&lt;/span&gt;&lt;span style="color:#999999"&gt;.&lt;/span&gt;&lt;span style="color:#999999"&gt;.&lt;/span&gt;&lt;span style="color:#999999"&gt;.&lt;/span&gt;&lt;span style="color:#999999"&gt;.&lt;/span&gt;&lt;span style="color:#999999"&gt;.&lt;/span&gt;&lt;span style="color:#999999"&gt;.&lt;/span&gt;&lt;span style="color:#999999"&gt;.&lt;/span&gt;&lt;span style="color:#999999"&gt;.&lt;/span&gt;&lt;span style="color:#999999"&gt;.&lt;/span&gt;&lt;span style="color:#999999"&gt;.&lt;/span&gt;&lt;span style="color:#999999"&gt;.&lt;/span&gt;&lt;span style="color:#999999"&gt;.&lt;/span&gt;&lt;span style="color:#999999"&gt;.&lt;/span&gt;&lt;span style="color:#999999"&gt;.&lt;/span&gt;&lt;span style="color:#999999"&gt;.&lt;/span&gt;&lt;span style="color:#999999"&gt;.&lt;/span&gt;&lt;span style="color:#999999"&gt;.&lt;/span&gt;&lt;span style="color:#999999"&gt;.&lt;/span&gt;&lt;span style="color:#999999"&gt;.&lt;/span&gt;&lt;span style="color:#999999"&gt;.&lt;/span&gt;&lt;span style="color:#999999"&gt;.&lt;/span&gt;&lt;span style="color:#999999"&gt;.&lt;/span&gt;&lt;span style="color:#999999"&gt;.&lt;/span&gt;&lt;span style="color:#999999"&gt;.&lt;/span&gt;&lt;span style="color:#999999"&gt;.&lt;/span&gt;&lt;span style="color:#999999"&gt;.&lt;/span&gt;&lt;span style="color:#999999"&gt;.&lt;/span&gt;&lt;span style="color:#999999"&gt;.&lt;/span&gt;&lt;span style="color:#999999"&gt;.&lt;/span&gt;&lt;span style="color:#999999"&gt;.&lt;/span&gt;&lt;span style="color:#999999"&gt;.&lt;/span&gt;&lt;span style="color:#999999"&gt;.&lt;/span&gt;&lt;span style="color:#999999"&gt;.&lt;/span&gt;&lt;span style="color:#999999"&gt;.&lt;/span&gt;&lt;span style="color:#999999"&gt;.&lt;/span&gt;&lt;span style="color:#999999"&gt;.&lt;/span&gt;&lt;span style="color:#999999"&gt;.&lt;/span&gt;&lt;span style="color:#999999"&gt;.&lt;/span&gt;
  &lt;span style="color:#c678dd"&gt;private&lt;/span&gt; Object &lt;span style="color:#61aeee"&gt;saveOrderFail&lt;/span&gt;&lt;span style="color:#999999"&gt;(&lt;/span&gt;&lt;span style="color:#c678dd"&gt;int&lt;/span&gt; userId&lt;span style="color:#999999"&gt;,&lt;/span&gt; &lt;span style="color:#c678dd"&gt;int&lt;/span&gt; productId&lt;span style="color:#999999"&gt;,&lt;/span&gt; HttpServletRequest request&lt;span style="color:#999999"&gt;)&lt;/span&gt;&lt;span style="color:#999999"&gt;{&lt;/span&gt;
        &lt;span style="color:#5c6370"&gt;//监控报警 start&lt;/span&gt;
        String saveOrderKey&lt;span style="color:#669900"&gt;=&lt;/span&gt;&lt;span style="color:#669900"&gt;"save-order"&lt;/span&gt;&lt;span style="color:#999999"&gt;;&lt;/span&gt;
        String sendValue &lt;span style="color:#669900"&gt;=&lt;/span&gt; redisTemplate&lt;span style="color:#999999"&gt;.&lt;/span&gt;&lt;span style="color:#61aeee"&gt;opsForValue&lt;/span&gt;&lt;span style="color:#999999"&gt;(&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt;&lt;span style="color:#999999"&gt;.&lt;/span&gt;&lt;span style="color:#61aeee"&gt;get&lt;/span&gt;&lt;span style="color:#999999"&gt;(&lt;/span&gt;saveOrderKey&lt;span style="color:#999999"&gt;)&lt;/span&gt;&lt;span style="color:#999999"&gt;;&lt;/span&gt;
        String ip&lt;span style="color:#669900"&gt;=&lt;/span&gt;request&lt;span style="color:#999999"&gt;.&lt;/span&gt;&lt;span style="color:#61aeee"&gt;getRemoteAddr&lt;/span&gt;&lt;span style="color:#999999"&gt;(&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt;&lt;span style="color:#999999"&gt;;&lt;/span&gt;
        &lt;span style="color:#5c6370"&gt;//注意，这里需要异步，不能同步，不然此处阻塞的话(发短息耗时的话)不会继续向下走&lt;/span&gt;
        &lt;span style="color:#c678dd"&gt;new&lt;/span&gt; Thread&lt;span style="color:#999999"&gt;(&lt;/span&gt;&lt;span style="color:#999999"&gt;(&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt;&lt;span style="color:#669900"&gt;-&lt;/span&gt;&lt;span style="color:#669900"&gt;&gt;&lt;/span&gt;&lt;span style="color:#999999"&gt;{&lt;/span&gt;
            &lt;span style="color:#c678dd"&gt;if&lt;/span&gt;&lt;span style="color:#999999"&gt;(&lt;/span&gt;StringUtils&lt;span style="color:#999999"&gt;.&lt;/span&gt;&lt;span style="color:#61aeee"&gt;isBlank&lt;/span&gt;&lt;span style="color:#999999"&gt;(&lt;/span&gt;sendValue&lt;span style="color:#999999"&gt;)&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt;&lt;span style="color:#999999"&gt;{&lt;/span&gt;
                System&lt;span style="color:#999999"&gt;.&lt;/span&gt;out&lt;span style="color:#999999"&gt;.&lt;/span&gt;&lt;span style="color:#61aeee"&gt;println&lt;/span&gt;&lt;span style="color:#999999"&gt;(&lt;/span&gt;&lt;span style="color:#669900"&gt;"调用发短信接口去发送短信；用户下单失败，请马上处理；"&lt;/span&gt;&lt;span style="color:#669900"&gt;+&lt;/span&gt;ip&lt;span style="color:#999999"&gt;)&lt;/span&gt;&lt;span style="color:#999999"&gt;;&lt;/span&gt;
                &lt;span style="color:#5c6370"&gt;//此时调用发短信接口去发送短信，略过&lt;/span&gt;

                &lt;span style="color:#5c6370"&gt;/**
                 * 在Redis里放入数据，防止一直不停的发短信
                 * 间隔时间20秒(正常比这个数据久，这里为了测试先设置20秒)
                 */&lt;/span&gt;
                redisTemplate&lt;span style="color:#999999"&gt;.&lt;/span&gt;&lt;span style="color:#61aeee"&gt;opsForValue&lt;/span&gt;&lt;span style="color:#999999"&gt;(&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt;&lt;span style="color:#999999"&gt;.&lt;/span&gt;&lt;span style="color:#61aeee"&gt;set&lt;/span&gt;&lt;span style="color:#999999"&gt;(&lt;/span&gt;saveOrderKey&lt;span style="color:#999999"&gt;,&lt;/span&gt;&lt;span style="color:#669900"&gt;"save-order-fail"&lt;/span&gt;&lt;span style="color:#999999"&gt;,&lt;/span&gt;&lt;span style="color:#98c379"&gt;20&lt;/span&gt;&lt;span style="color:#999999"&gt;,&lt;/span&gt; TimeUnit&lt;span style="color:#999999"&gt;.&lt;/span&gt;SECONDS&lt;span style="color:#999999"&gt;)&lt;/span&gt;&lt;span style="color:#999999"&gt;;&lt;/span&gt;
            &lt;span style="color:#999999"&gt;}&lt;/span&gt;&lt;span style="color:#c678dd"&gt;else&lt;/span&gt;&lt;span style="color:#999999"&gt;{&lt;/span&gt;
                System&lt;span style="color:#999999"&gt;.&lt;/span&gt;out&lt;span style="color:#999999"&gt;.&lt;/span&gt;&lt;span style="color:#61aeee"&gt;println&lt;/span&gt;&lt;span style="color:#999999"&gt;(&lt;/span&gt;&lt;span style="color:#669900"&gt;"已经发生过短信了，20秒内不要发了"&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt;&lt;span style="color:#999999"&gt;;&lt;/span&gt;
            &lt;span style="color:#999999"&gt;}&lt;/span&gt;
        &lt;span style="color:#999999"&gt;}&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt;&lt;span style="color:#999999"&gt;.&lt;/span&gt;&lt;span style="color:#61aeee"&gt;start&lt;/span&gt;&lt;span style="color:#999999"&gt;(&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt;&lt;span style="color:#999999"&gt;;&lt;/span&gt;
        
        &lt;span style="color:#5c6370"&gt;//监控报警 end&lt;/span&gt;
        Map&lt;span style="color:#61aeee"&gt;&lt;span style="color:#999999"&gt;&lt;&lt;/span&gt;String&lt;span style="color:#999999"&gt;,&lt;/span&gt;Object&lt;span style="color:#999999"&gt;&gt;&lt;/span&gt;&lt;/span&gt; msg&lt;span style="color:#669900"&gt;=&lt;/span&gt;&lt;span style="color:#c678dd"&gt;new&lt;/span&gt; HashMap&lt;span style="color:#669900"&gt;&lt;&lt;/span&gt;&lt;span style="color:#669900"&gt;&gt;&lt;/span&gt;&lt;span style="color:#999999"&gt;(&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt;&lt;span style="color:#999999"&gt;;&lt;/span&gt;
        msg&lt;span style="color:#999999"&gt;.&lt;/span&gt;&lt;span style="color:#61aeee"&gt;put&lt;/span&gt;&lt;span style="color:#999999"&gt;(&lt;/span&gt;&lt;span style="color:#669900"&gt;"code"&lt;/span&gt;&lt;span style="color:#999999"&gt;,&lt;/span&gt;&lt;span style="color:#669900"&gt;-&lt;/span&gt;&lt;span style="color:#98c379"&gt;1&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt;&lt;span style="color:#999999"&gt;;&lt;/span&gt;
        msg&lt;span style="color:#999999"&gt;.&lt;/span&gt;&lt;span style="color:#61aeee"&gt;put&lt;/span&gt;&lt;span style="color:#999999"&gt;(&lt;/span&gt;&lt;span style="color:#669900"&gt;"msg"&lt;/span&gt;&lt;span style="color:#999999"&gt;,&lt;/span&gt;&lt;span style="color:#669900"&gt;"抢购人数太多，稍后重试"&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt;&lt;span style="color:#999999"&gt;;&lt;/span&gt;
        &lt;span style="color:#c678dd"&gt;return&lt;/span&gt; msg&lt;span style="color:#999999"&gt;;&lt;/span&gt;
    &lt;span style="color:#999999"&gt;}&lt;/span&gt;

&lt;/code&gt;&lt;/span&gt;</code></pre> 
<ul style="margin-left:0px;"><li>1</li><li>2</li><li>3</li><li>4</li><li>5</li><li>6</li><li>7</li><li>8</li><li>9</li><li>10</li><li>11</li><li>12</li><li>13</li><li>14</li><li>15</li><li>16</li><li>17</li><li>18</li><li>19</li><li>20</li><li>21</li><li>22</li><li>23</li><li>24</li><li>25</li><li>26</li><li>27</li><li>28</li><li>29</li><li>30</li><li>31</li></ul> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">使用RedisTemplate从redis里取数据</span></p> 
<pre class="has" style="margin-left:0px;"><code class="language-prettyprint">&lt;span style="color:#000000"&gt;&lt;code class="language-java"&gt;&lt;span style="color:#5c6370"&gt;//从缓存里取数据&lt;/span&gt;
&lt;span style="color:#c678dd"&gt;public&lt;/span&gt; Article &lt;span style="color:#61aeee"&gt;findById&lt;/span&gt;&lt;span style="color:#999999"&gt;(&lt;/span&gt;String id&lt;span style="color:#999999"&gt;)&lt;/span&gt; &lt;span style="color:#999999"&gt;{&lt;/span&gt;
	&lt;span style="color:#5c6370"&gt;//从缓存中提取&lt;/span&gt;
	Article article&lt;span style="color:#669900"&gt;=&lt;/span&gt;&lt;span style="color:#999999"&gt;(&lt;/span&gt;Article&lt;span style="color:#999999"&gt;)&lt;/span&gt;redisTemplate&lt;span style="color:#999999"&gt;.&lt;/span&gt;&lt;span style="color:#61aeee"&gt;opsForValue&lt;/span&gt;&lt;span style="color:#999999"&gt;(&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt;&lt;span style="color:#999999"&gt;.&lt;/span&gt;&lt;span style="color:#61aeee"&gt;get&lt;/span&gt;&lt;span style="color:#999999"&gt;(&lt;/span&gt;&lt;span style="color:#669900"&gt;"article_"&lt;/span&gt;&lt;span style="color:#669900"&gt;+&lt;/span&gt;id&lt;span style="color:#999999"&gt;)&lt;/span&gt;&lt;span style="color:#999999"&gt;;&lt;/span&gt;
	&lt;span style="color:#5c6370"&gt;// 如果缓存没有则到数据库查询并放入缓存&lt;/span&gt;
	&lt;span style="color:#c678dd"&gt;if&lt;/span&gt;&lt;span style="color:#999999"&gt;(&lt;/span&gt;article&lt;span style="color:#669900"&gt;==&lt;/span&gt;null&lt;span style="color:#999999"&gt;)&lt;/span&gt; &lt;span style="color:#999999"&gt;{&lt;/span&gt;
		article &lt;span style="color:#669900"&gt;=&lt;/span&gt; articleDao&lt;span style="color:#999999"&gt;.&lt;/span&gt;&lt;span style="color:#61aeee"&gt;findById&lt;/span&gt;&lt;span style="color:#999999"&gt;(&lt;/span&gt;id&lt;span style="color:#999999"&gt;)&lt;/span&gt;&lt;span style="color:#999999"&gt;.&lt;/span&gt;&lt;span style="color:#61aeee"&gt;get&lt;/span&gt;&lt;span style="color:#999999"&gt;(&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt;&lt;span style="color:#999999"&gt;;&lt;/span&gt;
		redisTemplate&lt;span style="color:#999999"&gt;.&lt;/span&gt;&lt;span style="color:#61aeee"&gt;opsForValue&lt;/span&gt;&lt;span style="color:#999999"&gt;(&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt;&lt;span style="color:#999999"&gt;.&lt;/span&gt;&lt;span style="color:#61aeee"&gt;set&lt;/span&gt;&lt;span style="color:#999999"&gt;(&lt;/span&gt;&lt;span style="color:#669900"&gt;"article_"&lt;/span&gt; &lt;span style="color:#669900"&gt;+&lt;/span&gt; id&lt;span style="color:#999999"&gt;,&lt;/span&gt; article&lt;span style="color:#999999"&gt;)&lt;/span&gt;&lt;span style="color:#999999"&gt;;&lt;/span&gt;
	&lt;span style="color:#999999"&gt;}&lt;/span&gt;
	&lt;span style="color:#c678dd"&gt;return&lt;/span&gt; article&lt;span style="color:#999999"&gt;;&lt;/span&gt;
&lt;span style="color:#999999"&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/span&gt;</code></pre> 
<ul style="margin-left:0px;"><li>1</li><li>2</li><li>3</li><li>4</li><li>5</li><li>6</li><li>7</li><li>8</li><li>9</li><li>10</li><li>11</li></ul> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">修改或删除数据库时使用RedisTemplate清空缓存</span></p> 
<pre class="has" style="margin-left:0px;"><code class="language-prettyprint">&lt;span style="color:#000000"&gt;&lt;code class="language-java"&gt;&lt;span style="color:#5c6370"&gt;/**
* 修改
* @param article
*/&lt;/span&gt;
&lt;span style="color:#c678dd"&gt;public&lt;/span&gt; &lt;span style="color:#c678dd"&gt;void&lt;/span&gt; &lt;span style="color:#61aeee"&gt;update&lt;/span&gt;&lt;span style="color:#999999"&gt;(&lt;/span&gt;Article article&lt;span style="color:#999999"&gt;)&lt;/span&gt; &lt;span style="color:#999999"&gt;{&lt;/span&gt;
	redisTemplate&lt;span style="color:#999999"&gt;.&lt;/span&gt;&lt;span style="color:#61aeee"&gt;delete&lt;/span&gt;&lt;span style="color:#999999"&gt;(&lt;/span&gt; &lt;span style="color:#669900"&gt;"article_"&lt;/span&gt; &lt;span style="color:#669900"&gt;+&lt;/span&gt; article&lt;span style="color:#999999"&gt;.&lt;/span&gt;&lt;span style="color:#61aeee"&gt;getId&lt;/span&gt;&lt;span style="color:#999999"&gt;(&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt; &lt;span style="color:#999999"&gt;)&lt;/span&gt;&lt;span style="color:#999999"&gt;;&lt;/span&gt;&lt;span style="color:#5c6370"&gt;//删除缓存&lt;/span&gt;
	articleDao&lt;span style="color:#999999"&gt;.&lt;/span&gt;&lt;span style="color:#61aeee"&gt;save&lt;/span&gt;&lt;span style="color:#999999"&gt;(&lt;/span&gt;article&lt;span style="color:#999999"&gt;)&lt;/span&gt;&lt;span style="color:#999999"&gt;;&lt;/span&gt;
&lt;span style="color:#999999"&gt;}&lt;/span&gt; 
&lt;span style="color:#5c6370"&gt;/**
* 删除
* @param id
*/&lt;/span&gt;
&lt;span style="color:#c678dd"&gt;public&lt;/span&gt; &lt;span style="color:#c678dd"&gt;void&lt;/span&gt; &lt;span style="color:#61aeee"&gt;deleteById&lt;/span&gt;&lt;span style="color:#999999"&gt;(&lt;/span&gt;String id&lt;span style="color:#999999"&gt;)&lt;/span&gt; &lt;span style="color:#999999"&gt;{&lt;/span&gt;
	redisTemplate&lt;span style="color:#999999"&gt;.&lt;/span&gt;&lt;span style="color:#61aeee"&gt;delete&lt;/span&gt;&lt;span style="color:#999999"&gt;(&lt;/span&gt; &lt;span style="color:#669900"&gt;"article_"&lt;/span&gt; &lt;span style="color:#669900"&gt;+&lt;/span&gt; id &lt;span style="color:#999999"&gt;)&lt;/span&gt;&lt;span style="color:#999999"&gt;;&lt;/span&gt;&lt;span style="color:#5c6370"&gt;//删除缓存&lt;/span&gt;
	articleDao&lt;span style="color:#999999"&gt;.&lt;/span&gt;&lt;span style="color:#61aeee"&gt;deleteById&lt;/span&gt;&lt;span style="color:#999999"&gt;(&lt;/span&gt;id&lt;span style="color:#999999"&gt;)&lt;/span&gt;&lt;span style="color:#999999"&gt;;&lt;/span&gt;
&lt;span style="color:#999999"&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/span&gt;</code></pre> 
<ul style="margin-left:0px;"><li>1</li><li>2</li><li>3</li><li>4</li><li>5</li><li>6</li><li>7</li><li>8</li><li>9</li><li>10</li><li>11</li><li>12</li><li>13</li><li>14</li><li>15</li><li>16</li></ul> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">使用RedisTemplate设置缓存过期时间</span></p> 
<pre class="has" style="margin-left:0px;"><code class="language-prettyprint">&lt;span style="color:#000000"&gt;&lt;code class="language-java"&gt;&lt;span style="color:#5c6370"&gt;//过期时间为一天&lt;/span&gt;
redisTemplate&lt;span style="color:#999999"&gt;.&lt;/span&gt;&lt;span style="color:#61aeee"&gt;opsForValue&lt;/span&gt;&lt;span style="color:#999999"&gt;(&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt;&lt;span style="color:#999999"&gt;.&lt;/span&gt;&lt;span style="color:#61aeee"&gt;set&lt;/span&gt;&lt;span style="color:#999999"&gt;(&lt;/span&gt;&lt;span style="color:#669900"&gt;"article_"&lt;/span&gt; &lt;span style="color:#669900"&gt;+&lt;/span&gt; id&lt;span style="color:#999999"&gt;,&lt;/span&gt; article&lt;span style="color:#999999"&gt;,&lt;/span&gt;&lt;span style="color:#98c379"&gt;1&lt;/span&gt;&lt;span style="color:#999999"&gt;,&lt;/span&gt;
TimeUnit&lt;span style="color:#999999"&gt;.&lt;/span&gt;DAYS&lt;span style="color:#999999"&gt;)&lt;/span&gt;&lt;span style="color:#999999"&gt;;&lt;/span&gt;

&lt;span style="color:#5c6370"&gt;//过期时间为10秒&lt;/span&gt;
redisTemplate&lt;span style="color:#999999"&gt;.&lt;/span&gt;&lt;span style="color:#61aeee"&gt;opsForValue&lt;/span&gt;&lt;span style="color:#999999"&gt;(&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt;&lt;span style="color:#999999"&gt;.&lt;/span&gt;&lt;span style="color:#61aeee"&gt;set&lt;/span&gt;&lt;span style="color:#999999"&gt;(&lt;/span&gt;&lt;span style="color:#669900"&gt;"article_"&lt;/span&gt; &lt;span style="color:#669900"&gt;+&lt;/span&gt; id&lt;span style="color:#999999"&gt;,&lt;/span&gt; article&lt;span style="color:#999999"&gt;,&lt;/span&gt;&lt;span style="color:#98c379"&gt;10&lt;/span&gt;&lt;span style="color:#999999"&gt;,&lt;/span&gt;
TimeUnit&lt;span style="color:#999999"&gt;.&lt;/span&gt;SECONDS&lt;span style="color:#999999"&gt;)&lt;/span&gt;&lt;span style="color:#999999"&gt;;&lt;/span&gt;
&lt;/code&gt;&lt;/span&gt;</code></pre> 
<ul style="margin-left:0px;"><li>1</li><li>2</li><li>3</li><li>4</li><li>5</li><li>6</li><li>7</li></ul> 
<h2 style="margin-left:0px;"><strong><span style="color:#4f4f4f;"><a name="t4"></a><a id="centos6redis_201"></a>五、centos6安装配置redis</span></strong></h2> 
<h2 style="margin-left:0px;"><strong><span style="color:#4f4f4f;"><a name="t5"></a><a id="redis_202"></a>redis安装和配置</span></strong></h2> 
<h3 style="margin-left:0px;"><strong><span style="color:#4f4f4f;"><a name="t6"></a><a id="1_204"></a>1.安装</span></strong></h3> 
<ul style="margin-left:0px;"><li> <p style="margin-left:0px;"><span style="color:#4d4d4d;">下载安装包<br><a href="https://redis.io/download" rel="nofollow">官网下载</a></span></p> </li><li> <p style="margin-left:0px;"><span style="color:#4d4d4d;">解压</span></p> </li></ul> 
<pre class="has" style="margin-left:0px;"><code class="language-prettyprint">&lt;span style="color:#000000"&gt;&lt;code class="language-shell"&gt; &lt;span style="color:#61aeee"&gt;tar&lt;/span&gt; -xvf redis-4.0.9.tar.gz
&lt;/code&gt;&lt;/span&gt;</code></pre> 
<ul style="margin-left:0px;"><li>1</li></ul> 
<ul style="margin-left:0px;"><li>编译安装</li></ul> 
<pre class="has" style="margin-left:0px;"><code class="language-prettyprint">&lt;span style="color:#000000"&gt;&lt;code class="language-shell"&gt; &lt;span style="color:#61aeee"&gt;mv&lt;/span&gt; redis-4.0.9 redis
 &lt;span style="color:#61aeee"&gt;cd&lt;/span&gt; redis
 &lt;span style="color:#61aeee"&gt;make&lt;/span&gt; &lt;span style="color:#669900"&gt;&amp;&amp;&lt;/span&gt; &lt;span style="color:#61aeee"&gt;make&lt;/span&gt; &lt;span style="color:#61aeee"&gt;install&lt;/span&gt;
&lt;/code&gt;&lt;/span&gt;</code></pre> 
<ul style="margin-left:0px;"><li>1</li><li>2</li><li>3</li></ul> 
<h3 style="margin-left:0px;"><strong><span style="color:#4f4f4f;"><a name="t7"></a><a id="2_220"></a>2.配置</span></strong></h3> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">修改安装目录下的redis.conf文件</span></p> 
<pre class="has" style="margin-left:0px;"><code class="language-prettyprint">&lt;span style="color:#000000"&gt;&lt;code class="language-shell"&gt;vim redis.conf
&lt;/code&gt;&lt;/span&gt;</code></pre> 
<ul style="margin-left:0px;"><li>1</li></ul> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">修改以下配置：</span></p> 
<pre class="has" style="margin-left:0px;"><code class="language-prettyprint">&lt;span style="color:#000000"&gt;&lt;code class="language-shell"&gt;&lt;span style="color:#5c6370"&gt;#bind 127.0.0.1 # 将这行代码注释，监听所有的ip地址，外网可以访问&lt;/span&gt;
protected-mode no &lt;span style="color:#5c6370"&gt;# 把yes改成no，允许外网访问&lt;/span&gt;
daemonize &lt;span style="color:#61aeee"&gt;yes&lt;/span&gt; &lt;span style="color:#5c6370"&gt;# 把no改成yes，后台运行&lt;/span&gt;
&lt;/code&gt;&lt;/span&gt;</code></pre> 
<ul style="margin-left:0px;"><li>1</li><li>2</li><li>3</li></ul> 
<h3 style="margin-left:0px;"><strong><span style="color:#4f4f4f;"><a name="t8"></a><a id="3_233"></a>3.启动或停止</span></strong></h3> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">redis提供了服务端命令和客户端命令：</span></p> 
<ul style="margin-left:0px;"><li>redis-server 服务端命令，可以包含以下参数：<br> start 启动<br> stop 停止</li><li>redis-cli 客户端控制台，包含参数：<br> -h xxx 指定服务端地址，缺省值是127.0.0.1<br> -p xxx 指定服务端端口，缺省值是6379</li></ul> 
<h3 style="margin-left:0px;"><strong><span style="color:#4f4f4f;"><a name="t9"></a><a id="4_242"></a>4.设置开机启动</span></strong></h3> 
<ol style="margin-left:0px;"><li>输入命令，新建文件</li></ol> 
<pre class="has" style="margin-left:0px;"><code class="language-prettyprint">&lt;span style="color:#000000"&gt;&lt;code class="language-sh"&gt;vim /etc/init.d/redis
&lt;/code&gt;&lt;/span&gt;</code></pre> 
<ul style="margin-left:0px;"><li>1</li></ul> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">输入下面内容：</span></p> 
<pre class="has" style="margin-left:0px;"><code class="language-prettyprint">&lt;span style="color:#000000"&gt;&lt;code class="language-sh"&gt;#!/bin/sh
# chkconfig:   2345 90 10
# description:  Redis is a persistent key-value database
PATH=/usr/local/bin:/sbin:/usr/bin:/bin

REDISPORT=6379
EXEC=/usr/local/bin/redis-server
REDIS_CLI=/usr/local/bin/redis-cli

PIDFILE=/var/run/redis.pid

CONF="/home/leyou/redis/redis.conf"

case "$1" in  
    start)  
        if [ -f $PIDFILE ]  
        then  
                echo "$PIDFILE exists, process is already running or crashed"  
        else  
                echo "Starting Redis server..."  
                $EXEC $CONF  
        fi  
        if [ "$?"="0" ]   
        then  
              echo "Redis is running..."  
        fi  
        ;;  
    stop)  
        if [ ! -f $PIDFILE ]  
        then  
                echo "$PIDFILE does not exist, process is not running"  
        else  
                PID=$(cat $PIDFILE)  
                echo "Stopping ..."  
                $REDIS_CLI -p $REDISPORT SHUTDOWN  
                while [ -x ${PIDFILE} ]  
               do  
                    echo "Waiting for Redis to shutdown ..."  
                    sleep 1  
                done  
                echo "Redis stopped"  
        fi  
        ;;  
   restart|force-reload)  
        ${0} stop  
        ${0} start  
        ;;  
  *)  
    echo "Usage: /etc/init.d/redis {start|stop|restart|force-reload}" &gt;&amp;2  
        exit 1  
esac

&lt;/code&gt;&lt;/span&gt;</code></pre> 
<ul style="margin-left:0px;"><li>1</li><li>2</li><li>3</li><li>4</li><li>5</li><li>6</li><li>7</li><li>8</li><li>9</li><li>10</li><li>11</li><li>12</li><li>13</li><li>14</li><li>15</li><li>16</li><li>17</li><li>18</li><li>19</li><li>20</li><li>21</li><li>22</li><li>23</li><li>24</li><li>25</li><li>26</li><li>27</li><li>28</li><li>29</li><li>30</li><li>31</li><li>32</li><li>33</li><li>34</li><li>35</li><li>36</li><li>37</li><li>38</li><li>39</li><li>40</li><li>41</li><li>42</li><li>43</li><li>44</li><li>45</li><li>46</li><li>47</li><li>48</li><li>49</li><li>50</li><li>51</li><li>52</li></ul> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">然后保存退出</span></p> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">注意：以下信息需要根据安装目录进行调整：</span></p> 
<blockquote> 
 <p style="margin-left:0px;"><span style="color:#555666;">EXEC=/usr/local/bin/redis-server # 执行脚本的地址</span></p> 
 <p style="margin-left:0px;"><span style="color:#555666;">REDIS_CLI=/usr/local/bin/redis-cli # 客户端执行脚本的地址</span></p> 
 <p style="margin-left:0px;"><span style="color:#555666;">PIDFILE=/var/run/redis.pid # 进程id文件地址</span></p> 
 <p style="margin-left:0px;"><span style="color:#555666;">CONF="/usr/local/src/redis-3.0.2/redis.conf" #配置文件地址</span></p> 
</blockquote> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">2）设置权限</span></p> 
<pre class="has" style="margin-left:0px;"><code class="language-prettyprint">&lt;span style="color:#000000"&gt;&lt;code class="language-sh"&gt;chmod 755 /etc/init.d/redis
&lt;/code&gt;&lt;/span&gt;</code></pre> 
<ul style="margin-left:0px;"><li>1</li></ul> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">3）启动测试</span></p> 
<pre class="has" style="margin-left:0px;"><code class="language-prettyprint">&lt;span style="color:#000000"&gt;&lt;code class="language-sh"&gt;/etc/init.d/redis start
&lt;/code&gt;&lt;/span&gt;</code></pre> 
<ul style="margin-left:0px;"><li>1</li></ul> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">启动成功会提示如下信息：</span></p> 
<pre class="has" style="margin-left:0px;"><code class="language-prettyprint">&lt;span style="color:#000000"&gt;&lt;code&gt;Starting Redis server...
Redis is running...
&lt;/code&gt;&lt;/span&gt;</code></pre> 
<ul style="margin-left:0px;"><li>1</li><li>2</li></ul> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">4）设置开机自启动</span></p> 
<pre class="has" style="margin-left:0px;"><code class="language-prettyprint">&lt;span style="color:#000000"&gt;&lt;code class="language-sh"&gt;chkconfig --add /etc/init.d/redis
chkconfig redis on
&lt;/code&gt;&lt;/span&gt;</code></pre> 
<ul style="margin-left:0px;"><li>1</li><li>2</li></ul> 
<h2 style="margin-left:0px;"><strong><span style="color:#4f4f4f;"><a name="t10"></a><a id="redis_348"></a>六、redis多数据库</span></strong></h2> 
<h3 style="margin-left:0px;"><strong><span style="color:#4f4f4f;"><a name="t11"></a><a id="redis_349"></a>启动多个redis进程</span></strong></h3> 
<ol style="margin-left:0px;"><li>创建多个redis目录，以端口号命名，比如：创建6379、6380两个目录，将redis的安装文件bin和conf拷贝至这两个目录。</li><li>修改6379目录下的redis.conf设置端口号为6379<br> 修改6380目录下的redis.conf设置端口号为6380</li><li>启动6379和6380目录下的redis-server程序：</li></ol> 
<pre class="has" style="margin-left:0px;"><code class="language-prettyprint">&lt;span style="color:#000000"&gt;&lt;code&gt;cd 6379
./redis-server . /redis.conf
cd 6380
./redis-server . /redis.conf
&lt;/code&gt;&lt;/span&gt;</code></pre> 
<ul style="margin-left:0px;"><li>1</li><li>2</li><li>3</li><li>4</li></ul> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">此时，查看redis进程，发现有两个redis进程在运行<br><img alt="在这里插入图片描述" src="https://images2.imgbox.com/a0/cc/xnY6KXgP_o.png"></span></p> 
<h3 style="margin-left:0px;"><strong><span style="color:#4f4f4f;"><a name="t12"></a><a id="redis_364"></a>redis实例</span></strong></h3> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">一个redis进程就是一个redis实例，一台服务器可以同时有多个redis实例，不同的redis实例提供不同的服务端口对外提供服务，每个redis实例之间互相影响。每个redis实例都包括自己的数据库，数据库中可以存储自己的数据。</span></p> 
<h3 style="margin-left:0px;"><strong><span style="color:#4f4f4f;"><a name="t13"></a><a id="_366"></a>多数据库测试</span></strong></h3> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">一个Redis实例可以包括多个数据库，客户端可以指定连接某个redis实例的哪个数据库，就好比一个mysql中创建多个数据库，客户端连接时指定连接哪个数据库。<br> 一个redis实例最多可提供16个数据库，下标从0到15，客户端默认连接第0号数据库，也可以通过select选择连接哪个数据库，如下连接1号库：<br><img alt="在这里插入图片描述" src="https://images2.imgbox.com/56/74/l90PoyJX_o.png"><br> 在1号库中查询上节设置的数据，结果查询不到：<br><img alt="在这里插入图片描述" src="https://images2.imgbox.com/09/f3/2oCV5k4t_o.png"><br> 重新选择第0号数据库，查询数据：<br><img alt="在这里插入图片描述" src="https://images2.imgbox.com/69/a7/YrkQD0vB_o.png"><br> 如果选择一个不存在的数据库则会报错：<br><img alt="在这里插入图片描述" src="https://images2.imgbox.com/a4/ab/U1rCcGgP_o.png"><br> 注意：redis不支持修改数据库的名称，只能通过select 0、select 1…选择数据库</span></p> 
<h3 style="margin-left:0px;"><strong><span style="color:#4f4f4f;"><a name="t14"></a><a id="_378"></a>注意的问题</span></strong></h3> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">在0号数据库存储数据，在1号数据库执行清空数据命令却把0号数据库的数据给清空了：<br><img alt="在这里插入图片描述" src="https://images2.imgbox.com/a8/be/UqGMaGJX_o.png"><br> 建议：不同的应用系统要使用不同的redis实例，而不是使用同一个redis实例下的不同数据库。</span></p> 
<h2 style="margin-left:0px;"><strong><span style="color:#4f4f4f;"><a name="t15"></a><a id="Jedis_383"></a>七、Jedis</span></strong></h2> 
<h3 style="margin-left:0px;"><strong><span style="color:#4f4f4f;"><a name="t16"></a><a id="71jedis_384"></a>7.1、jedis介绍</span></strong></h3> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">Redis不仅是使用命令来操作，现在基本上主流的语言都有客户端支持，比如java、C、C#、C++、php、Node.js、Go等。<br> 在官方网站里列一些Java的客户端，有Jedis、Redisson、Jredis、JDBC-Redis等，其中官方推荐使用Jedis和Redisson。 在企业中用的最多的就是Jedis，下面我们就重点学习下Jedis。 Jedis同样也是托管在github上，地址：https://github.com/xetorthio/jedis</span></p> 
<h3 style="margin-left:0px;"><strong><span style="color:#4f4f4f;"><a name="t17"></a><a id="72%09jedisredis_387"></a>7.2 通过jedis连接redis单机</span></strong></h3> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">添加依赖</span></p> 
<pre class="has" style="margin-left:0px;"><code class="language-prettyprint">&lt;span style="color:#000000"&gt;&lt;code&gt;&lt;dependency&gt;
    &lt;groupId&gt;redis.clients&lt;/groupId&gt;
	&lt;artifactId&gt;jedis&lt;/artifactId&gt;
	&lt;version&gt;2.7.0&lt;/version&gt;
&lt;/dependency&gt;
&lt;/code&gt;&lt;/span&gt;</code></pre> 
<ul style="margin-left:0px;"><li>1</li><li>2</li><li>3</li><li>4</li><li>5</li></ul> 
<h4 style="margin-left:0px;"><strong><span style="color:#4f4f4f;"><a name="t18"></a><a id="721%09_397"></a>7.2.1 单实例连接</span></strong></h4> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">通过创建单实例jedis对象连接redis服务，如下代码</span></p> 
<pre class="has" style="margin-left:0px;"><code class="language-prettyprint">&lt;span style="color:#000000"&gt;&lt;code class="language-java"&gt;    &lt;span style="color:#5c6370"&gt;// 单实例连接redis&lt;/span&gt;
	&lt;span style="color:#999999"&gt;@Test&lt;/span&gt;
	&lt;span style="color:#c678dd"&gt;public&lt;/span&gt; &lt;span style="color:#c678dd"&gt;void&lt;/span&gt; &lt;span style="color:#61aeee"&gt;testJedisSingle&lt;/span&gt;&lt;span style="color:#999999"&gt;(&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt; &lt;span style="color:#999999"&gt;{&lt;/span&gt;
		Jedis jedis &lt;span style="color:#669900"&gt;=&lt;/span&gt; &lt;span style="color:#c678dd"&gt;new&lt;/span&gt; Jedis&lt;span style="color:#999999"&gt;(&lt;/span&gt;&lt;span style="color:#669900"&gt;"192.168.237.129"&lt;/span&gt;&lt;span style="color:#999999"&gt;,&lt;/span&gt; &lt;span style="color:#98c379"&gt;6379&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt;&lt;span style="color:#999999"&gt;;&lt;/span&gt;
		jedis&lt;span style="color:#999999"&gt;.&lt;/span&gt;&lt;span style="color:#61aeee"&gt;set&lt;/span&gt;&lt;span style="color:#999999"&gt;(&lt;/span&gt;&lt;span style="color:#669900"&gt;"name"&lt;/span&gt;&lt;span style="color:#999999"&gt;,&lt;/span&gt; &lt;span style="color:#669900"&gt;"bar"&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt;&lt;span style="color:#999999"&gt;;&lt;/span&gt;
		String name &lt;span style="color:#669900"&gt;=&lt;/span&gt; jedis&lt;span style="color:#999999"&gt;.&lt;/span&gt;&lt;span style="color:#61aeee"&gt;get&lt;/span&gt;&lt;span style="color:#999999"&gt;(&lt;/span&gt;&lt;span style="color:#669900"&gt;"name"&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt;&lt;span style="color:#999999"&gt;;&lt;/span&gt;
		System&lt;span style="color:#999999"&gt;.&lt;/span&gt;out&lt;span style="color:#999999"&gt;.&lt;/span&gt;&lt;span style="color:#61aeee"&gt;println&lt;/span&gt;&lt;span style="color:#999999"&gt;(&lt;/span&gt;name&lt;span style="color:#999999"&gt;)&lt;/span&gt;&lt;span style="color:#999999"&gt;;&lt;/span&gt;
		jedis&lt;span style="color:#999999"&gt;.&lt;/span&gt;&lt;span style="color:#61aeee"&gt;close&lt;/span&gt;&lt;span style="color:#999999"&gt;(&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt;&lt;span style="color:#999999"&gt;;&lt;/span&gt;
	&lt;span style="color:#999999"&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/span&gt;</code></pre> 
<ul style="margin-left:0px;"><li>1</li><li>2</li><li>3</li><li>4</li><li>5</li><li>6</li><li>7</li><li>8</li><li>9</li></ul> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">连接超时解决<br> 由于linux防火墙默认开启，redis的服务端口6379并不在开放规则之内，所有需要将此端口开放访问或者关闭防火墙。关闭防火墙命令：</span></p> 
<pre class="has" style="margin-left:0px;"><code class="language-prettyprint">&lt;span style="color:#000000"&gt;&lt;code&gt;sevice iptables stop
&lt;/code&gt;&lt;/span&gt;</code></pre> 
<ul style="margin-left:0px;"><li>1</li></ul> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">如果是修改防火墙规则，可以修改：/etc/sysconfig/iptables文件</span></p> 
<h4 style="margin-left:0px;"><strong><span style="color:#4f4f4f;"><a name="t19"></a><a id="722%09_418"></a>7.2.2 使用连接池连接</span></strong></h4> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">通过单实例连接redis不能对redis连接进行共享，可以使用连接池对redis连接进行共享，提高资源利用率，使用jedisPool连接redis服务，如下代码：</span></p> 
<pre class="has" style="margin-left:0px;"><code class="language-prettyprint">&lt;span style="color:#000000"&gt;&lt;code class="language-java"&gt;    &lt;span style="color:#999999"&gt;@Test&lt;/span&gt;
	&lt;span style="color:#c678dd"&gt;public&lt;/span&gt; &lt;span style="color:#c678dd"&gt;void&lt;/span&gt; &lt;span style="color:#61aeee"&gt;pool&lt;/span&gt;&lt;span style="color:#999999"&gt;(&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt; &lt;span style="color:#999999"&gt;{&lt;/span&gt;
		JedisPoolConfig config &lt;span style="color:#669900"&gt;=&lt;/span&gt; &lt;span style="color:#c678dd"&gt;new&lt;/span&gt; JedisPoolConfig&lt;span style="color:#999999"&gt;(&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt;&lt;span style="color:#999999"&gt;;&lt;/span&gt;
		&lt;span style="color:#5c6370"&gt;//最大连接数&lt;/span&gt;
		config&lt;span style="color:#999999"&gt;.&lt;/span&gt;&lt;span style="color:#61aeee"&gt;setMaxTotal&lt;/span&gt;&lt;span style="color:#999999"&gt;(&lt;/span&gt;&lt;span style="color:#98c379"&gt;30&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt;&lt;span style="color:#999999"&gt;;&lt;/span&gt;
		&lt;span style="color:#5c6370"&gt;//最大连接空闲数&lt;/span&gt;
		config&lt;span style="color:#999999"&gt;.&lt;/span&gt;&lt;span style="color:#61aeee"&gt;setMaxIdle&lt;/span&gt;&lt;span style="color:#999999"&gt;(&lt;/span&gt;&lt;span style="color:#98c379"&gt;2&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt;&lt;span style="color:#999999"&gt;;&lt;/span&gt;
		
		JedisPool pool &lt;span style="color:#669900"&gt;=&lt;/span&gt; &lt;span style="color:#c678dd"&gt;new&lt;/span&gt; JedisPool&lt;span style="color:#999999"&gt;(&lt;/span&gt;config&lt;span style="color:#999999"&gt;,&lt;/span&gt; &lt;span style="color:#669900"&gt;"192.168.237.129"&lt;/span&gt;&lt;span style="color:#999999"&gt;,&lt;/span&gt; &lt;span style="color:#98c379"&gt;6379&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt;&lt;span style="color:#999999"&gt;;&lt;/span&gt;
		Jedis jedis &lt;span style="color:#669900"&gt;=&lt;/span&gt; null&lt;span style="color:#999999"&gt;;&lt;/span&gt;

		&lt;span style="color:#c678dd"&gt;try&lt;/span&gt;  &lt;span style="color:#999999"&gt;{&lt;/span&gt;
			jedis &lt;span style="color:#669900"&gt;=&lt;/span&gt; pool&lt;span style="color:#999999"&gt;.&lt;/span&gt;&lt;span style="color:#61aeee"&gt;getResource&lt;/span&gt;&lt;span style="color:#999999"&gt;(&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt;&lt;span style="color:#999999"&gt;;&lt;/span&gt;
			
			jedis&lt;span style="color:#999999"&gt;.&lt;/span&gt;&lt;span style="color:#61aeee"&gt;set&lt;/span&gt;&lt;span style="color:#999999"&gt;(&lt;/span&gt;&lt;span style="color:#669900"&gt;"name"&lt;/span&gt;&lt;span style="color:#999999"&gt;,&lt;/span&gt; &lt;span style="color:#669900"&gt;"lisi"&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt;&lt;span style="color:#999999"&gt;;&lt;/span&gt;
			String name &lt;span style="color:#669900"&gt;=&lt;/span&gt; jedis&lt;span style="color:#999999"&gt;.&lt;/span&gt;&lt;span style="color:#61aeee"&gt;get&lt;/span&gt;&lt;span style="color:#999999"&gt;(&lt;/span&gt;&lt;span style="color:#669900"&gt;"name"&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt;&lt;span style="color:#999999"&gt;;&lt;/span&gt;
			System&lt;span style="color:#999999"&gt;.&lt;/span&gt;out&lt;span style="color:#999999"&gt;.&lt;/span&gt;&lt;span style="color:#61aeee"&gt;println&lt;/span&gt;&lt;span style="color:#999999"&gt;(&lt;/span&gt;name&lt;span style="color:#999999"&gt;)&lt;/span&gt;&lt;span style="color:#999999"&gt;;&lt;/span&gt;
		&lt;span style="color:#999999"&gt;}&lt;/span&gt;&lt;span style="color:#c678dd"&gt;catch&lt;/span&gt;&lt;span style="color:#999999"&gt;(&lt;/span&gt;Exception ex&lt;span style="color:#999999"&gt;)&lt;/span&gt;&lt;span style="color:#999999"&gt;{&lt;/span&gt;
			ex&lt;span style="color:#999999"&gt;.&lt;/span&gt;&lt;span style="color:#61aeee"&gt;printStackTrace&lt;/span&gt;&lt;span style="color:#999999"&gt;(&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt;&lt;span style="color:#999999"&gt;;&lt;/span&gt;
		&lt;span style="color:#999999"&gt;}&lt;/span&gt;&lt;span style="color:#c678dd"&gt;finally&lt;/span&gt;&lt;span style="color:#999999"&gt;{&lt;/span&gt;
			&lt;span style="color:#c678dd"&gt;if&lt;/span&gt;&lt;span style="color:#999999"&gt;(&lt;/span&gt;jedis &lt;span style="color:#669900"&gt;!=&lt;/span&gt; null&lt;span style="color:#999999"&gt;)&lt;/span&gt;&lt;span style="color:#999999"&gt;{&lt;/span&gt;
				&lt;span style="color:#5c6370"&gt;//关闭连接&lt;/span&gt;
				jedis&lt;span style="color:#999999"&gt;.&lt;/span&gt;&lt;span style="color:#61aeee"&gt;close&lt;/span&gt;&lt;span style="color:#999999"&gt;(&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt;&lt;span style="color:#999999"&gt;;&lt;/span&gt;
			&lt;span style="color:#999999"&gt;}&lt;/span&gt;
		&lt;span style="color:#999999"&gt;}&lt;/span&gt;
	&lt;span style="color:#999999"&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/span&gt;</code></pre> 
<ul style="margin-left:0px;"><li>1</li><li>2</li><li>3</li><li>4</li><li>5</li><li>6</li><li>7</li><li>8</li><li>9</li><li>10</li><li>11</li><li>12</li><li>13</li><li>14</li><li>15</li><li>16</li><li>17</li><li>18</li><li>19</li><li>20</li><li>21</li><li>22</li><li>23</li><li>24</li><li>25</li><li>26</li></ul> 
<h4 style="margin-left:0px;"><strong><span style="color:#4f4f4f;"><a name="t20"></a><a id="723jedisspring_449"></a>7.2.3、jedis与spring整合</span></strong></h4> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">配置spring配置文件applicationContext.xml</span></p> 
<pre class="has" style="margin-left:0px;"><code class="language-prettyprint">&lt;span style="color:#000000"&gt;&lt;code&gt;&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:mvc="http://www.springframework.org/schema/mvc"
	xmlns:context="http://www.springframework.org/schema/context"
	xmlns:aop="http://www.springframework.org/schema/aop" xmlns:tx="http://www.springframework.org/schema/tx"
	xsi:schemaLocation="http://www.springframework.org/schema/beans 
		http://www.springframework.org/schema/beans/spring-beans-3.2.xsd 
		http://www.springframework.org/schema/mvc 
		http://www.springframework.org/schema/mvc/spring-mvc-3.2.xsd 
		http://www.springframework.org/schema/context 
		http://www.springframework.org/schema/context/spring-context-3.2.xsd 
		http://www.springframework.org/schema/aop 
		http://www.springframework.org/schema/aop/spring-aop-3.2.xsd 
		http://www.springframework.org/schema/tx 
		http://www.springframework.org/schema/tx/spring-tx-3.2.xsd "&gt;

    &lt;!-- 连接池配置 --&gt;
	&lt;bean id="jedisPoolConfig" class="redis.clients.jedis.JedisPoolConfig"&gt;
		&lt;!-- 最大连接数 --&gt;
		&lt;property name="maxTotal" value="30" /&gt;
		&lt;!-- 最大空闲连接数 --&gt;
		&lt;property name="maxIdle" value="10" /&gt;
		&lt;!-- 每次释放连接的最大数目 --&gt;
		&lt;property name="numTestsPerEvictionRun" value="1024" /&gt;
		&lt;!-- 释放连接的扫描间隔（毫秒） --&gt;
		&lt;property name="timeBetweenEvictionRunsMillis" value="30000" /&gt;
		&lt;!-- 连接最小空闲时间 --&gt;
		&lt;property name="minEvictableIdleTimeMillis" value="1800000" /&gt;
		&lt;!-- 连接空闲多久后释放, 当空闲时间&gt;该值 且 空闲连接&gt;最大空闲连接数 时直接释放 --&gt;
		&lt;property name="softMinEvictableIdleTimeMillis" value="10000" /&gt;
		&lt;!-- 获取连接时的最大等待毫秒数,小于零:阻塞不确定的时间,默认-1 --&gt;
		&lt;property name="maxWaitMillis" value="1500" /&gt;
		&lt;!-- 在获取连接的时候检查有效性, 默认false --&gt;
		&lt;property name="testOnBorrow" value="true" /&gt;
		&lt;!-- 在空闲时检查有效性, 默认false --&gt;
		&lt;property name="testWhileIdle" value="true" /&gt;
		&lt;!-- 连接耗尽时是否阻塞, false报异常,ture阻塞直到超时, 默认true --&gt;
		&lt;property name="blockWhenExhausted" value="false" /&gt;
	&lt;/bean&gt;
	
	&lt;!-- redis单机 通过连接池 --&gt;
	&lt;bean id="jedisPool" class="redis.clients.jedis.JedisPool" destroy-method="close"&gt;
		&lt;constructor-arg name="poolConfig" ref="jedisPoolConfig"/&gt;
		&lt;constructor-arg name="host" value="192.168.25.145"/&gt;
		&lt;constructor-arg name="port" value="6379"/&gt;
	&lt;/bean&gt;
&lt;/beans&gt;
&lt;/code&gt;&lt;/span&gt;</code></pre> 
<ul style="margin-left:0px;"><li>1</li><li>2</li><li>3</li><li>4</li><li>5</li><li>6</li><li>7</li><li>8</li><li>9</li><li>10</li><li>11</li><li>12</li><li>13</li><li>14</li><li>15</li><li>16</li><li>17</li><li>18</li><li>19</li><li>20</li><li>21</li><li>22</li><li>23</li><li>24</li><li>25</li><li>26</li><li>27</li><li>28</li><li>29</li><li>30</li><li>31</li><li>32</li><li>33</li><li>34</li><li>35</li><li>36</li><li>37</li><li>38</li><li>39</li><li>40</li><li>41</li><li>42</li><li>43</li><li>44</li><li>45</li><li>46</li><li>47</li></ul> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">测试代码：</span></p> 
<pre class="has" style="margin-left:0px;"><code class="language-prettyprint">&lt;span style="color:#000000"&gt;&lt;code class="language-java"&gt;    &lt;span style="color:#c678dd"&gt;private&lt;/span&gt; ApplicationContext applicationContext&lt;span style="color:#999999"&gt;;&lt;/span&gt;

	&lt;span style="color:#999999"&gt;@Before&lt;/span&gt;
	&lt;span style="color:#c678dd"&gt;public&lt;/span&gt; &lt;span style="color:#c678dd"&gt;void&lt;/span&gt; &lt;span style="color:#61aeee"&gt;init&lt;/span&gt;&lt;span style="color:#999999"&gt;(&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt; &lt;span style="color:#999999"&gt;{&lt;/span&gt;
		applicationContext &lt;span style="color:#669900"&gt;=&lt;/span&gt; &lt;span style="color:#c678dd"&gt;new&lt;/span&gt; ClassPathXmlApplicationContext&lt;span style="color:#999999"&gt;(&lt;/span&gt;
				&lt;span style="color:#669900"&gt;"classpath:applicationContext.xml"&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt;&lt;span style="color:#999999"&gt;;&lt;/span&gt;
	&lt;span style="color:#999999"&gt;}&lt;/span&gt;

	&lt;span style="color:#999999"&gt;@Test&lt;/span&gt;
	&lt;span style="color:#c678dd"&gt;public&lt;/span&gt; &lt;span style="color:#c678dd"&gt;void&lt;/span&gt; &lt;span style="color:#61aeee"&gt;testJedisPool&lt;/span&gt;&lt;span style="color:#999999"&gt;(&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt; &lt;span style="color:#999999"&gt;{&lt;/span&gt;
	JedisPool pool &lt;span style="color:#669900"&gt;=&lt;/span&gt; &lt;span style="color:#999999"&gt;(&lt;/span&gt;JedisPool&lt;span style="color:#999999"&gt;)&lt;/span&gt; applicationContext&lt;span style="color:#999999"&gt;.&lt;/span&gt;&lt;span style="color:#61aeee"&gt;getBean&lt;/span&gt;&lt;span style="color:#999999"&gt;(&lt;/span&gt;&lt;span style="color:#669900"&gt;"jedisPool"&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt;&lt;span style="color:#999999"&gt;;&lt;/span&gt;
			&lt;span style="color:#c678dd"&gt;try&lt;/span&gt;  &lt;span style="color:#999999"&gt;{&lt;/span&gt;
			Jedis jedis &lt;span style="color:#669900"&gt;=&lt;/span&gt; pool&lt;span style="color:#999999"&gt;.&lt;/span&gt;&lt;span style="color:#61aeee"&gt;getResource&lt;/span&gt;&lt;span style="color:#999999"&gt;(&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt;&lt;span style="color:#999999"&gt;;&lt;/span&gt;
			
			jedis&lt;span style="color:#999999"&gt;.&lt;/span&gt;&lt;span style="color:#61aeee"&gt;set&lt;/span&gt;&lt;span style="color:#999999"&gt;(&lt;/span&gt;&lt;span style="color:#669900"&gt;"name"&lt;/span&gt;&lt;span style="color:#999999"&gt;,&lt;/span&gt; &lt;span style="color:#669900"&gt;"lisi"&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt;&lt;span style="color:#999999"&gt;;&lt;/span&gt;
			String name &lt;span style="color:#669900"&gt;=&lt;/span&gt; jedis&lt;span style="color:#999999"&gt;.&lt;/span&gt;&lt;span style="color:#61aeee"&gt;get&lt;/span&gt;&lt;span style="color:#999999"&gt;(&lt;/span&gt;&lt;span style="color:#669900"&gt;"name"&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt;&lt;span style="color:#999999"&gt;;&lt;/span&gt;
			System&lt;span style="color:#999999"&gt;.&lt;/span&gt;out&lt;span style="color:#999999"&gt;.&lt;/span&gt;&lt;span style="color:#61aeee"&gt;println&lt;/span&gt;&lt;span style="color:#999999"&gt;(&lt;/span&gt;name&lt;span style="color:#999999"&gt;)&lt;/span&gt;&lt;span style="color:#999999"&gt;;&lt;/span&gt;
		&lt;span style="color:#999999"&gt;}&lt;/span&gt;&lt;span style="color:#c678dd"&gt;catch&lt;/span&gt;&lt;span style="color:#999999"&gt;(&lt;/span&gt;Exception ex&lt;span style="color:#999999"&gt;)&lt;/span&gt;&lt;span style="color:#999999"&gt;{&lt;/span&gt;
			ex&lt;span style="color:#999999"&gt;.&lt;/span&gt;&lt;span style="color:#61aeee"&gt;printStackTrace&lt;/span&gt;&lt;span style="color:#999999"&gt;(&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt;&lt;span style="color:#999999"&gt;;&lt;/span&gt;
		&lt;span style="color:#999999"&gt;}&lt;/span&gt;&lt;span style="color:#c678dd"&gt;finally&lt;/span&gt;&lt;span style="color:#999999"&gt;{&lt;/span&gt;
			&lt;span style="color:#c678dd"&gt;if&lt;/span&gt;&lt;span style="color:#999999"&gt;(&lt;/span&gt;jedis &lt;span style="color:#669900"&gt;!=&lt;/span&gt; null&lt;span style="color:#999999"&gt;)&lt;/span&gt;&lt;span style="color:#999999"&gt;{&lt;/span&gt;
				&lt;span style="color:#5c6370"&gt;//关闭连接&lt;/span&gt;
				jedis&lt;span style="color:#999999"&gt;.&lt;/span&gt;&lt;span style="color:#61aeee"&gt;close&lt;/span&gt;&lt;span style="color:#999999"&gt;(&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt;&lt;span style="color:#999999"&gt;;&lt;/span&gt;
			&lt;span style="color:#999999"&gt;}&lt;/span&gt;
		&lt;span style="color:#999999"&gt;}&lt;/span&gt;
	&lt;span style="color:#999999"&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/span&gt;</code></pre> 
<ul style="margin-left:0px;"><li>1</li><li>2</li><li>3</li><li>4</li><li>5</li><li>6</li><li>7</li><li>8</li><li>9</li><li>10</li><li>11</li><li>12</li><li>13</li><li>14</li><li>15</li><li>16</li><li>17</li><li>18</li><li>19</li><li>20</li><li>21</li><li>22</li><li>23</li><li>24</li><li>25</li><li>26</li></ul> 
<h2 style="margin-left:0px;"><strong><span style="color:#4f4f4f;"><a name="t21"></a><a id="redis_531"></a>八、redis数据类型</span></strong></h2> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">Redis支持五种数据类型：<br> string（字符串），hash（哈希），list（列表），set（集合）及zset(sorted set：有序集合)。</span></p> 
<h3 style="margin-left:0px;"><strong><span style="color:#4f4f4f;"><a name="t22"></a><a id="81String_534"></a>8.1、String类型</span></strong></h3> 
<ul style="margin-left:0px;"><li>string 是 redis 最基本的类型，你可以理解成与 Memcached 一模一样的类型，一个 key 对应一个 value。</li><li>string 类型是二进制安全的。意思是 redis 的 string 可以包含任何数据。比如jpg图片或者序列化的对象。</li><li>string 类型是 Redis 最基本的数据类型，string 类型的值最大能存储 512MB。</li></ul> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">赋值：</span></p> 
<pre class="has" style="margin-left:0px;"><code class="language-prettyprint">&lt;span style="color:#000000"&gt;&lt;code&gt;SET key value
127.0.0.1:6379&gt; set test 123
OK
&lt;/code&gt;&lt;/span&gt;</code></pre> 
<ul style="margin-left:0px;"><li>1</li><li>2</li><li>3</li></ul> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">取值：</span></p> 
<pre class="has" style="margin-left:0px;"><code class="language-prettyprint">&lt;span style="color:#000000"&gt;&lt;code class="language-sql"&gt;&lt;span style="color:#5c6370"&gt;# 当键不存在时返回空结果。&lt;/span&gt;
GET &lt;span style="color:#c678dd"&gt;key&lt;/span&gt;
&lt;span style="color:#98c379"&gt;127.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.1&lt;/span&gt;:&lt;span style="color:#98c379"&gt;6379&lt;/span&gt;&lt;span style="color:#669900"&gt;&gt;&lt;/span&gt; get test
"&lt;span style="color:#98c379"&gt;123&lt;/span&gt;“
&lt;/code&gt;&lt;/span&gt;</code></pre> 
<ul style="margin-left:0px;"><li>1</li><li>2</li><li>3</li><li>4</li></ul> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">取值时同时对key进行赋值操作</span></p> 
<pre class="has" style="margin-left:0px;"><code class="language-prettyprint">&lt;span style="color:#000000"&gt;&lt;code class="language-sql"&gt;GETSET &lt;span style="color:#c678dd"&gt;key&lt;/span&gt; &lt;span style="color:#c678dd"&gt;value&lt;/span&gt;
&lt;/code&gt;&lt;/span&gt;</code></pre> 
<ul style="margin-left:0px;"><li>1</li></ul> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">删除：</span></p> 
<pre class="has" style="margin-left:0px;"><code class="language-prettyprint">&lt;span style="color:#000000"&gt;&lt;code class="language-sql"&gt;Del &lt;span style="color:#c678dd"&gt;key&lt;/span&gt;
&lt;span style="color:#98c379"&gt;127.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.1&lt;/span&gt;:&lt;span style="color:#98c379"&gt;6379&lt;/span&gt;&lt;span style="color:#669900"&gt;&gt;&lt;/span&gt; del test
&lt;span style="color:#999999"&gt;(&lt;/span&gt;&lt;span style="color:#c678dd"&gt;integer&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt; &lt;span style="color:#98c379"&gt;1&lt;/span&gt;
&lt;/code&gt;&lt;/span&gt;</code></pre> 
<ul style="margin-left:0px;"><li>1</li><li>2</li><li>3</li></ul> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;"><strong>数值增减：</strong></span></p> 
<ul style="margin-left:0px;"><li>递增：<br> INCR key<br> 当存储的字符串是整数时，Redis提供了一个实用的命令INCR，其作用是让当前键值递增，并返回递增后的值。</li></ul> 
<pre class="has" style="margin-left:0px;"><code class="language-prettyprint">&lt;span style="color:#000000"&gt;&lt;code class="language-sql"&gt;&lt;span style="color:#98c379"&gt;127.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.1&lt;/span&gt;:&lt;span style="color:#98c379"&gt;6379&lt;/span&gt;&lt;span style="color:#669900"&gt;&gt;&lt;/span&gt; incr num
&lt;span style="color:#999999"&gt;(&lt;/span&gt;&lt;span style="color:#c678dd"&gt;integer&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt; &lt;span style="color:#98c379"&gt;1&lt;/span&gt;
&lt;span style="color:#98c379"&gt;127.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.1&lt;/span&gt;:&lt;span style="color:#98c379"&gt;6379&lt;/span&gt;&lt;span style="color:#669900"&gt;&gt;&lt;/span&gt; incr num
&lt;span style="color:#999999"&gt;(&lt;/span&gt;&lt;span style="color:#c678dd"&gt;integer&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt; &lt;span style="color:#98c379"&gt;2&lt;/span&gt;
&lt;span style="color:#98c379"&gt;127.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.1&lt;/span&gt;:&lt;span style="color:#98c379"&gt;6379&lt;/span&gt;&lt;span style="color:#669900"&gt;&gt;&lt;/span&gt; incr num
&lt;span style="color:#999999"&gt;(&lt;/span&gt;&lt;span style="color:#c678dd"&gt;integer&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt; &lt;span style="color:#98c379"&gt;3&lt;/span&gt; 
&lt;/code&gt;&lt;/span&gt;</code></pre> 
<ul style="margin-left:0px;"><li>1</li><li>2</li><li>3</li><li>4</li><li>5</li><li>6</li></ul> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">增加指定的整数<br> INCRBY key increment<br> 示例：</span></p> 
<pre class="has" style="margin-left:0px;"><code class="language-prettyprint">&lt;span style="color:#000000"&gt;&lt;code class="language-sql"&gt;&lt;span style="color:#98c379"&gt;127.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.1&lt;/span&gt;:&lt;span style="color:#98c379"&gt;6379&lt;/span&gt;&lt;span style="color:#669900"&gt;&gt;&lt;/span&gt; incrby num &lt;span style="color:#98c379"&gt;2&lt;/span&gt;
&lt;span style="color:#999999"&gt;(&lt;/span&gt;&lt;span style="color:#c678dd"&gt;integer&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt; &lt;span style="color:#98c379"&gt;5&lt;/span&gt;
&lt;span style="color:#98c379"&gt;127.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.1&lt;/span&gt;:&lt;span style="color:#98c379"&gt;6379&lt;/span&gt;&lt;span style="color:#669900"&gt;&gt;&lt;/span&gt; incrby num &lt;span style="color:#98c379"&gt;2&lt;/span&gt;
&lt;span style="color:#999999"&gt;(&lt;/span&gt;&lt;span style="color:#c678dd"&gt;integer&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt; &lt;span style="color:#98c379"&gt;7&lt;/span&gt;
&lt;span style="color:#98c379"&gt;127.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.1&lt;/span&gt;:&lt;span style="color:#98c379"&gt;6379&lt;/span&gt;&lt;span style="color:#669900"&gt;&gt;&lt;/span&gt; incrby num &lt;span style="color:#98c379"&gt;2&lt;/span&gt;
&lt;span style="color:#999999"&gt;(&lt;/span&gt;&lt;span style="color:#c678dd"&gt;integer&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt; &lt;span style="color:#98c379"&gt;9&lt;/span&gt; 
&lt;/code&gt;&lt;/span&gt;</code></pre> 
<ul style="margin-left:0px;"><li>1</li><li>2</li><li>3</li><li>4</li><li>5</li><li>6</li></ul> 
<ul style="margin-left:0px;"><li>递减<br> 语法：DECR key<br> 减少指定的整数：<br> DECRBY key decrement<br> 示例：</li></ul> 
<pre class="has" style="margin-left:0px;"><code class="language-prettyprint">&lt;span style="color:#000000"&gt;&lt;code class="language-sql"&gt;&lt;span style="color:#98c379"&gt;127.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.1&lt;/span&gt;:&lt;span style="color:#98c379"&gt;6379&lt;/span&gt;&lt;span style="color:#669900"&gt;&gt;&lt;/span&gt; decr num
&lt;span style="color:#999999"&gt;(&lt;/span&gt;&lt;span style="color:#c678dd"&gt;integer&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt; &lt;span style="color:#98c379"&gt;6&lt;/span&gt;
&lt;span style="color:#98c379"&gt;127.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.1&lt;/span&gt;:&lt;span style="color:#98c379"&gt;6379&lt;/span&gt;&lt;span style="color:#669900"&gt;&gt;&lt;/span&gt; decr num
&lt;span style="color:#999999"&gt;(&lt;/span&gt;&lt;span style="color:#c678dd"&gt;integer&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt; &lt;span style="color:#98c379"&gt;5&lt;/span&gt;
&lt;span style="color:#98c379"&gt;127.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.1&lt;/span&gt;:&lt;span style="color:#98c379"&gt;6379&lt;/span&gt;&lt;span style="color:#669900"&gt;&gt;&lt;/span&gt; decrby num &lt;span style="color:#98c379"&gt;3&lt;/span&gt;
&lt;span style="color:#999999"&gt;(&lt;/span&gt;&lt;span style="color:#c678dd"&gt;integer&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt; &lt;span style="color:#98c379"&gt;2&lt;/span&gt;
&lt;span style="color:#98c379"&gt;127.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.1&lt;/span&gt;:&lt;span style="color:#98c379"&gt;6379&lt;/span&gt;&lt;span style="color:#669900"&gt;&gt;&lt;/span&gt; decrby num &lt;span style="color:#98c379"&gt;3&lt;/span&gt;
&lt;span style="color:#999999"&gt;(&lt;/span&gt;&lt;span style="color:#c678dd"&gt;integer&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt; &lt;span style="color:#669900"&gt;-&lt;/span&gt;&lt;span style="color:#98c379"&gt;1&lt;/span&gt; 
&lt;/code&gt;&lt;/span&gt;</code></pre> 
<ul style="margin-left:0px;"><li>1</li><li>2</li><li>3</li><li>4</li><li>5</li><li>6</li><li>7</li><li>8</li></ul> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;"><strong>向尾部追加值</strong><br> 语法：APPEND key value<br> APPEND的作用是向键值的末尾追加value。如果键不存在则将该键的值设置为value，即相当于 SET key value。返回值是追加后字符串的总长度。</span></p> 
<pre class="has" style="margin-left:0px;"><code class="language-prettyprint">&lt;span style="color:#000000"&gt;&lt;code class="language-sql"&gt;&lt;span style="color:#98c379"&gt;127.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.1&lt;/span&gt;:&lt;span style="color:#98c379"&gt;6379&lt;/span&gt;&lt;span style="color:#669900"&gt;&gt;&lt;/span&gt; &lt;span style="color:#c678dd"&gt;set&lt;/span&gt; str hello
OK
&lt;span style="color:#98c379"&gt;127.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.1&lt;/span&gt;:&lt;span style="color:#98c379"&gt;6379&lt;/span&gt;&lt;span style="color:#669900"&gt;&gt;&lt;/span&gt; append str &lt;span style="color:#669900"&gt;" world!"&lt;/span&gt;
&lt;span style="color:#999999"&gt;(&lt;/span&gt;&lt;span style="color:#c678dd"&gt;integer&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt; &lt;span style="color:#98c379"&gt;12&lt;/span&gt;
&lt;span style="color:#98c379"&gt;127.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.1&lt;/span&gt;:&lt;span style="color:#98c379"&gt;6379&lt;/span&gt;&lt;span style="color:#669900"&gt;&gt;&lt;/span&gt; get str 
&lt;span style="color:#669900"&gt;"hello world!"&lt;/span&gt;
&lt;/code&gt;&lt;/span&gt;</code></pre> 
<ul style="margin-left:0px;"><li>1</li><li>2</li><li>3</li><li>4</li><li>5</li><li>6</li></ul> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;"><strong>获取字符串长度</strong><br> 语法：STRLEN key<br> STRLEN命令返回键值的长度，如果键不存在则返回0。</span></p> 
<pre class="has" style="margin-left:0px;"><code class="language-prettyprint">&lt;span style="color:#000000"&gt;&lt;code class="language-sql"&gt;&lt;span style="color:#98c379"&gt;127.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.1&lt;/span&gt;:&lt;span style="color:#98c379"&gt;6379&lt;/span&gt;&lt;span style="color:#669900"&gt;&gt;&lt;/span&gt; strlen str 
&lt;span style="color:#999999"&gt;(&lt;/span&gt;&lt;span style="color:#c678dd"&gt;integer&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt; &lt;span style="color:#98c379"&gt;0&lt;/span&gt;
&lt;span style="color:#98c379"&gt;127.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.1&lt;/span&gt;:&lt;span style="color:#98c379"&gt;6379&lt;/span&gt;&lt;span style="color:#669900"&gt;&gt;&lt;/span&gt; &lt;span style="color:#c678dd"&gt;set&lt;/span&gt; str hello
OK
&lt;span style="color:#98c379"&gt;127.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.1&lt;/span&gt;:&lt;span style="color:#98c379"&gt;6379&lt;/span&gt;&lt;span style="color:#669900"&gt;&gt;&lt;/span&gt; strlen str 
&lt;span style="color:#999999"&gt;(&lt;/span&gt;&lt;span style="color:#c678dd"&gt;integer&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt; &lt;span style="color:#98c379"&gt;5&lt;/span&gt;
&lt;/code&gt;&lt;/span&gt;</code></pre> 
<ul style="margin-left:0px;"><li>1</li><li>2</li><li>3</li><li>4</li><li>5</li><li>6</li></ul> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;"><strong>同时设置/获取多个键值</strong><br> MSET key value [key value …]<br> MGET key [key …]</span></p> 
<pre class="has" style="margin-left:0px;"><code class="language-prettyprint">&lt;span style="color:#000000"&gt;&lt;code class="language-sql"&gt;&lt;span style="color:#98c379"&gt;127.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.1&lt;/span&gt;:&lt;span style="color:#98c379"&gt;6379&lt;/span&gt;&lt;span style="color:#669900"&gt;&gt;&lt;/span&gt; mset k1 v1 k2 v2 k3 v3
OK
&lt;span style="color:#98c379"&gt;127.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.1&lt;/span&gt;:&lt;span style="color:#98c379"&gt;6379&lt;/span&gt;&lt;span style="color:#669900"&gt;&gt;&lt;/span&gt; get k1
&lt;span style="color:#669900"&gt;"v1"&lt;/span&gt;
&lt;span style="color:#98c379"&gt;127.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.1&lt;/span&gt;:&lt;span style="color:#98c379"&gt;6379&lt;/span&gt;&lt;span style="color:#669900"&gt;&gt;&lt;/span&gt; mget k1 k3
&lt;span style="color:#98c379"&gt;1&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt; &lt;span style="color:#669900"&gt;"v1"&lt;/span&gt;
&lt;span style="color:#98c379"&gt;2&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt; &lt;span style="color:#669900"&gt;"v3"&lt;/span&gt;
&lt;/code&gt;&lt;/span&gt;</code></pre> 
<ul style="margin-left:0px;"><li>1</li><li>2</li><li>3</li><li>4</li><li>5</li><li>6</li><li>7</li></ul> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;"><strong>String类型应用场景：</strong><br> 自增主键：商品编号、订单号采用string的递增数字特性生成。</span></p> 
<pre class="has" style="margin-left:0px;"><code class="language-prettyprint">&lt;span style="color:#000000"&gt;&lt;code class="language-sql"&gt;定义商品编号&lt;span style="color:#c678dd"&gt;key&lt;/span&gt;：items:id
&lt;span style="color:#98c379"&gt;192.168&lt;/span&gt;&lt;span style="color:#98c379"&gt;.101&lt;/span&gt;&lt;span style="color:#98c379"&gt;.3&lt;/span&gt;:&lt;span style="color:#98c379"&gt;7003&lt;/span&gt;&lt;span style="color:#669900"&gt;&gt;&lt;/span&gt; INCR items:id
&lt;span style="color:#999999"&gt;(&lt;/span&gt;&lt;span style="color:#c678dd"&gt;integer&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt; &lt;span style="color:#98c379"&gt;2&lt;/span&gt;
&lt;span style="color:#98c379"&gt;192.168&lt;/span&gt;&lt;span style="color:#98c379"&gt;.101&lt;/span&gt;&lt;span style="color:#98c379"&gt;.3&lt;/span&gt;:&lt;span style="color:#98c379"&gt;7003&lt;/span&gt;&lt;span style="color:#669900"&gt;&gt;&lt;/span&gt; INCR items:id
&lt;span style="color:#999999"&gt;(&lt;/span&gt;&lt;span style="color:#c678dd"&gt;integer&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt; &lt;span style="color:#98c379"&gt;3&lt;/span&gt;
&lt;/code&gt;&lt;/span&gt;</code></pre> 
<ul style="margin-left:0px;"><li>1</li><li>2</li><li>3</li><li>4</li><li>5</li></ul> 
<h3 style="margin-left:0px;"><strong><span style="color:#4f4f4f;"><a name="t23"></a><a id="82Hash_655"></a>8.2、Hash类型</span></strong></h3> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;"><strong>redis使用string类型存在的问题：</strong><br> 假设有User对象以JSON序列化的形式存储到Redis中，User对象有id，username、password、age、name等属性，存储的过程如下：<br> 保存、更新：<br> User对象 ——&gt;json(string) ——&gt; redis<br> 如果在业务上只是更新age属性，其他的属性并不做更新我应该怎么做呢？ 如果仍然采用上边的方法在传输、处理时会造成资源浪费，下边讲的hash可以很好的解决这个问题。</span></p> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;"><strong>redis hash介绍</strong><br> hash叫散列类型，它提供了字段和字段值的映射。字段值只能是字符串类型，不支持散列类型、集合类型等其它类型。如下：<br><img alt="在这里插入图片描述" src="https://images2.imgbox.com/84/74/DzllwfRx_o.png"></span></p> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;"><strong>Hash命令</strong><br> 赋值：<br> HSET key field value 一次只能设置一个字段值</span></p> 
<pre class="has" style="margin-left:0px;"><code class="language-prettyprint">&lt;span style="color:#000000"&gt;&lt;code class="language-sql"&gt;&lt;span style="color:#98c379"&gt;127.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.1&lt;/span&gt;:&lt;span style="color:#98c379"&gt;6379&lt;/span&gt;&lt;span style="color:#669900"&gt;&gt;&lt;/span&gt; hset &lt;span style="color:#c678dd"&gt;user&lt;/span&gt; username zhangsan 
&lt;span style="color:#999999"&gt;(&lt;/span&gt;&lt;span style="color:#c678dd"&gt;integer&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt; &lt;span style="color:#98c379"&gt;1&lt;/span&gt;
&lt;/code&gt;&lt;/span&gt;</code></pre> 
<ul style="margin-left:0px;"><li>1</li><li>2</li></ul> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">HMSET key field value [field value …] 一次可以设置多个字段值</span></p> 
<pre class="has" style="margin-left:0px;"><code class="language-prettyprint">&lt;span style="color:#000000"&gt;&lt;code class="language-sql"&gt;&lt;span style="color:#98c379"&gt;127.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.1&lt;/span&gt;:&lt;span style="color:#98c379"&gt;6379&lt;/span&gt;&lt;span style="color:#669900"&gt;&gt;&lt;/span&gt; hmset &lt;span style="color:#c678dd"&gt;user&lt;/span&gt; age &lt;span style="color:#98c379"&gt;20&lt;/span&gt; username lisi 
OK
&lt;/code&gt;&lt;/span&gt;</code></pre> 
<ul style="margin-left:0px;"><li>1</li><li>2</li></ul> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">取值：<br> HGET key field 一次只能获取一个字段值</span></p> 
<pre class="has" style="margin-left:0px;"><code class="language-prettyprint">&lt;span style="color:#000000"&gt;&lt;code class="language-sql"&gt;&lt;span style="color:#98c379"&gt;127.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.1&lt;/span&gt;:&lt;span style="color:#98c379"&gt;6379&lt;/span&gt;&lt;span style="color:#669900"&gt;&gt;&lt;/span&gt; hget &lt;span style="color:#c678dd"&gt;user&lt;/span&gt; username
"zhangsan“
&lt;/code&gt;&lt;/span&gt;</code></pre> 
<ul style="margin-left:0px;"><li>1</li><li>2</li></ul> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">HMGET key field [field …] 一次可以获取多个字段值</span></p> 
<pre class="has" style="margin-left:0px;"><code class="language-prettyprint">&lt;span style="color:#000000"&gt;&lt;code class="language-sql"&gt;&lt;span style="color:#98c379"&gt;127.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.1&lt;/span&gt;:&lt;span style="color:#98c379"&gt;6379&lt;/span&gt;&lt;span style="color:#669900"&gt;&gt;&lt;/span&gt; hmget &lt;span style="color:#c678dd"&gt;user&lt;/span&gt; age username
&lt;span style="color:#98c379"&gt;1&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt; &lt;span style="color:#669900"&gt;"20"&lt;/span&gt;
&lt;span style="color:#98c379"&gt;2&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt; &lt;span style="color:#669900"&gt;"lisi"&lt;/span&gt;
&lt;/code&gt;&lt;/span&gt;</code></pre> 
<ul style="margin-left:0px;"><li>1</li><li>2</li><li>3</li></ul> 
<hr> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">HGETALL key</span></p> 
<pre class="has" style="margin-left:0px;"><code class="language-prettyprint">&lt;span style="color:#000000"&gt;&lt;code class="language-sql"&gt;&lt;span style="color:#98c379"&gt;127.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.1&lt;/span&gt;:&lt;span style="color:#98c379"&gt;6379&lt;/span&gt;&lt;span style="color:#669900"&gt;&gt;&lt;/span&gt; hgetall &lt;span style="color:#c678dd"&gt;user&lt;/span&gt;
&lt;span style="color:#98c379"&gt;1&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt; &lt;span style="color:#669900"&gt;"age"&lt;/span&gt;
&lt;span style="color:#98c379"&gt;2&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt; &lt;span style="color:#669900"&gt;"20"&lt;/span&gt;
&lt;span style="color:#98c379"&gt;3&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt; &lt;span style="color:#669900"&gt;"username"&lt;/span&gt;
&lt;span style="color:#98c379"&gt;4&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt; &lt;span style="color:#669900"&gt;"lisi"&lt;/span&gt;
&lt;/code&gt;&lt;/span&gt;</code></pre> 
<ul style="margin-left:0px;"><li>1</li><li>2</li><li>3</li><li>4</li><li>5</li></ul> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">HSET命令不区分插入和更新操作，当执行插入操作时HSET命令返回1，当执行更新操作时返回0.</span></p> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">删除：<br> 可以删除一个或多个字段，返回值是被删除的字段个数<br> HDEL key field [field …]</span></p> 
<pre class="has" style="margin-left:0px;"><code class="language-prettyprint">&lt;span style="color:#000000"&gt;&lt;code class="language-sql"&gt;&lt;span style="color:#98c379"&gt;127.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.1&lt;/span&gt;:&lt;span style="color:#98c379"&gt;6379&lt;/span&gt;&lt;span style="color:#669900"&gt;&gt;&lt;/span&gt; hdel &lt;span style="color:#c678dd"&gt;user&lt;/span&gt; age
&lt;span style="color:#999999"&gt;(&lt;/span&gt;&lt;span style="color:#c678dd"&gt;integer&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt; &lt;span style="color:#98c379"&gt;1&lt;/span&gt;
&lt;span style="color:#98c379"&gt;127.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.1&lt;/span&gt;:&lt;span style="color:#98c379"&gt;6379&lt;/span&gt;&lt;span style="color:#669900"&gt;&gt;&lt;/span&gt; hdel &lt;span style="color:#c678dd"&gt;user&lt;/span&gt; age name
&lt;span style="color:#999999"&gt;(&lt;/span&gt;&lt;span style="color:#c678dd"&gt;integer&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt; &lt;span style="color:#98c379"&gt;0&lt;/span&gt;
&lt;span style="color:#98c379"&gt;127.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.1&lt;/span&gt;:&lt;span style="color:#98c379"&gt;6379&lt;/span&gt;&lt;span style="color:#669900"&gt;&gt;&lt;/span&gt; hdel &lt;span style="color:#c678dd"&gt;user&lt;/span&gt; age username
&lt;span style="color:#999999"&gt;(&lt;/span&gt;&lt;span style="color:#c678dd"&gt;integer&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt; &lt;span style="color:#98c379"&gt;1&lt;/span&gt; 
&lt;/code&gt;&lt;/span&gt;</code></pre> 
<ul style="margin-left:0px;"><li>1</li><li>2</li><li>3</li><li>4</li><li>5</li><li>6</li></ul> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">增加数字：<br> HINCRBY key field increment</span></p> 
<pre class="has" style="margin-left:0px;"><code class="language-prettyprint">&lt;span style="color:#000000"&gt;&lt;code class="language-sql"&gt;&lt;span style="color:#98c379"&gt;127.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.1&lt;/span&gt;:&lt;span style="color:#98c379"&gt;6379&lt;/span&gt;&lt;span style="color:#669900"&gt;&gt;&lt;/span&gt; hincrby &lt;span style="color:#c678dd"&gt;user&lt;/span&gt; age &lt;span style="color:#98c379"&gt;2&lt;/span&gt;	将用户的年龄加&lt;span style="color:#98c379"&gt;2&lt;/span&gt;
&lt;span style="color:#999999"&gt;(&lt;/span&gt;&lt;span style="color:#c678dd"&gt;integer&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt; &lt;span style="color:#98c379"&gt;22&lt;/span&gt;
&lt;span style="color:#98c379"&gt;127.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.1&lt;/span&gt;:&lt;span style="color:#98c379"&gt;6379&lt;/span&gt;&lt;span style="color:#669900"&gt;&gt;&lt;/span&gt; hget &lt;span style="color:#c678dd"&gt;user&lt;/span&gt; age		获取用户的年龄
"&lt;span style="color:#98c379"&gt;22&lt;/span&gt;“
&lt;/code&gt;&lt;/span&gt;</code></pre> 
<ul style="margin-left:0px;"><li>1</li><li>2</li><li>3</li><li>4</li></ul> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;"><strong>其他命令：</strong></span></p> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">判断字段是否存在<br> HEXISTS key field</span></p> 
<pre class="has" style="margin-left:0px;"><code class="language-prettyprint">&lt;span style="color:#000000"&gt;&lt;code class="language-sql"&gt;&lt;span style="color:#98c379"&gt;127.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.1&lt;/span&gt;:&lt;span style="color:#98c379"&gt;6379&lt;/span&gt;&lt;span style="color:#669900"&gt;&gt;&lt;/span&gt; hexists &lt;span style="color:#c678dd"&gt;user&lt;/span&gt; age		查看&lt;span style="color:#c678dd"&gt;user&lt;/span&gt;中是否有age字段
&lt;span style="color:#999999"&gt;(&lt;/span&gt;&lt;span style="color:#c678dd"&gt;integer&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt; &lt;span style="color:#98c379"&gt;1&lt;/span&gt;
&lt;span style="color:#98c379"&gt;127.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.1&lt;/span&gt;:&lt;span style="color:#98c379"&gt;6379&lt;/span&gt;&lt;span style="color:#669900"&gt;&gt;&lt;/span&gt; hexists &lt;span style="color:#c678dd"&gt;user&lt;/span&gt; name	查看&lt;span style="color:#c678dd"&gt;user&lt;/span&gt;中是否有name字段
&lt;span style="color:#999999"&gt;(&lt;/span&gt;&lt;span style="color:#c678dd"&gt;integer&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt; &lt;span style="color:#98c379"&gt;0&lt;/span&gt;
&lt;/code&gt;&lt;/span&gt;</code></pre> 
<ul style="margin-left:0px;"><li>1</li><li>2</li><li>3</li><li>4</li></ul> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">HSETNX key field value<br> 当字段不存在时赋值，类似HSET，区别在于如果字段已经存在，该命令不执行任何操作。</span></p> 
<pre class="has" style="margin-left:0px;"><code class="language-prettyprint">&lt;span style="color:#000000"&gt;&lt;code class="language-sql"&gt;&lt;span style="color:#98c379"&gt;127.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.1&lt;/span&gt;:&lt;span style="color:#98c379"&gt;6379&lt;/span&gt;&lt;span style="color:#669900"&gt;&gt;&lt;/span&gt; hsetnx &lt;span style="color:#c678dd"&gt;user&lt;/span&gt; age &lt;span style="color:#98c379"&gt;30&lt;/span&gt;	如果&lt;span style="color:#c678dd"&gt;user&lt;/span&gt;中没有age字段则设置age值为&lt;span style="color:#98c379"&gt;30&lt;/span&gt;，否则不做任何操作
&lt;span style="color:#999999"&gt;(&lt;/span&gt;&lt;span style="color:#c678dd"&gt;integer&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt; &lt;span style="color:#98c379"&gt;0&lt;/span&gt;
&lt;/code&gt;&lt;/span&gt;</code></pre> 
<ul style="margin-left:0px;"><li>1</li><li>2</li></ul> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">只获取字段名或字段值<br> HKEYS key<br> HVALS key</span></p> 
<pre class="has" style="margin-left:0px;"><code class="language-prettyprint">&lt;span style="color:#000000"&gt;&lt;code class="language-sql"&gt;&lt;span style="color:#98c379"&gt;127.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.1&lt;/span&gt;:&lt;span style="color:#98c379"&gt;6379&lt;/span&gt;&lt;span style="color:#669900"&gt;&gt;&lt;/span&gt; hmset &lt;span style="color:#c678dd"&gt;user&lt;/span&gt; age &lt;span style="color:#98c379"&gt;20&lt;/span&gt; name lisi 
OK
&lt;span style="color:#98c379"&gt;127.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.1&lt;/span&gt;:&lt;span style="color:#98c379"&gt;6379&lt;/span&gt;&lt;span style="color:#669900"&gt;&gt;&lt;/span&gt; hkeys &lt;span style="color:#c678dd"&gt;user&lt;/span&gt;
&lt;span style="color:#98c379"&gt;1&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt; &lt;span style="color:#669900"&gt;"age"&lt;/span&gt;
&lt;span style="color:#98c379"&gt;2&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt; &lt;span style="color:#669900"&gt;"name"&lt;/span&gt;
&lt;span style="color:#98c379"&gt;127.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.1&lt;/span&gt;:&lt;span style="color:#98c379"&gt;6379&lt;/span&gt;&lt;span style="color:#669900"&gt;&gt;&lt;/span&gt; hvals &lt;span style="color:#c678dd"&gt;user&lt;/span&gt;
&lt;span style="color:#98c379"&gt;1&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt; &lt;span style="color:#669900"&gt;"20"&lt;/span&gt;
&lt;span style="color:#98c379"&gt;2&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt; &lt;span style="color:#669900"&gt;"lisi"&lt;/span&gt;
&lt;/code&gt;&lt;/span&gt;</code></pre> 
<ul style="margin-left:0px;"><li>1</li><li>2</li><li>3</li><li>4</li><li>5</li><li>6</li><li>7</li><li>8</li></ul> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">获取字段数量<br> HLEN key</span></p> 
<pre class="has" style="margin-left:0px;"><code class="language-prettyprint">&lt;span style="color:#000000"&gt;&lt;code class="language-sql"&gt;&lt;span style="color:#98c379"&gt;127.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.1&lt;/span&gt;:&lt;span style="color:#98c379"&gt;6379&lt;/span&gt;&lt;span style="color:#669900"&gt;&gt;&lt;/span&gt; hlen &lt;span style="color:#c678dd"&gt;user&lt;/span&gt;
&lt;span style="color:#999999"&gt;(&lt;/span&gt;&lt;span style="color:#c678dd"&gt;integer&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt; &lt;span style="color:#98c379"&gt;2&lt;/span&gt;
&lt;/code&gt;&lt;/span&gt;</code></pre> 
<ul style="margin-left:0px;"><li>1</li><li>2</li></ul> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;"><strong>Hash类型应用场景：</strong></span></p> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">商品id、商品名称、商品描述、商品库存、商品好评</span></p> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">定义商品信息的key：<br> 商品1001的信息在 redis中的key为：items:1001</span></p> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">存储商品信息</span></p> 
<pre class="has" style="margin-left:0px;"><code class="language-prettyprint">&lt;span style="color:#000000"&gt;&lt;code class="language-sql"&gt;&lt;span style="color:#98c379"&gt;192.168&lt;/span&gt;&lt;span style="color:#98c379"&gt;.101&lt;/span&gt;&lt;span style="color:#98c379"&gt;.3&lt;/span&gt;:&lt;span style="color:#98c379"&gt;7003&lt;/span&gt;&lt;span style="color:#669900"&gt;&gt;&lt;/span&gt; HMSET items:&lt;span style="color:#98c379"&gt;1001&lt;/span&gt; id &lt;span style="color:#98c379"&gt;3&lt;/span&gt; name apple price &lt;span style="color:#98c379"&gt;999.9&lt;/span&gt;
OK
&lt;/code&gt;&lt;/span&gt;</code></pre> 
<ul style="margin-left:0px;"><li>1</li><li>2</li></ul> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">获取商品信息</span></p> 
<pre class="has" style="margin-left:0px;"><code class="language-prettyprint">&lt;span style="color:#000000"&gt;&lt;code class="language-sql"&gt;&lt;span style="color:#98c379"&gt;192.168&lt;/span&gt;&lt;span style="color:#98c379"&gt;.101&lt;/span&gt;&lt;span style="color:#98c379"&gt;.3&lt;/span&gt;:&lt;span style="color:#98c379"&gt;7003&lt;/span&gt;&lt;span style="color:#669900"&gt;&gt;&lt;/span&gt; HGET items:&lt;span style="color:#98c379"&gt;1001&lt;/span&gt; id
&lt;span style="color:#669900"&gt;"3"&lt;/span&gt;
&lt;span style="color:#98c379"&gt;192.168&lt;/span&gt;&lt;span style="color:#98c379"&gt;.101&lt;/span&gt;&lt;span style="color:#98c379"&gt;.3&lt;/span&gt;:&lt;span style="color:#98c379"&gt;7003&lt;/span&gt;&lt;span style="color:#669900"&gt;&gt;&lt;/span&gt; HGETALL items:&lt;span style="color:#98c379"&gt;1001&lt;/span&gt;
&lt;span style="color:#98c379"&gt;1&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt; &lt;span style="color:#669900"&gt;"id"&lt;/span&gt;
&lt;span style="color:#98c379"&gt;2&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt; &lt;span style="color:#669900"&gt;"3"&lt;/span&gt;
&lt;span style="color:#98c379"&gt;3&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt; &lt;span style="color:#669900"&gt;"name"&lt;/span&gt;
&lt;span style="color:#98c379"&gt;4&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt; &lt;span style="color:#669900"&gt;"apple"&lt;/span&gt;
&lt;span style="color:#98c379"&gt;5&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt; &lt;span style="color:#669900"&gt;"price"&lt;/span&gt;
&lt;span style="color:#98c379"&gt;6&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt; &lt;span style="color:#669900"&gt;"999.9"&lt;/span&gt;
&lt;/code&gt;&lt;/span&gt;</code></pre> 
<ul style="margin-left:0px;"><li>1</li><li>2</li><li>3</li><li>4</li><li>5</li><li>6</li><li>7</li><li>8</li><li>9</li></ul> 
<h3 style="margin-left:0px;"><strong><span style="color:#4f4f4f;"><a name="t24"></a><a id="83list_797"></a>8.3、list类型</span></strong></h3> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;"><strong>ArrayList与LinkedList的区别</strong><br> ArrayList使用数组方式存储数据，所以根据索引查询数据速度快，而新增或者删除元素时需要设计到位移操作，所以比较慢。<br> LinkedList使用双向链接方式存储数据，每个元素都记录前后元素的指针，所以插入、删除数据时只是更改前后元素的指针指向即可，速度非常快，然后通过下标查询元素时需要从头开始索引，所以比较慢，但是如果查询前几个元素或后几个元素速度比较快。<br><img alt="在这里插入图片描述" src="https://images2.imgbox.com/31/15/aPQbqPeb_o.png"><br><img alt="在这里插入图片描述" src="https://images2.imgbox.com/94/01/YIyEk3Ft_o.png"><br><strong>redis list介绍</strong><br> 列表类型（list）可以存储一个有序的字符串列表，常用的操作是向列表两端添加元素，或者获得列表的某一个片段。<br> 列表类型内部是使用双向链表（double linked list）实现的，所以向列表两端添加元素的时间复杂度为0(1)，获取越接近两端的元素速度就越快。这意味着即使是一个有几千万个元素的列表，获取头部或尾部的10条记录也是极快的。</span></p> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;"><strong>list类型命令</strong><br> 向列表两端增加元素<br> LPUSH key value [value …]<br> RPUSH key value [value …]<br> 向列表左边增加元素</span></p> 
<pre class="has" style="margin-left:0px;"><code class="language-prettyprint">&lt;span style="color:#000000"&gt;&lt;code class="language-sql"&gt;&lt;span style="color:#98c379"&gt;127.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.1&lt;/span&gt;:&lt;span style="color:#98c379"&gt;6379&lt;/span&gt;&lt;span style="color:#669900"&gt;&gt;&lt;/span&gt; lpush list:&lt;span style="color:#98c379"&gt;1&lt;/span&gt; &lt;span style="color:#98c379"&gt;1&lt;/span&gt; &lt;span style="color:#98c379"&gt;2&lt;/span&gt; &lt;span style="color:#98c379"&gt;3&lt;/span&gt;
&lt;span style="color:#999999"&gt;(&lt;/span&gt;&lt;span style="color:#c678dd"&gt;integer&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt; &lt;span style="color:#98c379"&gt;3&lt;/span&gt;
&lt;/code&gt;&lt;/span&gt;</code></pre> 
<ul style="margin-left:0px;"><li>1</li><li>2</li></ul> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">向列表右边增加元素</span></p> 
<pre class="has" style="margin-left:0px;"><code class="language-prettyprint">&lt;span style="color:#000000"&gt;&lt;code class="language-sql"&gt;&lt;span style="color:#98c379"&gt;127.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.1&lt;/span&gt;:&lt;span style="color:#98c379"&gt;6379&lt;/span&gt;&lt;span style="color:#669900"&gt;&gt;&lt;/span&gt; rpush list:&lt;span style="color:#98c379"&gt;1&lt;/span&gt; &lt;span style="color:#98c379"&gt;4&lt;/span&gt; &lt;span style="color:#98c379"&gt;5&lt;/span&gt; &lt;span style="color:#98c379"&gt;6&lt;/span&gt;
&lt;span style="color:#999999"&gt;(&lt;/span&gt;&lt;span style="color:#c678dd"&gt;integer&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt; &lt;span style="color:#98c379"&gt;3&lt;/span&gt;
&lt;/code&gt;&lt;/span&gt;</code></pre> 
<ul style="margin-left:0px;"><li>1</li><li>2</li></ul> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">查看列表<br> LRANGE key start stop<br> LRANGE命令是列表类型最常用的命令之一，获取列表中的某一片段，将返回start、stop之间的所有元素（包含两端的元素），索引从0开始。索引可以是负数，如：“-1”代表最后边的一个元素。</span></p> 
<pre class="has" style="margin-left:0px;"><code class="language-prettyprint">&lt;span style="color:#000000"&gt;&lt;code class="language-sql"&gt;&lt;span style="color:#98c379"&gt;127.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.1&lt;/span&gt;:&lt;span style="color:#98c379"&gt;6379&lt;/span&gt;&lt;span style="color:#669900"&gt;&gt;&lt;/span&gt; lrange list:&lt;span style="color:#98c379"&gt;1&lt;/span&gt; &lt;span style="color:#98c379"&gt;0&lt;/span&gt; &lt;span style="color:#98c379"&gt;2&lt;/span&gt;
&lt;span style="color:#98c379"&gt;1&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt; &lt;span style="color:#669900"&gt;"2"&lt;/span&gt;
&lt;span style="color:#98c379"&gt;2&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt; &lt;span style="color:#669900"&gt;"1"&lt;/span&gt;
&lt;span style="color:#98c379"&gt;3&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt; &lt;span style="color:#669900"&gt;"4"&lt;/span&gt;
&lt;/code&gt;&lt;/span&gt;</code></pre> 
<ul style="margin-left:0px;"><li>1</li><li>2</li><li>3</li><li>4</li></ul> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">从列表两端弹出元素</span></p> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">LPOP key<br> RPOP key<br> LPOP命令从列表左边弹出一个元素，会分两步完成，第一步是将列表左边的元素从列表中移除，第二步是返回被移除的元素值。</span></p> 
<pre class="has" style="margin-left:0px;"><code class="language-prettyprint">&lt;span style="color:#000000"&gt;&lt;code class="language-sql"&gt;&lt;span style="color:#98c379"&gt;127.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.1&lt;/span&gt;:&lt;span style="color:#98c379"&gt;6379&lt;/span&gt;&lt;span style="color:#669900"&gt;&gt;&lt;/span&gt; lpop list:&lt;span style="color:#98c379"&gt;1&lt;/span&gt;
&lt;span style="color:#669900"&gt;"3“
127.0.0.1:6379&gt; rpop list:1
"&lt;/span&gt;&lt;span style="color:#98c379"&gt;6&lt;/span&gt;“
&lt;/code&gt;&lt;/span&gt;</code></pre> 
<ul style="margin-left:0px;"><li>1</li><li>2</li><li>3</li><li>4</li></ul> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">获取列表中元素的个数<br> LLEN key</span></p> 
<pre class="has" style="margin-left:0px;"><code class="language-prettyprint">&lt;span style="color:#000000"&gt;&lt;code class="language-sql"&gt;&lt;span style="color:#98c379"&gt;127.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.1&lt;/span&gt;:&lt;span style="color:#98c379"&gt;6379&lt;/span&gt;&lt;span style="color:#669900"&gt;&gt;&lt;/span&gt; llen list:&lt;span style="color:#98c379"&gt;1&lt;/span&gt;
&lt;span style="color:#999999"&gt;(&lt;/span&gt;&lt;span style="color:#c678dd"&gt;integer&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt; &lt;span style="color:#98c379"&gt;2&lt;/span&gt;
&lt;/code&gt;&lt;/span&gt;</code></pre> 
<ul style="margin-left:0px;"><li>1</li><li>2</li></ul> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">删除列表中指定的值<br> LREM key count value<br> LREM命令会删除列表中前count个值为value的元素，返回实际删除的元素个数。根据count值的不同，该命令的执行方式会有所不同：<br> 当count&gt;0时， LREM会从列表左边开始删除。<br> 当count&lt;0时， LREM会从列表后边开始删除。<br> 当count=0时， LREM删除所有值为value的元素。</span></p> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">获得/设置指定索引的元素值<br> LINDEX key index<br> LSET key index value</span></p> 
<pre class="has" style="margin-left:0px;"><code class="language-prettyprint">&lt;span style="color:#000000"&gt;&lt;code class="language-sql"&gt;&lt;span style="color:#98c379"&gt;127.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.1&lt;/span&gt;:&lt;span style="color:#98c379"&gt;6379&lt;/span&gt;&lt;span style="color:#669900"&gt;&gt;&lt;/span&gt; lindex l:list &lt;span style="color:#98c379"&gt;2&lt;/span&gt;
&lt;span style="color:#669900"&gt;"1"&lt;/span&gt;
&lt;span style="color:#98c379"&gt;127.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.1&lt;/span&gt;:&lt;span style="color:#98c379"&gt;6379&lt;/span&gt;&lt;span style="color:#669900"&gt;&gt;&lt;/span&gt; lset l:list &lt;span style="color:#98c379"&gt;2&lt;/span&gt; &lt;span style="color:#98c379"&gt;2&lt;/span&gt;
OK
&lt;span style="color:#98c379"&gt;127.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.1&lt;/span&gt;:&lt;span style="color:#98c379"&gt;6379&lt;/span&gt;&lt;span style="color:#669900"&gt;&gt;&lt;/span&gt; lrange l:list &lt;span style="color:#98c379"&gt;0&lt;/span&gt; &lt;span style="color:#669900"&gt;-&lt;/span&gt;&lt;span style="color:#98c379"&gt;1&lt;/span&gt;
&lt;span style="color:#98c379"&gt;1&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt; &lt;span style="color:#669900"&gt;"6"&lt;/span&gt;
&lt;span style="color:#98c379"&gt;2&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt; &lt;span style="color:#669900"&gt;"5"&lt;/span&gt;
&lt;span style="color:#98c379"&gt;3&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt; &lt;span style="color:#669900"&gt;"2"&lt;/span&gt;
&lt;span style="color:#98c379"&gt;4&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt; &lt;span style="color:#669900"&gt;"2"&lt;/span&gt;
&lt;/code&gt;&lt;/span&gt;</code></pre> 
<ul style="margin-left:0px;"><li>1</li><li>2</li><li>3</li><li>4</li><li>5</li><li>6</li><li>7</li><li>8</li><li>9</li></ul> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">只保留列表指定片段，指定范围和LRANGE一致<br> LTRIM key start stop</span></p> 
<pre class="has" style="margin-left:0px;"><code class="language-prettyprint">&lt;span style="color:#000000"&gt;&lt;code class="language-sql"&gt;&lt;span style="color:#98c379"&gt;127.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.1&lt;/span&gt;:&lt;span style="color:#98c379"&gt;6379&lt;/span&gt;&lt;span style="color:#669900"&gt;&gt;&lt;/span&gt; lrange l:list &lt;span style="color:#98c379"&gt;0&lt;/span&gt; &lt;span style="color:#669900"&gt;-&lt;/span&gt;&lt;span style="color:#98c379"&gt;1&lt;/span&gt;
&lt;span style="color:#98c379"&gt;1&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt; &lt;span style="color:#669900"&gt;"6"&lt;/span&gt;
&lt;span style="color:#98c379"&gt;2&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt; &lt;span style="color:#669900"&gt;"5"&lt;/span&gt;
&lt;span style="color:#98c379"&gt;3&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt; &lt;span style="color:#669900"&gt;"0"&lt;/span&gt;
&lt;span style="color:#98c379"&gt;4&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt; &lt;span style="color:#669900"&gt;"2"&lt;/span&gt;
&lt;span style="color:#98c379"&gt;127.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.1&lt;/span&gt;:&lt;span style="color:#98c379"&gt;6379&lt;/span&gt;&lt;span style="color:#669900"&gt;&gt;&lt;/span&gt; ltrim l:list &lt;span style="color:#98c379"&gt;0&lt;/span&gt; &lt;span style="color:#98c379"&gt;2&lt;/span&gt;
OK
&lt;span style="color:#98c379"&gt;127.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.1&lt;/span&gt;:&lt;span style="color:#98c379"&gt;6379&lt;/span&gt;&lt;span style="color:#669900"&gt;&gt;&lt;/span&gt; lrange l:list &lt;span style="color:#98c379"&gt;0&lt;/span&gt; &lt;span style="color:#669900"&gt;-&lt;/span&gt;&lt;span style="color:#98c379"&gt;1&lt;/span&gt;
&lt;span style="color:#98c379"&gt;1&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt; &lt;span style="color:#669900"&gt;"6"&lt;/span&gt;
&lt;span style="color:#98c379"&gt;2&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt; &lt;span style="color:#669900"&gt;"5"&lt;/span&gt;
&lt;span style="color:#98c379"&gt;3&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt; &lt;span style="color:#669900"&gt;"0"&lt;/span&gt;
&lt;/code&gt;&lt;/span&gt;</code></pre> 
<ul style="margin-left:0px;"><li>1</li><li>2</li><li>3</li><li>4</li><li>5</li><li>6</li><li>7</li><li>8</li><li>9</li><li>10</li><li>11</li></ul> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">向列表中插入元素<br> LINSERT key BEFORE|AFTER pivot value<br> 该命令首先会在列表中从左到右查找值为pivot的元素，然后根据第二个参数是BEFORE还是AFTER来决定将value插入到该元素的前面还是后面。</span></p> 
<pre class="has" style="margin-left:0px;"><code class="language-prettyprint">&lt;span style="color:#000000"&gt;&lt;code class="language-sql"&gt;&lt;span style="color:#98c379"&gt;127.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.1&lt;/span&gt;:&lt;span style="color:#98c379"&gt;6379&lt;/span&gt;&lt;span style="color:#669900"&gt;&gt;&lt;/span&gt; lrange list &lt;span style="color:#98c379"&gt;0&lt;/span&gt; &lt;span style="color:#669900"&gt;-&lt;/span&gt;&lt;span style="color:#98c379"&gt;1&lt;/span&gt;
&lt;span style="color:#98c379"&gt;1&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt; &lt;span style="color:#669900"&gt;"3"&lt;/span&gt;
&lt;span style="color:#98c379"&gt;2&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt; &lt;span style="color:#669900"&gt;"2"&lt;/span&gt;
&lt;span style="color:#98c379"&gt;3&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt; &lt;span style="color:#669900"&gt;"1"&lt;/span&gt;
&lt;span style="color:#98c379"&gt;127.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.1&lt;/span&gt;:&lt;span style="color:#98c379"&gt;6379&lt;/span&gt;&lt;span style="color:#669900"&gt;&gt;&lt;/span&gt; linsert list &lt;span style="color:#c678dd"&gt;after&lt;/span&gt; &lt;span style="color:#98c379"&gt;3&lt;/span&gt; &lt;span style="color:#98c379"&gt;4&lt;/span&gt;
&lt;span style="color:#999999"&gt;(&lt;/span&gt;&lt;span style="color:#c678dd"&gt;integer&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt; &lt;span style="color:#98c379"&gt;4&lt;/span&gt;
&lt;span style="color:#98c379"&gt;127.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.1&lt;/span&gt;:&lt;span style="color:#98c379"&gt;6379&lt;/span&gt;&lt;span style="color:#669900"&gt;&gt;&lt;/span&gt; lrange list &lt;span style="color:#98c379"&gt;0&lt;/span&gt; &lt;span style="color:#669900"&gt;-&lt;/span&gt;&lt;span style="color:#98c379"&gt;1&lt;/span&gt;
&lt;span style="color:#98c379"&gt;1&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt; &lt;span style="color:#669900"&gt;"3"&lt;/span&gt;
&lt;span style="color:#98c379"&gt;2&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt; &lt;span style="color:#669900"&gt;"4"&lt;/span&gt;
&lt;span style="color:#98c379"&gt;3&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt; &lt;span style="color:#669900"&gt;"2"&lt;/span&gt;
&lt;span style="color:#98c379"&gt;4&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt; &lt;span style="color:#669900"&gt;"1"&lt;/span&gt;
&lt;/code&gt;&lt;/span&gt;</code></pre> 
<ul style="margin-left:0px;"><li>1</li><li>2</li><li>3</li><li>4</li><li>5</li><li>6</li><li>7</li><li>8</li><li>9</li><li>10</li><li>11</li></ul> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">将元素从一个列表转移到另一个列表中<br> RPOPLPUSH source destination</span></p> 
<pre class="has" style="margin-left:0px;"><code class="language-prettyprint">&lt;span style="color:#000000"&gt;&lt;code class="language-sql"&gt;&lt;span style="color:#98c379"&gt;127.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.1&lt;/span&gt;:&lt;span style="color:#98c379"&gt;6379&lt;/span&gt;&lt;span style="color:#669900"&gt;&gt;&lt;/span&gt; rpoplpush list newlist 
&lt;span style="color:#669900"&gt;"1"&lt;/span&gt;
&lt;span style="color:#98c379"&gt;127.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.1&lt;/span&gt;:&lt;span style="color:#98c379"&gt;6379&lt;/span&gt;&lt;span style="color:#669900"&gt;&gt;&lt;/span&gt; lrange newlist &lt;span style="color:#98c379"&gt;0&lt;/span&gt; &lt;span style="color:#669900"&gt;-&lt;/span&gt;&lt;span style="color:#98c379"&gt;1&lt;/span&gt;
&lt;span style="color:#98c379"&gt;1&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt; &lt;span style="color:#669900"&gt;"1"&lt;/span&gt;
&lt;span style="color:#98c379"&gt;127.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.1&lt;/span&gt;:&lt;span style="color:#98c379"&gt;6379&lt;/span&gt;&lt;span style="color:#669900"&gt;&gt;&lt;/span&gt; lrange list &lt;span style="color:#98c379"&gt;0&lt;/span&gt; &lt;span style="color:#669900"&gt;-&lt;/span&gt;&lt;span style="color:#98c379"&gt;1&lt;/span&gt;
&lt;span style="color:#98c379"&gt;1&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt; &lt;span style="color:#669900"&gt;"3"&lt;/span&gt;
&lt;span style="color:#98c379"&gt;2&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt; &lt;span style="color:#669900"&gt;"4"&lt;/span&gt;
&lt;span style="color:#98c379"&gt;3&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt; &lt;span style="color:#669900"&gt;"2"&lt;/span&gt; 
&lt;/code&gt;&lt;/span&gt;</code></pre> 
<ul style="margin-left:0px;"><li>1</li><li>2</li><li>3</li><li>4</li><li>5</li><li>6</li><li>7</li><li>8</li></ul> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;"><strong>list类型应用场景</strong><br> 在redis中创建商品评论列表<br> 用户发布商品评论，将评论信息转成json存储到list中。<br> 用户在页面查询评论列表，从redis中取出json数据展示到页面。</span></p> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">定义商品评论列表key：<br> 商品编号为1001的商品评论key：items: comment:1001</span></p> 
<pre class="has" style="margin-left:0px;"><code class="language-prettyprint">&lt;span style="color:#000000"&gt;&lt;code class="language-sql"&gt;&lt;span style="color:#98c379"&gt;192.168&lt;/span&gt;&lt;span style="color:#98c379"&gt;.237&lt;/span&gt;&lt;span style="color:#98c379"&gt;.129&lt;/span&gt;:&lt;span style="color:#98c379"&gt;7001&lt;/span&gt;&lt;span style="color:#669900"&gt;&gt;&lt;/span&gt; LPUSH items:&lt;span style="color:#c678dd"&gt;comment&lt;/span&gt;:&lt;span style="color:#98c379"&gt;1001&lt;/span&gt; &lt;span style="color:#669900"&gt;'{"id":1,"name":"商品不错，很好！！","date":1430295077289}'&lt;/span&gt;
&lt;/code&gt;&lt;/span&gt;</code></pre> 
<ul style="margin-left:0px;"><li>1</li></ul> 
<h3 style="margin-left:0px;"><strong><span style="color:#4f4f4f;"><a name="t25"></a><a id="84set_938"></a>8.4、set类型</span></strong></h3> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;"><strong>set类型介绍</strong><br> 在set集合中的每个元素都是不同的，且没有顺序。<br> 集合类型和列表类型的对比：</span></p> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;"><img alt="在这里插入图片描述" src="https://images2.imgbox.com/2e/93/G5vNt9sA_o.png"><br> 集合类型的常用操作是向集合中加入或删除元素、判断某个元素是否存在等，由于集合类型的Redis内部是使用值为空的散列表实现，所有这些操作的时间复杂度都为0(1)。<br> Redis还提供了多个集合之间的交集、并集、差集的运算。</span></p> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;"><strong>set类型常用命令</strong><br> 增加/删除元素<br> SADD key member [member …]<br> SREM key member [member …]</span></p> 
<pre class="has" style="margin-left:0px;"><code class="language-prettyprint">&lt;span style="color:#000000"&gt;&lt;code class="language-sql"&gt;&lt;span style="color:#98c379"&gt;127.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.1&lt;/span&gt;:&lt;span style="color:#98c379"&gt;6379&lt;/span&gt;&lt;span style="color:#669900"&gt;&gt;&lt;/span&gt; sadd &lt;span style="color:#c678dd"&gt;set&lt;/span&gt; a b c
&lt;span style="color:#999999"&gt;(&lt;/span&gt;&lt;span style="color:#c678dd"&gt;integer&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt; &lt;span style="color:#98c379"&gt;3&lt;/span&gt;
&lt;span style="color:#98c379"&gt;127.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.1&lt;/span&gt;:&lt;span style="color:#98c379"&gt;6379&lt;/span&gt;&lt;span style="color:#669900"&gt;&gt;&lt;/span&gt; sadd &lt;span style="color:#c678dd"&gt;set&lt;/span&gt; a
&lt;span style="color:#999999"&gt;(&lt;/span&gt;&lt;span style="color:#c678dd"&gt;integer&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt; &lt;span style="color:#98c379"&gt;0&lt;/span&gt;
&lt;span style="color:#98c379"&gt;127.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.1&lt;/span&gt;:&lt;span style="color:#98c379"&gt;6379&lt;/span&gt;&lt;span style="color:#669900"&gt;&gt;&lt;/span&gt; srem &lt;span style="color:#c678dd"&gt;set&lt;/span&gt; c d
&lt;span style="color:#999999"&gt;(&lt;/span&gt;&lt;span style="color:#c678dd"&gt;integer&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt; &lt;span style="color:#98c379"&gt;1&lt;/span&gt;
&lt;/code&gt;&lt;/span&gt;</code></pre> 
<ul style="margin-left:0px;"><li>1</li><li>2</li><li>3</li><li>4</li><li>5</li><li>6</li></ul> 
<pre class="has" style="margin-left:0px;"><code class="language-prettyprint">&lt;span style="color:#000000"&gt;&lt;code&gt;获得集合中的所有元素 
&lt;/code&gt;&lt;/span&gt;</code></pre> 
<ul style="margin-left:0px;"><li>1</li></ul> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">SMEMBERS key</span></p> 
<pre class="has" style="margin-left:0px;"><code class="language-prettyprint">&lt;span style="color:#000000"&gt;&lt;code class="language-sql"&gt;&lt;span style="color:#98c379"&gt;127.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.1&lt;/span&gt;:&lt;span style="color:#98c379"&gt;6379&lt;/span&gt;&lt;span style="color:#669900"&gt;&gt;&lt;/span&gt; smembers &lt;span style="color:#c678dd"&gt;set&lt;/span&gt;
&lt;span style="color:#98c379"&gt;1&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt; &lt;span style="color:#669900"&gt;"b"&lt;/span&gt;
&lt;span style="color:#98c379"&gt;2&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt; "a”
&lt;/code&gt;&lt;/span&gt;</code></pre> 
<ul style="margin-left:0px;"><li>1</li><li>2</li><li>3</li></ul> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">判断元素是否在集合中，无论集合中有多少元素都可以极速的返回结果。<br> SISMEMBER key member</span></p> 
<pre class="has" style="margin-left:0px;"><code class="language-prettyprint">&lt;span style="color:#000000"&gt;&lt;code class="language-sql"&gt;&lt;span style="color:#98c379"&gt;127.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.1&lt;/span&gt;:&lt;span style="color:#98c379"&gt;6379&lt;/span&gt;&lt;span style="color:#669900"&gt;&gt;&lt;/span&gt; sismember &lt;span style="color:#c678dd"&gt;set&lt;/span&gt; a
&lt;span style="color:#999999"&gt;(&lt;/span&gt;&lt;span style="color:#c678dd"&gt;integer&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt; &lt;span style="color:#98c379"&gt;1&lt;/span&gt;
&lt;span style="color:#98c379"&gt;127.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.1&lt;/span&gt;:&lt;span style="color:#98c379"&gt;6379&lt;/span&gt;&lt;span style="color:#669900"&gt;&gt;&lt;/span&gt; sismember &lt;span style="color:#c678dd"&gt;set&lt;/span&gt; h
&lt;span style="color:#999999"&gt;(&lt;/span&gt;&lt;span style="color:#c678dd"&gt;integer&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt; &lt;span style="color:#98c379"&gt;0&lt;/span&gt;
&lt;/code&gt;&lt;/span&gt;</code></pre> 
<ul style="margin-left:0px;"><li>1</li><li>2</li><li>3</li><li>4</li></ul> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">集合的差集运算 A-B<br> 属于A并且不属于B的元素构成的集合。<br> SDIFF key [key …]</span></p> 
<pre class="has" style="margin-left:0px;"><code class="language-prettyprint">&lt;span style="color:#000000"&gt;&lt;code class="language-sql"&gt;&lt;span style="color:#98c379"&gt;127.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.1&lt;/span&gt;:&lt;span style="color:#98c379"&gt;6379&lt;/span&gt;&lt;span style="color:#669900"&gt;&gt;&lt;/span&gt; sadd setA &lt;span style="color:#98c379"&gt;1&lt;/span&gt; &lt;span style="color:#98c379"&gt;2&lt;/span&gt; &lt;span style="color:#98c379"&gt;3&lt;/span&gt;
&lt;span style="color:#999999"&gt;(&lt;/span&gt;&lt;span style="color:#c678dd"&gt;integer&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt; &lt;span style="color:#98c379"&gt;3&lt;/span&gt;
&lt;span style="color:#98c379"&gt;127.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.1&lt;/span&gt;:&lt;span style="color:#98c379"&gt;6379&lt;/span&gt;&lt;span style="color:#669900"&gt;&gt;&lt;/span&gt; sadd setB &lt;span style="color:#98c379"&gt;2&lt;/span&gt; &lt;span style="color:#98c379"&gt;3&lt;/span&gt; &lt;span style="color:#98c379"&gt;4&lt;/span&gt;
&lt;span style="color:#999999"&gt;(&lt;/span&gt;&lt;span style="color:#c678dd"&gt;integer&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt; &lt;span style="color:#98c379"&gt;3&lt;/span&gt;
&lt;span style="color:#98c379"&gt;127.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.1&lt;/span&gt;:&lt;span style="color:#98c379"&gt;6379&lt;/span&gt;&lt;span style="color:#669900"&gt;&gt;&lt;/span&gt; sdiff setA setB 
&lt;span style="color:#98c379"&gt;1&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt; &lt;span style="color:#669900"&gt;"1"&lt;/span&gt;
&lt;span style="color:#98c379"&gt;127.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.1&lt;/span&gt;:&lt;span style="color:#98c379"&gt;6379&lt;/span&gt;&lt;span style="color:#669900"&gt;&gt;&lt;/span&gt; sdiff setB setA 
&lt;span style="color:#98c379"&gt;1&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt; &lt;span style="color:#669900"&gt;"4"&lt;/span&gt;
&lt;/code&gt;&lt;/span&gt;</code></pre> 
<ul style="margin-left:0px;"><li>1</li><li>2</li><li>3</li><li>4</li><li>5</li><li>6</li><li>7</li><li>8</li></ul> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">集合的交集运算 A ∩ B<br> 属于A且属于B的元素构成的集合<br> SINTER key [key …]</span></p> 
<pre class="has" style="margin-left:0px;"><code class="language-prettyprint">&lt;span style="color:#000000"&gt;&lt;code class="language-sql"&gt;&lt;span style="color:#98c379"&gt;127.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.1&lt;/span&gt;:&lt;span style="color:#98c379"&gt;6379&lt;/span&gt;&lt;span style="color:#669900"&gt;&gt;&lt;/span&gt; sinter setA setB 
&lt;span style="color:#98c379"&gt;1&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt; &lt;span style="color:#669900"&gt;"2"&lt;/span&gt;
&lt;span style="color:#98c379"&gt;2&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt; &lt;span style="color:#669900"&gt;"3"&lt;/span&gt;
&lt;/code&gt;&lt;/span&gt;</code></pre> 
<ul style="margin-left:0px;"><li>1</li><li>2</li><li>3</li></ul> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">集合的并集运算 A ∪ B<br> 属于A或者属于B的元素构成的集合<br> SUNION key [key …]</span></p> 
<pre class="has" style="margin-left:0px;"><code class="language-prettyprint">&lt;span style="color:#000000"&gt;&lt;code class="language-sql"&gt;&lt;span style="color:#98c379"&gt;127.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.1&lt;/span&gt;:&lt;span style="color:#98c379"&gt;6379&lt;/span&gt;&lt;span style="color:#669900"&gt;&gt;&lt;/span&gt; sunion setA setB
&lt;span style="color:#98c379"&gt;1&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt; &lt;span style="color:#669900"&gt;"1"&lt;/span&gt;
&lt;span style="color:#98c379"&gt;2&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt; &lt;span style="color:#669900"&gt;"2"&lt;/span&gt;
&lt;span style="color:#98c379"&gt;3&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt; &lt;span style="color:#669900"&gt;"3"&lt;/span&gt;
&lt;span style="color:#98c379"&gt;4&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt; &lt;span style="color:#669900"&gt;"4"&lt;/span&gt;
&lt;/code&gt;&lt;/span&gt;</code></pre> 
<ul style="margin-left:0px;"><li>1</li><li>2</li><li>3</li><li>4</li><li>5</li></ul> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">获得集合中元素的个数<br> SCARD key</span></p> 
<pre class="has" style="margin-left:0px;"><code class="language-prettyprint">&lt;span style="color:#000000"&gt;&lt;code class="language-sql"&gt;&lt;span style="color:#98c379"&gt;127.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.1&lt;/span&gt;:&lt;span style="color:#98c379"&gt;6379&lt;/span&gt;&lt;span style="color:#669900"&gt;&gt;&lt;/span&gt; smembers setA 
&lt;span style="color:#98c379"&gt;1&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt; &lt;span style="color:#669900"&gt;"1"&lt;/span&gt;
&lt;span style="color:#98c379"&gt;2&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt; &lt;span style="color:#669900"&gt;"2"&lt;/span&gt;
&lt;span style="color:#98c379"&gt;3&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt; &lt;span style="color:#669900"&gt;"3"&lt;/span&gt;
&lt;span style="color:#98c379"&gt;127.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.1&lt;/span&gt;:&lt;span style="color:#98c379"&gt;6379&lt;/span&gt;&lt;span style="color:#669900"&gt;&gt;&lt;/span&gt; scard setA 
&lt;span style="color:#999999"&gt;(&lt;/span&gt;&lt;span style="color:#c678dd"&gt;integer&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt; &lt;span style="color:#98c379"&gt;3&lt;/span&gt;
&lt;/code&gt;&lt;/span&gt;</code></pre> 
<ul style="margin-left:0px;"><li>1</li><li>2</li><li>3</li><li>4</li><li>5</li><li>6</li></ul> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">从集合中弹出一个元素<br> SPOP key</span></p> 
<pre class="has" style="margin-left:0px;"><code class="language-prettyprint">&lt;span style="color:#000000"&gt;&lt;code class="language-sql"&gt;&lt;span style="color:#98c379"&gt;127.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.1&lt;/span&gt;:&lt;span style="color:#98c379"&gt;6379&lt;/span&gt;&lt;span style="color:#669900"&gt;&gt;&lt;/span&gt; spop setA 
"&lt;span style="color:#98c379"&gt;1&lt;/span&gt;“
&lt;/code&gt;&lt;/span&gt;</code></pre> 
<ul style="margin-left:0px;"><li>1</li><li>2</li></ul> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">注意：由于集合是无序的，所有SPOP命令会从集合中随机选择一个元素弹出</span></p> 
<h3 style="margin-left:0px;"><strong><span style="color:#4f4f4f;"><a name="t26"></a><a id="85sorted_1034"></a>8.5、sorted类型</span></strong></h3> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;"><strong>sorted set类型介绍</strong></span></p> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">在集合类型的基础上，有序集合类型(sorted set)为集合中的每个元素都关联一个分数，这使得我们不仅可以完成插入、删除和判断元素是否存在在集合中，还能够获得分数最高或最低的前N个元素、获取指定分数范围内的元素等与分数有关的操作。<br> 在某些方面有序集合和列表类型有些相似。<br> 1、二者都是有序的。<br> 2、二者都可以获得某一范围的元素。<br> 但是，二者有着很大区别：<br> 1、列表类型是通过链表实现的，获取靠近两端的数据速度极快，而当元素增多后，访问中间数据的速度会变慢。<br> 2、有序集合类型使用散列表实现，所有即使读取位于中间部分的数据也很快。<br> 3、列表中不能简单的调整某个元素的位置，但是有序集合可以（通过更改分数实现）<br> 4、有序集合要比列表类型更耗内存。</span></p> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">sorted set类型常用命令<br> 增加元素<br> 向有序集合中加入一个元素和该元素的分数，如果该元素已经存在则会用新的分数替换原有的分数。返回值是新加入到集合中的元素个数，不包含之前已经存在的元素。<br> ZADD key score member [score member …]</span></p> 
<pre class="has" style="margin-left:0px;"><code class="language-prettyprint">&lt;span style="color:#000000"&gt;&lt;code class="language-sql"&gt;&lt;span style="color:#98c379"&gt;127.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.1&lt;/span&gt;:&lt;span style="color:#98c379"&gt;6379&lt;/span&gt;&lt;span style="color:#669900"&gt;&gt;&lt;/span&gt; zadd scoreboard &lt;span style="color:#98c379"&gt;80&lt;/span&gt; zhangsan &lt;span style="color:#98c379"&gt;89&lt;/span&gt; lisi &lt;span style="color:#98c379"&gt;94&lt;/span&gt; wangwu 
&lt;span style="color:#999999"&gt;(&lt;/span&gt;&lt;span style="color:#c678dd"&gt;integer&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt; &lt;span style="color:#98c379"&gt;3&lt;/span&gt;
&lt;span style="color:#98c379"&gt;127.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.1&lt;/span&gt;:&lt;span style="color:#98c379"&gt;6379&lt;/span&gt;&lt;span style="color:#669900"&gt;&gt;&lt;/span&gt; zadd scoreboard &lt;span style="color:#98c379"&gt;97&lt;/span&gt; lisi 
&lt;span style="color:#999999"&gt;(&lt;/span&gt;&lt;span style="color:#c678dd"&gt;integer&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt; &lt;span style="color:#98c379"&gt;0&lt;/span&gt;
&lt;/code&gt;&lt;/span&gt;</code></pre> 
<ul style="margin-left:0px;"><li>1</li><li>2</li><li>3</li><li>4</li></ul> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">获取元素的分数<br> ZSCORE key member</span></p> 
<pre class="has" style="margin-left:0px;"><code class="language-prettyprint">&lt;span style="color:#000000"&gt;&lt;code class="language-sql"&gt;&lt;span style="color:#98c379"&gt;127.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.1&lt;/span&gt;:&lt;span style="color:#98c379"&gt;6379&lt;/span&gt;&lt;span style="color:#669900"&gt;&gt;&lt;/span&gt; zscore scoreboard lisi 
&lt;/code&gt;&lt;/span&gt;</code></pre> 
<ul style="margin-left:0px;"><li>1</li></ul> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">删除元素<br> ZREM key member [member …]<br> 移除有序集key中的一个或多个成员，不存在的成员将被忽略。<br> 当key存在但不是有序集类型时，返回一个错误。</span></p> 
<pre class="has" style="margin-left:0px;"><code class="language-prettyprint">&lt;span style="color:#000000"&gt;&lt;code class="language-sql"&gt;&lt;span style="color:#98c379"&gt;127.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.1&lt;/span&gt;:&lt;span style="color:#98c379"&gt;6379&lt;/span&gt;&lt;span style="color:#669900"&gt;&gt;&lt;/span&gt; zrem scoreboard lisi
&lt;span style="color:#999999"&gt;(&lt;/span&gt;&lt;span style="color:#c678dd"&gt;integer&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt; &lt;span style="color:#98c379"&gt;1&lt;/span&gt;
&lt;/code&gt;&lt;/span&gt;</code></pre> 
<ul style="margin-left:0px;"><li>1</li><li>2</li></ul> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">获得排名在某个范围的元素列表<br> 获得排名在某个范围的元素列表<br> ZRANGE key start stop [WITHSCORES] 照元素分数从小到大的顺序返回索引从start到stop之间的所有元素（包含两端的元素）</span></p> 
<pre class="has" style="margin-left:0px;"><code class="language-prettyprint">&lt;span style="color:#000000"&gt;&lt;code class="language-sql"&gt;&lt;span style="color:#98c379"&gt;127.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.1&lt;/span&gt;:&lt;span style="color:#98c379"&gt;6379&lt;/span&gt;&lt;span style="color:#669900"&gt;&gt;&lt;/span&gt; zrange scoreboard &lt;span style="color:#98c379"&gt;0&lt;/span&gt; &lt;span style="color:#98c379"&gt;2&lt;/span&gt;
&lt;span style="color:#98c379"&gt;1&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt; &lt;span style="color:#669900"&gt;"zhangsan"&lt;/span&gt;
&lt;span style="color:#98c379"&gt;2&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt; &lt;span style="color:#669900"&gt;"wangwu"&lt;/span&gt;
&lt;span style="color:#98c379"&gt;3&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt; "lisi“
&lt;/code&gt;&lt;/span&gt;</code></pre> 
<ul style="margin-left:0px;"><li>1</li><li>2</li><li>3</li><li>4</li></ul> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">ZREVRANGE key start stop [WITHSCORES] 照元素分数从大到小的顺序返回索引从start到stop之间的所有元素（包含两端的元素）</span></p> 
<pre class="has" style="margin-left:0px;"><code class="language-prettyprint">&lt;span style="color:#000000"&gt;&lt;code class="language-sql"&gt;&lt;span style="color:#98c379"&gt;127.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.1&lt;/span&gt;:&lt;span style="color:#98c379"&gt;6379&lt;/span&gt;&lt;span style="color:#669900"&gt;&gt;&lt;/span&gt; zrevrange scoreboard &lt;span style="color:#98c379"&gt;0&lt;/span&gt; &lt;span style="color:#98c379"&gt;2&lt;/span&gt;
&lt;span style="color:#98c379"&gt;1&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt; &lt;span style="color:#669900"&gt;" lisi "&lt;/span&gt;
&lt;span style="color:#98c379"&gt;2&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt; &lt;span style="color:#669900"&gt;"wangwu"&lt;/span&gt;
&lt;span style="color:#98c379"&gt;3&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt; " zhangsan “
&lt;/code&gt;&lt;/span&gt;</code></pre> 
<ul style="margin-left:0px;"><li>1</li><li>2</li><li>3</li><li>4</li></ul> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">如果需要获得元素的分数的可以在命令尾部加上WITHSCORES参数</span></p> 
<pre class="has" style="margin-left:0px;"><code class="language-prettyprint">&lt;span style="color:#000000"&gt;&lt;code class="language-sql"&gt;&lt;span style="color:#98c379"&gt;127.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.1&lt;/span&gt;:&lt;span style="color:#98c379"&gt;6379&lt;/span&gt;&lt;span style="color:#669900"&gt;&gt;&lt;/span&gt; zrange scoreboard &lt;span style="color:#98c379"&gt;0&lt;/span&gt; &lt;span style="color:#98c379"&gt;1&lt;/span&gt; WITHSCORES
&lt;span style="color:#98c379"&gt;1&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt; &lt;span style="color:#669900"&gt;"zhangsan"&lt;/span&gt;
&lt;span style="color:#98c379"&gt;2&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt; &lt;span style="color:#669900"&gt;"80"&lt;/span&gt;
&lt;span style="color:#98c379"&gt;3&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt; &lt;span style="color:#669900"&gt;"wangwu"&lt;/span&gt;
&lt;span style="color:#98c379"&gt;4&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt; &lt;span style="color:#669900"&gt;"94"&lt;/span&gt;
&lt;/code&gt;&lt;/span&gt;</code></pre> 
<ul style="margin-left:0px;"><li>1</li><li>2</li><li>3</li><li>4</li><li>5</li></ul> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">获得指定分数范围的元素<br> ZRANGEBYSCORE key min max [WITHSCORES] [LIMIT offset count]</span></p> 
<pre class="has" style="margin-left:0px;"><code class="language-prettyprint">&lt;span style="color:#000000"&gt;&lt;code class="language-sql"&gt;&lt;span style="color:#98c379"&gt;127.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.1&lt;/span&gt;:&lt;span style="color:#98c379"&gt;6379&lt;/span&gt;&lt;span style="color:#669900"&gt;&gt;&lt;/span&gt; ZRANGEBYSCORE scoreboard &lt;span style="color:#98c379"&gt;90&lt;/span&gt; &lt;span style="color:#98c379"&gt;97&lt;/span&gt; WITHSCORES
&lt;span style="color:#98c379"&gt;1&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt; &lt;span style="color:#669900"&gt;"wangwu"&lt;/span&gt;
&lt;span style="color:#98c379"&gt;2&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt; &lt;span style="color:#669900"&gt;"94"&lt;/span&gt;
&lt;span style="color:#98c379"&gt;3&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt; &lt;span style="color:#669900"&gt;"lisi"&lt;/span&gt;
&lt;span style="color:#98c379"&gt;4&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt; &lt;span style="color:#669900"&gt;"97"&lt;/span&gt;
&lt;span style="color:#98c379"&gt;127.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.1&lt;/span&gt;:&lt;span style="color:#98c379"&gt;6379&lt;/span&gt;&lt;span style="color:#669900"&gt;&gt;&lt;/span&gt; ZRANGEBYSCORE scoreboard &lt;span style="color:#98c379"&gt;70&lt;/span&gt; &lt;span style="color:#98c379"&gt;100&lt;/span&gt; &lt;span style="color:#c678dd"&gt;limit&lt;/span&gt; &lt;span style="color:#98c379"&gt;1&lt;/span&gt; &lt;span style="color:#98c379"&gt;2&lt;/span&gt;
&lt;span style="color:#98c379"&gt;1&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt; &lt;span style="color:#669900"&gt;"wangwu"&lt;/span&gt;
&lt;span style="color:#98c379"&gt;2&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt; &lt;span style="color:#669900"&gt;"lisi"&lt;/span&gt;
&lt;/code&gt;&lt;/span&gt;</code></pre> 
<ul style="margin-left:0px;"><li>1</li><li>2</li><li>3</li><li>4</li><li>5</li><li>6</li><li>7</li><li>8</li></ul> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">增加某个元素的分数，返回值是更改后的分数。<br> ZINCRBY key increment member<br> 给lisi加4分</span></p> 
<pre class="has" style="margin-left:0px;"><code class="language-prettyprint">&lt;span style="color:#000000"&gt;&lt;code class="language-sql"&gt;&lt;span style="color:#98c379"&gt;127.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.1&lt;/span&gt;:&lt;span style="color:#98c379"&gt;6379&lt;/span&gt;&lt;span style="color:#669900"&gt;&gt;&lt;/span&gt; ZINCRBY scoreboard  &lt;span style="color:#98c379"&gt;4&lt;/span&gt; lisi 
"&lt;span style="color:#98c379"&gt;101&lt;/span&gt;“
&lt;/code&gt;&lt;/span&gt;</code></pre> 
<ul style="margin-left:0px;"><li>1</li><li>2</li></ul> 
<pre class="has" style="margin-left:0px;"><code class="language-prettyprint">&lt;span style="color:#000000"&gt;&lt;code&gt;获得集合中元素的数量 
&lt;/code&gt;&lt;/span&gt;</code></pre> 
<ul style="margin-left:0px;"><li>1</li></ul> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">ZCARD key</span></p> 
<pre class="has" style="margin-left:0px;"><code class="language-prettyprint">&lt;span style="color:#000000"&gt;&lt;code class="language-sql"&gt;&lt;span style="color:#98c379"&gt;127.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.1&lt;/span&gt;:&lt;span style="color:#98c379"&gt;6379&lt;/span&gt;&lt;span style="color:#669900"&gt;&gt;&lt;/span&gt; ZCARD scoreboard
&lt;span style="color:#999999"&gt;(&lt;/span&gt;&lt;span style="color:#c678dd"&gt;integer&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt; &lt;span style="color:#98c379"&gt;3&lt;/span&gt;
&lt;/code&gt;&lt;/span&gt;</code></pre> 
<ul style="margin-left:0px;"><li>1</li><li>2</li></ul> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">获得指定分数范围内的元素个数<br> ZCOUNT key min max</span></p> 
<pre class="has" style="margin-left:0px;"><code class="language-prettyprint">&lt;span style="color:#000000"&gt;&lt;code class="language-sql"&gt;&lt;span style="color:#98c379"&gt;127.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.1&lt;/span&gt;:&lt;span style="color:#98c379"&gt;6379&lt;/span&gt;&lt;span style="color:#669900"&gt;&gt;&lt;/span&gt; ZCOUNT scoreboard &lt;span style="color:#98c379"&gt;80&lt;/span&gt; &lt;span style="color:#98c379"&gt;90&lt;/span&gt;
&lt;span style="color:#999999"&gt;(&lt;/span&gt;&lt;span style="color:#c678dd"&gt;integer&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt; &lt;span style="color:#98c379"&gt;1&lt;/span&gt;
&lt;/code&gt;&lt;/span&gt;</code></pre> 
<ul style="margin-left:0px;"><li>1</li><li>2</li></ul> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">按照排名范围删除元素<br> ZREMRANGEBYRANK key start stop</span></p> 
<pre class="has" style="margin-left:0px;"><code class="language-prettyprint">&lt;span style="color:#000000"&gt;&lt;code class="language-sql"&gt;&lt;span style="color:#98c379"&gt;127.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.1&lt;/span&gt;:&lt;span style="color:#98c379"&gt;6379&lt;/span&gt;&lt;span style="color:#669900"&gt;&gt;&lt;/span&gt; ZREMRANGEBYRANK scoreboard &lt;span style="color:#98c379"&gt;0&lt;/span&gt; &lt;span style="color:#98c379"&gt;1&lt;/span&gt;
&lt;span style="color:#999999"&gt;(&lt;/span&gt;&lt;span style="color:#c678dd"&gt;integer&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt; &lt;span style="color:#98c379"&gt;2&lt;/span&gt; 
&lt;span style="color:#98c379"&gt;127.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.1&lt;/span&gt;:&lt;span style="color:#98c379"&gt;6379&lt;/span&gt;&lt;span style="color:#669900"&gt;&gt;&lt;/span&gt; ZRANGE scoreboard &lt;span style="color:#98c379"&gt;0&lt;/span&gt; &lt;span style="color:#669900"&gt;-&lt;/span&gt;&lt;span style="color:#98c379"&gt;1&lt;/span&gt;
&lt;span style="color:#98c379"&gt;1&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt; &lt;span style="color:#669900"&gt;"lisi"&lt;/span&gt;
&lt;/code&gt;&lt;/span&gt;</code></pre> 
<ul style="margin-left:0px;"><li>1</li><li>2</li><li>3</li><li>4</li></ul> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">ZREMRANGEBYSCORE key min max<br> 按照分数范围删除元素</span></p> 
<pre class="has" style="margin-left:0px;"><code class="language-prettyprint">&lt;span style="color:#000000"&gt;&lt;code class="language-sql"&gt;&lt;span style="color:#98c379"&gt;127.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.1&lt;/span&gt;:&lt;span style="color:#98c379"&gt;6379&lt;/span&gt;&lt;span style="color:#669900"&gt;&gt;&lt;/span&gt; zadd scoreboard &lt;span style="color:#98c379"&gt;84&lt;/span&gt; zhangsan	
&lt;span style="color:#999999"&gt;(&lt;/span&gt;&lt;span style="color:#c678dd"&gt;integer&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt; &lt;span style="color:#98c379"&gt;1&lt;/span&gt;
&lt;span style="color:#98c379"&gt;127.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.1&lt;/span&gt;:&lt;span style="color:#98c379"&gt;6379&lt;/span&gt;&lt;span style="color:#669900"&gt;&gt;&lt;/span&gt; ZREMRANGEBYSCORE scoreboard &lt;span style="color:#98c379"&gt;80&lt;/span&gt; &lt;span style="color:#98c379"&gt;100&lt;/span&gt;
&lt;span style="color:#999999"&gt;(&lt;/span&gt;&lt;span style="color:#c678dd"&gt;integer&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt; &lt;span style="color:#98c379"&gt;1&lt;/span&gt;
&lt;/code&gt;&lt;/span&gt;</code></pre> 
<ul style="margin-left:0px;"><li>1</li><li>2</li><li>3</li><li>4</li></ul> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">获取元素的排名<br> ZRANK key member<br> ZREVRANK key member<br> 从小到大</span></p> 
<pre class="has" style="margin-left:0px;"><code class="language-prettyprint">&lt;span style="color:#000000"&gt;&lt;code class="language-sql"&gt;&lt;span style="color:#98c379"&gt;127.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.1&lt;/span&gt;:&lt;span style="color:#98c379"&gt;6379&lt;/span&gt;&lt;span style="color:#669900"&gt;&gt;&lt;/span&gt; ZRANK scoreboard lisi 
&lt;span style="color:#999999"&gt;(&lt;/span&gt;&lt;span style="color:#c678dd"&gt;integer&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt; &lt;span style="color:#98c379"&gt;0&lt;/span&gt;
从大到小 
&lt;span style="color:#98c379"&gt;127.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.1&lt;/span&gt;:&lt;span style="color:#98c379"&gt;6379&lt;/span&gt;&lt;span style="color:#669900"&gt;&gt;&lt;/span&gt; ZREVRANK scoreboard zhangsan 
&lt;span style="color:#999999"&gt;(&lt;/span&gt;&lt;span style="color:#c678dd"&gt;integer&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt; &lt;span style="color:#98c379"&gt;1&lt;/span&gt;
&lt;/code&gt;&lt;/span&gt;</code></pre> 
<ul style="margin-left:0px;"><li>1</li><li>2</li><li>3</li><li>4</li><li>5</li></ul> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;"><strong>应用场景</strong><br> 根据商品销售量对商品进行排行显示，定义sorted set集合，商品销售量为元素的分数。</span></p> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">定义商品销售排行榜key：items:sellsort</span></p> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">写入商品销售量：<br> 商品编号1001的销量是9，商品编号1002的销量是10</span></p> 
<pre class="has" style="margin-left:0px;"><code class="language-prettyprint">&lt;span style="color:#000000"&gt;&lt;code class="language-sql"&gt;&lt;span style="color:#98c379"&gt;192.168&lt;/span&gt;&lt;span style="color:#98c379"&gt;.101&lt;/span&gt;&lt;span style="color:#98c379"&gt;.3&lt;/span&gt;:&lt;span style="color:#98c379"&gt;7007&lt;/span&gt;&lt;span style="color:#669900"&gt;&gt;&lt;/span&gt; ZADD items:sellsort &lt;span style="color:#98c379"&gt;9&lt;/span&gt; &lt;span style="color:#98c379"&gt;1001&lt;/span&gt; &lt;span style="color:#98c379"&gt;10&lt;/span&gt; &lt;span style="color:#98c379"&gt;1002&lt;/span&gt;
&lt;/code&gt;&lt;/span&gt;</code></pre> 
<ul style="margin-left:0px;"><li>1</li></ul> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">商品编号1001的销量加1</span></p> 
<pre class="has" style="margin-left:0px;"><code class="language-prettyprint">&lt;span style="color:#000000"&gt;&lt;code class="language-sql"&gt;&lt;span style="color:#98c379"&gt;192.168&lt;/span&gt;&lt;span style="color:#98c379"&gt;.101&lt;/span&gt;&lt;span style="color:#98c379"&gt;.3&lt;/span&gt;:&lt;span style="color:#98c379"&gt;7001&lt;/span&gt;&lt;span style="color:#669900"&gt;&gt;&lt;/span&gt; ZINCRBY items:sellsort &lt;span style="color:#98c379"&gt;1&lt;/span&gt; &lt;span style="color:#98c379"&gt;1001&lt;/span&gt;
&lt;/code&gt;&lt;/span&gt;</code></pre> 
<ul style="margin-left:0px;"><li>1</li></ul> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">商品销量前10名：</span></p> 
<pre class="has" style="margin-left:0px;"><code class="language-prettyprint">&lt;span style="color:#000000"&gt;&lt;code class="language-sql"&gt;&lt;span style="color:#98c379"&gt;192.168&lt;/span&gt;&lt;span style="color:#98c379"&gt;.101&lt;/span&gt;&lt;span style="color:#98c379"&gt;.3&lt;/span&gt;:&lt;span style="color:#98c379"&gt;7001&lt;/span&gt;&lt;span style="color:#669900"&gt;&gt;&lt;/span&gt; ZRANGE items:sellsort &lt;span style="color:#98c379"&gt;0&lt;/span&gt; &lt;span style="color:#98c379"&gt;9&lt;/span&gt; withscores
&lt;/code&gt;&lt;/span&gt;</code></pre> 
<ul style="margin-left:0px;"><li>1</li></ul> 
<h2 style="margin-left:0px;"><strong><span style="color:#4f4f4f;"><a name="t27"></a><a id="keys_1200"></a>九、keys命令</span></strong></h2> 
<h3 style="margin-left:0px;"><strong><span style="color:#4f4f4f;"><a name="t28"></a><a id="91key_1201"></a>9.1、设置key的生存时间</span></strong></h3> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">Redis在实际使用过程中更多的用作缓存，然而缓存的数据一般都是需要设置生存时间的，即：到期后数据销毁。</span></p> 
<ul style="margin-left:0px;"><li>EXPIRE key seconds 设置key的生存时间（单位：秒）key在多少秒后会自动删除</li><li>TTL key 查看key生于的生存时间</li><li>PERSIST key 清除生存时间</li><li>PEXPIRE key milliseconds 生存时间设置单位为：毫秒</li></ul> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">例子：</span></p> 
<pre class="has" style="margin-left:0px;"><code class="language-prettyprint">&lt;span style="color:#000000"&gt;&lt;code class="language-sql"&gt;&lt;span style="color:#98c379"&gt;192.168&lt;/span&gt;&lt;span style="color:#98c379"&gt;.101&lt;/span&gt;&lt;span style="color:#98c379"&gt;.3&lt;/span&gt;:&lt;span style="color:#98c379"&gt;7002&lt;/span&gt;&lt;span style="color:#669900"&gt;&gt;&lt;/span&gt; &lt;span style="color:#c678dd"&gt;set&lt;/span&gt; test &lt;span style="color:#98c379"&gt;1&lt;/span&gt;		设置test的值为&lt;span style="color:#98c379"&gt;1&lt;/span&gt;
OK
&lt;span style="color:#98c379"&gt;192.168&lt;/span&gt;&lt;span style="color:#98c379"&gt;.101&lt;/span&gt;&lt;span style="color:#98c379"&gt;.3&lt;/span&gt;:&lt;span style="color:#98c379"&gt;7002&lt;/span&gt;&lt;span style="color:#669900"&gt;&gt;&lt;/span&gt; get test			获取test的值
&lt;span style="color:#669900"&gt;"1"&lt;/span&gt;
&lt;span style="color:#98c379"&gt;192.168&lt;/span&gt;&lt;span style="color:#98c379"&gt;.101&lt;/span&gt;&lt;span style="color:#98c379"&gt;.3&lt;/span&gt;:&lt;span style="color:#98c379"&gt;7002&lt;/span&gt;&lt;span style="color:#669900"&gt;&gt;&lt;/span&gt; EXPIRE test &lt;span style="color:#98c379"&gt;5&lt;/span&gt;	设置test的生存时间为&lt;span style="color:#98c379"&gt;5&lt;/span&gt;秒
&lt;span style="color:#999999"&gt;(&lt;/span&gt;&lt;span style="color:#c678dd"&gt;integer&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt; &lt;span style="color:#98c379"&gt;1&lt;/span&gt;
&lt;span style="color:#98c379"&gt;192.168&lt;/span&gt;&lt;span style="color:#98c379"&gt;.101&lt;/span&gt;&lt;span style="color:#98c379"&gt;.3&lt;/span&gt;:&lt;span style="color:#98c379"&gt;7002&lt;/span&gt;&lt;span style="color:#669900"&gt;&gt;&lt;/span&gt; TTL test			查看test的生于生成时间还有&lt;span style="color:#98c379"&gt;1&lt;/span&gt;秒删除
&lt;span style="color:#999999"&gt;(&lt;/span&gt;&lt;span style="color:#c678dd"&gt;integer&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt; &lt;span style="color:#98c379"&gt;1&lt;/span&gt;
&lt;span style="color:#98c379"&gt;192.168&lt;/span&gt;&lt;span style="color:#98c379"&gt;.101&lt;/span&gt;&lt;span style="color:#98c379"&gt;.3&lt;/span&gt;:&lt;span style="color:#98c379"&gt;7002&lt;/span&gt;&lt;span style="color:#669900"&gt;&gt;&lt;/span&gt; TTL test
&lt;span style="color:#999999"&gt;(&lt;/span&gt;&lt;span style="color:#c678dd"&gt;integer&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt; &lt;span style="color:#669900"&gt;-&lt;/span&gt;&lt;span style="color:#98c379"&gt;2&lt;/span&gt;
&lt;span style="color:#98c379"&gt;192.168&lt;/span&gt;&lt;span style="color:#98c379"&gt;.101&lt;/span&gt;&lt;span style="color:#98c379"&gt;.3&lt;/span&gt;:&lt;span style="color:#98c379"&gt;7002&lt;/span&gt;&lt;span style="color:#669900"&gt;&gt;&lt;/span&gt; get test			获取test的值，已经删除
&lt;span style="color:#999999"&gt;(&lt;/span&gt;nil&lt;span style="color:#999999"&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/span&gt;</code></pre> 
<ul style="margin-left:0px;"><li>1</li><li>2</li><li>3</li><li>4</li><li>5</li><li>6</li><li>7</li><li>8</li><li>9</li><li>10</li><li>11</li><li>12</li></ul> 
<h3 style="margin-left:0px;"><strong><span style="color:#4f4f4f;"><a name="t29"></a><a id="92pattern_key_1225"></a>9.2、返回满足给定pattern 的所有key</span></strong></h3> 
<pre class="has" style="margin-left:0px;"><code class="language-prettyprint">&lt;span style="color:#000000"&gt;&lt;code class="language-sql"&gt;redis &lt;span style="color:#98c379"&gt;127.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.1&lt;/span&gt;:&lt;span style="color:#98c379"&gt;6379&lt;/span&gt;&lt;span style="color:#669900"&gt;&gt;&lt;/span&gt; &lt;span style="color:#c678dd"&gt;keys&lt;/span&gt; mylist&lt;span style="color:#669900"&gt;*&lt;/span&gt;
&lt;span style="color:#98c379"&gt;1&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt; &lt;span style="color:#669900"&gt;"mylist"&lt;/span&gt;
&lt;span style="color:#98c379"&gt;2&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt; &lt;span style="color:#669900"&gt;"mylist5"&lt;/span&gt;
&lt;span style="color:#98c379"&gt;3&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt; &lt;span style="color:#669900"&gt;"mylist6"&lt;/span&gt;
&lt;span style="color:#98c379"&gt;4&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt; &lt;span style="color:#669900"&gt;"mylist7"&lt;/span&gt;
&lt;span style="color:#98c379"&gt;5&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt; &lt;span style="color:#669900"&gt;"mylist8"&lt;/span&gt;
&lt;/code&gt;&lt;/span&gt;</code></pre> 
<ul style="margin-left:0px;"><li>1</li><li>2</li><li>3</li><li>4</li><li>5</li><li>6</li></ul> 
<h3 style="margin-left:0px;"><strong><span style="color:#4f4f4f;"><a name="t30"></a><a id="93key__1235"></a>9.3、确认一个key 是否存在</span></strong></h3> 
<pre class="has" style="margin-left:0px;"><code class="language-prettyprint">&lt;span style="color:#000000"&gt;&lt;code class="language-sql"&gt;redis &lt;span style="color:#98c379"&gt;127.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.1&lt;/span&gt;:&lt;span style="color:#98c379"&gt;6379&lt;/span&gt;&lt;span style="color:#669900"&gt;&gt;&lt;/span&gt; &lt;span style="color:#c678dd"&gt;exists&lt;/span&gt; HongWan
&lt;span style="color:#999999"&gt;(&lt;/span&gt;&lt;span style="color:#c678dd"&gt;integer&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt; &lt;span style="color:#98c379"&gt;0&lt;/span&gt;
redis &lt;span style="color:#98c379"&gt;127.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.1&lt;/span&gt;:&lt;span style="color:#98c379"&gt;6379&lt;/span&gt;&lt;span style="color:#669900"&gt;&gt;&lt;/span&gt; &lt;span style="color:#c678dd"&gt;exists&lt;/span&gt; age
&lt;span style="color:#999999"&gt;(&lt;/span&gt;&lt;span style="color:#c678dd"&gt;integer&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt; &lt;span style="color:#98c379"&gt;1&lt;/span&gt;
redis &lt;span style="color:#98c379"&gt;127.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.1&lt;/span&gt;:&lt;span style="color:#98c379"&gt;6379&lt;/span&gt;&lt;span style="color:#669900"&gt;&gt;&lt;/span&gt;
&lt;/code&gt;&lt;/span&gt;</code></pre> 
<ul style="margin-left:0px;"><li>1</li><li>2</li><li>3</li><li>4</li><li>5</li></ul> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">从结果来数据库中不存在HongWan 这个key，但是age 这个key 是存在的</span></p> 
<h3 style="margin-left:0px;"><strong><span style="color:#4f4f4f;"><a name="t31"></a><a id="93key_1246"></a>9.3、删除一个key</span></strong></h3> 
<pre class="has" style="margin-left:0px;"><code class="language-prettyprint">&lt;span style="color:#000000"&gt;&lt;code class="language-sql"&gt;redis &lt;span style="color:#98c379"&gt;127.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.1&lt;/span&gt;:&lt;span style="color:#98c379"&gt;6379&lt;/span&gt;&lt;span style="color:#669900"&gt;&gt;&lt;/span&gt; del age
&lt;span style="color:#999999"&gt;(&lt;/span&gt;&lt;span style="color:#c678dd"&gt;integer&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt; &lt;span style="color:#98c379"&gt;1&lt;/span&gt;
redis &lt;span style="color:#98c379"&gt;127.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.1&lt;/span&gt;:&lt;span style="color:#98c379"&gt;6379&lt;/span&gt;&lt;span style="color:#669900"&gt;&gt;&lt;/span&gt; &lt;span style="color:#c678dd"&gt;exists&lt;/span&gt; age
&lt;span style="color:#999999"&gt;(&lt;/span&gt;&lt;span style="color:#c678dd"&gt;integer&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt; &lt;span style="color:#98c379"&gt;0&lt;/span&gt;
redis &lt;span style="color:#98c379"&gt;127.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.1&lt;/span&gt;:&lt;span style="color:#98c379"&gt;6379&lt;/span&gt;&lt;span style="color:#669900"&gt;&gt;&lt;/span&gt;
&lt;/code&gt;&lt;/span&gt;</code></pre> 
<ul style="margin-left:0px;"><li>1</li><li>2</li><li>3</li><li>4</li><li>5</li></ul> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">从结果来数据库中不存在HongWan 这个key，但是age 这个key 是存在的</span></p> 
<h3 style="margin-left:0px;"><strong><span style="color:#4f4f4f;"><a name="t32"></a><a id="94key_1257"></a>9.4、重命名key</span></strong></h3> 
<pre class="has" style="margin-left:0px;"><code class="language-prettyprint">&lt;span style="color:#000000"&gt;&lt;code class="language-sql"&gt;redis &lt;span style="color:#98c379"&gt;127.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.1&lt;/span&gt;:&lt;span style="color:#98c379"&gt;6379&lt;/span&gt;&lt;span style="color:#999999"&gt;[&lt;/span&gt;&lt;span style="color:#98c379"&gt;1&lt;/span&gt;&lt;span style="color:#999999"&gt;]&lt;/span&gt;&lt;span style="color:#669900"&gt;&gt;&lt;/span&gt; &lt;span style="color:#c678dd"&gt;keys&lt;/span&gt; &lt;span style="color:#669900"&gt;*&lt;/span&gt;
&lt;span style="color:#98c379"&gt;1&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt; &lt;span style="color:#669900"&gt;"age"&lt;/span&gt;
redis &lt;span style="color:#98c379"&gt;127.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.1&lt;/span&gt;:&lt;span style="color:#98c379"&gt;6379&lt;/span&gt;&lt;span style="color:#999999"&gt;[&lt;/span&gt;&lt;span style="color:#98c379"&gt;1&lt;/span&gt;&lt;span style="color:#999999"&gt;]&lt;/span&gt;&lt;span style="color:#669900"&gt;&gt;&lt;/span&gt; &lt;span style="color:#c678dd"&gt;rename&lt;/span&gt; age age_new
OK
redis &lt;span style="color:#98c379"&gt;127.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.1&lt;/span&gt;:&lt;span style="color:#98c379"&gt;6379&lt;/span&gt;&lt;span style="color:#999999"&gt;[&lt;/span&gt;&lt;span style="color:#98c379"&gt;1&lt;/span&gt;&lt;span style="color:#999999"&gt;]&lt;/span&gt;&lt;span style="color:#669900"&gt;&gt;&lt;/span&gt; &lt;span style="color:#c678dd"&gt;keys&lt;/span&gt; &lt;span style="color:#669900"&gt;*&lt;/span&gt;
&lt;span style="color:#98c379"&gt;1&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt; &lt;span style="color:#669900"&gt;"age_new"&lt;/span&gt;
redis &lt;span style="color:#98c379"&gt;127.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.1&lt;/span&gt;:&lt;span style="color:#98c379"&gt;6379&lt;/span&gt;&lt;span style="color:#999999"&gt;[&lt;/span&gt;&lt;span style="color:#98c379"&gt;1&lt;/span&gt;&lt;span style="color:#999999"&gt;]&lt;/span&gt;&lt;span style="color:#669900"&gt;&gt;&lt;/span&gt;
&lt;/code&gt;&lt;/span&gt;</code></pre> 
<ul style="margin-left:0px;"><li>1</li><li>2</li><li>3</li><li>4</li><li>5</li><li>6</li><li>7</li></ul> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">age 成功的被我们改名为age_new 了</span></p> 
<h3 style="margin-left:0px;"><strong><span style="color:#4f4f4f;"><a name="t33"></a><a id="95_1270"></a>9.5、返回值的类型</span></strong></h3> 
<pre class="has" style="margin-left:0px;"><code class="language-prettyprint">&lt;span style="color:#000000"&gt;&lt;code class="language-sql"&gt;redis &lt;span style="color:#98c379"&gt;127.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.1&lt;/span&gt;:&lt;span style="color:#98c379"&gt;6379&lt;/span&gt;&lt;span style="color:#669900"&gt;&gt;&lt;/span&gt; &lt;span style="color:#c678dd"&gt;type&lt;/span&gt; addr
string
redis &lt;span style="color:#98c379"&gt;127.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.1&lt;/span&gt;:&lt;span style="color:#98c379"&gt;6379&lt;/span&gt;&lt;span style="color:#669900"&gt;&gt;&lt;/span&gt; &lt;span style="color:#c678dd"&gt;type&lt;/span&gt; myzset2
zset
redis &lt;span style="color:#98c379"&gt;127.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.1&lt;/span&gt;:&lt;span style="color:#98c379"&gt;6379&lt;/span&gt;&lt;span style="color:#669900"&gt;&gt;&lt;/span&gt; &lt;span style="color:#c678dd"&gt;type&lt;/span&gt; mylist
list
redis &lt;span style="color:#98c379"&gt;127.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.1&lt;/span&gt;:&lt;span style="color:#98c379"&gt;6379&lt;/span&gt;&lt;span style="color:#669900"&gt;&gt;&lt;/span&gt;
&lt;/code&gt;&lt;/span&gt;</code></pre> 
<ul style="margin-left:0px;"><li>1</li><li>2</li><li>3</li><li>4</li><li>5</li><li>6</li><li>7</li></ul> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">这个方法可以非常简单的判断出值的类型</span></p> 
<h2 style="margin-left:0px;"><strong><span style="color:#4f4f4f;"><a name="t34"></a><a id="_1284"></a>十、服务器命令</span></strong></h2> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;"><strong>ping</strong><br> 测试连接是否存活（返回PONG代表存活）</span></p> 
<pre class="has" style="margin-left:0px;"><code class="language-prettyprint">&lt;span style="color:#000000"&gt;&lt;code class="language-sql"&gt;redis &lt;span style="color:#98c379"&gt;127.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.1&lt;/span&gt;:&lt;span style="color:#98c379"&gt;6379&lt;/span&gt;&lt;span style="color:#669900"&gt;&gt;&lt;/span&gt; ping
PONG
&lt;/code&gt;&lt;/span&gt;</code></pre> 
<ul style="margin-left:0px;"><li>1</li><li>2</li></ul> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">//执行下面命令之前，我们停止redis 服务器</span></p> 
<pre class="has" style="margin-left:0px;"><code class="language-prettyprint">&lt;span style="color:#000000"&gt;&lt;code class="language-sql"&gt;redis &lt;span style="color:#98c379"&gt;127.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.1&lt;/span&gt;:&lt;span style="color:#98c379"&gt;6379&lt;/span&gt;&lt;span style="color:#669900"&gt;&gt;&lt;/span&gt; ping
Could &lt;span style="color:#669900"&gt;not&lt;/span&gt; &lt;span style="color:#c678dd"&gt;connect&lt;/span&gt; &lt;span style="color:#c678dd"&gt;to&lt;/span&gt; Redis at &lt;span style="color:#98c379"&gt;127.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.1&lt;/span&gt;:&lt;span style="color:#98c379"&gt;6379&lt;/span&gt;: Connection refused
&lt;/code&gt;&lt;/span&gt;</code></pre> 
<ul style="margin-left:0px;"><li>1</li><li>2</li></ul> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">//执行下面命令之前，我们启动redis 服务器</span></p> 
<pre class="has" style="margin-left:0px;"><code class="language-prettyprint">&lt;span style="color:#000000"&gt;&lt;code class="language-sql"&gt;&lt;span style="color:#669900"&gt;not&lt;/span&gt; connected&lt;span style="color:#669900"&gt;&gt;&lt;/span&gt; ping
PONG
redis &lt;span style="color:#98c379"&gt;127.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.1&lt;/span&gt;:&lt;span style="color:#98c379"&gt;6379&lt;/span&gt;&lt;span style="color:#669900"&gt;&gt;&lt;/span&gt;
&lt;/code&gt;&lt;/span&gt;</code></pre> 
<ul style="margin-left:0px;"><li>1</li><li>2</li><li>3</li></ul> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">第一个ping 时，说明此连接正常<br> 第二个ping 之前，我们将redis 服务器停止，那么ping 是失败的<br> 第三个ping 之前，我们将redis 服务器启动，那么ping 是成功的</span></p> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;"><strong>echo</strong><br> 在命令行打印一些内容</span></p> 
<pre class="has" style="margin-left:0px;"><code class="language-prettyprint">&lt;span style="color:#000000"&gt;&lt;code class="language-sql"&gt;redis &lt;span style="color:#98c379"&gt;127.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.1&lt;/span&gt;:&lt;span style="color:#98c379"&gt;6379&lt;/span&gt;&lt;span style="color:#669900"&gt;&gt;&lt;/span&gt; echo HongWan
&lt;span style="color:#669900"&gt;"HongWan"&lt;/span&gt;
redis &lt;span style="color:#98c379"&gt;127.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.1&lt;/span&gt;:&lt;span style="color:#98c379"&gt;6379&lt;/span&gt;&lt;span style="color:#669900"&gt;&gt;&lt;/span&gt;
&lt;/code&gt;&lt;/span&gt;</code></pre> 
<ul style="margin-left:0px;"><li>1</li><li>2</li><li>3</li></ul> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;"><strong>select</strong><br> 选择数据库。Redis 数据库编号从0~15，我们可以选择任意一个数据库来进行数据的存取。</span></p> 
<pre class="has" style="margin-left:0px;"><code class="language-prettyprint">&lt;span style="color:#000000"&gt;&lt;code class="language-sql"&gt;redis &lt;span style="color:#98c379"&gt;127.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.1&lt;/span&gt;:&lt;span style="color:#98c379"&gt;6379&lt;/span&gt;&lt;span style="color:#669900"&gt;&gt;&lt;/span&gt; &lt;span style="color:#c678dd"&gt;select&lt;/span&gt; &lt;span style="color:#98c379"&gt;1&lt;/span&gt;
OK
redis &lt;span style="color:#98c379"&gt;127.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.1&lt;/span&gt;:&lt;span style="color:#98c379"&gt;6379&lt;/span&gt;&lt;span style="color:#999999"&gt;[&lt;/span&gt;&lt;span style="color:#98c379"&gt;1&lt;/span&gt;&lt;span style="color:#999999"&gt;]&lt;/span&gt;&lt;span style="color:#669900"&gt;&gt;&lt;/span&gt; &lt;span style="color:#c678dd"&gt;select&lt;/span&gt; &lt;span style="color:#98c379"&gt;16&lt;/span&gt;
&lt;span style="color:#999999"&gt;(&lt;/span&gt;error&lt;span style="color:#999999"&gt;)&lt;/span&gt; ERR invalid DB &lt;span style="color:#c678dd"&gt;index&lt;/span&gt;
redis &lt;span style="color:#98c379"&gt;127.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.1&lt;/span&gt;:&lt;span style="color:#98c379"&gt;6379&lt;/span&gt;&lt;span style="color:#999999"&gt;[&lt;/span&gt;&lt;span style="color:#98c379"&gt;16&lt;/span&gt;&lt;span style="color:#999999"&gt;]&lt;/span&gt;&lt;span style="color:#669900"&gt;&gt;&lt;/span&gt;
&lt;/code&gt;&lt;/span&gt;</code></pre> 
<ul style="margin-left:0px;"><li>1</li><li>2</li><li>3</li><li>4</li><li>5</li></ul> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">当选择16 时，报错，说明没有编号为16 的这个数据库</span></p> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;"><strong>quit</strong><br> 退出连接。</span></p> 
<pre class="has" style="margin-left:0px;"><code class="language-prettyprint">&lt;span style="color:#000000"&gt;&lt;code class="language-sql"&gt;redis &lt;span style="color:#98c379"&gt;127.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.1&lt;/span&gt;:&lt;span style="color:#98c379"&gt;6379&lt;/span&gt;&lt;span style="color:#669900"&gt;&gt;&lt;/span&gt; quit
&lt;/code&gt;&lt;/span&gt;</code></pre> 
<ul style="margin-left:0px;"><li>1</li></ul> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;"><strong>dbsize</strong><br> 返回当前数据库中key 的数目。</span></p> 
<pre class="has" style="margin-left:0px;"><code class="language-prettyprint">&lt;span style="color:#000000"&gt;&lt;code class="language-sql"&gt;redis &lt;span style="color:#98c379"&gt;127.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.1&lt;/span&gt;:&lt;span style="color:#98c379"&gt;6379&lt;/span&gt;&lt;span style="color:#669900"&gt;&gt;&lt;/span&gt; dbsize
&lt;span style="color:#999999"&gt;(&lt;/span&gt;&lt;span style="color:#c678dd"&gt;integer&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt; &lt;span style="color:#98c379"&gt;18&lt;/span&gt;
redis &lt;span style="color:#98c379"&gt;127.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.1&lt;/span&gt;:&lt;span style="color:#98c379"&gt;6379&lt;/span&gt;&lt;span style="color:#669900"&gt;&gt;&lt;/span&gt;
&lt;/code&gt;&lt;/span&gt;</code></pre> 
<ul style="margin-left:0px;"><li>1</li><li>2</li><li>3</li></ul> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">结果说明此库中有18 个key<br><strong>info</strong><br> 获取服务器的信息和统计。</span></p> 
<pre class="has" style="margin-left:0px;"><code class="language-prettyprint">&lt;span style="color:#000000"&gt;&lt;code class="language-sql"&gt;redis &lt;span style="color:#98c379"&gt;127.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.1&lt;/span&gt;:&lt;span style="color:#98c379"&gt;6379&lt;/span&gt;&lt;span style="color:#669900"&gt;&gt;&lt;/span&gt; info
redis_version:&lt;span style="color:#98c379"&gt;2.2&lt;/span&gt;&lt;span style="color:#98c379"&gt;.12&lt;/span&gt;
redis_git_sha1:&lt;span style="color:#98c379"&gt;00000000&lt;/span&gt;
redis_git_dirty:&lt;span style="color:#98c379"&gt;0&lt;/span&gt;
arch_bits:&lt;span style="color:#98c379"&gt;32&lt;/span&gt;
multiplexing_api:epoll
process_id:&lt;span style="color:#98c379"&gt;28480&lt;/span&gt;
uptime_in_seconds:&lt;span style="color:#98c379"&gt;2515&lt;/span&gt;
uptime_in_days:&lt;span style="color:#98c379"&gt;0&lt;/span&gt;
。。。。
。。。。
&lt;/code&gt;&lt;/span&gt;</code></pre> 
<ul style="margin-left:0px;"><li>1</li><li>2</li><li>3</li><li>4</li><li>5</li><li>6</li><li>7</li><li>8</li><li>9</li><li>10</li><li>11</li></ul> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;"><strong>flushdb</strong><br> 删除当前选择数据库中的所有key。</span></p> 
<pre class="has" style="margin-left:0px;"><code class="language-prettyprint">&lt;span style="color:#000000"&gt;&lt;code class="language-sql"&gt;redis &lt;span style="color:#98c379"&gt;127.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.1&lt;/span&gt;:&lt;span style="color:#98c379"&gt;6379&lt;/span&gt;&lt;span style="color:#669900"&gt;&gt;&lt;/span&gt; dbsize
&lt;span style="color:#999999"&gt;(&lt;/span&gt;&lt;span style="color:#c678dd"&gt;integer&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt; &lt;span style="color:#98c379"&gt;18&lt;/span&gt;
redis &lt;span style="color:#98c379"&gt;127.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.1&lt;/span&gt;:&lt;span style="color:#98c379"&gt;6379&lt;/span&gt;&lt;span style="color:#669900"&gt;&gt;&lt;/span&gt; flushdb
OK
redis &lt;span style="color:#98c379"&gt;127.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.1&lt;/span&gt;:&lt;span style="color:#98c379"&gt;6379&lt;/span&gt;&lt;span style="color:#669900"&gt;&gt;&lt;/span&gt; dbsize
&lt;span style="color:#999999"&gt;(&lt;/span&gt;&lt;span style="color:#c678dd"&gt;integer&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt; &lt;span style="color:#98c379"&gt;0&lt;/span&gt;
redis &lt;span style="color:#98c379"&gt;127.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.1&lt;/span&gt;:&lt;span style="color:#98c379"&gt;6379&lt;/span&gt;&lt;span style="color:#669900"&gt;&gt;&lt;/span&gt;
&lt;/code&gt;&lt;/span&gt;</code></pre> 
<ul style="margin-left:0px;"><li>1</li><li>2</li><li>3</li><li>4</li><li>5</li><li>6</li><li>7</li></ul> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">在本例中我们将0 号数据库中的key 都清除了。</span></p> 
<pre class="has" style="margin-left:0px;"><code class="language-prettyprint">&lt;span style="color:#000000"&gt;&lt;code class="language-sql"&gt;flushall
&lt;/code&gt;&lt;/span&gt;</code></pre> 
<ul style="margin-left:0px;"><li>1</li></ul> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">删除所有数据库中的所有key。</span></p> 
<pre class="has" style="margin-left:0px;"><code class="language-prettyprint">&lt;span style="color:#000000"&gt;&lt;code class="language-sql"&gt;redis &lt;span style="color:#98c379"&gt;127.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.1&lt;/span&gt;:&lt;span style="color:#98c379"&gt;6379&lt;/span&gt;&lt;span style="color:#999999"&gt;[&lt;/span&gt;&lt;span style="color:#98c379"&gt;1&lt;/span&gt;&lt;span style="color:#999999"&gt;]&lt;/span&gt;&lt;span style="color:#669900"&gt;&gt;&lt;/span&gt; dbsize
&lt;span style="color:#999999"&gt;(&lt;/span&gt;&lt;span style="color:#c678dd"&gt;integer&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt; &lt;span style="color:#98c379"&gt;1&lt;/span&gt;
redis &lt;span style="color:#98c379"&gt;127.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.1&lt;/span&gt;:&lt;span style="color:#98c379"&gt;6379&lt;/span&gt;&lt;span style="color:#999999"&gt;[&lt;/span&gt;&lt;span style="color:#98c379"&gt;1&lt;/span&gt;&lt;span style="color:#999999"&gt;]&lt;/span&gt;&lt;span style="color:#669900"&gt;&gt;&lt;/span&gt; &lt;span style="color:#c678dd"&gt;select&lt;/span&gt; &lt;span style="color:#98c379"&gt;0&lt;/span&gt;
OK
redis &lt;span style="color:#98c379"&gt;127.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.1&lt;/span&gt;:&lt;span style="color:#98c379"&gt;6379&lt;/span&gt;&lt;span style="color:#669900"&gt;&gt;&lt;/span&gt; flushall
OK
redis &lt;span style="color:#98c379"&gt;127.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.1&lt;/span&gt;:&lt;span style="color:#98c379"&gt;6379&lt;/span&gt;&lt;span style="color:#669900"&gt;&gt;&lt;/span&gt; &lt;span style="color:#c678dd"&gt;select&lt;/span&gt; &lt;span style="color:#98c379"&gt;1&lt;/span&gt;
OK
redis &lt;span style="color:#98c379"&gt;127.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.1&lt;/span&gt;:&lt;span style="color:#98c379"&gt;6379&lt;/span&gt;&lt;span style="color:#999999"&gt;[&lt;/span&gt;&lt;span style="color:#98c379"&gt;1&lt;/span&gt;&lt;span style="color:#999999"&gt;]&lt;/span&gt;&lt;span style="color:#669900"&gt;&gt;&lt;/span&gt; dbsize
&lt;span style="color:#999999"&gt;(&lt;/span&gt;&lt;span style="color:#c678dd"&gt;integer&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt; &lt;span style="color:#98c379"&gt;0&lt;/span&gt;
redis &lt;span style="color:#98c379"&gt;127.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.0&lt;/span&gt;&lt;span style="color:#98c379"&gt;.1&lt;/span&gt;:&lt;span style="color:#98c379"&gt;6379&lt;/span&gt;&lt;span style="color:#999999"&gt;[&lt;/span&gt;&lt;span style="color:#98c379"&gt;1&lt;/span&gt;&lt;span style="color:#999999"&gt;]&lt;/span&gt;&lt;span style="color:#669900"&gt;&gt;&lt;/span&gt;
&lt;/code&gt;&lt;/span&gt;</code></pre> 
<ul style="margin-left:0px;"><li>1</li><li>2</li><li>3</li><li>4</li><li>5</li><li>6</li><li>7</li><li>8</li><li>9</li><li>10</li><li>11</li></ul> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">在本例中我们先查看了一个1 号数据库中有一个key，然后我切换到0 号库执行flushall 命令，结果1 号库中的key 也被清除了，说是此命令工作正常。</span></p> 
<h2 style="margin-left:0px;"><strong><span style="color:#4f4f4f;"><a name="t35"></a><a id="_1404"></a>十一、持久化</span></strong></h2> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">Redis的高性能是由于其将所有数据都存储在了内存中，为了使Redis在重启之后仍能保证数据不丢失，需要将数据从内存中同步到硬盘中，这一过程就是持久化。<br> Redis支持两种方式的持久化，一种是RDB方式，一种是AOF方式。可以单独使用其中一种或将二者结合使用。</span></p> 
<h3 style="margin-left:0px;"><strong><span style="color:#4f4f4f;"><a name="t36"></a><a id="111RDB_1408"></a>11.1、RDB持久化</span></strong></h3> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">RDB方式的持久化是通过快照（snapshotting）完成的，当符合一定条件时Redis会自动将内存中的数据进行快照并持久化到硬盘。<br> RDB是Redis默认采用的持久化方式，在redis.conf配置文件中默认有此下配置：</span></p> 
<pre class="has" style="margin-left:0px;"><code class="language-prettyprint">&lt;span style="color:#000000"&gt;&lt;code class="language-sql"&gt;&lt;span style="color:#c678dd"&gt;save&lt;/span&gt; &lt;span style="color:#98c379"&gt;900&lt;/span&gt; &lt;span style="color:#98c379"&gt;1&lt;/span&gt;
&lt;span style="color:#c678dd"&gt;save&lt;/span&gt; &lt;span style="color:#98c379"&gt;300&lt;/span&gt; &lt;span style="color:#98c379"&gt;10&lt;/span&gt;
&lt;span style="color:#c678dd"&gt;save&lt;/span&gt; &lt;span style="color:#98c379"&gt;60&lt;/span&gt; &lt;span style="color:#98c379"&gt;10000&lt;/span&gt;
&lt;/code&gt;&lt;/span&gt;</code></pre> 
<ul style="margin-left:0px;"><li>1</li><li>2</li><li>3</li></ul> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">save 开头的一行就是持久化配置，可以配置多个条件（每行配置一个条件），每个条件之间是“或”的关系，“save 900 1”表示15分钟（900秒钟）内至少1个键被更改则进行快照，“save 300 10”表示5分钟（300秒）内至少10个键被更改则进行快照。</span></p> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">在redis.conf中：<br> 配置dir指定rdb快照文件的位置<br> 配置dbfilenam指定rdb快照文件的名称</span></p> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">Redis启动后会读取RDB快照文件，将数据从硬盘载入到内存。根据数据量大小与结构和服务器性能不同，这个时间也不同。通常将记录一千万个字符串类型键、大小为1GB的快照文件载入到内存中需要花费20～30秒钟。</span></p> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">问题总结：<br> 通过RDB方式实现持久化，一旦Redis异常退出，就会丢失最后一次快照以后更改的所有数据。这就需要开发者根据具体的应用场合，通过组合设置自动快照条件的方式来将可能发生的数据损失控制在能够接受的范围。如果数据很重要以至于无法承受任何损失，则可以考虑使用AOF方式进行持久化。</span></p> 
<h3 style="margin-left:0px;"><strong><span style="color:#4f4f4f;"><a name="t37"></a><a id="112AOF_1430"></a>11.2、AOF持久化</span></strong></h3> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">默认情况下Redis没有开启AOF（append only file）方式的持久化，可以通过appendonly参数开启：</span></p> 
<pre class="has" style="margin-left:0px;"><code class="language-prettyprint">&lt;span style="color:#000000"&gt;&lt;code class="language-sql"&gt;appendonly yes
&lt;/code&gt;&lt;/span&gt;</code></pre> 
<ul style="margin-left:0px;"><li>1</li></ul> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">开启AOF持久化后每执行一条会更改Redis中的数据的命令，Redis就会将该命令写入硬盘中的AOF文件。AOF文件的保存位置和RDB文件的位置相同，都是通过dir参数设置的，默认的文件名是appendonly.aof，可以通过appendfilename参数修改：appendfilename appendonly.aof</span></p> 
<h2 style="margin-left:0px;"><strong><span style="color:#4f4f4f;"><a name="t38"></a><a id="_1439"></a>十二、主从复制</span></strong></h2> 
<h3 style="margin-left:0px;"><strong><span style="color:#4f4f4f;"><a name="t39"></a><a id="121__1440"></a>12.1 什么是主从复制</span></strong></h3> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">持久化保证了即使redis服务重启也会丢失数据，因为redis服务重启后会将硬盘上持久化的数据恢复到内存中，但是当redis服务器的硬盘损坏了可能会导致数据丢失，如果通过redis的主从复制机制就可以避免这种单点故障，如下图：<br><img alt="在这里插入图片描述" src="https://images2.imgbox.com/d6/5c/Qe93rjSB_o.png"><br> 说明：</span></p> 
<ul style="margin-left:0px;"><li>主redis中的数据有两个副本（replication）即从redis1和从redis2，即使一台redis服务器宕机其它两台redis服务也可以继续提供服务。</li><li>主redis中的数据和从redis上的数据保持实时同步，当主redis写入数据时通过主从复制机制会复制到两个从redis服务上。</li><li>只有一个主redis，可以有多个从redis。</li><li>主从复制不会阻塞master，在同步数据时，master 可以继续处理client 请求</li><li>一个redis可以即是主又是从，如下图：<br><img alt="在这里插入图片描述" src="https://images2.imgbox.com/7a/a1/6cMUhSRb_o.png"></li></ul> 
<h3 style="margin-left:0px;"><strong><span style="color:#4f4f4f;"><a name="t40"></a><a id="122__1451"></a>12.2 主从配置</span></strong></h3> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;"><strong>主redis配置</strong><br> 无需特殊配置。</span></p> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;"><strong>从redis配置</strong><br> 修改从redis服务器上的redis.conf文件，添加slaveof 主redisip 主redis端口<br><img alt="在这里插入图片描述" src="https://images2.imgbox.com/bc/3c/UoRVfTCN_o.png"><br> 上边的配置说明当前该从redis服务器所对应的主redis是192.168.101.3，端口是6379</span></p> 
<h3 style="margin-left:0px;"><strong><span style="color:#4f4f4f;"><a name="t41"></a><a id="123__1460"></a>12.3 主从复制过程</span></strong></h3> 
<h4 style="margin-left:0px;"><strong><span style="color:#4f4f4f;"><a name="t42"></a><a id="1231_1461"></a>12.3.1、完整复制</span></strong></h4> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">在redis2.8版本之前主从复制过程如下图：<br><img alt="在这里插入图片描述" src="https://images2.imgbox.com/53/72/FSew9OUA_o.png"><br> 复制过程说明：</span></p> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">1、slave 服务启动，slave 会建立和master 的连接，发送sync 命令。<br> 2、master启动一个后台进程将数据库快照保存到RDB文件中<br> 注意：此时如果生成RDB文件过程中存在写数据操作会导致RDB文件和当前主redis数据不一致，所以此时master 主进程会开始收集写命令并缓存起来。<br> 3、master 就发送RDB文件给slave<br> 4、slave 将文件保存到磁盘上，然后加载到内存恢复<br> 5、master把缓存的命令转发给slave<br> 注意：后续master 收到的写命令都会通过开始建立的连接发送给slave。<br> 当master 和slave 的连接断开时slave 可以自动重新建立连接。如果master 同时收到多个slave 发来的同步连接命令，只会启动一个进程来写数据库镜像，然后发送给所有slave。</span></p> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">完整复制的问题：</span></p> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">在redis2.8之前从redis每次同步都会从主redis中复制全部的数据，如果从redis是新创建的从主redis中复制全部的数据这是没有问题的，但是，如果当从redis停止运行，再启动时可能只有少部分数据和主redis不同步，此时启动redis仍然会从主redis复制全部数据，这样的性能肯定没有只复制那一小部分不同步的数据高。</span></p> 
<h4 style="margin-left:0px;"><strong><span style="color:#4f4f4f;"><a name="t43"></a><a id="1232_1479"></a>12.3.2、部分复制</span></strong></h4> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;"><img alt="在这里插入图片描述" src="https://images2.imgbox.com/31/0b/p4r5YYP8_o.png"><br> 部分复制说明：<br> 从机连接主机后，会主动发起 PSYNC 命令，从机会提供 master的runid(机器标识，随机生成的一个串) 和 offset（数据偏移量，如果offset主从不一致则说明数据不同步），主机验证 runid 和 offset 是否有效， runid 相当于主机身份验证码，用来验证从机上一次连接的主机，如果runid验证未通过则，则进行全同步，如果验证通过则说明曾经同步过，根据offset同步部分数据。</span></p> 
<h2 style="margin-left:0px;"><strong><span style="color:#4f4f4f;"><a name="t44"></a><a id="_Redis_1484"></a>十三 Redis事物</span></strong></h2> 
<h3 style="margin-left:0px;"><strong><span style="color:#4f4f4f;"><a name="t45"></a><a id="131__1486"></a>13.1 介绍</span></strong></h3> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">Redis事务是一个单独的隔离操作：事务中的所有命令都会序列化、按顺序地执行。事务在执行的过程中，不会被其他客户端发送来的命令请求所打断，Redis事务的主要作用就是串联多个命令防止别的命令插队。</span></p> 
<h3 style="margin-left:0px;"><strong><span style="color:#4f4f4f;"><a name="t46"></a><a id="132_MultiExecdiscard_1492"></a>13.2 Multi、Exec、discard</span></strong></h3> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">从输入Multi命令开始，输入的命令都会依次进入命令队列中，但不会执行，直到输入Exec后，Redis会将之前的命令队列中的命令依次执行。组队的过程中可以通过discard命令来放弃组队。</span></p> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;"><img alt="在这里插入图片描述" src="https://images2.imgbox.com/f4/a7/BG36XuSQ_o.png"></span></p> 
<h3 style="margin-left:0px;"><strong><span style="color:#4f4f4f;"><a name="t47"></a><a id="133___1499"></a>13.3 事务的错误处理</span></strong></h3> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;"><span style="color:#FF0000;">组队中</span>某个命令出现了报告错误，执行时整个的所有队列会都会被取消。</span></p> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;"><img alt="在这里插入图片描述" src="https://images2.imgbox.com/74/2e/odvN9fYB_o.png"></span></p> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;"><span style="color:#FF0000;">执行阶段</span>某个命令报出了错误，则只有报错的命令不会被执行，而其他的命令都会执行，不会回滚。</span></p> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;"><img alt="在这里插入图片描述" src="https://images2.imgbox.com/73/bf/pX1XzZuT_o.png"></span></p> 
<h3 style="margin-left:0px;"><strong><span style="color:#4f4f4f;"><a name="t48"></a><a id="134___1509"></a>13.4 为什么要做成事务</span></strong></h3> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">场景：</span></p> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">你的账户里有10000块钱，有三人有你的账户,同时去参加双十一抢购：</span></p> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">一个请求想给金额减8000</span></p> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">一个请求想给金额减5000</span></p> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">一个请求想给金额减1000<br><img alt="在这里插入图片描述" src="https://images2.imgbox.com/5b/70/IuGELl7C_o.png"></span></p> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;"><strong>Redis事物锁</strong></span></p> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">悲观锁</span></p> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">顾名思义，就是很悲观，每次去拿数据的时候都认为别人会修改，所以每次在拿数据的时候都会上锁，这样别人想拿这个数据就会block直到它拿到锁。<strong>传统的关系型数据库里边就用到了很多这种锁机制</strong>，比如行锁，表锁等，读锁，写锁等，都是在做操作之前先上锁。</span></p> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;"><img alt="在这里插入图片描述" src="https://images2.imgbox.com/a8/5b/yp0ASqkk_o.png"></span></p> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">乐观锁</span></p> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">顾名思义，就是很乐观，每次去拿数据的时候都认为别人不会修改，所以不会上锁，但是在更新的时候会判断一下在此期间别人有没有去更新这个数据，可以使用版本号等机制。<strong>乐观锁适用于多读的应用类型，这样可以提高吞吐量</strong>。Redis就是利用这种check-and-set机制实现事务的。</span></p> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">有了版本控制，每次执行操作的时候，都先查询版本，版本不连续的话，再去查redis里的数据和版本，查完之后，版本连续的话再继续做下一步的"增删更新"等操作；</span></p> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;"><img alt="在这里插入图片描述" src="https://images2.imgbox.com/9d/b8/aND8TnWz_o.png"></span></p> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">即关系型数据库一般采用的是悲观锁，而非关系型数据库使用的是乐观锁</span></p> 
<h3 style="margin-left:0px;"><strong><span style="color:#4f4f4f;"><a name="t49"></a><a id="135_redis_1544"></a>13.5 redis事物的具体实现</span></strong></h3> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;"><strong>语法</strong></span></p> 
<pre class="has" style="margin-left:0px;"><code class="language-prettyprint">&lt;span style="color:#000000"&gt;&lt;code class="language-shell"&gt;WATCH key &lt;span style="color:#999999"&gt;[&lt;/span&gt;key &lt;span style="color:#999999"&gt;..&lt;/span&gt;.&lt;span style="color:#999999"&gt;]&lt;/span&gt;
&lt;/code&gt;&lt;/span&gt;</code></pre> 
<ul style="margin-left:0px;"><li>1</li></ul> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">在执行multi之前，先执行watch key1 [key2],可以监视一个(或多个) key ，如果在事务执行之前这个(或这些) key 被其他命令所改动，那么事务将被打断。</span></p> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;"><img alt="在这里插入图片描述" src="https://images2.imgbox.com/53/2c/zjwtRaia_o.png"></span></p> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;"><strong>取消锁</strong></span></p> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">unwatch命令</span></p> 
<ul style="margin-left:0px;"><li> <p style="margin-left:0px;"><span style="color:#4d4d4d;">取消 <strong>WATCH</strong> 命令对所有 key 的监视。</span></p> </li><li> <p style="margin-left:0px;"><span style="color:#4d4d4d;">如果在执行 <strong>WATCH</strong>命令之后， <strong>EXEC</strong>命令或 <strong>DISCARD</strong>命令先被执行了的话，那么就不需要再执行 <strong>UNWATCH</strong>了。</span></p> </li></ul> 
<h3 style="margin-left:0px;"><strong><span style="color:#4f4f4f;"><a name="t50"></a><a id="136_redis_1564"></a>13.6 redis事物三个特性</span></strong></h3> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;"><strong>单独的隔离操作</strong></span></p> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">事务中的所有命令都会序列化、按顺序地执行。事务在执行的过程中，不会被其他客户端发送来的命令请求所打断。</span></p> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;"><strong>没有隔离级别的概念</strong></span></p> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">队列中的命令没有提交之前都不会实际的被执行，因为事务提交前任何指令都不会被实际执行，也就不存在“事务内的查询要看到事务里的更新，在事务外查询不能看到”这个让人万分头痛的问题 。</span></p> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;"><strong>不保证原子性</strong></span></p> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">Redis同一个事务中如果有一条命令执行失败，其后的命令仍然会被执行，没有回滚 。</span></p> 
<h2 style="margin-left:0px;"><strong><span style="color:#4f4f4f;"><a name="t51"></a><a id="__1580"></a>十四 主从复制的搭建</span></strong></h2> 
<h3 style="margin-left:0px;"><strong><span style="color:#4f4f4f;"><a name="t52"></a><a id="141__1582"></a>14.1 什么是主从复制</span></strong></h3> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;"><strong>介绍</strong></span></p> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">主从复制，就是主机数据更新后根据配置和策略，自动同步到备机的master/slaver机制，Master以写为主，Slave以读为主，一个主机可以有多个从机，一个从机只能有一个主机；</span></p> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;"><img alt="在这里插入图片描述" src="https://images2.imgbox.com/72/eb/YBqjWQ8j_o.png"></span></p> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;"><strong>优势</strong></span></p> 
<ul style="margin-left:0px;"><li> <p style="margin-left:0px;"><span style="color:#4d4d4d;">读写分离，性能扩展</span></p> </li><li> <p style="margin-left:0px;"><span style="color:#4d4d4d;">容灾快速恢复</span></p> </li></ul> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;"><img alt="在这里插入图片描述" src="https://images2.imgbox.com/cc/2a/Hus1oO8O_o.png"></span></p> 
<h3 style="margin-left:0px;"><strong><span style="color:#4f4f4f;"><a name="t53"></a><a id="142__1598"></a>14.2 配置主从复制</span></strong></h3> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">配置从机即可，不需要配置主机（下边的才操作都是在从机里进行的配置，主机不用动）</span></p> 
<ol style="margin-left:0px;"><li>拷贝多个redis.conf文件include（include指的是包含redis.conf里之前的配置）</li></ol> 
<pre class="has" style="margin-left:0px;"><code class="language-prettyprint">&lt;span style="color:#000000"&gt;&lt;code class="language-shell"&gt;&lt;span style="color:#5c6370"&gt;# 新建redis6379.conf文件&lt;/span&gt;
vim redis6379.conf
&lt;/code&gt;&lt;/span&gt;</code></pre> 
<ul style="margin-left:0px;"><li>1</li><li>2</li></ul> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">在新建的文件里写入如下内容</span></p> 
<pre class="has" style="margin-left:0px;"><code class="language-prettyprint">&lt;span style="color:#000000"&gt;&lt;code class="language-shell"&gt;&lt;span style="color:#5c6370"&gt;# 包含之前的配置信息:redis.conf&lt;/span&gt;
include /root/myredis/redis.conf
&lt;/code&gt;&lt;/span&gt;</code></pre> 
<ul style="margin-left:0px;"><li>1</li><li>2</li></ul> 
<ol style="margin-left:0px;"><li>开启daemonize yes</li></ol> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">开启守护进程（后台运行），如果include后的redis.conf文件里已经开启了，则新建的redis6379.conf文件里就不用再开启了；</span></p> 
<ol style="margin-left:0px;"><li>Pid文件名字pidfile</li></ol> 
<pre class="has" style="margin-left:0px;"><code class="language-prettyprint">&lt;span style="color:#000000"&gt;&lt;code class="language-shell"&gt;&lt;span style="color:#5c6370"&gt;# 从redis.conf里复制即可&lt;/span&gt;
pidfile /var/run/redis_6379.pid
&lt;/code&gt;&lt;/span&gt;</code></pre> 
<ul style="margin-left:0px;"><li>1</li><li>2</li></ul> 
<ol style="margin-left:0px;"><li>指定端口port</li></ol> 
<pre class="has" style="margin-left:0px;"><code class="language-prettyprint">&lt;span style="color:#000000"&gt;&lt;code class="language-shell"&gt;port 6379
&lt;/code&gt;&lt;/span&gt;</code></pre> 
<ul style="margin-left:0px;"><li>1</li></ul> 
<ol style="margin-left:0px;"><li>Log文件名字</li></ol> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">​ 主机里配置过了的话，这里就不用再配置了</span></p> 
<ol style="margin-left:0px;"><li> <p style="margin-left:0px;"><span style="color:#4d4d4d;">Dump.rdb名字改为自己的名字</span></p> <pre class="has" style="margin-left:0px;"><code class="language-prettyprint">&lt;span style="color:#000000"&gt;&lt;code&gt;dbfilename  dump6379.rdb
&lt;/code&gt;&lt;/span&gt;</code></pre> 
  <ul style="margin-left:0px;"><li>1</li></ul></li><li> <p style="margin-left:0px;"><span style="color:#4d4d4d;">Appendonly 关掉或者换名字</span></p> <p style="margin-left:0px;"><span style="color:#4d4d4d;">主机里配置过了的话，这里就不用再配置了</span></p> </li></ol> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">配置完成后的redis6379.conf文件如下：</span></p> 
<pre class="has" style="margin-left:0px;"><code class="language-prettyprint">&lt;span style="color:#000000"&gt;&lt;code class="language-shell"&gt;include /root/myredis/redis.conf
pidfile /var/run/redis_6379.pid
port 6379
dbfilename  dump6379.rdb
&lt;/code&gt;&lt;/span&gt;</code></pre> 
<ul style="margin-left:0px;"><li>1</li><li>2</li><li>3</li><li>4</li></ul> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">然后在多台从机里配置上边的文件（记得改端口号）</span></p> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;"><strong>打印主从复制的相关信息</strong></span></p> 
<pre class="has" style="margin-left:0px;"><code class="language-prettyprint">&lt;span style="color:#000000"&gt;&lt;code class="language-shell"&gt;&lt;span style="color:#5c6370"&gt;# 启动redis，进入客户端后(redis-cli -p 6379)执行如下命令，查看当前机器是主还是从&lt;/span&gt;
info replication
&lt;/code&gt;&lt;/span&gt;</code></pre> 
<ul style="margin-left:0px;"><li>1</li><li>2</li></ul> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;"><img alt="在这里插入图片描述" src="https://images2.imgbox.com/ca/dc/yoyKusgB_o.png"></span></p> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;"><strong>配置当前从机的主机信息</strong></span></p> 
<pre class="has" style="margin-left:0px;"><code class="language-prettyprint">&lt;span style="color:#000000"&gt;&lt;code&gt;# 配置主机的地址端口信息
slaveof  ip  port
&lt;/code&gt;&lt;/span&gt;</code></pre> 
<ul style="margin-left:0px;"><li>1</li><li>2</li></ul> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;"><img alt="在这里插入图片描述" src="https://images2.imgbox.com/67/cc/AwhPkb7W_o.png"></span></p> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">此时，主机里写入信息后，从机就可以查到了，从机只能获取信息，不可以写入信息；</span></p> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;"><strong>主机宕机</strong></span></p> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">这种情况下，一旦主机宕机的话，就没有可以写入信息的redis机器了（从机不可以自动上位为主机），从机执行info replication命令，也可以查看主机状态：</span></p> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;"><img alt="在这里插入图片描述" src="https://images2.imgbox.com/03/ef/TYVMk6X3_o.png"></span></p> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">此时，主机恢复正常以后：</span></p> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;"><img alt="在这里插入图片描述" src="https://images2.imgbox.com/c1/d6/76RiHjLW_o.png"></span></p> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">主机恢复后，从机依然可以获取到主机宕机前的数据；</span></p> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;"><strong>从机宕机</strong></span></p> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">从机宕机，再恢复后，还得重新找一下主机，即需要重新执行slaveof ip port命令来找主机；</span></p> 
<h3 style="margin-left:0px;"><strong><span style="color:#4f4f4f;"><a name="t54"></a><a id="143__1694"></a>14.3 主从复制总结</span></strong></h3> 
<ol style="margin-left:0px;"><li> <p style="margin-left:0px;"><span style="color:#4d4d4d;">切入点问题：slave1、slave2是从头开始复制还是从切入点开始复制?比如从k4进来，那之前的123是否也可以复制</span></p> <p style="margin-left:0px;"><span style="color:#4d4d4d;">从头开始复制,不是从切入点开始；</span></p> </li><li> <p style="margin-left:0px;"><span style="color:#4d4d4d;">从机是否可以写？set可否？</span></p> </li></ol> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">​ 不可以</span></p> 
<ol style="margin-left:0px;"><li>主机shutdown后情况如何？从机是上位还是原地待命</li></ol> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">​ 原地待命</span></p> 
<ol style="margin-left:0px;"><li>主机又回来了后，主机新增记录，从机还能否顺利复制？</li></ol> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">​ 可以顺利复制</span></p> 
<ol style="margin-left:0px;"><li>其中一台从机down后重启后情况如何？依照原有它能跟上大部队吗？</li></ol> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">​ 不可以跟上大部队，只能重新找主机，然后再复制主机里的信息；</span></p> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;"><strong>复制原理</strong></span></p> 
<ol style="margin-left:0px;"><li> <p style="margin-left:0px;"><span style="color:#4d4d4d;">每次从机联通后，都会给主机发送sync指令</span></p> </li><li> <p style="margin-left:0px;"><span style="color:#4d4d4d;">主机立刻进行存盘操作，发送RDB文件，给从机</span></p> </li><li> <p style="margin-left:0px;"><span style="color:#4d4d4d;">从机收到RDB文件后，进行全盘加载</span></p> </li><li> <p style="margin-left:0px;"><span style="color:#4d4d4d;">之后每次主机的写操作，都会立刻发送给从机，从机执行相同的命令</span></p> </li></ol> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;"><img alt="在这里插入图片描述" src="https://images2.imgbox.com/f6/a3/aMi4sWY9_o.png"></span></p> 
<h3 style="margin-left:0px;"><strong><span style="color:#4f4f4f;"><a name="t55"></a><a id="144__1728"></a>14.4 哨兵模式</span></strong></h3> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">假如主机宕机，哨兵检测到后，根据投票数自动将从机转换为主机</span></p> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;"><img alt="在这里插入图片描述" src="https://images2.imgbox.com/e9/15/iMll9ZiZ_o.png"></span></p> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;"><strong>配置哨兵</strong></span></p> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">自定义的/myredis目录下新建sentinel.conf文件，在配置文件中填写内容：</span></p> 
<pre class="has" style="margin-left:0px;"><code class="language-prettyprint">&lt;span style="color:#000000"&gt;&lt;code class="language-shell"&gt;&lt;span style="color:#5c6370"&gt;#127.0.0.1 6379指的是当前主机的信息（还没宕机的主机）   1指的是主机宕机的话，至少有一台机器同意，则将从机变为主机&lt;/span&gt;
sentinel monitor mymaster 127.0.0.1 6379 1
&lt;/code&gt;&lt;/span&gt;</code></pre> 
<ul style="margin-left:0px;"><li>1</li><li>2</li></ul> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;"><strong>配置从机变成为主机的优先级</strong></span></p> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">在从机配置文件redis_6381.conf里进行配置</span></p> 
<pre class="has" style="margin-left:0px;"><code class="language-prettyprint">&lt;span style="color:#000000"&gt;&lt;code class="language-shell"&gt;&lt;span style="color:#5c6370"&gt;# 主机宕机后，当前从机成为主机的优先级，值越小，优先级越高&lt;/span&gt;
slave-priority  10
&lt;/code&gt;&lt;/span&gt;</code></pre> 
<ul style="margin-left:0px;"><li>1</li><li>2</li></ul> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;"><strong>启动哨兵</strong></span></p> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">执行redis-sentinel /myredis/sentinel.conf</span></p> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">此时，主机宕机的话，会根据优先级将从机自动生成新主机，并且其他从机立刻自动将新主机作为主机</span></p> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;"><strong>选择新主机的条件</strong></span></p> 
<ol style="margin-left:0px;"><li> <p style="margin-left:0px;"><span style="color:#4d4d4d;">选择优先级靠前的：优先级配置在redis.conf中slave-priority 100</span></p> </li><li> <p style="margin-left:0px;"><span style="color:#4d4d4d;">选择偏移量最大的：偏移量是指获得原主数据最多的</span></p> </li><li> <p style="margin-left:0px;"><span style="color:#4d4d4d;">选择runid最小的从服务：每个redis实例启动后都会随机生成一个40位的runid</span></p> </li></ol> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">挑选出新的主服务之后，sentinel 向原主服务的从服务发送 slaveof 新主服务 的命令，复制新master；</span></p> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">当已下线的服务重新上线时，sentinel会向其发送slaveof命令，让其成为新主的从；</span></p> 
<h2 style="margin-left:0px;"><strong><span style="color:#4f4f4f;"><a name="t56"></a><a id="_redis_1770"></a>十五 redis集群</span></strong></h2> 
<h3 style="margin-left:0px;"><strong><span style="color:#4f4f4f;"><a name="t57"></a><a id="151_redis_1772"></a>15.1 redis集群介绍</span></strong></h3> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;"><strong>问题</strong></span></p> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">容量不够，redis如何进行扩容？</span></p> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">并发写操作， redis如何分摊？</span></p> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;"><strong>分布式与集群</strong></span></p> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">如果一个项目里有多个信息：用户信息、订单信息、商品信息</span></p> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">分布式：</span></p> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">将用户信息、订单信息、商品信息分别存储在三台机器上（每台机器放不一样的内容）</span></p> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">集群：</span></p> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">将每一个信息平均分成三份，再将三份信息分别放在三台机器里</span></p> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;"><strong>什么是redis集群</strong></span></p> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">Redis 集群实现了对Redis的水平扩容，即启动N个redis节点，将整个数据库分布存储在这N个节点中，每个节点存储总数据的1/N。</span></p> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">Redis 集群通过分区（partition）来提供一定程度的可用性（availability）： 即使集群中有一部分节点失效或者无法进行通讯， 集群也可以继续处理命令请求。</span></p> 
<h3 style="margin-left:0px;"><strong><span style="color:#4f4f4f;"><a name="t58"></a><a id="152_redis_1798"></a>15.2 搭建redis集群</span></strong></h3> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;"><strong>安装ruby环境</strong></span></p> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">注意：安装ruby之前，要把前边配置的rdb文件删除，不然会有很多问题出现</span></p> 
<pre class="has" style="margin-left:0px;"><code class="language-prettyprint">&lt;span style="color:#000000"&gt;&lt;code class="language-shell"&gt;yum &lt;span style="color:#61aeee"&gt;install&lt;/span&gt; ruby&lt;span style="color:#999999"&gt;;&lt;/span&gt;
yum &lt;span style="color:#61aeee"&gt;install&lt;/span&gt; rubygems&lt;span style="color:#999999"&gt;;&lt;/span&gt;
&lt;/code&gt;&lt;/span&gt;</code></pre> 
<ul style="margin-left:0px;"><li>1</li><li>2</li></ul> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;"><strong>下载redis-3.2.0.gem</strong></span></p> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">打开一遍的网址：https://rubygems.org/gems/redis/versions/</span></p> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;"><img alt="在这里插入图片描述" src="https://images2.imgbox.com/ab/38/JgJMrXES_o.png"></span></p> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">进入3.2.0版本后，点击右下角的下载即可</span></p> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;"><img alt="在这里插入图片描述" src="https://images2.imgbox.com/72/5a/ECc2zM2A_o.png"></span></p> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;"><strong>安装redis-3.2.0.gem</strong></span></p> 
<pre class="has" style="margin-left:0px;"><code class="language-prettyprint">&lt;span style="color:#000000"&gt;&lt;code class="language-shell"&gt;&lt;span style="color:#5c6370"&gt;# 将上边下载下来的文件复制到/opt目录，然后执行下边的命令进行安装&lt;/span&gt;
gem &lt;span style="color:#61aeee"&gt;install&lt;/span&gt; --local redis-3.2.0.gem
&lt;/code&gt;&lt;/span&gt;</code></pre> 
<ul style="margin-left:0px;"><li>1</li><li>2</li></ul> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;"><strong>制作六个redis实例（用来模拟集群）</strong></span></p> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">端口分别是6379、6380、6381、6389、6390、6391，其中6389是6379的从机，8390是6380的从机，6391是6381的从机，然后参考14.2章节进行配置</span></p> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;"><strong>安装redis cluster配置修改</strong></span></p> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">vim redis6379.conf</span></p> 
<pre class="has" style="margin-left:0px;"><code class="language-prettyprint">&lt;span style="color:#000000"&gt;&lt;code&gt;# 在配置文件里打开集群模式
cluster-enabled yes  
# 设定节点配置文件名
cluster-config-file  nodes-6379.conf  
# 设定节点失联时间，超过该时间（毫秒），集群自动进行主从切换。
cluster-node-timeout 15000  
&lt;/code&gt;&lt;/span&gt;</code></pre> 
<ul style="margin-left:0px;"><li>1</li><li>2</li><li>3</li><li>4</li><li>5</li><li>6</li></ul> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">然后将redis6379.conf文件复制六份即可（内容记得做相应的修改，6379的地方都改为自己的端口号）</span></p> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;"><strong>将六个节点合成一个集群</strong></span></p> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">组合之前，请确保所有redis实例启动后，nodes-xxxx.conf文件都生成正常（即所有实例启动后，会生成各自对应的nodes-xxxx.conf文件）。</span></p> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;"><img alt="在这里插入图片描述" src="https://images2.imgbox.com/51/0b/JjLHefjA_o.png"></span></p> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">进入到redis解压后的目录的src里</span></p> 
<pre class="has" style="margin-left:0px;"><code class="language-prettyprint">&lt;span style="color:#000000"&gt;&lt;code&gt;cd /opt/redis-3.2.5/src
&lt;/code&gt;&lt;/span&gt;</code></pre> 
<ul style="margin-left:0px;"><li>1</li></ul> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">执行如下命令</span></p> 
<pre class="has" style="margin-left:0px;"><code class="language-prettyprint">&lt;span style="color:#000000"&gt;&lt;code&gt;# 切记：此处使用真实ip，不可以使用127.0.0.1
./redis-trib.rb create --replicas 1 192.168.1.100:6379 192.168.1.100:6380 192.168.1.100:6381 192.168.1.100:6389 192.168.1.100:6390 192.168.1.100:6391
&lt;/code&gt;&lt;/span&gt;</code></pre> 
<ul style="margin-left:0px;"><li>1</li><li>2</li></ul> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;"><img alt="在这里插入图片描述" src="https://images2.imgbox.com/6a/78/JC8nKEUl_o.png"></span></p> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">输入yes后：</span></p> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;"><img alt="在这里插入图片描述" src="https://images2.imgbox.com/a4/ee/5foEhbrR_o.png"></span></p> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;"><img alt="在这里插入图片描述" src="https://images2.imgbox.com/36/e8/6gsxAoe0_o.png"></span></p> 
<h3 style="margin-left:0px;"><strong><span style="color:#4f4f4f;"><a name="t59"></a><a id="153__1872"></a>15.3 查看集群信息</span></strong></h3> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">进入6379机器</span></p> 
<pre class="has" style="margin-left:0px;"><code class="language-prettyprint">&lt;span style="color:#000000"&gt;&lt;code class="language-shell"&gt;redis-cli -p 6379
&lt;/code&gt;&lt;/span&gt;</code></pre> 
<ul style="margin-left:0px;"><li>1</li></ul> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">执行如下命令查看集群信息</span></p> 
<pre class="has" style="margin-left:0px;"><code class="language-prettyprint">&lt;span style="color:#000000"&gt;&lt;code&gt;cluster nodes
&lt;/code&gt;&lt;/span&gt;</code></pre> 
<ul style="margin-left:0px;"><li>1</li></ul> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;"><img alt="在这里插入图片描述" src="https://images2.imgbox.com/0e/0d/B0sixSau_o.png"></span></p> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">此时，在6379上写入数据，会有如下提示</span></p> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;"><img alt="在这里插入图片描述" src="https://images2.imgbox.com/28/43/KKUXkPBP_o.png"></span></p> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">MOVED 12706 192.168.1.100:6381</span></p> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">提示需要移动到6381机器上进行操作,这是因为redis一共16384个插槽，通过计算我们要插入的key的hash值（上边的截图可以看出来，计算后的key的hash值是12706），会将对应的值插入相应的插槽里</span></p> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;"><img alt="在这里插入图片描述" src="https://images2.imgbox.com/c5/22/Drsr7vsb_o.png"></span></p> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">我们登陆的是6379机器，遇到上边的情况，本来会自动将数据插入到6381机器里，但是因为我们进入redis的方式不对，所以会出现MOVED 12706 192.168.1.100:6381提示</span></p> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">正确进入6379(集群)的方式：</span></p> 
<pre class="has" style="margin-left:0px;"><code class="language-prettyprint">&lt;span style="color:#000000"&gt;&lt;code class="language-shell"&gt;&lt;span style="color:#5c6370"&gt;# -c：自动重定向    -p：端口&lt;/span&gt;
redis-cli -c -p 6379
&lt;/code&gt;&lt;/span&gt;</code></pre> 
<ul style="margin-left:0px;"><li>1</li><li>2</li></ul> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;"><img alt="在这里插入图片描述" src="https://images2.imgbox.com/97/dd/3rJdP8eB_o.png"></span></p> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">可以看到，自动切换到6381机器了；</span></p> 
<h3 style="margin-left:0px;"><strong><span style="color:#4f4f4f;"><a name="t60"></a><a id="154_redis_cluster__1911"></a>15.4 redis cluster 如何分配这六个节点</span></strong></h3> 
<ul style="margin-left:0px;"><li> <p style="margin-left:0px;"><span style="color:#4d4d4d;">一个集群至少要有<strong>三个主节点</strong></span></p> </li><li> <p style="margin-left:0px;"><span style="color:#4d4d4d;">选项 --replicas 1 表示我们希望为集群中的每个主节点创建一个从节点。</span></p> </li><li> <p style="margin-left:0px;"><span style="color:#4d4d4d;">分配原则尽量保证每个主数据库运行在不同的IP地址，每个从库和主库不在一个IP地址上。</span></p> </li></ul> 
<h3 style="margin-left:0px;"><strong><span style="color:#4f4f4f;"><a name="t61"></a><a id="155_slots_1919"></a>15.5 slots插槽</span></strong></h3> 
<ul style="margin-left:0px;"><li> <p style="margin-left:0px;"><span style="color:#4d4d4d;">一个 Redis 集群包含 16384 个插槽（hash slot）， 数据库中的每个键都属于这 16384 个插槽的其中一个， 集群使用公式 CRC16(key) % 16384 来计算键 key 属于哪个槽， 其中 CRC16(key) 语句用于计算键 key 的 CRC16 校验和 。</span></p> </li><li> <p style="margin-left:0px;"><span style="color:#4d4d4d;">集群中的每个节点负责处理一部分插槽。 举个例子， 如果一个集群可以有主节点， 其中：</span></p> </li></ul> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">​ 节点 A 负责处理 0 号至 5500 号插槽。</span></p> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">​ 节点 B 负责处理 5501 号至 11000 号插槽。</span></p> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">​ 节点 C 负责处理 11001 号至 16383 号插槽。</span></p> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;"><strong>在集群中录入值</strong></span></p> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">在redis-cli每次录入、查询键值，redis都会计算出该key应该送往的插槽，如果不是该客户端对应服务器的插槽，redis会报错，并告知应前往的redis实例地址和端口。</span></p> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">redis-cli客户端提供了 –c 参数实现自动重定向。如 redis-cli -c –p 6379 登入后，再录入、查询键值对可以自动重定向。</span></p> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">不在一个slot下的键值，是不能使用mget,mset等多键操作。</span></p> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">可以通过{}来定义组的概念，从而使key中{}内相同内容的键值对放到一个slot中去。</span></p> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;"><strong>查询集群中的值</strong></span></p> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">CLUSTER KEYSLOT 计算键 key 应该被放置在哪个槽上。</span></p> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">CLUSTER COUNTKEYSINSLOT 返回槽 slot 目前包含的键值对数量。</span></p> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">CLUSTER GETKEYSINSLOT 返回 count 个 slot 槽中的键。</span></p> 
<h3 style="margin-left:0px;"><strong><span style="color:#4f4f4f;"><a name="t62"></a><a id="156__1949"></a>15.6 故障恢复</span></strong></h3> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">•如果主节点下线？从节点能否自动升为主节点？</span></p> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">•主节点恢复后，主从关系会如何？</span></p> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">•如果所有某一段插槽的主从节点都宕掉，redis服务是否还能继续?</span></p> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">•redis.conf中的参数 cluster-require-full-coverage</span></p> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;">配置故障恢复参数</span></p> 
<pre class="has" style="margin-left:0px;"><code class="language-prettyprint">&lt;span style="color:#000000"&gt;&lt;code class="language-shell"&gt;&lt;span style="color:#5c6370"&gt;# redis.conf中的参数 &lt;/span&gt;
cluster-require-full-coverage 
&lt;/code&gt;&lt;/span&gt;</code></pre> 
<ul style="margin-left:0px;"><li>1</li><li>2</li></ul> 
<h3 style="margin-left:0px;"><strong><span style="color:#4f4f4f;"><a name="t63"></a><a id="157_Jedis_1968"></a>15.7 集群的Jedis开发</span></strong></h3> 
<pre class="has" style="margin-left:0px;"><code class="language-prettyprint">&lt;span style="color:#000000"&gt;&lt;code class="language-java"&gt;&lt;span style="color:#c678dd"&gt;public&lt;/span&gt; &lt;span style="color:#c678dd"&gt;class&lt;/span&gt; JedisClusterTest &lt;span style="color:#999999"&gt;{&lt;/span&gt;



&lt;span style="color:#c678dd"&gt;public&lt;/span&gt; &lt;span style="color:#c678dd"&gt;static&lt;/span&gt; &lt;span style="color:#c678dd"&gt;void&lt;/span&gt; &lt;span style="color:#61aeee"&gt;main&lt;/span&gt;&lt;span style="color:#999999"&gt;(&lt;/span&gt;String&lt;span style="color:#999999"&gt;[&lt;/span&gt;&lt;span style="color:#999999"&gt;]&lt;/span&gt; args &lt;span style="color:#999999"&gt;)&lt;/span&gt; &lt;span style="color:#999999"&gt;{&lt;/span&gt;

   Set&lt;span style="color:#61aeee"&gt;&lt;span style="color:#999999"&gt;&lt;&lt;/span&gt;HostAndPort&lt;span style="color:#999999"&gt;&gt;&lt;/span&gt;&lt;/span&gt; set &lt;span style="color:#669900"&gt;=&lt;/span&gt;&lt;span style="color:#c678dd"&gt;new&lt;/span&gt; HashSet&lt;span style="color:#61aeee"&gt;&lt;span style="color:#999999"&gt;&lt;&lt;/span&gt;HostAndPort&lt;span style="color:#999999"&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="color:#999999"&gt;(&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt;&lt;span style="color:#999999"&gt;;&lt;/span&gt;

   set&lt;span style="color:#999999"&gt;.&lt;/span&gt;&lt;span style="color:#61aeee"&gt;add&lt;/span&gt;&lt;span style="color:#999999"&gt;(&lt;/span&gt;&lt;span style="color:#c678dd"&gt;new&lt;/span&gt; HostAndPort&lt;span style="color:#999999"&gt;(&lt;/span&gt;&lt;span style="color:#669900"&gt;"192.168.1.100"&lt;/span&gt;&lt;span style="color:#999999"&gt;,&lt;/span&gt;&lt;span style="color:#98c379"&gt;6379&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt;&lt;span style="color:#999999"&gt;;&lt;/span&gt;
   set&lt;span style="color:#999999"&gt;.&lt;/span&gt;&lt;span style="color:#61aeee"&gt;add&lt;/span&gt;&lt;span style="color:#999999"&gt;(&lt;/span&gt;&lt;span style="color:#c678dd"&gt;new&lt;/span&gt; HostAndPort&lt;span style="color:#999999"&gt;(&lt;/span&gt;&lt;span style="color:#669900"&gt;"192.168.1.100"&lt;/span&gt;&lt;span style="color:#999999"&gt;,&lt;/span&gt;&lt;span style="color:#98c379"&gt;6380&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt;&lt;span style="color:#999999"&gt;;&lt;/span&gt;
   set&lt;span style="color:#999999"&gt;.&lt;/span&gt;&lt;span style="color:#61aeee"&gt;add&lt;/span&gt;&lt;span style="color:#999999"&gt;(&lt;/span&gt;&lt;span style="color:#c678dd"&gt;new&lt;/span&gt; HostAndPort&lt;span style="color:#999999"&gt;(&lt;/span&gt;&lt;span style="color:#669900"&gt;"192.168.1.100"&lt;/span&gt;&lt;span style="color:#999999"&gt;,&lt;/span&gt;&lt;span style="color:#98c379"&gt;6381&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt;&lt;span style="color:#999999"&gt;;&lt;/span&gt;
   set&lt;span style="color:#999999"&gt;.&lt;/span&gt;&lt;span style="color:#61aeee"&gt;add&lt;/span&gt;&lt;span style="color:#999999"&gt;(&lt;/span&gt;&lt;span style="color:#c678dd"&gt;new&lt;/span&gt; HostAndPort&lt;span style="color:#999999"&gt;(&lt;/span&gt;&lt;span style="color:#669900"&gt;"192.168.1.100"&lt;/span&gt;&lt;span style="color:#999999"&gt;,&lt;/span&gt;&lt;span style="color:#98c379"&gt;6389&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt;&lt;span style="color:#999999"&gt;;&lt;/span&gt;
   set&lt;span style="color:#999999"&gt;.&lt;/span&gt;&lt;span style="color:#61aeee"&gt;add&lt;/span&gt;&lt;span style="color:#999999"&gt;(&lt;/span&gt;&lt;span style="color:#c678dd"&gt;new&lt;/span&gt; HostAndPort&lt;span style="color:#999999"&gt;(&lt;/span&gt;&lt;span style="color:#669900"&gt;"192.168.1.100"&lt;/span&gt;&lt;span style="color:#999999"&gt;,&lt;/span&gt;&lt;span style="color:#98c379"&gt;6390&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt;&lt;span style="color:#999999"&gt;;&lt;/span&gt;
   set&lt;span style="color:#999999"&gt;.&lt;/span&gt;&lt;span style="color:#61aeee"&gt;add&lt;/span&gt;&lt;span style="color:#999999"&gt;(&lt;/span&gt;&lt;span style="color:#c678dd"&gt;new&lt;/span&gt; HostAndPort&lt;span style="color:#999999"&gt;(&lt;/span&gt;&lt;span style="color:#669900"&gt;"192.168.1.100"&lt;/span&gt;&lt;span style="color:#999999"&gt;,&lt;/span&gt;&lt;span style="color:#98c379"&gt;6391&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt;&lt;span style="color:#999999"&gt;;&lt;/span&gt;
   &lt;span style="color:#5c6370"&gt;//注意：这里new的是集群JedisCluster&lt;/span&gt;
   JedisCluster jedisCluster&lt;span style="color:#669900"&gt;=&lt;/span&gt;&lt;span style="color:#c678dd"&gt;new&lt;/span&gt; JedisCluster&lt;span style="color:#999999"&gt;(&lt;/span&gt;set&lt;span style="color:#999999"&gt;)&lt;/span&gt;&lt;span style="color:#999999"&gt;;&lt;/span&gt;

   jedisCluster&lt;span style="color:#999999"&gt;.&lt;/span&gt;&lt;span style="color:#61aeee"&gt;set&lt;/span&gt;&lt;span style="color:#999999"&gt;(&lt;/span&gt;&lt;span style="color:#669900"&gt;"k1"&lt;/span&gt;&lt;span style="color:#999999"&gt;,&lt;/span&gt; &lt;span style="color:#669900"&gt;"v1"&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt;&lt;span style="color:#999999"&gt;;&lt;/span&gt;
   System&lt;span style="color:#999999"&gt;.&lt;/span&gt;out&lt;span style="color:#999999"&gt;.&lt;/span&gt;&lt;span style="color:#61aeee"&gt;println&lt;/span&gt;&lt;span style="color:#999999"&gt;(&lt;/span&gt;jedisCluster&lt;span style="color:#999999"&gt;.&lt;/span&gt;&lt;span style="color:#61aeee"&gt;get&lt;/span&gt;&lt;span style="color:#999999"&gt;(&lt;/span&gt;&lt;span style="color:#669900"&gt;"k1"&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt;&lt;span style="color:#999999"&gt;)&lt;/span&gt;&lt;span style="color:#999999"&gt;;&lt;/span&gt;
 &lt;span style="color:#999999"&gt;}&lt;/span&gt;
&lt;span style="color:#999999"&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/span&gt;</code></pre> 
<div style="margin-left:8px;">
    
</div> 
<ul style="margin-left:0px;"><li>1</li><li>2</li><li>3</li><li>4</li><li>5</li><li>6</li><li>7</li><li>8</li><li>9</li><li>10</li><li>11</li><li>12</li><li>13</li><li>14</li><li>15</li><li>16</li><li>17</li><li>18</li><li>19</li><li>20</li><li>21</li></ul> 
<h3 style="margin-left:0px;"><strong><span style="color:#4f4f4f;"><a name="t64"></a><a id="158__1994"></a>15.8 总结</span></strong></h3> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;"><strong>集群优势</strong></span></p> 
<ul style="margin-left:0px;"><li> <p style="margin-left:0px;"><span style="color:#4d4d4d;">实现扩容</span></p> </li><li> <p style="margin-left:0px;"><span style="color:#4d4d4d;">分摊压力</span></p> </li><li> <p style="margin-left:0px;"><span style="color:#4d4d4d;">无中心配置相对简单</span></p> </li></ul> 
<p style="margin-left:0px;"><span style="color:#4d4d4d;"><strong>集群不足</strong></span></p> 
<ul style="margin-left:0px;"><li> <p style="margin-left:0px;"><span style="color:#4d4d4d;">多键操作是不被支持的</span></p> </li><li> <p style="margin-left:0px;"><span style="color:#4d4d4d;">多键的Redis事务是不被支持的。lua脚本不被支持。</span></p> </li><li> <p style="margin-left:0px;"><span style="color:#4d4d4d;">由于集群方案出现较晚，很多公司已经采用了其他的集群方案，而代理或者客户端分片的方案想要迁移至redis cluster，需要整体迁移而不是逐步过渡，复杂度较大。</span></p> </li></ul>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/087c1825479e62169ceccd8cd4553938/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">windows下格式化内存卡</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/2a13df9ad28b51bd912d3851bb596762/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">java比对文字重复_Java编程实现比对两个文本文件并标记相同与不同之处的方法...</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 追风少年的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>