<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>遗传算法的Python实现（非线性函数优化问题为例） - 追风少年的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="遗传算法的Python实现（非线性函数优化问题为例）" />
<meta property="og:description" content="1、遗传算法（GA）介绍 遗传算法（Genetic Algorithm，GA）最早是由美国的 John holland于20世纪70年代提出,该算法是根据大自然中生物体进化规律而设计提出的，是一种通过模拟自然进化过程搜索最优解的方法。
该算法通过数学的方式,利用计算机仿真运算,将问题的求解过程转换成类似生物进化中的染色体基因的交叉、变异等过程。在求解较为复杂的组合优化问题时,相对一些常规的优化算法,通常能够较快地获得较好的优化结果。遗传算法已被人们广泛地应用于组合优化、机器学习、信号处理、自适应控制和人工生命等领域。
（一）遗传算法流程： （二）基本操作： （1）编码
用于将要解答的问题编码成染色体信息，便于后续运算编码方式： 位串编码（二进制/Gray编码，存在搜索效率低的问题）实数编码（较为常用） （2）适应度函数的尺度变换
欺骗问题：函数值之间的差异太小，导致过早收敛解决方案：尺度变换 线性变换（f’ = af &#43; b）幂函数变换（f’ = f ^ k）指数变换（f’ = e ^ (-af)） （3）选择
根据适应度进行染色体串的选择，适应度越高的染色体串被选上的概率越大（不是一定选上，可以解决牛顿下降法容易收敛到局部最优的缺点）个体选择的概率分配方法 适应度比例（蒙特卡洛法）：个体适应度 / 总体适应度之和排序法：分为线性排序和指数排序，后者可以扩大排名在前和在后的个体间的差距 （4）交叉
对两条染色体进行交叉操作基本的交叉算子 一点交叉：选择一个位点，将两条染色体在该位点后的片段进行交叉两点/多点交叉：选择多个位点，将位点间的片段进行交叉部分匹配交叉：用于旅行商问题等 （5）变异
对染色体的某个基因进行变异变异方式 位点变异：某个/每个位点以一定概率变异逆转变异：随机选两点，将两点间的基因逆序插入变异：随机选一个基因插入随机的插入点间互换变异：随机选两个基因进行简单互换移动变异：将某个基因向左/右移动随机位数 2、Python实现（非线性函数最优化问题为例） （1）定义适应度函数
import math def func(x, y): num = 6.452 * (x &#43; 0.125 * y) * (math.cos(x) - math.cos(2 * y)) ** 2 den = math.sqrt(0.8 &#43; (x - 4.2) ** 2 &#43; 2 * (y - 7) ** 2) return num / den &#43; 3." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://zhuifengsn.github.io/posts/2f63f0b928de74ee598354ee347e8525/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-08-30T17:43:27+08:00" />
<meta property="article:modified_time" content="2020-08-30T17:43:27+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="追风少年的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">追风少年的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">遗传算法的Python实现（非线性函数优化问题为例）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h3><a id="1GA_0"></a>1、遗传算法（GA）介绍</h3> 
<p><strong>遗传算法</strong>（Genetic Algorithm，<strong>GA</strong>）最早是由美国的 John holland于20世纪70年代提出,该算法是根据大自然中生物体进化规律而设计提出的，是一种通过<strong>模拟自然进化过程搜索最优解</strong>的方法。</p> 
<p>该算法通过数学的方式,利用计算机仿真运算,将问题的求解过程<strong>转换</strong>成类似生物进化中的染色体基因的<strong>交叉、变异</strong>等过程。在求解较为<strong>复杂的组合优化问题</strong>时,相对一些常规的优化算法,通常能够<strong>较快地获得较好的优化结果</strong>。遗传算法已被人们广泛地应用于组合优化、机器学习、信号处理、自适应控制和人工生命等领域。</p> 
<h5><a id="_5"></a>（一）遗传算法流程：</h5> 
<p><img src="https://images2.imgbox.com/97/13/MhsbVRkx_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="_9"></a>（二）基本操作：</h5> 
<p><strong>（1）编码</strong></p> 
<ul><li>用于将要解答的问题编码成染色体信息，便于后续运算</li><li>编码方式： 
  <ul><li>位串编码（二进制/Gray编码，存在搜索效率低的问题）</li><li>实数编码（较为常用）</li></ul> </li></ul> 
<p><strong>（2）适应度函数的尺度变换</strong></p> 
<ul><li>欺骗问题：函数值之间的差异太小，导致过早收敛</li><li>解决方案：尺度变换 
  <ul><li>线性变换（f’ = af + b）</li><li>幂函数变换（f’ = f ^ k）</li><li>指数变换（f’ = e ^ (-af)）</li></ul> </li></ul> 
<p><strong>（3）选择</strong></p> 
<ul><li>根据适应度进行染色体串的选择，适应度越高的染色体串被选上的概率越大（不是一定选上，可以解决牛顿下降法容易收敛到局部最优的缺点）</li><li>个体选择的概率分配方法 
  <ul><li>适应度比例（蒙特卡洛法）：个体适应度 / 总体适应度之和</li><li>排序法：分为线性排序和指数排序，后者可以扩大排名在前和在后的个体间的差距</li></ul> </li></ul> 
<p><strong>（4）交叉</strong></p> 
<ul><li>对两条染色体进行交叉操作</li><li>基本的交叉算子 
  <ul><li>一点交叉：选择一个位点，将两条染色体在该位点后的片段进行交叉</li><li>两点/多点交叉：选择多个位点，将位点间的片段进行交叉</li><li>部分匹配交叉：用于旅行商问题等</li></ul> </li></ul> 
<p><strong>（5）变异</strong></p> 
<ul><li>对染色体的某个基因进行变异</li><li>变异方式 
  <ul><li>位点变异：某个/每个位点以一定概率变异</li><li>逆转变异：随机选两点，将两点间的基因逆序</li><li>插入变异：随机选一个基因插入随机的插入点间</li><li>互换变异：随机选两个基因进行简单互换</li><li>移动变异：将某个基因向左/右移动随机位数</li></ul> </li></ul> 
<h3><a id="2Python_51"></a>2、Python实现（非线性函数最优化问题为例）</h3> 
<p><strong>（1）定义适应度函数</strong></p> 
<p><img src="https://images2.imgbox.com/a5/33/lkblx5T5_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> math

<span class="token keyword">def</span> <span class="token function">func</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">:</span>
    num <span class="token operator">=</span> <span class="token number">6.452</span> <span class="token operator">*</span> <span class="token punctuation">(</span>x <span class="token operator">+</span> <span class="token number">0.125</span> <span class="token operator">*</span> y<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>math<span class="token punctuation">.</span>cos<span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token operator">-</span> math<span class="token punctuation">.</span>cos<span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> y<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">**</span> <span class="token number">2</span>
    den <span class="token operator">=</span> math<span class="token punctuation">.</span>sqrt<span class="token punctuation">(</span><span class="token number">0.8</span> <span class="token operator">+</span> <span class="token punctuation">(</span>x <span class="token operator">-</span> <span class="token number">4.2</span><span class="token punctuation">)</span> <span class="token operator">**</span> <span class="token number">2</span> <span class="token operator">+</span> <span class="token number">2</span> <span class="token operator">*</span> <span class="token punctuation">(</span>y <span class="token operator">-</span> <span class="token number">7</span><span class="token punctuation">)</span> <span class="token operator">**</span> <span class="token number">2</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> num <span class="token operator">/</span> den <span class="token operator">+</span> <span class="token number">3.226</span> <span class="token operator">*</span> y
</code></pre> 
<p><strong>（2）初始化GeneticAlgorith类</strong></p> 
<pre><code class="prism language-python"><span class="token keyword">class</span> <span class="token class-name">GeneticAlgorithm</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> function<span class="token punctuation">,</span> M<span class="token punctuation">,</span> gen<span class="token punctuation">,</span> Pc<span class="token operator">=</span><span class="token number">0.85</span><span class="token punctuation">,</span> Pm<span class="token operator">=</span><span class="token number">0.05</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""
        :param function: fitness function
        :param M: population
        :param gen: total generations
        :param Pc: probability of crossover
        :param Pm: probability of mutation
        """</span>
        self<span class="token punctuation">.</span>func <span class="token operator">=</span> function
        self<span class="token punctuation">.</span>Pc <span class="token operator">=</span> Pc
        self<span class="token punctuation">.</span>Pm <span class="token operator">=</span> Pm
        self<span class="token punctuation">.</span>M <span class="token operator">=</span> M
        self<span class="token punctuation">.</span>gen <span class="token operator">=</span> gen
        self<span class="token punctuation">.</span>dec_num <span class="token operator">=</span> <span class="token number">3</span>
        self<span class="token punctuation">.</span>X <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        self<span class="token punctuation">.</span>Y <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        self<span class="token punctuation">.</span><span class="token builtin">chr</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        self<span class="token punctuation">.</span>f <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        self<span class="token punctuation">.</span>rank <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        self<span class="token punctuation">.</span>history <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
            <span class="token string">'f'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token string">'x'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token string">'y'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
</code></pre> 
<p><strong>（3）编码函数</strong></p> 
<p>定义编码方式：x, y =&gt; chromosome</p> 
<ul><li>例：x=3.124, y=5.637, 则chromosome=“31245637”</li></ul> 
<pre><code class="prism language-python">    <span class="token keyword">def</span> <span class="token function">num2str</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> num<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># return str(int(num)) + str(int(num - int(num)) * 1e3)</span>
        s <span class="token operator">=</span> <span class="token builtin">str</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span>
        s <span class="token operator">+=</span> <span class="token string">'0'</span> <span class="token operator">*</span> <span class="token builtin">abs</span><span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span> <span class="token operator">//</span> <span class="token number">10</span> <span class="token operator">+</span> <span class="token number">1</span> <span class="token operator">+</span> self<span class="token punctuation">.</span>dec_num <span class="token operator">-</span> <span class="token builtin">len</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> s

    <span class="token keyword">def</span> <span class="token function">encoder</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">:</span>
        chr_list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token builtin">chr</span> <span class="token operator">=</span> self<span class="token punctuation">.</span>num2str<span class="token punctuation">(</span>x<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">+</span> self<span class="token punctuation">.</span>num2str<span class="token punctuation">(</span>y<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
            chr_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token builtin">chr</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> chr_list
</code></pre> 
<p>于此同时，定义编码方式所对应的解码方式：chromosome =&gt; x, y</p> 
<pre><code class="prism language-python">    <span class="token keyword">def</span> <span class="token function">str2num</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> s<span class="token punctuation">)</span><span class="token punctuation">:</span>
        num <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>s<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token operator">-</span>self<span class="token punctuation">.</span>dec_num<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token builtin">float</span><span class="token punctuation">(</span>s<span class="token punctuation">[</span><span class="token operator">-</span>self<span class="token punctuation">.</span>dec_num<span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">10</span> <span class="token operator">**</span> self<span class="token punctuation">.</span>dec_num
        <span class="token keyword">return</span> <span class="token builtin">round</span><span class="token punctuation">(</span>num<span class="token punctuation">,</span> self<span class="token punctuation">.</span>dec_num<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">decoder</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token builtin">chr</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        cut <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span><span class="token builtin">chr</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span>
        x <span class="token operator">=</span> <span class="token punctuation">[</span>self<span class="token punctuation">.</span>str2num<span class="token punctuation">(</span><span class="token builtin">chr</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">:</span>cut<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span><span class="token builtin">chr</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
        y <span class="token operator">=</span> <span class="token punctuation">[</span>self<span class="token punctuation">.</span>str2num<span class="token punctuation">(</span><span class="token builtin">chr</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>cut<span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span><span class="token builtin">chr</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
        <span class="token keyword">return</span> x<span class="token punctuation">,</span> y
</code></pre> 
<p><strong>（4）选择后代染色体</strong></p> 
<p>这里以适应度比例作为选择方式，通过轮盘赌的方法随机选择M次，得到M个新后代（适应度比例越大，轮盘赌中随机数落在该扇区的概率就越大，被选中的概率就越高）</p> 
<pre><code class="prism language-python">	<span class="token keyword">from</span> random <span class="token keyword">import</span> random

    <span class="token keyword">def</span> <span class="token function">choose</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># calculate percentage</span>
        s <span class="token operator">=</span> <span class="token builtin">sum</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>f<span class="token punctuation">)</span>
        p <span class="token operator">=</span> <span class="token punctuation">[</span>self<span class="token punctuation">.</span>f<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">/</span> s <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>M<span class="token punctuation">)</span><span class="token punctuation">]</span>
        chosen <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token comment"># choose M times</span>
        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>M<span class="token punctuation">)</span><span class="token punctuation">:</span>
            cum <span class="token operator">=</span> <span class="token number">0</span>
            m <span class="token operator">=</span> random<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token comment"># Roulette</span>
            <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>M<span class="token punctuation">)</span><span class="token punctuation">:</span>
                cum <span class="token operator">+=</span> p<span class="token punctuation">[</span>j<span class="token punctuation">]</span>
                <span class="token keyword">if</span> cum <span class="token operator">&gt;=</span> m<span class="token punctuation">:</span>
                    chosen<span class="token punctuation">.</span>append<span class="token punctuation">(</span>self<span class="token punctuation">.</span><span class="token builtin">chr</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span>
                    <span class="token keyword">break</span>
        <span class="token keyword">return</span> chosen
</code></pre> 
<p><strong>（5）交叉</strong></p> 
<p>使用一点交叉作为交叉算子，对每两条染色体以Pc的概率进行交叉</p> 
<pre><code class="prism language-python">	<span class="token keyword">from</span> random <span class="token keyword">import</span> randint

    <span class="token keyword">def</span> <span class="token function">crossover</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token builtin">chr</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        crossed <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token comment"># if chr list is odd</span>
        <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span><span class="token builtin">chr</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">2</span><span class="token punctuation">:</span>
            crossed<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token builtin">chr</span><span class="token punctuation">.</span>pop<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span><span class="token builtin">chr</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            a <span class="token operator">=</span> <span class="token builtin">chr</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span>
            b <span class="token operator">=</span> <span class="token builtin">chr</span><span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span>
            <span class="token comment"># 0.85 probability of crossover</span>
            <span class="token keyword">if</span> random<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> self<span class="token punctuation">.</span>Pc<span class="token punctuation">:</span>
                loc <span class="token operator">=</span> randint<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span><span class="token builtin">chr</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>
                temp <span class="token operator">=</span> a<span class="token punctuation">[</span>loc<span class="token punctuation">:</span><span class="token punctuation">]</span>
                a <span class="token operator">=</span> a<span class="token punctuation">[</span><span class="token punctuation">:</span>loc<span class="token punctuation">]</span> <span class="token operator">+</span> b<span class="token punctuation">[</span>loc<span class="token punctuation">:</span><span class="token punctuation">]</span>
                b <span class="token operator">=</span> b<span class="token punctuation">[</span><span class="token punctuation">:</span>loc<span class="token punctuation">]</span> <span class="token operator">+</span> temp
            <span class="token comment"># add to crossed</span>
            crossed<span class="token punctuation">.</span>append<span class="token punctuation">(</span>a<span class="token punctuation">)</span>
            crossed<span class="token punctuation">.</span>append<span class="token punctuation">(</span>b<span class="token punctuation">)</span>
        <span class="token keyword">return</span> crossed
</code></pre> 
<p><strong>（6）变异</strong></p> 
<p>用位点变异的方法，对某条染色体的每一位基因以概率Pm进行变异，并确保变异后与变异前的基因不同</p> 
<pre><code class="prism language-python">    <span class="token keyword">def</span> <span class="token function">mutation</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token builtin">chr</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        res <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">chr</span><span class="token punctuation">:</span>
            l <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
            <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>l<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token comment"># 0.05 probability of mutation on each location</span>
                <span class="token keyword">if</span> random<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> self<span class="token punctuation">.</span>Pm<span class="token punctuation">:</span>
                    <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
                        r <span class="token operator">=</span> <span class="token builtin">str</span><span class="token punctuation">(</span>randint<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                        <span class="token keyword">if</span> r <span class="token operator">!=</span> l<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">:</span>
                            l<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> r
                            <span class="token keyword">break</span>
            res<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>l<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> res
</code></pre> 
<p><strong>（7）主函数</strong></p> 
<p>先对染色体种群进行初始化并编码，然后开始迭代进化：</p> 
<ul><li>对每一代染色体计算相应的适应度值和排名，打印信息</li><li>保存到history，便于后续绘制折线图</li><li>进行染色体的选串复制、交叉与变异</li><li>对染色体解码，完成一次迭代</li></ul> 
<pre><code class="prism language-python">    <span class="token keyword">from</span> random <span class="token keyword">import</span> uniform
    
    <span class="token keyword">def</span> <span class="token function">run</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># initialization</span>
        x <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        y <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>M<span class="token punctuation">)</span><span class="token punctuation">:</span>
            x<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token builtin">round</span><span class="token punctuation">(</span>uniform<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>dec_num<span class="token punctuation">)</span><span class="token punctuation">)</span>
            y<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token builtin">round</span><span class="token punctuation">(</span>uniform<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>dec_num<span class="token punctuation">)</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>X <span class="token operator">=</span> x
        self<span class="token punctuation">.</span>Y <span class="token operator">=</span> y
        self<span class="token punctuation">.</span><span class="token builtin">chr</span> <span class="token operator">=</span> self<span class="token punctuation">.</span>encoder<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span>
        <span class="token comment"># iteration</span>
        <span class="token keyword">for</span> <span class="token builtin">iter</span> <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>gen<span class="token punctuation">)</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>f <span class="token operator">=</span> <span class="token punctuation">[</span>func<span class="token punctuation">(</span>self<span class="token punctuation">.</span>X<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>Y<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>M<span class="token punctuation">)</span><span class="token punctuation">]</span>
            fitness_sort <span class="token operator">=</span> <span class="token builtin">sorted</span><span class="token punctuation">(</span><span class="token builtin">enumerate</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>f<span class="token punctuation">)</span><span class="token punctuation">,</span> key<span class="token operator">=</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> x<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> reverse<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
            <span class="token comment"># 1st : fitness[rank[0]]</span>
            self<span class="token punctuation">.</span>rank <span class="token operator">=</span> <span class="token punctuation">[</span>i<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> fitness_sort<span class="token punctuation">]</span>
            winner <span class="token operator">=</span> self<span class="token punctuation">.</span>f<span class="token punctuation">[</span>self<span class="token punctuation">.</span>rank<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token string">'Iter={iter + 1}, Max-Fitness={winner}'</span><span class="token punctuation">)</span>
            <span class="token comment"># save to history</span>
            self<span class="token punctuation">.</span>history<span class="token punctuation">[</span><span class="token string">'f'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span>winner<span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>history<span class="token punctuation">[</span><span class="token string">'x'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span>self<span class="token punctuation">.</span>X<span class="token punctuation">[</span>self<span class="token punctuation">.</span>rank<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>history<span class="token punctuation">[</span><span class="token string">'y'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span>self<span class="token punctuation">.</span>Y<span class="token punctuation">[</span>self<span class="token punctuation">.</span>rank<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
            <span class="token comment"># choose, crossover and mutation</span>
            chosen <span class="token operator">=</span> self<span class="token punctuation">.</span>choose<span class="token punctuation">(</span><span class="token punctuation">)</span>
            crossed <span class="token operator">=</span> self<span class="token punctuation">.</span>crossover<span class="token punctuation">(</span>chosen<span class="token punctuation">)</span>
            self<span class="token punctuation">.</span><span class="token builtin">chr</span> <span class="token operator">=</span> self<span class="token punctuation">.</span>mutation<span class="token punctuation">(</span>crossed<span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>X<span class="token punctuation">,</span> self<span class="token punctuation">.</span>Y <span class="token operator">=</span> self<span class="token punctuation">.</span>decoder<span class="token punctuation">(</span>self<span class="token punctuation">.</span><span class="token builtin">chr</span><span class="token punctuation">)</span>
</code></pre> 
<p><strong>（8）运行结果</strong></p> 
<p>实例化GeneticAlgorith类，设置种群数为10，迭代次数为100次</p> 
<pre><code class="prism language-python"><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    <span class="token comment"># run</span>
    ga <span class="token operator">=</span> GeneticAlgorithm<span class="token punctuation">(</span>func<span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span>
    ga<span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment"># plot</span>
    plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>ga<span class="token punctuation">.</span>history<span class="token punctuation">[</span><span class="token string">'f'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">'Fitness value'</span><span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span><span class="token string">'Iter'</span><span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p>运行得到结果如下</p> 
<p><img src="https://images2.imgbox.com/b6/40/E8cb0eXG_o.png" alt="在这里插入图片描述"></p> 
<p>每一次遗传算法的运算结果都可能有较大的不同，这跟初始种群的选取、交叉等操作有密切的联系，如果想提高稳定性可以进行参数的调整，如扩大种群的数量，增加迭代次数，选用不同的交叉、变异方法和相应的概率，以优化这一模型，得到更加理想的结果。</p> 
<p><strong>以上是遗传算法的Python实现，最后附上完整代码：</strong></p> 
<pre><code class="prism language-python"><span class="token comment"># -*- coding: utf-8 -*-</span>
<span class="token comment"># @Author  : gyy</span>
<span class="token comment"># @Email   : evangu1104@foxmail.com</span>
<span class="token comment"># @File    : GA.py</span>

<span class="token keyword">import</span> math
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt
<span class="token keyword">from</span> random <span class="token keyword">import</span> random<span class="token punctuation">,</span> randint<span class="token punctuation">,</span> uniform

<span class="token keyword">def</span> <span class="token function">func</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">:</span>
    num <span class="token operator">=</span> <span class="token number">6.452</span> <span class="token operator">*</span> <span class="token punctuation">(</span>x <span class="token operator">+</span> <span class="token number">0.125</span> <span class="token operator">*</span> y<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>math<span class="token punctuation">.</span>cos<span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token operator">-</span> math<span class="token punctuation">.</span>cos<span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> y<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">**</span> <span class="token number">2</span>
    den <span class="token operator">=</span> math<span class="token punctuation">.</span>sqrt<span class="token punctuation">(</span><span class="token number">0.8</span> <span class="token operator">+</span> <span class="token punctuation">(</span>x <span class="token operator">-</span> <span class="token number">4.2</span><span class="token punctuation">)</span> <span class="token operator">**</span> <span class="token number">2</span> <span class="token operator">+</span> <span class="token number">2</span> <span class="token operator">*</span> <span class="token punctuation">(</span>y <span class="token operator">-</span> <span class="token number">7</span><span class="token punctuation">)</span> <span class="token operator">**</span> <span class="token number">2</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> num <span class="token operator">/</span> den <span class="token operator">+</span> <span class="token number">3.226</span> <span class="token operator">*</span> y

<span class="token keyword">class</span> <span class="token class-name">GeneticAlgorithm</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> function<span class="token punctuation">,</span> M<span class="token punctuation">,</span> gen<span class="token punctuation">,</span> Pc<span class="token operator">=</span><span class="token number">0.85</span><span class="token punctuation">,</span> Pm<span class="token operator">=</span><span class="token number">0.05</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""
        :param function: fitness function
        :param M: population
        :param gen: total generations
        :param Pc: probability of crossover
        :param Pm: probability of mutation
        """</span>
        self<span class="token punctuation">.</span>func <span class="token operator">=</span> function
        self<span class="token punctuation">.</span>Pc <span class="token operator">=</span> Pc
        self<span class="token punctuation">.</span>Pm <span class="token operator">=</span> Pm
        self<span class="token punctuation">.</span>M <span class="token operator">=</span> M
        self<span class="token punctuation">.</span>gen <span class="token operator">=</span> gen
        self<span class="token punctuation">.</span>dec_num <span class="token operator">=</span> <span class="token number">3</span>
        self<span class="token punctuation">.</span>X <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        self<span class="token punctuation">.</span>Y <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        self<span class="token punctuation">.</span><span class="token builtin">chr</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        self<span class="token punctuation">.</span>f <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        self<span class="token punctuation">.</span>rank <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        self<span class="token punctuation">.</span>history <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
            <span class="token string">'f'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token string">'x'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token string">'y'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token punctuation">}</span>

    <span class="token keyword">def</span> <span class="token function">num2str</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> num<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># return str(int(num)) + str(int(num - int(num)) * 1e3)</span>
        s <span class="token operator">=</span> <span class="token builtin">str</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span>
        s <span class="token operator">+=</span> <span class="token string">'0'</span> <span class="token operator">*</span> <span class="token builtin">abs</span><span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span> <span class="token operator">//</span> <span class="token number">10</span> <span class="token operator">+</span> <span class="token number">1</span> <span class="token operator">+</span> self<span class="token punctuation">.</span>dec_num <span class="token operator">-</span> <span class="token builtin">len</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> s

    <span class="token keyword">def</span> <span class="token function">encoder</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">:</span>
        chr_list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token builtin">chr</span> <span class="token operator">=</span> self<span class="token punctuation">.</span>num2str<span class="token punctuation">(</span>x<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">+</span> self<span class="token punctuation">.</span>num2str<span class="token punctuation">(</span>y<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
            chr_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token builtin">chr</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> chr_list

    <span class="token keyword">def</span> <span class="token function">str2num</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> s<span class="token punctuation">)</span><span class="token punctuation">:</span>
        num <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>s<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token operator">-</span>self<span class="token punctuation">.</span>dec_num<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token builtin">float</span><span class="token punctuation">(</span>s<span class="token punctuation">[</span><span class="token operator">-</span>self<span class="token punctuation">.</span>dec_num<span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">10</span> <span class="token operator">**</span> self<span class="token punctuation">.</span>dec_num
        <span class="token keyword">return</span> <span class="token builtin">round</span><span class="token punctuation">(</span>num<span class="token punctuation">,</span> self<span class="token punctuation">.</span>dec_num<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">decoder</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token builtin">chr</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        cut <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span><span class="token builtin">chr</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span>
        x <span class="token operator">=</span> <span class="token punctuation">[</span>self<span class="token punctuation">.</span>str2num<span class="token punctuation">(</span><span class="token builtin">chr</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">:</span>cut<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span><span class="token builtin">chr</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
        y <span class="token operator">=</span> <span class="token punctuation">[</span>self<span class="token punctuation">.</span>str2num<span class="token punctuation">(</span><span class="token builtin">chr</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>cut<span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span><span class="token builtin">chr</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
        <span class="token keyword">return</span> x<span class="token punctuation">,</span> y

    <span class="token keyword">def</span> <span class="token function">choose</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># calculate percentage</span>
        s <span class="token operator">=</span> <span class="token builtin">sum</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>f<span class="token punctuation">)</span>
        p <span class="token operator">=</span> <span class="token punctuation">[</span>self<span class="token punctuation">.</span>f<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">/</span> s <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>M<span class="token punctuation">)</span><span class="token punctuation">]</span>
        chosen <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token comment"># choose M times</span>
        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>M<span class="token punctuation">)</span><span class="token punctuation">:</span>
            cum <span class="token operator">=</span> <span class="token number">0</span>
            m <span class="token operator">=</span> random<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token comment"># Roulette</span>
            <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>M<span class="token punctuation">)</span><span class="token punctuation">:</span>
                cum <span class="token operator">+=</span> p<span class="token punctuation">[</span>j<span class="token punctuation">]</span>
                <span class="token keyword">if</span> cum <span class="token operator">&gt;=</span> m<span class="token punctuation">:</span>
                    chosen<span class="token punctuation">.</span>append<span class="token punctuation">(</span>self<span class="token punctuation">.</span><span class="token builtin">chr</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span>
                    <span class="token keyword">break</span>
        <span class="token keyword">return</span> chosen

    <span class="token keyword">def</span> <span class="token function">crossover</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token builtin">chr</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        crossed <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token comment"># if chr list is odd</span>
        <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span><span class="token builtin">chr</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">2</span><span class="token punctuation">:</span>
            crossed<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token builtin">chr</span><span class="token punctuation">.</span>pop<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span><span class="token builtin">chr</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            a <span class="token operator">=</span> <span class="token builtin">chr</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span>
            b <span class="token operator">=</span> <span class="token builtin">chr</span><span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span>
            <span class="token comment"># 0.85 probability of crossover</span>
            <span class="token keyword">if</span> random<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> self<span class="token punctuation">.</span>Pc<span class="token punctuation">:</span>
                loc <span class="token operator">=</span> randint<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span><span class="token builtin">chr</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>
                temp <span class="token operator">=</span> a<span class="token punctuation">[</span>loc<span class="token punctuation">:</span><span class="token punctuation">]</span>
                a <span class="token operator">=</span> a<span class="token punctuation">[</span><span class="token punctuation">:</span>loc<span class="token punctuation">]</span> <span class="token operator">+</span> b<span class="token punctuation">[</span>loc<span class="token punctuation">:</span><span class="token punctuation">]</span>
                b <span class="token operator">=</span> b<span class="token punctuation">[</span><span class="token punctuation">:</span>loc<span class="token punctuation">]</span> <span class="token operator">+</span> temp
            <span class="token comment"># add to crossed</span>
            crossed<span class="token punctuation">.</span>append<span class="token punctuation">(</span>a<span class="token punctuation">)</span>
            crossed<span class="token punctuation">.</span>append<span class="token punctuation">(</span>b<span class="token punctuation">)</span>
        <span class="token keyword">return</span> crossed

    <span class="token keyword">def</span> <span class="token function">mutation</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token builtin">chr</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        res <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">chr</span><span class="token punctuation">:</span>
            l <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
            <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>l<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token comment"># 0.05 probability of mutation on each location</span>
                <span class="token keyword">if</span> random<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> self<span class="token punctuation">.</span>Pm<span class="token punctuation">:</span>
                    <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
                        r <span class="token operator">=</span> <span class="token builtin">str</span><span class="token punctuation">(</span>randint<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                        <span class="token keyword">if</span> r <span class="token operator">!=</span> l<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">:</span>
                            l<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> r
                            <span class="token keyword">break</span>
            res<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>l<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> res

    <span class="token keyword">def</span> <span class="token function">run</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># initialization</span>
        x <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        y <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>M<span class="token punctuation">)</span><span class="token punctuation">:</span>
            x<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token builtin">round</span><span class="token punctuation">(</span>uniform<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>dec_num<span class="token punctuation">)</span><span class="token punctuation">)</span>
            y<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token builtin">round</span><span class="token punctuation">(</span>uniform<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>dec_num<span class="token punctuation">)</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>X <span class="token operator">=</span> x
        self<span class="token punctuation">.</span>Y <span class="token operator">=</span> y
        self<span class="token punctuation">.</span><span class="token builtin">chr</span> <span class="token operator">=</span> self<span class="token punctuation">.</span>encoder<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span>
        <span class="token comment"># iteration</span>
        <span class="token keyword">for</span> <span class="token builtin">iter</span> <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>gen<span class="token punctuation">)</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>f <span class="token operator">=</span> <span class="token punctuation">[</span>func<span class="token punctuation">(</span>self<span class="token punctuation">.</span>X<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>Y<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>M<span class="token punctuation">)</span><span class="token punctuation">]</span>
            fitness_sort <span class="token operator">=</span> <span class="token builtin">sorted</span><span class="token punctuation">(</span><span class="token builtin">enumerate</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>f<span class="token punctuation">)</span><span class="token punctuation">,</span> key<span class="token operator">=</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> x<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> reverse<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
            <span class="token comment"># 1st : fitness[rank[0]]</span>
            self<span class="token punctuation">.</span>rank <span class="token operator">=</span> <span class="token punctuation">[</span>i<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> fitness_sort<span class="token punctuation">]</span>
            winner <span class="token operator">=</span> self<span class="token punctuation">.</span>f<span class="token punctuation">[</span>self<span class="token punctuation">.</span>rank<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token string">'Iter={iter + 1}, Max-Fitness={winner}'</span><span class="token punctuation">)</span>
            <span class="token comment"># save to history</span>
            self<span class="token punctuation">.</span>history<span class="token punctuation">[</span><span class="token string">'f'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span>winner<span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>history<span class="token punctuation">[</span><span class="token string">'x'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span>self<span class="token punctuation">.</span>X<span class="token punctuation">[</span>self<span class="token punctuation">.</span>rank<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>history<span class="token punctuation">[</span><span class="token string">'y'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span>self<span class="token punctuation">.</span>Y<span class="token punctuation">[</span>self<span class="token punctuation">.</span>rank<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
            <span class="token comment"># choose, crossover and mutation</span>
            chosen <span class="token operator">=</span> self<span class="token punctuation">.</span>choose<span class="token punctuation">(</span><span class="token punctuation">)</span>
            crossed <span class="token operator">=</span> self<span class="token punctuation">.</span>crossover<span class="token punctuation">(</span>chosen<span class="token punctuation">)</span>
            self<span class="token punctuation">.</span><span class="token builtin">chr</span> <span class="token operator">=</span> self<span class="token punctuation">.</span>mutation<span class="token punctuation">(</span>crossed<span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>X<span class="token punctuation">,</span> self<span class="token punctuation">.</span>Y <span class="token operator">=</span> self<span class="token punctuation">.</span>decoder<span class="token punctuation">(</span>self<span class="token punctuation">.</span><span class="token builtin">chr</span><span class="token punctuation">)</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    <span class="token comment"># run</span>
    ga <span class="token operator">=</span> GeneticAlgorithm<span class="token punctuation">(</span>func<span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span>
    ga<span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment"># plot</span>
    plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>ga<span class="token punctuation">.</span>history<span class="token punctuation">[</span><span class="token string">'f'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">'Fitness value'</span><span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span><span class="token string">'Iter'</span><span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>

</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/53a75ac8fb9b19b2921a915163de89f1/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">GTest基础学习-05-第5个单元测试-父test fixture和子test fixture的使用</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/0c6c3f47047088d8f61d2fc42b324404/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">hdu 2074 叠框（排版题）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 追风少年的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>