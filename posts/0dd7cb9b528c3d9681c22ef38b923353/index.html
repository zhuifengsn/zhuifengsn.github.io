<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>c#调用python的四种方法（尝试了四种，只详细讲解本人成功的后两种，其余方法只列出，详细用法请自行谷歌百度） - 追风少年的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="c#调用python的四种方法（尝试了四种，只详细讲解本人成功的后两种，其余方法只列出，详细用法请自行谷歌百度）" />
<meta property="og:description" content="一、使用c#，nuget管理包上下载的ironPython安装包
尝试后发现，对引用了numpy等第三方库的python代码，会报找不到模块xxx的错误，上网查证后发现此问题基本难以解决
二、使用c&#43;&#43;程序调用python文件，然后将其做成动态链接库（dll），在c#中调用此dll文件
限制：实现方式很复杂，并且受python版本、(python/vs)32/64位影响，而且要求用户必须安装python运行环境
三、使用安装好的python环境，利用c#命令行，调用.py文件执行
优点：执行速度只比在python本身环境中慢一点，步骤也相对简单
缺点：需要用户安装配置python环境
实用步骤：
1、下载安装python，并配置好环境变量等（本人用的Anaconda，链接此处不再提供）
2、编写python文件（这里为了便于理解，只传比较简单的两个参数） 注：这两个python文件，我引用了numpy第三方库，也要安装后才能在python中使用
#multi.py def multiplication(a,b): return a*b #main.py import numpy as np import multi import sys def func(a,b): result=np.sqrt(multi.multiplication(int(a),int(b))) return result if __name__ == &#39;__main__&#39;: print(func(sys.argv[1],sys.argv[2])) ps:为了import不报错，尽量把multi.py文件放main.py同一文件夹下。因为打包exe文件执行后，可能会报找不到Multi模块的错误 3、在c#中调用上述主python文件：main.py
(我直接建了一个wpf文件，放在一个按钮的点击事件中执行了，你们随意)
private void Button_Click(object sender, RoutedEventArgs e) { string[] strArr=new string[2];//参数列表 string sArguments = @&#34;main.py&#34;;//这里是python的文件名字 strArr[0] = &#34;2&#34;; strArr[1] = &#34;3&#34;; RunPythonScript(sArguments, &#34;-u&#34;, strArr); } //调用python核心代码 public static void RunPythonScript(string sArgName, string args = &#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://zhuifengsn.github.io/posts/0dd7cb9b528c3d9681c22ef38b923353/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2018-09-05T14:00:50+08:00" />
<meta property="article:modified_time" content="2018-09-05T14:00:50+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="追风少年的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">追风少年的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">c#调用python的四种方法（尝试了四种，只详细讲解本人成功的后两种，其余方法只列出，详细用法请自行谷歌百度）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p><strong>一、使用c#，nuget管理包上下载的ironPython安装包</strong></p> 
<p>     尝试后发现，对引用了numpy等第三方库的python代码，会报找不到模块xxx的错误，上网查证后发现此问题基本难以解决</p> 
<p><br><strong>二、使用c++程序调用python文件，然后将其做成动态链接库（dll），在c#中调用此dll文件</strong><br>      限制：实现方式很复杂，并且受python版本、(python/vs)32/64位影响，而且要求用户必须安装python运行环境</p> 
<p><strong>三、使用安装好的python环境，利用c#命令行，调用.py文件执行</strong></p> 
<p>      优点：执行速度只比在python本身环境中慢一点，步骤也相对简单</p> 
<p>      缺点：需要用户安装配置python环境</p> 
<p>      实用步骤：</p> 
<p>      1、下载安装python，并配置好环境变量等（本人用的Anaconda，链接此处不再提供）</p> 
<p>       2、编写python文件（这里为了便于理解，只传比较简单的两个参数）  </p> 
<p><span style="color:#f33b45;">注：这两个python文件，我引用了numpy第三方库，也要安装后才能在python中使用</span></p> 
<pre class="has"><code class="language-python">#multi.py

def multiplication(a,b):
	return a*b</code></pre> 
<pre class="has"><code class="language-python">#main.py
import numpy as np
import multi
import sys

def func(a,b):
    result=np.sqrt(multi.multiplication(int(a),int(b)))
    return result


if __name__ == '__main__':
    print(func(sys.argv[1],sys.argv[2]))</code></pre> 
<p>ps:为了import不报错，尽量把multi.py文件放main.py同一文件夹下。因为打包exe文件执行后，可能会报找不到Multi模块的错误  </p> 
<p>      3、在c#中调用上述主python文件：main.py</p> 
<p>      (我直接建了一个wpf文件，放在一个按钮的点击事件中执行了，你们随意)</p> 
<pre class="has"><code class="language-cs">        private void Button_Click(object sender, RoutedEventArgs e)
        {

            string[] strArr=new string[2];//参数列表
            string sArguments = @"main.py";//这里是python的文件名字
            strArr[0] = "2";
            strArr[1] = "3";
            RunPythonScript(sArguments, "-u", strArr);
        }
        //调用python核心代码
        public static void RunPythonScript(string sArgName, string args = "", params string[] teps)
        {
            Process p = new Process();
            string path = System.AppDomain.CurrentDomain.SetupInformation.ApplicationBase + sArgName;// 获得python文件的绝对路径（将文件放在c#的debug文件夹中可以这样操作）
            path = @"C:\Users\user\Desktop\test\"+sArgName;//(因为我没放debug下，所以直接写的绝对路径,替换掉上面的路径了)
            p.StartInfo.FileName = @"D:\Python\envs\python3\python.exe";//没有配环境变量的话，可以像我这样写python.exe的绝对路径。如果配了，直接写"python.exe"即可
            string sArguments = path;
            foreach (string sigstr in teps)
            {
                sArguments += " " + sigstr;//传递参数
            }

                sArguments += " " + args;

            p.StartInfo.Arguments = sArguments;

            p.StartInfo.UseShellExecute = false;

            p.StartInfo.RedirectStandardOutput = true;

            p.StartInfo.RedirectStandardInput = true;

            p.StartInfo.RedirectStandardError = true;

            p.StartInfo.CreateNoWindow = true;

            p.Start();
            p.BeginOutputReadLine();
            p.OutputDataReceived += new DataReceivedEventHandler(p_OutputDataReceived);
            Console.ReadLine();
            p.WaitForExit();
        }
        //输出打印的信息
        static void p_OutputDataReceived(object sender, DataReceivedEventArgs e)
        {
            if (!string.IsNullOrEmpty(e.Data))
            {
                AppendText(e.Data + Environment.NewLine);
            }
        }
        public delegate void AppendTextCallback(string text);
        public static void AppendText(string text)
        {
            Console.WriteLine(text);     //此处在控制台输出.py文件print的结果

        }</code></pre> 
<p>执行成功，得到结果：也就是<img alt="\sqrt{2*3}" class="mathcode" src="https://images2.imgbox.com/b5/96/ZApk4IXh_o.gif"></p> 
<p><img alt="" class="has" height="256" src="https://images2.imgbox.com/b4/e8/bFv0YYqD_o.png" width="476"><br><strong>四、c#调用python可执行exe文件，使用命令行进行传参取返回值</strong></p> 
<p>      优点：无需安装python运行环境</p> 
<p>      缺点：</p> 
<p>       1、可能是因为要展开exe中包含的python环境，执行速度相当慢，慎用！</p> 
<p>       2、因为是命令行传参形式，故传参需要自行处理。ps：由于命令行传参形式为：xxx.exe 参数1 参数2 参数3....</p> 
<p>我要传一个很大的数组，曲线救国，用c#将数组写入txt文件中，将存放路径传给python函数，python读取此txt文件得到数据</p> 
<hr> 
<p><strong>     使用步骤：</strong></p> 
<p>      1、编写python文件（这里为了便于理解，只传比较简单的两个参数）  </p> 
<pre class="has"><code class="language-python">#multi.py

def multiplication(a,b):
	return a*b</code></pre> 
<pre class="has"><code class="language-python">#main.py
import numpy as np
import multi
import sys

def func(a,b):
    result=np.sqrt(multi.multiplication(int(a),int(b)))
    return result


if __name__ == '__main__':
    print(func(sys.argv[1],sys.argv[2]))</code></pre> 
<p>ps:为了import不报错，尽量把multi.py文件放main.py同一文件夹下。因为打包exe文件执行后，可能会报找不到Multi模块的错误</p> 
<p>2、安装pyInstaller（若已安装请直接跳过此步骤）</p> 
<p>      我使用的是Anaconda编写python，所以使用Anaconda Prompt进行安装pyInstaller（直接安装python并配好环境变量的小伙伴，可以在电脑的cmd下进行操作）</p> 
<p>      <img alt="" class="has" height="354" src="https://images2.imgbox.com/3c/9c/mHk8yi45_o.png" width="308"></p> 
<p>这个类似于电脑的cmd.exe程序，可在其中输入命令行操作</p> 
<p>安装pyInstaller命令行:</p> 
<p><img alt="" class="has" height="303" src="https://images2.imgbox.com/6e/5f/fRMSrXCJ_o.png" width="525"></p> 
<p>正常来讲会报一个错误，说你的pip版本过低，需要先更新一下</p> 
<pre class="has"><code>pip install --upgrade pip</code></pre> 
<p>使用此命令更新pip，然后再执行pip install pyinstaller命令即可</p> 
<p>3、使用pyinstaller打包python程序</p> 
<p>同样还是在Anaconda Prompt中，cd python文件所在的路径，然后执行打包命令</p> 
<p><img alt="" class="has" height="496" src="https://images2.imgbox.com/15/0e/shyP0aAi_o.png" width="699"></p> 
<p>打包过程可能会出错（找不到模块、迭代深度超出等，在我另两篇博客里有解决办法）</p> 
<p>若打包成功，出现successfully，失败的话会给出错误信息</p> 
<p><img alt="" class="has" height="355" src="https://images2.imgbox.com/9d/53/Yfe4HnFc_o.png" width="801"></p> 
<p>4、在c#中调用此exe文件（此处我建了一个wpf项目，利用按钮点击事件来实现调用）</p> 
<pre class="has"><code class="language-cs">namespace WpfTest2
{
    /// &lt;summary&gt;
    /// MainWindow.xaml 的交互逻辑
    /// &lt;/summary&gt;
    public partial class MainWindow : Window
    {
        public MainWindow()
        {
            InitializeComponent();
        }

        private void Button_Click(object sender, RoutedEventArgs e)
        {
            //string debugPath = System.Environment.CurrentDirectory;           //此c#项目的debug文件夹路径
            string pyexePath = @"C:\Users\user\Desktop\test\dist\main.exe";     
            //python文件所在路径，一般不使用绝对路径，此处仅作为例子，建议转移到debug文件夹下
            
            Process p = new Process();
            p.StartInfo.FileName = pyexePath;//需要执行的文件路径
            p.StartInfo.UseShellExecute = false; //必需
            p.StartInfo.RedirectStandardOutput = true;//输出参数设定
            p.StartInfo.RedirectStandardInput = true;//传入参数设定
            p.StartInfo.CreateNoWindow = true;
            p.StartInfo.Arguments = "2 3";//参数以空格分隔，如果某个参数为空，可以传入””
            p.Start();
            string output = p.StandardOutput.ReadToEnd();
            p.WaitForExit();//关键，等待外部程序退出后才能往下执行}
            Console.Write(output);//输出
            p.Close();        
        }
    }
}</code></pre> 
<p>在控制台打印出结果：也就是<img alt="\sqrt{2*3}" class="mathcode" src="https://images2.imgbox.com/48/35/Hjol5CBK_o.gif"></p> 
<p><img alt="" class="has" height="282" src="https://images2.imgbox.com/4b/07/hRsU86iM_o.png" width="664"></p> 
<p>至此，完成c#调用python的exe文件，并实现了传入传出参数功能，谢谢观看</p> 
<p></p> 
<p></p> 
<p><span style="color:#f33b45;">第三种实现方式整理了下源代码，下载链接放在下面，需要的话请自行下载：</span></p> 
<p><span style="color:#f33b45;">百度网盘免费链接和提取码：</span></p> 
<p>链接：https://pan.baidu.com/s/1YBcjdr-0fo0HVP1sq1U7nw <br> 提取码：zana</p> 
<p><span style="color:#f33b45;">CSDN收费链接：</span><a href="https://download.csdn.net/download/qq_42063091/12011343" title="netCallpyFile.rar_c#调用python-C#文档类资源-CSDN下载">netCallpyFile.rar_c#调用python-C#文档类资源-CSDN下载</a></p> 
<p><span style="color:#f33b45;">里面有注意事项，代码运行出现问题时最好看一下。有其他问题可以在下面评论或者私信我，可能回复不及时，请谅解，谢谢支持</span></p> 
<p><span style="color:#3399ea;"><strong>2019-5-16更新，补充一点，path中不能带有空格，尽量不要有中文。不然会出现不报错，但执行也不出结果的情况，</strong></span></p> 
<p><span style="color:#3399ea;"><strong>因为此种方式本质上类似与管理员命令行中执行：<u>python.exe </u></strong></span><u><span style="color:#ffbb66;"><strong> c:\hua bei\main.py</strong></span></u><span style="color:#3399ea;"><strong> 2 3   的效果。如黄色字体中的空格，会导致执行变成 <u>python.exe </u></strong></span><span style="color:#ffbb66;"><strong><u>c:\hua</u> ...,</strong></span><span style="color:#3399ea;"><strong>也就是把</strong></span><span style="color:#ffbb66;"><strong>c:\hua </strong></span><span style="color:#3399ea;"><strong>当成.py文件的路径，所以导致执行不出结果，希望大家避免踩坑</strong></span></p> 
<p></p> 
<p></p> 
<p></p> 
<p></p> 
<p></p> 
<p></p> 
<p></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/27253a4fff27a38cea52d8ac6becf0ae/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">java编程题50道</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/03a5f268addd68febaa93884ef831481/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">math.h库函数中atan与atan2的区别</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 追风少年的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>