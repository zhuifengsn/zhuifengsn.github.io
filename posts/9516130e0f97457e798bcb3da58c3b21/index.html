<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Python爬虫：ZzzFun动漫视频网 - 追风少年的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Python爬虫：ZzzFun动漫视频网" />
<meta property="og:description" content="提醒：转载请标明作者和原文链接！！！
CSDN个人主页： 高智商白痴
原文地址： https://blog.csdn.net/qq_44700693/article/details/109924262
日常跳转： 前言分析获取m3u8文件链接下载m3u8文件源码及结果最后 前言 我们都知道爬虫分为两类，分别是 通用爬虫 和 聚焦爬虫 ，我在这次的实例说明前给大家简要说明一下：
1、通用爬虫：
通用网络爬虫是捜索引擎抓取系统（Baidu、Google等）的重要组成部分。主要目的是将互联网上的网页下载到本地，形成一个互联网内容的镜像备份。
但是搜索引擎蜘蛛的爬取是被定义了一定的规则的，它需要遵从一些命令或文件的内容，如标注为 nofollow 的链接，或者是 Robots 协议。
2、聚焦爬虫：
聚焦爬虫是 “面向特定主题需求” 的一种网络爬虫程序，它与通用搜索引擎爬虫的区别在于： 聚焦爬虫在实施网页抓取时会对内容进行处理筛选，尽量保证只抓取与需求相关的网页信息。而我们将要学习的，就是聚焦爬虫。
而在编写 聚焦爬虫 时，免不了会遇到一些反扒机制，如：
1、headers and referer 反爬机制2、IP 限制3、UA限制4、验证码反爬虫或者模拟登陆
… 其实到目前为止，我已经写过一些关于一些 反反爬 的案例，大家可以自行去了解：https://blog.csdn.net/qq_44700693/category_9835663.html
分析 而今天呢，我又将会给大家介绍另一种反爬的情况：ZzzFun动漫视频网 - (￣﹃￣)~zZZ
针对这个网站会有一个不同于其他网站的特性：
不知道各位有没有发现什么，没错！那就是该网站某些页面无法调试，否则会 直接跳转到网站首页！这是因为在网页的某一请求资源下含有以下的 JS源码：
//debug调试时跳转页面 var element = new Image(); Object.defineProperty(element,&#39;id&#39;,{get:function(){window.location.href=&#34;http://www.zzzfun.com&#34;}}); console.log(element); 先不要管这段代码从哪里来，我后面会说明。不光是代码，我甚至就连代码的原注释都复制过来了，应该已经说的够详细了吧~~
针对这样的网站，像以前单纯的用浏览器抓包已经满足不了我们了，所以就需要用一点特殊的手段，使用第三方的工具 Fiddler 来进行抓包。
关于 Fiddler 的内容就在我之前的一篇文章里，我还会持续更新用法的~~
Fiddler：Fiddler新旧版抓包相关总结
说干就干，我这次使用的是最新版的 Fiddler Everywhere ，毕竟界面简洁干净嘛~
我们还是打开某一动漫的详情介绍页面后打开 Fiddler Everywhere 开始抓取请求：" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://zhuifengsn.github.io/posts/9516130e0f97457e798bcb3da58c3b21/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-12-14T19:21:56+08:00" />
<meta property="article:modified_time" content="2020-12-14T19:21:56+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="追风少年的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">追风少年的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Python爬虫：ZzzFun动漫视频网</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p><img src="https://images2.imgbox.com/e5/6c/q3G3LBSu_o.jpg" alt="在这里插入图片描述"><br> <strong><mark>提醒：转载请标明作者和原文链接！！！</mark></strong></p> 
<blockquote> 
 <p><strong>CSDN个人主页：</strong> <a href="https://blog.csdn.net/qq_44700693">高智商白痴</a><br> <strong>原文地址：</strong> <a href="https://blog.csdn.net/qq_44700693/article/details/109924262">https://blog.csdn.net/qq_44700693/article/details/109924262</a></p> 
</blockquote> 
<p></p> 
<div class="toc"> 
 <h4>日常跳转：</h4> 
 <ul><li><ul><li><ul><li><a href="#_8" rel="nofollow">前言</a></li><li><ul><li><a href="#_25" rel="nofollow">分析</a></li><li><a href="#m3u8_67" rel="nofollow">获取m3u8文件链接</a></li><li><a href="#m3u8_156" rel="nofollow">下载m3u8文件</a></li><li><a href="#_226" rel="nofollow">源码及结果</a></li><li><a href="#_341" rel="nofollow">最后</a></li></ul> 
   </li></ul> 
  </li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h4><a id="_8"></a>前言</h4> 
<p>我们都知道爬虫分为两类，分别是 <strong>通用爬虫</strong> 和 <strong>聚焦爬虫</strong> ，我在这次的实例说明前给大家简要说明一下：</p> 
<blockquote> 
 <p><strong>1、通用爬虫</strong>：<br> 通用网络爬虫是捜索引擎抓取系统（Baidu、Google等）的重要组成部分。主要目的是将互联网上的网页下载到本地，形成一个互联网内容的镜像备份。<br> 但是搜索引擎蜘蛛的爬取是被定义了一定的规则的，它需要遵从一些命令或文件的内容，如标注为 <strong>nofollow</strong> 的链接，或者是 <strong>Robots</strong> 协议。<br> <strong>2、聚焦爬虫</strong>：<br> 聚焦爬虫是 <strong>“面向特定主题需求”</strong> 的一种网络爬虫程序，它与通用搜索引擎爬虫的区别在于： 聚焦爬虫在实施网页抓取时会对内容进行处理筛选，尽量保证只抓取与需求相关的网页信息。而我们将要学习的，就是聚焦爬虫。</p> 
</blockquote> 
<p>而在编写 <strong>聚焦爬虫</strong> 时，免不了会遇到一些反扒机制，如：</p> 
<blockquote> 
 <ul><li>1、<strong>headers and referer 反爬机制</strong></li><li>2、<strong>IP 限制</strong></li><li>3、<strong>UA限制</strong></li><li>4、<strong>验证码反爬虫或者模拟登陆</strong><br> …</li></ul> 
</blockquote> 
<p>其实到目前为止，我已经写过一些关于一些 <strong>反反爬</strong> 的案例，大家可以自行去了解：<strong><a href="https://blog.csdn.net/qq_44700693/category_9835663.html">https://blog.csdn.net/qq_44700693/category_9835663.html</a></strong></p> 
<hr> 
<h5><a id="_25"></a>分析</h5> 
<p>而今天呢，我又将会给大家介绍另一种反爬的情况：<a href="http://www.zzzfun.com/" rel="nofollow">ZzzFun动漫视频网 - (￣﹃￣)~zZZ</a></p> 
<p>针对这个网站会有一个不同于其他网站的特性：<br> <img src="https://images2.imgbox.com/f9/c3/C0tvxoMF_o.gif" alt="在这里插入图片描述"><br> 不知道各位有没有发现什么，没错！那就是该网站某些页面<strong>无法调试</strong>，否则会 <strong>直接跳转到网站首页</strong>！这是因为在网页的某一请求资源下含有以下的 <strong>JS源码</strong>：</p> 
<pre><code class="prism language-javascript"><span class="token comment">//debug调试时跳转页面</span>
<span class="token keyword">var</span> element <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>element<span class="token punctuation">,</span><span class="token string">'id'</span><span class="token punctuation">,</span><span class="token punctuation">{<!-- --></span><span class="token keyword">get</span><span class="token punctuation">:</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>href<span class="token operator">=</span><span class="token string">"http://www.zzzfun.com"</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>element<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>先不要管这段代码从哪里来，我后面会说明。不光是代码，我甚至就连代码的原注释都复制过来了，应该已经说的够详细了吧~~</p> 
<p>针对这样的网站，像以前单纯的用浏览器抓包已经满足不了我们了，所以就需要用一点特殊的手段，使用第三方的工具 <strong>Fiddler</strong> 来进行抓包。</p> 
<blockquote> 
 <p>关于 <strong>Fiddler</strong> 的内容就在我之前的一篇文章里，我还会<strong>持续更新</strong>用法的~~<br> <a href="https://blog.csdn.net/qq_44700693/article/details/109820296">Fiddler：Fiddler新旧版抓包相关总结</a></p> 
</blockquote> 
<p>说干就干，我这次使用的是最新版的 <strong>Fiddler Everywhere</strong> ，毕竟界面简洁干净嘛~</p> 
<p>我们还是打开某一动漫的详情介绍页面后打开 <strong>Fiddler Everywhere</strong> 开始抓取请求：<br> <img src="https://images2.imgbox.com/8f/84/fzKONusr_o.gif" alt="在这里插入图片描述"></p> 
<blockquote> 
 <p>当页面全部加载完成后，我们就可以关闭 <strong>Fiddler Everywhere</strong> 了，避免我们的误操作会造成多余的抓取信息。</p> 
</blockquote> 
<p>当浏览器加载完成后我们就可以开始挨个儿查看所抓取到的信息：</p> 
<p><img src="https://images2.imgbox.com/ad/db/YcxarGdx_o.png" alt="在这里插入图片描述"><br> 当我们挨个儿查看时发现，在某一次与当前剧集链接相同的请求时，点击 <strong>Preview</strong> ，会发现当前页面的所有信息都已经加载完成了，除了视频信息~~ 那么视频信息就有可能是 <strong>AJAX</strong> 或者其他方式来进行的界面局部更新。</p> 
<p>我们知道了视频的加载方式，那么接下来就可以开始寻找视频的来源到底时什么了~~<br> <img src="https://images2.imgbox.com/34/3d/8IrzaInN_o.png" alt="在这里插入图片描述"><br> 在第一遍大概浏览的时候我发现，在上图的位置，浏览器请求了一个 <strong>m3u8</strong> 文件，而这估计就是视频的信息了。<br> 那么反过来说，这是一个<strong>m3u8</strong> 文件的请求链接，那么在这之前，就肯定会有一个地方对这个链接进行了参数生成然后开始请求，并且我发现同一个视频，链接会发生变化，并且每一条链接的时效性很短很短！！！</p> 
<p>综合现有的信息我一开始猜测可能是用 <strong>JS</strong> 实现的参数生成，结果并不是，不信你继续往下看~~<br> 既然知道了这一次请求的链接参数，那么我们就开始寻找参数生成的位置：我又挨个儿的对返回数据进行查找，终于让我找到了链接来源：<br> <img src="https://images2.imgbox.com/92/9a/QYsZX60e_o.png" alt="在这里插入图片描述"><br> 在这里就还可以顺便把我之前埋的坑给填了：<br> <img src="https://images2.imgbox.com/ce/63/lj8AzyxC_o.png" alt="在这里插入图片描述"></p> 
<hr> 
<h5><a id="m3u8_67"></a>获取m3u8文件链接</h5> 
<p>而且是完全拼接好的链接，那这就简单很多了，我们可以直接从该链接下手进行抓取，然后通过正则表达式来进行链接的提取：<br> 根据抓包信息来破解反爬：</p> 
<pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">user_ui</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
	<span class="token triple-quoted-string string">"""
	CSDN ：高智商白痴
    CSDN个人主页：https://blog.csdn.net/qq_44700693
	"""</span>
    main_headers <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">'Host'</span><span class="token punctuation">:</span> <span class="token string">'www.zzzfun.com'</span><span class="token punctuation">,</span>
        <span class="token string">'Connection'</span><span class="token punctuation">:</span> <span class="token string">'keep-alive'</span><span class="token punctuation">,</span>
        <span class="token string">'Upgrade-Insecure-Requests'</span><span class="token punctuation">:</span> <span class="token string">'1'</span><span class="token punctuation">,</span>
        <span class="token string">'User-Agent'</span><span class="token punctuation">:</span> <span class="token string">'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/86.0.4240.198 Safari/537.36 Edg/86.0.622.69'</span><span class="token punctuation">,</span>
        <span class="token string">'Accept'</span><span class="token punctuation">:</span> <span class="token string">'text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9'</span><span class="token punctuation">,</span>
        <span class="token string">'Referer'</span><span class="token punctuation">:</span> <span class="token string">"http://www.zzzfun.com/vod-detail-id-1934.html"</span><span class="token punctuation">,</span>
        <span class="token string">'Accept-Encoding'</span><span class="token punctuation">:</span> <span class="token string">'gzip, deflate'</span><span class="token punctuation">,</span>
        <span class="token string">'Accept-Language'</span><span class="token punctuation">:</span> <span class="token string">'zh-CN,zh;q=0.9,en;q=0.8,en-GB;q=0.7,en-US;q=0.6'</span>
    <span class="token punctuation">}</span>
    video_urls <span class="token operator">=</span> <span class="token string">'http://www.zzzfun.com/static/danmu/bed-bofang.php?1934/01.m3u8'</span>
    r <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>video_urls<span class="token punctuation">,</span> proxies<span class="token operator">=</span>proxy<span class="token punctuation">,</span> headers<span class="token operator">=</span>main_headers<span class="token punctuation">)</span>
    m3u8_url <span class="token operator">=</span> re<span class="token punctuation">.</span>findall<span class="token punctuation">(</span><span class="token string">"video.src = '(.*?)';"</span><span class="token punctuation">,</span> r<span class="token punctuation">.</span>text<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>m3u8_url<span class="token punctuation">)</span>
</code></pre> 
<blockquote> 
 <p>得到以下链接：<br> <a href="http://service-agbhuggw-1259251677.gz.apigw.tencentcs.com/pay/hlsjiami/1606222851/8a4dcc584f6a406890cb0551f2753082/1934/01.m3u8" rel="nofollow">http://service-agbhuggw-1259251677.gz.apigw.tencentcs.com/pay/hlsjiami/1606222851/8a4dcc584f6a406890cb0551f2753082/1934/01.m3u8</a></p> 
</blockquote> 
<p>获取了某一集的视频信息，接下来就要开始分析这个新的请求链接的参数：<br> 通过对多集链接的查看可以很明了的看出参数的构造，不信你看：</p> 
<blockquote> 
 <p><strong>同动漫不同集</strong>：<br> 第一集：http://www.zzzfun.com/static/danmu/bed-bofang.php?<strong>1934/01</strong>.m3u8<br> 第二集：http://www.zzzfun.com/static/danmu/bed-bofang.php?<strong>1934/02</strong>.m3u8<br> 第二集：http://www.zzzfun.com/static/danmu/bed-bofang.php?<strong>1934/03</strong>.m3u8</p> 
 <hr> 
 <p><strong>不同动漫</strong>：<br> 动漫一：http://www.zzzfun.com/vod-detail-id-<strong>1916</strong>.html<br> 动漫二：http://www.zzzfun.com/vod-detail-id-<strong>1929</strong>.html<br> 动漫三：http://www.zzzfun.com/vod-detail-id-<strong>1913</strong>.html</p> 
</blockquote> 
<p>根据以上的信息我们可以很快的看出参数的构造，所以我们就可以写出如何爬取不同的集数了，但是总不能爬取每一个动漫都要输入下载的集数吧，所以这就体现出视频详情页的重要性了，我们可以从视频详情页找到每一集的信息，并且顺手获取了动漫的名字：</p> 
<pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">user_ui</span><span class="token punctuation">(</span>videos_url<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
	CSDN ：高智商白痴
    CSDN个人主页：https://blog.csdn.net/qq_44700693
    :param videos_url: 视频的详情页链接
    :return:
    """</span>
    main_headers <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">'Host'</span><span class="token punctuation">:</span> <span class="token string">'www.zzzfun.com'</span><span class="token punctuation">,</span>
        <span class="token string">'Connection'</span><span class="token punctuation">:</span> <span class="token string">'keep-alive'</span><span class="token punctuation">,</span>
        <span class="token string">'Upgrade-Insecure-Requests'</span><span class="token punctuation">:</span> <span class="token string">'1'</span><span class="token punctuation">,</span>
        <span class="token string">'User-Agent'</span><span class="token punctuation">:</span> <span class="token string">'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/86.0.4240.198 Safari/537.36 Edg/86.0.622.69'</span><span class="token punctuation">,</span>
        <span class="token string">'Accept'</span><span class="token punctuation">:</span> <span class="token string">'text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9'</span><span class="token punctuation">,</span>
        <span class="token string">'Referer'</span><span class="token punctuation">:</span> videos_url<span class="token punctuation">,</span>
        <span class="token string">'Accept-Encoding'</span><span class="token punctuation">:</span> <span class="token string">'gzip, deflate'</span><span class="token punctuation">,</span>
        <span class="token string">'Accept-Language'</span><span class="token punctuation">:</span> <span class="token string">'zh-CN,zh;q=0.9,en;q=0.8,en-GB;q=0.7,en-US;q=0.6'</span>
    <span class="token punctuation">}</span>
    r <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>videos_url<span class="token punctuation">,</span> headers<span class="token operator">=</span>main_headers<span class="token punctuation">)</span>
    video_name <span class="token operator">=</span> re<span class="token punctuation">.</span>findall<span class="token punctuation">(</span><span class="token string">"&lt;title&gt;(.*?)详情介绍-.*?&lt;/title&gt;"</span><span class="token punctuation">,</span> r<span class="token punctuation">.</span>text<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">" "</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span>
    video_nums <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>parsel<span class="token punctuation">.</span>Selector<span class="token punctuation">(</span>r<span class="token punctuation">.</span>text<span class="token punctuation">)</span><span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'//div[@class="episode-wrap"]/ul[1]/li'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    video_id <span class="token operator">=</span> videos_url<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">"-"</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
    video_urls <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'http://www.zzzfun.com/static/danmu/bed-bofang.php?{}/{:0&gt;2d}.m3u8'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>video_id<span class="token punctuation">,</span> num<span class="token punctuation">)</span> <span class="token keyword">for</span> num <span class="token keyword">in</span>
                  <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> video_nums <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
    rel_path <span class="token operator">=</span> path <span class="token operator">+</span> video_name
    <span class="token keyword">if</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>rel_path<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">pass</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        os<span class="token punctuation">.</span>makedirs<span class="token punctuation">(</span>rel_path<span class="token punctuation">)</span>
    <span class="token keyword">for</span> url <span class="token keyword">in</span> video_urls<span class="token punctuation">:</span>
        r <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">,</span> proxies<span class="token operator">=</span>proxy<span class="token punctuation">,</span> headers<span class="token operator">=</span>main_headers<span class="token punctuation">)</span>
        m3u8_url <span class="token operator">=</span> re<span class="token punctuation">.</span>findall<span class="token punctuation">(</span><span class="token string">"video.src = '(.*?)';"</span><span class="token punctuation">,</span> r<span class="token punctuation">.</span>text<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
        name <span class="token operator">=</span> <span class="token string">"第"</span> <span class="token operator">+</span> url<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">"话"</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>name <span class="token operator">+</span> <span class="token string">" ---&gt; "</span> <span class="token operator">+</span> m3u8_url<span class="token punctuation">)</span>


<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
	<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token triple-quoted-string string">"""
	CSDN ：高智商白痴
    CSDN个人主页：https://blog.csdn.net/qq_44700693
	"""</span><span class="token punctuation">)</span>
    videos_url <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">"请输入视频的详情页链接: "</span><span class="token punctuation">)</span>
    user_ui<span class="token punctuation">(</span>videos_url<span class="token punctuation">)</span>
</code></pre> 
<blockquote> 
 <p><strong>正则表达式是真的香~~~</strong></p> 
</blockquote> 
<p><img src="https://images2.imgbox.com/f2/27/IstfKj7N_o.png" alt="在这里插入图片描述"></p> 
<hr> 
<h5><a id="m3u8_156"></a>下载m3u8文件</h5> 
<p>到此我们已经获取了一个动漫所需的信息以及下载的链接，接下来就可以开始研究如何下载的。</p> 
<blockquote> 
 <p>我在之前的几篇文章中都提到过 <strong>m3u8文件</strong> 的下载方式：如最近的这篇：<a href="https://blog.csdn.net/qq_44700693/article/details/109124334">Python爬虫：AcFun弹幕视频网</a></p> 
 <p>核心思想都是 ：<a href="https://blog.csdn.net/qq_44700693/article/details/106189511">Python爬虫：用最普通的方法爬取ts文件并合成为mp4格式</a></p> 
</blockquote> 
<p>不过在这个例子中会有一点点的修改：</p> 
<ul><li>1、对于下载 <strong>m3u8</strong> 文件视频信息时头文件有所不同。</li><li>2、视频信息链接中没有 <strong>.ts</strong> 字段。</li></ul> 
<pre><code class="prism language-python"><span class="token keyword">class</span> <span class="token class-name">Download</span><span class="token punctuation">:</span>
	<span class="token triple-quoted-string string">"""
	CSDN ：高智商白痴
    CSDN个人主页：https://blog.csdn.net/qq_44700693
	"""</span>
    urls <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    m3u8_headers <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">'Host'</span><span class="token punctuation">:</span> <span class="token string">'service-agbhuggw-1259251677.gz.apigw.tencentcs.com'</span><span class="token punctuation">,</span>
        <span class="token string">'Connection'</span><span class="token punctuation">:</span> <span class="token string">'keep-alive'</span><span class="token punctuation">,</span>
        <span class="token string">'User-Agent'</span><span class="token punctuation">:</span> <span class="token string">'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/86.0.4240.198 Safari/537.36 Edg/86.0.622.69'</span><span class="token punctuation">,</span>
        <span class="token string">'Accept'</span><span class="token punctuation">:</span> <span class="token string">'*/*'</span><span class="token punctuation">,</span>
        <span class="token string">'Origin'</span><span class="token punctuation">:</span> <span class="token string">'null'</span><span class="token punctuation">,</span>
        <span class="token string">'Sec-Fetch-Site'</span><span class="token punctuation">:</span> <span class="token string">'cross-site'</span><span class="token punctuation">,</span>
        <span class="token string">'Sec-Fetch-Mode'</span><span class="token punctuation">:</span> <span class="token string">'cors'</span><span class="token punctuation">,</span>
        <span class="token string">'Sec-Fetch-Dest'</span><span class="token punctuation">:</span> <span class="token string">'empty'</span><span class="token punctuation">,</span>
        <span class="token string">'Accept-Encoding'</span><span class="token punctuation">:</span> <span class="token string">'gzip, deflate, br'</span><span class="token punctuation">,</span>
        <span class="token string">'Accept-Language'</span><span class="token punctuation">:</span> <span class="token string">'zh-CN,zh;q=0.9,en;q=0.8,en-GB;q=0.7,en-US;q=0.6'</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token punctuation">,</span> m3u8_url<span class="token punctuation">,</span> download_path<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""
        :param name: 视频名
        :param m3u8_url: 视频的 m3u8文件 地址
        :param path: 下载地址
        """</span>
        self<span class="token punctuation">.</span>video_name <span class="token operator">=</span> name
        self<span class="token punctuation">.</span>path <span class="token operator">=</span> download_path
        self<span class="token punctuation">.</span>f_url <span class="token operator">=</span> m3u8_url
        <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>path <span class="token operator">+</span> <span class="token string">'/{}.m3u8'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>video_name<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'wb'</span><span class="token punctuation">)</span><span class="token keyword">as</span> f<span class="token punctuation">:</span>
            f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>m3u8_url<span class="token punctuation">,</span> headers<span class="token operator">=</span>self<span class="token punctuation">.</span>m3u8_headers<span class="token punctuation">)</span><span class="token punctuation">.</span>content<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">get_ts_urls</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>path <span class="token operator">+</span> <span class="token string">'/{}.m3u8'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>video_name<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"r"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token builtin">file</span><span class="token punctuation">:</span>
            lines <span class="token operator">=</span> <span class="token builtin">file</span><span class="token punctuation">.</span>readlines<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">for</span> line <span class="token keyword">in</span> lines<span class="token punctuation">:</span>
                <span class="token keyword">if</span> <span class="token string">'pgc-image'</span> <span class="token keyword">in</span> line<span class="token punctuation">:</span>
                    self<span class="token punctuation">.</span>urls<span class="token punctuation">.</span>append<span class="token punctuation">(</span>line<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">start_download</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>get_ts_urls<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">for</span> url <span class="token keyword">in</span> tqdm<span class="token punctuation">(</span>self<span class="token punctuation">.</span>urls<span class="token punctuation">,</span> desc<span class="token operator">=</span><span class="token string">"正在下载 {} "</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>video_name<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            video_headers <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
                <span class="token string">'Host'</span><span class="token punctuation">:</span> re<span class="token punctuation">.</span>findall<span class="token punctuation">(</span><span class="token string">"https://(.*?)/obj/"</span><span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token string">'Connection'</span><span class="token punctuation">:</span> <span class="token string">'keep-alive'</span><span class="token punctuation">,</span>
                <span class="token string">'User-Agent'</span><span class="token punctuation">:</span> <span class="token string">'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/86.0.4240.198 Safari/537.36 Edg/86.0.622.69'</span><span class="token punctuation">,</span>
                <span class="token string">'Accept'</span><span class="token punctuation">:</span> <span class="token string">'*/*'</span><span class="token punctuation">,</span>
                <span class="token string">'Origin'</span><span class="token punctuation">:</span> <span class="token string">'http://www.zzzfun.com'</span><span class="token punctuation">,</span>
                <span class="token string">'Sec-Fetch-Site'</span><span class="token punctuation">:</span> <span class="token string">'cross-site'</span><span class="token punctuation">,</span>
                <span class="token string">'Sec-Fetch-Mode'</span><span class="token punctuation">:</span> <span class="token string">'cors'</span><span class="token punctuation">,</span>
                <span class="token string">'Sec-Fetch-Dest'</span><span class="token punctuation">:</span> <span class="token string">'empty'</span><span class="token punctuation">,</span>
                <span class="token string">'Accept-Encoding'</span><span class="token punctuation">:</span> <span class="token string">'gzip, deflate, br'</span><span class="token punctuation">,</span>
                <span class="token string">'Accept-Language'</span><span class="token punctuation">:</span> <span class="token string">'zh-CN,zh;q=0.9,en;q=0.8,en-GB;q=0.7,en-US;q=0.6'</span>
            <span class="token punctuation">}</span>
            movie <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">,</span> headers<span class="token operator">=</span>video_headers<span class="token punctuation">)</span>
            <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>path <span class="token operator">+</span> <span class="token string">'/{}.flv'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>video_name<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'ab'</span><span class="token punctuation">)</span><span class="token keyword">as</span> f<span class="token punctuation">:</span>
                f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>movie<span class="token punctuation">.</span>content<span class="token punctuation">)</span>
        os<span class="token punctuation">.</span>remove<span class="token punctuation">(</span>self<span class="token punctuation">.</span>path <span class="token operator">+</span> <span class="token string">'/{}.m3u8'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>video_name<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
<h5><a id="_226"></a>源码及结果</h5> 
<pre><code class="prism language-python"><span class="token keyword">import</span> os
<span class="token keyword">import</span> re
<span class="token keyword">import</span> parsel
<span class="token keyword">import</span> requests
<span class="token keyword">from</span> tqdm <span class="token keyword">import</span> tqdm

path <span class="token operator">=</span> <span class="token string">'./'</span>

<span class="token keyword">class</span> <span class="token class-name">Download</span><span class="token punctuation">:</span>
    urls <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    m3u8_headers <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">'Host'</span><span class="token punctuation">:</span> <span class="token string">'service-agbhuggw-1259251677.gz.apigw.tencentcs.com'</span><span class="token punctuation">,</span>
        <span class="token string">'Connection'</span><span class="token punctuation">:</span> <span class="token string">'keep-alive'</span><span class="token punctuation">,</span>
        <span class="token string">'User-Agent'</span><span class="token punctuation">:</span> <span class="token string">'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/86.0.4240.198 Safari/537.36 Edg/86.0.622.69'</span><span class="token punctuation">,</span>
        <span class="token string">'Accept'</span><span class="token punctuation">:</span> <span class="token string">'*/*'</span><span class="token punctuation">,</span>
        <span class="token string">'Origin'</span><span class="token punctuation">:</span> <span class="token string">'null'</span><span class="token punctuation">,</span>
        <span class="token string">'Sec-Fetch-Site'</span><span class="token punctuation">:</span> <span class="token string">'cross-site'</span><span class="token punctuation">,</span>
        <span class="token string">'Sec-Fetch-Mode'</span><span class="token punctuation">:</span> <span class="token string">'cors'</span><span class="token punctuation">,</span>
        <span class="token string">'Sec-Fetch-Dest'</span><span class="token punctuation">:</span> <span class="token string">'empty'</span><span class="token punctuation">,</span>
        <span class="token string">'Accept-Encoding'</span><span class="token punctuation">:</span> <span class="token string">'gzip, deflate, br'</span><span class="token punctuation">,</span>
        <span class="token string">'Accept-Language'</span><span class="token punctuation">:</span> <span class="token string">'zh-CN,zh;q=0.9,en;q=0.8,en-GB;q=0.7,en-US;q=0.6'</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token punctuation">,</span> m3u8_url<span class="token punctuation">,</span> download_path<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""
        CSDN ：高智商白痴
        CSDN个人主页：https://blog.csdn.net/qq_44700693
        :param name: 视频名
        :param m3u8_url: 视频的 m3u8文件 地址
        :param path: 下载地址
        """</span>
        self<span class="token punctuation">.</span>video_name <span class="token operator">=</span> name
        self<span class="token punctuation">.</span>path <span class="token operator">=</span> download_path
        self<span class="token punctuation">.</span>f_url <span class="token operator">=</span> m3u8_url
        <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>path <span class="token operator">+</span> <span class="token string">'/{}.m3u8'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>video_name<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'wb'</span><span class="token punctuation">)</span><span class="token keyword">as</span> f<span class="token punctuation">:</span>
            f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>m3u8_url<span class="token punctuation">,</span> headers<span class="token operator">=</span>self<span class="token punctuation">.</span>m3u8_headers<span class="token punctuation">)</span><span class="token punctuation">.</span>content<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">get_ts_urls</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>path <span class="token operator">+</span> <span class="token string">'/{}.m3u8'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>video_name<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"r"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token builtin">file</span><span class="token punctuation">:</span>
            lines <span class="token operator">=</span> <span class="token builtin">file</span><span class="token punctuation">.</span>readlines<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">for</span> line <span class="token keyword">in</span> lines<span class="token punctuation">:</span>
                <span class="token keyword">if</span> <span class="token string">'pgc-image'</span> <span class="token keyword">in</span> line<span class="token punctuation">:</span>
                    self<span class="token punctuation">.</span>urls<span class="token punctuation">.</span>append<span class="token punctuation">(</span>line<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">start_download</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>get_ts_urls<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">for</span> url <span class="token keyword">in</span> tqdm<span class="token punctuation">(</span>self<span class="token punctuation">.</span>urls<span class="token punctuation">,</span> desc<span class="token operator">=</span><span class="token string">"正在下载 {} "</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>video_name<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            video_headers <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
                <span class="token string">'Host'</span><span class="token punctuation">:</span> re<span class="token punctuation">.</span>findall<span class="token punctuation">(</span><span class="token string">"https://(.*?)/obj/"</span><span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token string">'Connection'</span><span class="token punctuation">:</span> <span class="token string">'keep-alive'</span><span class="token punctuation">,</span>
                <span class="token string">'User-Agent'</span><span class="token punctuation">:</span> <span class="token string">'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/86.0.4240.198 Safari/537.36 Edg/86.0.622.69'</span><span class="token punctuation">,</span>
                <span class="token string">'Accept'</span><span class="token punctuation">:</span> <span class="token string">'*/*'</span><span class="token punctuation">,</span>
                <span class="token string">'Origin'</span><span class="token punctuation">:</span> <span class="token string">'http://www.zzzfun.com'</span><span class="token punctuation">,</span>
                <span class="token string">'Sec-Fetch-Site'</span><span class="token punctuation">:</span> <span class="token string">'cross-site'</span><span class="token punctuation">,</span>
                <span class="token string">'Sec-Fetch-Mode'</span><span class="token punctuation">:</span> <span class="token string">'cors'</span><span class="token punctuation">,</span>
                <span class="token string">'Sec-Fetch-Dest'</span><span class="token punctuation">:</span> <span class="token string">'empty'</span><span class="token punctuation">,</span>
                <span class="token string">'Accept-Encoding'</span><span class="token punctuation">:</span> <span class="token string">'gzip, deflate, br'</span><span class="token punctuation">,</span>
                <span class="token string">'Accept-Language'</span><span class="token punctuation">:</span> <span class="token string">'zh-CN,zh;q=0.9,en;q=0.8,en-GB;q=0.7,en-US;q=0.6'</span>
            <span class="token punctuation">}</span>
            movie <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">,</span> headers<span class="token operator">=</span>video_headers<span class="token punctuation">)</span>
            <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>path <span class="token operator">+</span> <span class="token string">'/{}.flv'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>video_name<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'ab'</span><span class="token punctuation">)</span><span class="token keyword">as</span> f<span class="token punctuation">:</span>
                f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>movie<span class="token punctuation">.</span>content<span class="token punctuation">)</span>
        os<span class="token punctuation">.</span>remove<span class="token punctuation">(</span>self<span class="token punctuation">.</span>path <span class="token operator">+</span> <span class="token string">'/{}.m3u8'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>video_name<span class="token punctuation">)</span><span class="token punctuation">)</span>


<span class="token keyword">def</span> <span class="token function">user_ui</span><span class="token punctuation">(</span>videos_url<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    CSDN ：高智商白痴
    CSDN个人主页：https://blog.csdn.net/qq_44700693
    :param videos_url: 视频的详情页链接
    :return:
    """</span>
    main_headers <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">'Host'</span><span class="token punctuation">:</span> <span class="token string">'www.zzzfun.com'</span><span class="token punctuation">,</span>
        <span class="token string">'Connection'</span><span class="token punctuation">:</span> <span class="token string">'keep-alive'</span><span class="token punctuation">,</span>
        <span class="token string">'Upgrade-Insecure-Requests'</span><span class="token punctuation">:</span> <span class="token string">'1'</span><span class="token punctuation">,</span>
        <span class="token string">'User-Agent'</span><span class="token punctuation">:</span> <span class="token string">'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/86.0.4240.198 Safari/537.36 Edg/86.0.622.69'</span><span class="token punctuation">,</span>
        <span class="token string">'Accept'</span><span class="token punctuation">:</span> <span class="token string">'text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9'</span><span class="token punctuation">,</span>
        <span class="token string">'Referer'</span><span class="token punctuation">:</span> videos_url<span class="token punctuation">,</span>
        <span class="token string">'Accept-Encoding'</span><span class="token punctuation">:</span> <span class="token string">'gzip, deflate'</span><span class="token punctuation">,</span>
        <span class="token string">'Accept-Language'</span><span class="token punctuation">:</span> <span class="token string">'zh-CN,zh;q=0.9,en;q=0.8,en-GB;q=0.7,en-US;q=0.6'</span>
    <span class="token punctuation">}</span>
    r <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>videos_url<span class="token punctuation">,</span> headers<span class="token operator">=</span>main_headers<span class="token punctuation">)</span>
    video_name <span class="token operator">=</span> re<span class="token punctuation">.</span>findall<span class="token punctuation">(</span><span class="token string">"&lt;title&gt;(.*?)详情介绍-.*?&lt;/title&gt;"</span><span class="token punctuation">,</span> r<span class="token punctuation">.</span>text<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">" "</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span>
    video_nums <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>parsel<span class="token punctuation">.</span>Selector<span class="token punctuation">(</span>r<span class="token punctuation">.</span>text<span class="token punctuation">)</span><span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'//div[@class="episode-wrap"]/ul[1]/li'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    video_id <span class="token operator">=</span> videos_url<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">"-"</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
    video_urls <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'http://www.zzzfun.com/static/danmu/bed-bofang.php?{}/{:0&gt;2d}.m3u8'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>video_id<span class="token punctuation">,</span> num<span class="token punctuation">)</span> <span class="token keyword">for</span> num <span class="token keyword">in</span>
                  <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> video_nums <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
    rel_path <span class="token operator">=</span> path <span class="token operator">+</span> video_name
    <span class="token keyword">if</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>rel_path<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">pass</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        os<span class="token punctuation">.</span>makedirs<span class="token punctuation">(</span>rel_path<span class="token punctuation">)</span>
    <span class="token keyword">for</span> url <span class="token keyword">in</span> video_urls<span class="token punctuation">:</span>
        r <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">,</span> headers<span class="token operator">=</span>main_headers<span class="token punctuation">)</span>
        m3u8_url <span class="token operator">=</span> re<span class="token punctuation">.</span>findall<span class="token punctuation">(</span><span class="token string">"video.src = '(.*?)';"</span><span class="token punctuation">,</span> r<span class="token punctuation">.</span>text<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
        name <span class="token operator">=</span> <span class="token string">"第"</span> <span class="token operator">+</span> url<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">"话"</span>
        Download<span class="token punctuation">(</span>name<span class="token punctuation">,</span> m3u8_url<span class="token punctuation">,</span> rel_path<span class="token punctuation">)</span><span class="token punctuation">.</span>start_download<span class="token punctuation">(</span><span class="token punctuation">)</span>


<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
	<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token triple-quoted-string string">"""
	CSDN ：高智商白痴
    CSDN个人主页：https://blog.csdn.net/qq_44700693
	"""</span><span class="token punctuation">)</span>
    videos_url <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">"请输入视频的详情页链接: "</span><span class="token punctuation">)</span>
    user_ui<span class="token punctuation">(</span>videos_url<span class="token punctuation">)</span>
</code></pre> 
<p>结果：<br> <img src="https://images2.imgbox.com/6a/cd/W8gRJcdP_o.png" alt="在这里插入图片描述"></p> 
<hr> 
<h5><a id="_341"></a>最后</h5> 
<p><strong>最后给个小提醒：</strong><br> 如果你出现了这个错误提醒：<code>IndexError: list index out of range</code><br> 那么你就该检查下你的浏览器打开该网页时是不是这样的：<br> <img src="https://images2.imgbox.com/55/27/alJEaEVE_o.png" alt="在这里插入图片描述"></p> 
<p>解决方法很简单，就是手动点开它就好了，然后在此运行代码~~</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/a32688f4c6737303b8ccac63fa141c08/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">如何在python中表示微分_Python实现自动微分(Automatic Differentiation)</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/3d40966ae5ff54f3062860ca06869f55/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">简述raid 0 1 5 10的区别</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 追风少年的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>