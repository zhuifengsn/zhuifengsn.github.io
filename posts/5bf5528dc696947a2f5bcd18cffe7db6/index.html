<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Linux系统编程---进程I/O - 追风少年的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Linux系统编程---进程I/O" />
<meta property="og:description" content="进程I/O C语言下的文件接口使用调用fwrite()函数--写入函数fread()读取文件 Linux 下的文件操作打开文件write函数 文件描述符。如何理解Linux下一切皆文件文件描述符的分配规则文件流指针FILE*与文件描述符的区别 重定向普通重定向追加重定向重定向的本质 缓冲区为什么要引入缓冲区？缓冲区归属常见的缓冲方式 理解文件系统理解目录 软硬链接软链接软链接文件的特性软链接的使用软链接的使用注意 硬链接硬链接的使用理解ll命令 动静态库静态链接与动态链接生成可执行文件为什么推荐使用动态链接动态链接实现本质动态链接与静态链接优缺点 实现动静态库静态库生成静态库静态库的使用 动态库动态库的生成测试动态库 C语言下的文件接口使用 C语言文件描述
示例：
这里实验两个。
调用fwrite()函数–写入函数 1#include&lt;stdio.h&gt; 2 #include&lt;string.h&gt; 3 #include&lt;stdlib.h&gt; 4 int main() 5 { 6 FILE *fp=fopen(&#34;1.txt&#34;,&#34;w&#34;); 7 if(fp==NULL) 8 { 9 perror(&#34;create error&#34;); 10 exit(1); 11 } 12 char buf[256]=&#34;hello world\n&#34;; 13 fwrite(buf,strlen(buf),1,fp); 14 fclose(fp); 15 return 0; 16 } fwrite(buf,strlen(buf),1,fp); 为什么strlen不加1，
因为’\0’只是字符串中的描述符，与文件无关，加上可能会造成乱码的情况。
fread()读取文件 1 #include&lt;stdio.h&gt; 2 #include&lt;string.h&gt; 3 #include&lt;stdlib.h&gt; 4 int main() 5 { 6 FILE *fp=fopen(&#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://zhuifengsn.github.io/posts/5bf5528dc696947a2f5bcd18cffe7db6/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-06-27T14:58:00+08:00" />
<meta property="article:modified_time" content="2021-06-27T14:58:00+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="追风少年的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">追风少年的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Linux系统编程---进程I/O</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>进程I/O</h4> 
 <ul><li><a href="#C_1" rel="nofollow">C语言下的文件接口使用</a></li><li><ul><li><a href="#fwrite_5" rel="nofollow">调用fwrite()函数--写入函数</a></li><li><a href="#fread_28" rel="nofollow">fread()读取文件</a></li></ul> 
  </li><li><a href="#Linux__68" rel="nofollow">Linux 下的文件操作</a></li><li><ul><li><a href="#_69" rel="nofollow">打开文件</a></li><li><a href="#write_93" rel="nofollow">write函数</a></li></ul> 
  </li><li><a href="#_156" rel="nofollow">文件描述符。</a></li><li><ul><li><a href="#Linux_161" rel="nofollow">如何理解Linux下一切皆文件</a></li><li><a href="#_166" rel="nofollow">文件描述符的分配规则</a></li><li><a href="#FILE_205" rel="nofollow">文件流指针FILE*与文件描述符的区别</a></li></ul> 
  </li><li><a href="#_209" rel="nofollow">重定向</a></li><li><ul><li><a href="#_213" rel="nofollow">普通重定向</a></li><li><a href="#_246" rel="nofollow">追加重定向</a></li><li><a href="#_277" rel="nofollow">重定向的本质</a></li></ul> 
  </li><li><a href="#_280" rel="nofollow">缓冲区</a></li><li><ul><li><a href="#_281" rel="nofollow">为什么要引入缓冲区？</a></li><li><a href="#_284" rel="nofollow">缓冲区归属</a></li><li><a href="#_320" rel="nofollow">常见的缓冲方式</a></li></ul> 
  </li><li><a href="#_332" rel="nofollow">理解文件系统</a></li><li><ul><li><a href="#_353" rel="nofollow">理解目录</a></li></ul> 
  </li><li><a href="#_362" rel="nofollow">软硬链接</a></li><li><ul><li><a href="#_363" rel="nofollow">软链接</a></li><li><ul><li><a href="#_365" rel="nofollow">软链接文件的特性</a></li><li><a href="#_370" rel="nofollow">软链接的使用</a></li><li><a href="#_386" rel="nofollow">软链接的使用注意</a></li></ul> 
   </li><li><a href="#_391" rel="nofollow">硬链接</a></li><li><ul><li><a href="#_396" rel="nofollow">硬链接的使用</a></li><li><a href="#ll_398" rel="nofollow">理解ll命令</a></li></ul> 
  </li></ul> 
  </li><li><a href="#_409" rel="nofollow">动静态库</a></li><li><ul><li><a href="#_410" rel="nofollow">静态链接与动态链接生成可执行文件</a></li><li><ul><li><a href="#_430" rel="nofollow">为什么推荐使用动态链接</a></li><li><a href="#_433" rel="nofollow">动态链接实现本质</a></li><li><a href="#_435" rel="nofollow">动态链接与静态链接优缺点</a></li></ul> 
  </li></ul> 
  </li><li><a href="#_442" rel="nofollow">实现动静态库</a></li><li><ul><li><a href="#_443" rel="nofollow">静态库</a></li><li><ul><li><a href="#_444" rel="nofollow">生成静态库</a></li><li><a href="#_455" rel="nofollow">静态库的使用</a></li></ul> 
   </li><li><a href="#_463" rel="nofollow">动态库</a></li><li><ul><li><a href="#_464" rel="nofollow">动态库的生成</a></li><li><a href="#_470" rel="nofollow">测试动态库</a></li></ul> 
  </li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h2><a id="C_1"></a>C语言下的文件接口使用</h2> 
<p><a href="https://blog.csdn.net/qq_45313714/article/details/116400768?spm=1001.2014.3001.5501">C语言文件描述</a><br> 示例：<br> 这里实验两个。</p> 
<h3><a id="fwrite_5"></a>调用fwrite()函数–写入函数</h3> 
<pre><code class="prism language-c">  <span class="token number">1</span>#include<span class="token operator">&lt;</span>stdio<span class="token punctuation">.</span>h<span class="token operator">&gt;</span>
  <span class="token number">2</span> #include<span class="token operator">&lt;</span>string<span class="token punctuation">.</span>h<span class="token operator">&gt;</span>
  <span class="token number">3</span> #include<span class="token operator">&lt;</span>stdlib<span class="token punctuation">.</span>h<span class="token operator">&gt;</span>
  <span class="token number">4</span> <span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token number">5</span> <span class="token punctuation">{<!-- --></span>
  <span class="token number">6</span>     FILE <span class="token operator">*</span>fp<span class="token operator">=</span><span class="token function">fopen</span><span class="token punctuation">(</span><span class="token string">"1.txt"</span><span class="token punctuation">,</span><span class="token string">"w"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token number">7</span>     <span class="token keyword">if</span><span class="token punctuation">(</span>fp<span class="token operator">==</span><span class="token constant">NULL</span><span class="token punctuation">)</span>
  <span class="token number">8</span>     <span class="token punctuation">{<!-- --></span>
  <span class="token number">9</span>         <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"create error"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token number">10</span>         <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token number">11</span>     <span class="token punctuation">}</span>
 <span class="token number">12</span>     <span class="token keyword">char</span> buf<span class="token punctuation">[</span><span class="token number">256</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">"hello world\n"</span><span class="token punctuation">;</span>                                                                                                                                                    
 <span class="token number">13</span>     <span class="token function">fwrite</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span><span class="token function">strlen</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span>fp<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token number">14</span>     <span class="token function">fclose</span><span class="token punctuation">(</span>fp<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token number">15</span>     <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
 <span class="token number">16</span> <span class="token punctuation">}</span>
</code></pre> 
<p><strong>fwrite(buf,strlen(buf),1,fp);</strong> 为什么strlen不加1，<br> 因为’\0’只是字符串中的描述符，与文件无关，加上可能会造成乱码的情况。<br> <img src="https://images2.imgbox.com/c4/b8/322fRDJN_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="fread_28"></a>fread()读取文件</h3> 
<pre><code class="prism language-c">   <span class="token number">1</span> #include<span class="token operator">&lt;</span>stdio<span class="token punctuation">.</span>h<span class="token operator">&gt;</span>
    <span class="token number">2</span> #include<span class="token operator">&lt;</span>string<span class="token punctuation">.</span>h<span class="token operator">&gt;</span>
    <span class="token number">3</span> #include<span class="token operator">&lt;</span>stdlib<span class="token punctuation">.</span>h<span class="token operator">&gt;</span>
    <span class="token number">4</span> <span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token number">5</span> <span class="token punctuation">{<!-- --></span>
    <span class="token number">6</span>     FILE <span class="token operator">*</span>fp<span class="token operator">=</span><span class="token function">fopen</span><span class="token punctuation">(</span><span class="token string">"1.txt"</span><span class="token punctuation">,</span><span class="token string">"w"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token number">7</span>     <span class="token keyword">if</span><span class="token punctuation">(</span>fp<span class="token operator">==</span><span class="token constant">NULL</span><span class="token punctuation">)</span>
    <span class="token number">8</span>     <span class="token punctuation">{<!-- --></span>
    <span class="token number">9</span>         <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"create error"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token number">10</span>         <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token number">11</span>     <span class="token punctuation">}</span>
   <span class="token number">12</span> 
   <span class="token number">13</span>     <span class="token keyword">char</span> buf<span class="token punctuation">[</span><span class="token number">256</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">"hello world\n"</span><span class="token punctuation">;</span>
   <span class="token number">14</span>     <span class="token function">fwrite</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span><span class="token function">strlen</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span>fp<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token number">15</span>    <span class="token comment">// fclose(fp);</span>
   <span class="token number">16</span>     <span class="token function">fflush</span><span class="token punctuation">(</span>fp<span class="token punctuation">)</span><span class="token punctuation">;</span>                                                                                                                                                                     
   <span class="token number">17</span>     fp<span class="token operator">=</span><span class="token function">fopen</span><span class="token punctuation">(</span><span class="token string">"1.txt"</span><span class="token punctuation">,</span><span class="token string">"r"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token number">18</span>     <span class="token keyword">if</span><span class="token punctuation">(</span>fp<span class="token operator">==</span><span class="token constant">NULL</span><span class="token punctuation">)</span>
   <span class="token number">19</span>     <span class="token punctuation">{<!-- --></span>
   <span class="token number">20</span>         <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"open filed"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token number">21</span>     <span class="token punctuation">}</span>
   <span class="token number">22</span>     <span class="token keyword">char</span> cat1<span class="token punctuation">[</span><span class="token number">100</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
   <span class="token number">23</span>     size_t k<span class="token operator">=</span> <span class="token function">fread</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>cat1<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>cat1<span class="token punctuation">)</span><span class="token punctuation">,</span>fp<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token number">24</span>     <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%d\n"</span><span class="token punctuation">,</span>k<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token number">25</span>     cat1<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">'\0'</span><span class="token punctuation">;</span>
   <span class="token number">26</span> 
   <span class="token number">27</span>     <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%s"</span><span class="token punctuation">,</span>cat1<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token number">28</span>     <span class="token function">fclose</span><span class="token punctuation">(</span>fp<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token number">29</span>     <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
   <span class="token number">30</span> <span class="token punctuation">}</span>
  <span class="token operator">~</span>
  <span class="token operator">~</span>

</code></pre> 
<p><img src="https://images2.imgbox.com/85/ee/Bge2OwxP_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/4f/b6/1FKesUpI_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="Linux__68"></a>Linux 下的文件操作</h2> 
<h3><a id="_69"></a>打开文件</h3> 
<p><img src="https://images2.imgbox.com/d1/57/T2edkCJ7_o.png" alt="在这里插入图片描述"><br> 摘自：Linux 2.6.32内核<br> <img src="https://images2.imgbox.com/01/5a/cKmkoj44_o.png" alt="在这里插入图片描述"><br> 使用：</p> 
<pre><code class="prism language-c"> <span class="token number">1</span> #include<span class="token operator">&lt;</span>stdio<span class="token punctuation">.</span>h<span class="token operator">&gt;</span>
  <span class="token number">2</span> #include<span class="token operator">&lt;</span>sys<span class="token operator">/</span>stat<span class="token punctuation">.</span>h<span class="token operator">&gt;</span>                                                      
  <span class="token number">3</span> #include<span class="token operator">&lt;</span>sys<span class="token operator">/</span>types<span class="token punctuation">.</span>h<span class="token operator">&gt;</span>
  <span class="token number">4</span> #include<span class="token operator">&lt;</span>fcntl<span class="token punctuation">.</span>h<span class="token operator">&gt;</span>
  <span class="token number">5</span> <span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token number">6</span> <span class="token punctuation">{<!-- --></span>
  <span class="token number">7</span>    <span class="token keyword">int</span> fd<span class="token operator">=</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">"1.txt"</span><span class="token punctuation">,</span>O_RDONLY<span class="token punctuation">)</span><span class="token punctuation">;</span>                         
  <span class="token number">8</span>    <span class="token keyword">if</span><span class="token punctuation">(</span>fd<span class="token operator">&lt;</span><span class="token number">0</span><span class="token punctuation">)</span>
  <span class="token number">9</span>    <span class="token punctuation">{<!-- --></span>
 <span class="token number">10</span>        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"open error"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token number">11</span>        <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>        
 <span class="token number">12</span>    <span class="token punctuation">}</span>                 
 <span class="token number">13</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%d\n"</span><span class="token punctuation">,</span>fd<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token number">14</span>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>                                                                                                                                                                          
 <span class="token number">15</span> <span class="token punctuation">}</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/f0/67/J2jyLgQO_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="write_93"></a>write函数</h3> 
<p><img src="https://images2.imgbox.com/8d/bf/sMshPLSC_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-c">  <span class="token number">1</span> #include<span class="token operator">&lt;</span>stdio<span class="token punctuation">.</span>h<span class="token operator">&gt;</span>  
  <span class="token number">2</span> #include<span class="token operator">&lt;</span>sys<span class="token operator">/</span>stat<span class="token punctuation">.</span>h<span class="token operator">&gt;</span>  
  <span class="token number">3</span> #include<span class="token operator">&lt;</span>sys<span class="token operator">/</span>types<span class="token punctuation">.</span>h<span class="token operator">&gt;</span>  
  <span class="token number">4</span> #include<span class="token operator">&lt;</span>fcntl<span class="token punctuation">.</span>h<span class="token operator">&gt;</span>  
  <span class="token number">5</span> #include<span class="token operator">&lt;</span>string<span class="token punctuation">.</span>h<span class="token operator">&gt;</span>  
  <span class="token number">6</span> #include<span class="token operator">&lt;</span>unistd<span class="token punctuation">.</span>h<span class="token operator">&gt;</span>
  <span class="token number">7</span> <span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token number">8</span> <span class="token punctuation">{<!-- --></span>
  <span class="token number">9</span>    <span class="token keyword">int</span> fd<span class="token operator">=</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">"write.txt"</span><span class="token punctuation">,</span>O_WRONLY<span class="token operator">|</span>O_CREAT<span class="token punctuation">,</span><span class="token number">0664</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token number">10</span>    <span class="token keyword">if</span><span class="token punctuation">(</span>fd<span class="token operator">&lt;</span><span class="token number">0</span><span class="token punctuation">)</span>
 <span class="token number">11</span>    <span class="token punctuation">{<!-- --></span>
 <span class="token number">12</span>        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"open error"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token number">13</span>        <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>                                                                                                                                                                      
 <span class="token number">14</span>    <span class="token punctuation">}</span>                                    
 <span class="token number">15</span>    <span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span>str<span class="token operator">=</span><span class="token string">"hello Linux\n"</span><span class="token punctuation">;</span>      
 <span class="token number">16</span>    <span class="token function">write</span><span class="token punctuation">(</span>fd<span class="token punctuation">,</span>str<span class="token punctuation">,</span><span class="token function">strlen</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>           
 <span class="token number">17</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%d\n"</span><span class="token punctuation">,</span>fd<span class="token punctuation">)</span><span class="token punctuation">;</span>                   
 <span class="token number">18</span>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>                            
 <span class="token number">19</span> <span class="token punctuation">}</span> 
</code></pre> 
<p><img src="https://images2.imgbox.com/d7/ac/YS0lAhWi_o.png" alt="在这里插入图片描述"><br> 这里的O_WRONLY会在文件有内容的情况下隐式的清空我们的文件。还有一个O_TRUNC显式清空，我们这里试一下。<br> <img src="https://images2.imgbox.com/3b/36/kwu1oVau_o.png" alt="在这里插入图片描述"><br> 与之相对的，是O_APPEND 追加。</p> 
<pre><code class="prism language-c"> <span class="token number">1</span> #include<span class="token operator">&lt;</span>stdio<span class="token punctuation">.</span>h<span class="token operator">&gt;</span>
  <span class="token number">2</span> #include<span class="token operator">&lt;</span>sys<span class="token operator">/</span>stat<span class="token punctuation">.</span>h<span class="token operator">&gt;</span>
  <span class="token number">3</span> #include<span class="token operator">&lt;</span>sys<span class="token operator">/</span>types<span class="token punctuation">.</span>h<span class="token operator">&gt;</span>
  <span class="token number">4</span> #include<span class="token operator">&lt;</span>fcntl<span class="token punctuation">.</span>h<span class="token operator">&gt;</span>
  <span class="token number">5</span> #include<span class="token operator">&lt;</span>string<span class="token punctuation">.</span>h<span class="token operator">&gt;</span>
  <span class="token number">6</span> #include<span class="token operator">&lt;</span>unistd<span class="token punctuation">.</span>h<span class="token operator">&gt;</span>
  <span class="token number">7</span> <span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token number">8</span> <span class="token punctuation">{<!-- --></span>
  <span class="token number">9</span>   <span class="token comment">// int fd=open("write.txt",O_WRONLY|O_CREAT,0664);</span>
 <span class="token number">10</span>   <span class="token comment">// int fd=open("write.txt",O_WRONLY|O_CREAT|O_TRUNC,0664);</span>
 <span class="token number">11</span> 
 <span class="token number">12</span>    <span class="token keyword">int</span> fd<span class="token operator">=</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">"write.txt"</span><span class="token punctuation">,</span>O_WRONLY<span class="token operator">|</span>O_CREAT<span class="token operator">|</span>O_APPEND<span class="token punctuation">,</span><span class="token number">0664</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token number">13</span>    <span class="token keyword">if</span><span class="token punctuation">(</span>fd<span class="token operator">&lt;</span><span class="token number">0</span><span class="token punctuation">)</span>
 <span class="token number">14</span>    <span class="token punctuation">{<!-- --></span>
 <span class="token number">15</span>        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"open error"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token number">16</span>        <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
 <span class="token number">17</span>    <span class="token punctuation">}</span>
 <span class="token number">18</span>     <span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span>str<span class="token operator">=</span><span class="token string">"hello Linux\n"</span><span class="token punctuation">;</span>
 <span class="token number">19</span>     <span class="token function">write</span><span class="token punctuation">(</span>fd<span class="token punctuation">,</span>str<span class="token punctuation">,</span><span class="token function">strlen</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token number">20</span>     <span class="token function">close</span><span class="token punctuation">(</span>fd<span class="token punctuation">)</span><span class="token punctuation">;</span>                                                                                                                                                                        
 <span class="token number">21</span> <span class="token comment">//   printf("%d\n",fd);</span>
 <span class="token number">22</span>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
 <span class="token number">23</span> <span class="token punctuation">}</span>
<span class="token operator">~</span>

</code></pre> 
<p>执行三次后，有三个hello Linux被写入</p> 
<p><img src="https://images2.imgbox.com/4e/4c/SpihICWj_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="_156"></a>文件描述符。</h2> 
<p><img src="https://images2.imgbox.com/33/9a/mVnrYss6_o.png" alt="在这里插入图片描述"><br> 看第一次验证打开文件时open()函数的返回值为3，这里怎么理解它呢？<br> <img src="https://images2.imgbox.com/9c/f5/jqTf5LjB_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/af/7b/JpYx6d5X_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="Linux_161"></a>如何理解Linux下一切皆文件</h3> 
<p><img src="https://images2.imgbox.com/ad/2f/iNM1HnS8_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/58/fa/B3YRNIIe_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_166"></a>文件描述符的分配规则</h3> 
<p><strong>默认从小到大进行分配</strong></p> 
<pre><code class="prism language-c">  <span class="token number">1</span> #include<span class="token operator">&lt;</span>stdio<span class="token punctuation">.</span>h<span class="token operator">&gt;</span>
  <span class="token number">2</span> #include<span class="token operator">&lt;</span>sys<span class="token operator">/</span>stat<span class="token punctuation">.</span>h<span class="token operator">&gt;</span>
  <span class="token number">3</span> #include<span class="token operator">&lt;</span>sys<span class="token operator">/</span>types<span class="token punctuation">.</span>h<span class="token operator">&gt;</span>
  <span class="token number">4</span> #include<span class="token operator">&lt;</span>fcntl<span class="token punctuation">.</span>h<span class="token operator">&gt;</span>
  <span class="token number">5</span> #include<span class="token operator">&lt;</span>string<span class="token punctuation">.</span>h<span class="token operator">&gt;</span>
  <span class="token number">6</span> #include<span class="token operator">&lt;</span>unistd<span class="token punctuation">.</span>h<span class="token operator">&gt;</span>
  <span class="token number">7</span> <span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token number">8</span> <span class="token punctuation">{<!-- --></span>
  <span class="token number">9</span>   <span class="token comment">// int fd=open("write.txt",O_WRONLY|O_CREAT,0664);</span>
 <span class="token number">10</span>   <span class="token comment">// int fd=open("write.txt",O_WRONLY|O_CREAT|O_TRUNC,0664);</span>
 <span class="token number">11</span> 
 <span class="token number">12</span>    <span class="token function">close</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                                                                                                                                                                          
 <span class="token number">13</span>    <span class="token keyword">int</span> fd<span class="token operator">=</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">"write.txt"</span><span class="token punctuation">,</span>O_WRONLY<span class="token operator">|</span>O_CREAT<span class="token operator">|</span>O_APPEND<span class="token punctuation">,</span><span class="token number">0664</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token number">14</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%d\n"</span><span class="token punctuation">,</span>fd<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token number">15</span>    <span class="token keyword">int</span> fd1<span class="token operator">=</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">"a.txt"</span><span class="token punctuation">,</span>O_CREAT<span class="token operator">|</span>O_WRONLY<span class="token punctuation">,</span><span class="token number">0664</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token number">16</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%d\n"</span><span class="token punctuation">,</span>fd1<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token number">17</span>    <span class="token keyword">int</span> fd2<span class="token operator">=</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">"b.txt"</span><span class="token punctuation">,</span>O_CREAT<span class="token operator">|</span>O_WRONLY<span class="token punctuation">,</span><span class="token number">0664</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token number">18</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%d\n"</span><span class="token punctuation">,</span>fd2<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token number">19</span>    <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token number">20</span>    <span class="token keyword">int</span> fd3<span class="token operator">=</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">"c.txt"</span><span class="token punctuation">,</span>O_CREAT<span class="token operator">|</span>O_WRONLY<span class="token punctuation">,</span><span class="token number">0664</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token number">21</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%d\n"</span><span class="token punctuation">,</span>fd3<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token number">22</span>    <span class="token comment">//if(fd&lt;0)</span>
 <span class="token number">23</span>    <span class="token comment">//{<!-- --></span>
 <span class="token number">24</span>    <span class="token comment">//    printf("open error");</span>
 <span class="token number">25</span>    <span class="token comment">//    return 1;</span>
 <span class="token number">26</span>    <span class="token comment">//}</span>
 <span class="token number">27</span>    <span class="token comment">// const char*str="hello Linux\n";</span>
 <span class="token number">28</span>    <span class="token comment">// write(fd,str,strlen(str));</span>
 <span class="token number">29</span>    <span class="token comment">// close(fd);</span>
 <span class="token number">30</span> <span class="token comment">// //  printf("%d\n",fd);</span>
 <span class="token number">31</span>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
 <span class="token number">32</span> <span class="token punctuation">}</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/00/8f/6Ee3NmAb_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/bd/e2/FrgOaNNO_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="FILE_205"></a>文件流指针FILE*与文件描述符的区别</h3> 
<p><img src="https://images2.imgbox.com/bb/ef/Dz4xtnvC_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="_209"></a>重定向</h2> 
<p>把原本所要显示到当前文件中的内容输出到别的文件中去。<br> <img src="https://images2.imgbox.com/72/bb/pykBWiLP_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_213"></a>普通重定向</h3> 
<p>通俗的说，就是每次在重定向之前，若文件存在则清空该文件，然后执行写入，若不存在，则先创建文件，然后执行写入操作。<br> 使用函数：<br> <img src="https://images2.imgbox.com/84/10/ZSM1jPuB_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-c">  <span class="token number">1</span> #include<span class="token operator">&lt;</span>stdio<span class="token punctuation">.</span>h<span class="token operator">&gt;</span>
  <span class="token number">2</span> #include<span class="token operator">&lt;</span>sys<span class="token operator">/</span>types<span class="token punctuation">.</span>h<span class="token operator">&gt;</span>
  <span class="token number">3</span> #include<span class="token operator">&lt;</span>sys<span class="token operator">/</span>stat<span class="token punctuation">.</span>h<span class="token operator">&gt;</span>
  <span class="token number">4</span> #include<span class="token operator">&lt;</span>fcntl<span class="token punctuation">.</span>h<span class="token operator">&gt;</span>
  <span class="token number">5</span> #include<span class="token operator">&lt;</span>unistd<span class="token punctuation">.</span>h<span class="token operator">&gt;</span>
  <span class="token number">6</span> <span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token number">7</span> <span class="token punctuation">{<!-- --></span>
  <span class="token number">8</span>     <span class="token keyword">int</span> fd<span class="token operator">=</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">"redirect.txt"</span><span class="token punctuation">,</span>O_CREAT<span class="token operator">|</span>O_WRONLY<span class="token operator">|</span>O_TRUNC<span class="token punctuation">,</span><span class="token number">0664</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token number">9</span>     <span class="token keyword">if</span><span class="token punctuation">(</span>fd<span class="token operator">&lt;</span><span class="token number">0</span><span class="token punctuation">)</span>
 <span class="token number">10</span>     <span class="token punctuation">{<!-- --></span>
 <span class="token number">11</span>         <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"open failed"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token number">12</span>         <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
 <span class="token number">13</span>     <span class="token punctuation">}</span>
 <span class="token number">14</span>     <span class="token function">dup2</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token number">15</span>     <span class="token function">close</span><span class="token punctuation">(</span>fd<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token number">16</span>     <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"hello Linux\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token number">17</span>     <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"hello young man\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token number">18</span>     <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"hello oc\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token number">19</span>     <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>                                                                                                                                                                         
 <span class="token number">20</span> <span class="token punctuation">}</span>
 <span class="token number">21</span> 

</code></pre> 
<p><img src="https://images2.imgbox.com/d0/76/xeOyksnq_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_246"></a>追加重定向</h3> 
<p>与普通重定向相比来说，其类似于就是文件的追加，不清空文件。<br> <img src="https://images2.imgbox.com/47/95/R07kJY9A_o.png" alt="在这里插入图片描述"><br> <strong>相对于普通重定向来说，我们只需要将其的打开文件的方式由O_TRUNC变为O_APPEND 即可</strong></p> 
<pre><code class="prism language-c">  <span class="token number">1</span> #include<span class="token operator">&lt;</span>stdio<span class="token punctuation">.</span>h<span class="token operator">&gt;</span>
  <span class="token number">2</span> #include<span class="token operator">&lt;</span>sys<span class="token operator">/</span>types<span class="token punctuation">.</span>h<span class="token operator">&gt;</span>
  <span class="token number">3</span> #include<span class="token operator">&lt;</span>sys<span class="token operator">/</span>stat<span class="token punctuation">.</span>h<span class="token operator">&gt;</span>
  <span class="token number">4</span> #include<span class="token operator">&lt;</span>fcntl<span class="token punctuation">.</span>h<span class="token operator">&gt;</span>
  <span class="token number">5</span> #include<span class="token operator">&lt;</span>unistd<span class="token punctuation">.</span>h<span class="token operator">&gt;</span>
  <span class="token number">6</span> <span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token number">7</span> <span class="token punctuation">{<!-- --></span>
  <span class="token number">8</span>    <span class="token comment">// int fd=open("redirect.txt",O_CREAT|O_WRONLY|O_TRUNC,0664);</span>
  <span class="token number">9</span>     <span class="token keyword">int</span> fd<span class="token operator">=</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">"redirect.txt"</span><span class="token punctuation">,</span>O_CREAT<span class="token operator">|</span>O_WRONLY<span class="token operator">|</span>O_APPEND<span class="token punctuation">,</span><span class="token number">0664</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                                                                                                                       
 <span class="token number">10</span>     <span class="token keyword">if</span><span class="token punctuation">(</span>fd<span class="token operator">&lt;</span><span class="token number">0</span><span class="token punctuation">)</span>
 <span class="token number">11</span>     <span class="token punctuation">{<!-- --></span>
 <span class="token number">12</span>         <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"open failed"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token number">13</span>         <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
 <span class="token number">14</span>     <span class="token punctuation">}</span>
 <span class="token number">15</span>     <span class="token function">dup2</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token number">16</span>     <span class="token function">close</span><span class="token punctuation">(</span>fd<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token number">17</span>     <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"hello Linux\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token number">18</span>     <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"hello young man\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token number">19</span>     <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"hello oc\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token number">20</span>     <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
 <span class="token number">21</span> <span class="token punctuation">}</span>

</code></pre> 
<p><img src="https://images2.imgbox.com/61/c9/l6Mz87oi_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_277"></a>重定向的本质</h3> 
<p>将其stdout文件的指向由之前的指向变为新创建的文件，（通俗点说，要么你关闭掉1号文件，1号文件就是stdout，然后重新打开新文件，则根据文件描述符的分配方式，则会将1分配给新打开的文件，这时候执行程序的话，将本该打印在屏幕上的数据输出到了你新打开的文件。 第二种方式调用dup2(int newfd,int oldfd).<strong>将newfd拷贝给oldfd</strong>，其本质也是更改1号文件的指向。</p> 
<h2><a id="_280"></a>缓冲区</h2> 
<h3><a id="_281"></a>为什么要引入缓冲区？</h3> 
<p>因为cpu的处理速度是远远大于I/O操作的，所以我们再写入或是读取的时候，都会先将写入或者读取的数据放在一块缓冲区内，等cpu执行完后，用户再去取数据，或者用户先写入到缓冲区，然后由cpu直接去读取。<br> 本质：<strong>空间换时间，匹配cpu与I/O差异的情况。</strong></p> 
<h3><a id="_284"></a>缓冲区归属</h3> 
<p>我们在学习C/C++中都听到过缓冲区的概念，那么缓冲区位于什么地方，它到底是属于语言层面的缓冲区还是属于系统层面的缓冲区？</p> 
<pre><code class="prism language-c">  <span class="token number">1</span> #include<span class="token operator">&lt;</span>stdio<span class="token punctuation">.</span>h<span class="token operator">&gt;</span>
  <span class="token number">2</span> #include<span class="token operator">&lt;</span>sys<span class="token operator">/</span>stat<span class="token punctuation">.</span>h<span class="token operator">&gt;</span>
  <span class="token number">3</span> #include<span class="token operator">&lt;</span>sys<span class="token operator">/</span>types<span class="token punctuation">.</span>h<span class="token operator">&gt;</span>
  <span class="token number">4</span> #include<span class="token operator">&lt;</span>fcntl<span class="token punctuation">.</span>h<span class="token operator">&gt;</span>
  <span class="token number">5</span> #include<span class="token operator">&lt;</span>string<span class="token punctuation">.</span>h<span class="token operator">&gt;</span>
  <span class="token number">6</span> #include<span class="token operator">&lt;</span>unistd<span class="token punctuation">.</span>h<span class="token operator">&gt;</span>
  <span class="token number">7</span> <span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token number">8</span> <span class="token punctuation">{<!-- --></span>
  <span class="token number">9</span>     <span class="token function">close</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token number">10</span>     <span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span>str1<span class="token operator">=</span><span class="token string">"hello Linux\n"</span><span class="token punctuation">;</span>
 <span class="token number">11</span>     <span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span>str2<span class="token operator">=</span><span class="token string">"hello world\n"</span><span class="token punctuation">;</span>
 <span class="token number">12</span>     <span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span>str3<span class="token operator">=</span><span class="token string">"hello peter\n"</span><span class="token punctuation">;</span>
 <span class="token number">13</span>     <span class="token keyword">int</span> fd<span class="token operator">=</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">"buf.txt"</span><span class="token punctuation">,</span>O_WRONLY<span class="token operator">|</span>O_CREAT<span class="token operator">|</span>O_APPEND<span class="token punctuation">,</span><span class="token number">0664</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token number">14</span>     <span class="token keyword">if</span><span class="token punctuation">(</span>fd<span class="token operator">&lt;</span><span class="token number">0</span><span class="token punctuation">)</span>
 <span class="token number">15</span>     <span class="token punctuation">{<!-- --></span>
 <span class="token number">16</span>         <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"create err"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token number">17</span>         <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
 <span class="token number">18</span>     <span class="token punctuation">}</span>
 <span class="token number">19</span>     <span class="token function">write</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>str1<span class="token punctuation">,</span><span class="token function">strlen</span><span class="token punctuation">(</span>str1<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                                                                                                                                                       
 <span class="token number">20</span>     <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%s"</span><span class="token punctuation">,</span>str2<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token number">21</span>     <span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stdout</span><span class="token punctuation">,</span><span class="token string">"%s"</span><span class="token punctuation">,</span>str3<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token number">22</span>     <span class="token function">fork</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token number">23</span>     <span class="token function">fflush</span><span class="token punctuation">(</span><span class="token constant">stdout</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token number">24</span>     <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
 <span class="token number">25</span> <span class="token punctuation">}</span>

</code></pre> 
<p>此时在子进程中会被刷新一次，父进程中也会刷新一次。<br> <img src="https://images2.imgbox.com/99/ce/B9KR88CR_o.png" alt="在这里插入图片描述"><br> 原因：<strong>在刷新过程中只对库函数的写入刷新了两次，系统调用只写入一次。</strong></p> 
<h3><a id="_320"></a>常见的缓冲方式</h3> 
<p>1、全缓冲</p> 
<p>在这种情况下，当填满标准I/O缓存后才进行实际I/O操作。全缓冲的典型代表是对磁盘文件的读写。</p> 
<p>2、行缓冲</p> 
<p>在这种情况下，当在输入和输出中遇到换行符时，执行真正的I/O操作。这时，我们输入的字符先存放在缓冲区，等按下回车键换行时才进行实际的I/O操作。典型代表是键盘输入数据。</p> 
<p>3、不带缓冲</p> 
<p>也就是不进行缓冲，标准出错情况stderr是典型代表，这使得出错信息可以直接尽快地显示出来。</p> 
<h2><a id="_332"></a>理解文件系统</h2> 
<p><img src="https://images2.imgbox.com/5d/70/pB6LWWt6_o.png" alt="在这里插入图片描述"><br> 操作系统会将我们的磁盘的管理抽象为对数组的管理。地址映射，根据逻辑地址计算物理地址。<br> <img src="https://images2.imgbox.com/bd/c6/GGk7lui2_o.png" alt="在这里插入图片描述"><br> <strong>Block Group</strong> ：ext2文件系统会根据分区的大小划分为数个Block Group。而每个Block Group都有着相同的结构组成。政府管理各区的例子<br> <strong>超级块（Super Block）</strong>：存放文件系统本身的结构信息。记录的信息主要有：bolck 和 inode的总量，未使用的block和inode的数量，一个block和inode的大小，最近一次挂载的时间，最近一次写入数据的时间，最近一次检验磁盘的时间等其他文件系统的相关信息。Super Block的信息被破坏，可以说整个文件系统结构就被破坏了GDT，<br> <strong>Group Descriptor Table</strong>：块组描述符，描述块组属性信息，有兴趣的可以在了解一下<br> <strong>块位图（Block Bitmap）</strong>：Block Bitmap中记录着Data Block中哪个数据块已经被占用，哪个数据块没有被占用<br> <strong>inode位图（inode Bitmap）</strong>：每个bit表示一个inode是否空闲可用。<br> i节点表:存放文件属性 如 文件大小，所有者，最近修改时间等<br> <strong>数据区</strong>：存放文件内容<br> 位图：<strong>Inode Bitmap：表示该inode有没有被分配出去。这个表标识了有哪些inode被使用，有多少个inode没有被使用。</strong><br> <strong>Block Bitmap：标识了有哪些块已经被使用，哪些块没有被使用。</strong><br> 怎么创建一个文件：首先在inode Bitmap中找到一块未被分配的内存，创建完后再去Block Bitmap中选取相应的内存。<br> 怎么找一个文件：首先确定分区，再查找Inode Bitmap位图找到对应的inode号，接下来根据里面存储的文件所在地方去找文件即可。<br> <strong>问答题：在磁盘容量充足的情况下，创建文件失败，为什么？<br> 这种情况是存在的，因为文件系统自创建起其inode Bitmap 中所能创建的最大的inode 个数已经确定了，此时虽然说你有容量，但是在inode Bitmap这个位图中已经没有多余的空间供你去记录你文件的信息了，所以此时尽管你有空间，你也不能创建文件。</strong><br> 如何理解删除文件？<br> 删除文件是不是将文件删除（物理上的），不是的，因为你会发现你下载的时间可能很长，但删除的时间却很短。为甚么会这样，这是因为在删除时操作系统首先会找到文件，然后将你的文件的inode从inode Bitmap中置0，标识这部分空间没有被使用。相应的，在Block Bitmap中同样的，也会将这文件对应的 data Blocks 从位图中置0。这样在肉眼上你确实看到你文件不见了，同时磁盘可用容量也变多了。<br> 如何恢复删除的文件？<br> 在没有文件覆盖删除文件的inode的情况下，我们可以去inode Table中去查找，其中仍然记录着与data Block 之间的映射关系，此时去找的话我们就可以找到对应的块。本质便是先将它里面的inode Bitmap 中的inode置为1，然后通过映射关系将其data Block对应的 Block Bitmap 置为1。</p> 
<h3><a id="_353"></a>理解目录</h3> 
<p>目录也是文件=inode+数据块（文件名：inode id）<br> 理解ls命令：</p> 
<p><img src="https://images2.imgbox.com/90/ae/nasmH4Di_o.png" alt="在这里插入图片描述"><br> 理解ls -al<br> <img src="https://images2.imgbox.com/26/91/AwbzmzZL_o.png" alt="在这里插入图片描述"><br> 通过ls -i查看对应关系。<br> <img src="https://images2.imgbox.com/b3/f3/TVvPF9tP_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="_362"></a>软硬链接</h2> 
<h3><a id="_363"></a>软链接</h3> 
<p>软链接又称之为符号连接（Symbolic Link）。软链接文件类似于Windows的快捷方式。它实际上是一个<strong>特殊的文件</strong>。在符号连接中，文件实际上是一个文本文件，<strong>其中包含的有另一文件的位置信息</strong>。</p> 
<h4><a id="_365"></a>软链接文件的特性</h4> 
<p>生成软链接文件： ln -s 源文件名 生成文件名<br> <img src="https://images2.imgbox.com/5c/a8/vUj0L7XJ_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/db/88/dJpM3qRX_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_370"></a>软链接的使用</h4> 
<p><strong>1.作为启动程序的快捷方式</strong><br> 首先创建一个软链接文件<br> <img src="https://images2.imgbox.com/56/8b/EEh7grFk_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-c">  <span class="token number">1</span> #include<span class="token operator">&lt;</span>stdio<span class="token punctuation">.</span>h<span class="token operator">&gt;</span>
  <span class="token number">2</span> <span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token number">3</span> <span class="token punctuation">{<!-- --></span>
  <span class="token number">4</span>     <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"hello Linix\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token number">5</span>     <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>                                                                                                                                                                         
  <span class="token number">6</span> <span class="token punctuation">}</span>


</code></pre> 
<h4><a id="_386"></a>软链接的使用注意</h4> 
<p>1.软链接文件会随着源文件的修改在变<br> 2.<img src="https://images2.imgbox.com/24/6d/tBb7NDjH_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_391"></a>硬链接</h3> 
<p>语法：<br> ln 源文件 硬链接文件<br> <img src="https://images2.imgbox.com/cc/ad/utDtuMUX_o.png" alt="在这里插入图片描述"><br> 如上图可以看到<strong>硬链接文件不是一个独立的文件</strong>。因为硬链接文件没有独立的inode。</p> 
<h4><a id="_396"></a>硬链接的使用</h4> 
<p>类似于windows下的重命名，重命名可以看作是先生成一个硬链接文件，然后删除源文件，则这个硬链接文件便是 重命名之后的文件。</p> 
<h4><a id="ll_398"></a>理解ll命令</h4> 
<p><img src="https://images2.imgbox.com/b5/a6/8uiUVAkr_o.png" alt="在这里插入图片描述"><br> 1.模式<br> 2.硬链接数<br> 3.文件所有者<br> 4.组<br> 5.大小<br> 6.最后修改时间<br> 7.文件名<br> <img src="https://images2.imgbox.com/f7/43/h9IM10nW_o.png" alt="在这里插入图片描述"><br> 软硬链接的区别是软链接具有独立的inode，硬链接与链接文件共有一个inode。</p> 
<h2><a id="_409"></a>动静态库</h2> 
<h3><a id="_410"></a>静态链接与动态链接生成可执行文件</h3> 
<p>测试用例：</p> 
<p><img src="https://images2.imgbox.com/a0/22/WHM9gr4G_o.png" alt="在这里插入图片描述"><br> makefile文件</p> 
<pre><code class="prism language-c">  <span class="token number">1</span> all<span class="token punctuation">:</span>test teststatic
  <span class="token number">2</span> test<span class="token punctuation">:</span>test<span class="token punctuation">.</span>c
  <span class="token number">3</span>     gcc $<span class="token operator">^</span> <span class="token operator">-</span>o $@ 
  <span class="token number">4</span> teststatic<span class="token punctuation">:</span>teststatic<span class="token punctuation">.</span>c
  <span class="token number">5</span>     gcc $<span class="token operator">^</span> <span class="token operator">-</span>o $@ <span class="token operator">-</span><span class="token keyword">static</span>
  <span class="token number">6</span> <span class="token punctuation">.</span>PHONY<span class="token punctuation">:</span>clean
  <span class="token number">7</span> clean<span class="token punctuation">:</span>
  <span class="token number">8</span>     rm test teststatic    
</code></pre> 
<p><img src="https://images2.imgbox.com/68/c9/umaQh0Ez_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/65/7e/Gdsjcb6x_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_430"></a>为什么推荐使用动态链接</h4> 
<p>1.因为静态链接会将程序所依赖的库文件链接在可执行文件之中，假如你有一个程序无所谓，但是假如你有上百上千个文件的话，浪费了内存和磁盘空间。<br> 2.静态库的模块更新困难，假如说你现在将一个静态库链接到了一个文件中，此时如果这个库需要更新的话，那岂不是你又要重新进行编译链接，再生成可执行程序。而动态库可以规避这种问题，假如你动态库变了，我只在运行程序的过程中去找依赖的库，只要你仍存在，我照样可以用。</p> 
<h4><a id="_433"></a>动态链接实现本质</h4> 
<p><img src="https://images2.imgbox.com/c3/f2/n3d4dVrV_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_435"></a>动态链接与静态链接优缺点</h4> 
<p>动态链接：<br> 优点：体积小，模块更新比较容易。<br> 缺点：依赖第三方库，可移植性相对静态链接可执行文件差<br> 静态链接：<br> 优点：不依赖第三方库，可执行程序的移植性强。<br> 缺点：体积大，模块更新较难，需要重新将依赖的库链接在可执行文件。</p> 
<h2><a id="_442"></a>实现动静态库</h2> 
<h3><a id="_443"></a>静态库</h3> 
<h4><a id="_444"></a>生成静态库</h4> 
<p>.h文件<br> <img src="https://images2.imgbox.com/79/81/mNqZQRno_o.png" alt="在这里插入图片描述"><br> .c 文件<br> <img src="https://images2.imgbox.com/94/6e/pZNuOcx5_o.png" alt="在这里插入图片描述"><br> makefile<br> <img src="https://images2.imgbox.com/82/f6/rIZwGESA_o.png" alt="在这里插入图片描述"></p> 
<p>生成静态库文件<br> <img src="https://images2.imgbox.com/e8/a3/5aQ4LNsE_o.png" alt="在这里插入图片描述"><br> <strong>ar是gnu归档工具，rc表示(replace and create)</strong></p> 
<h4><a id="_455"></a>静态库的使用</h4> 
<p><img src="https://images2.imgbox.com/ee/9a/ZurDa871_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/24/a3/LVanRxMi_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/76/40/x23AgC1G_o.png" alt="在这里插入图片描述"><br> 注：库名字是要去掉前缀lib 和后缀.a的<br> 运行结果：<br> <img src="https://images2.imgbox.com/b7/0f/S7LRcyJQ_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_463"></a>动态库</h3> 
<h4><a id="_464"></a>动态库的生成</h4> 
<p>源文件与上面静态库文件相同<br> makefile文件<br> <img src="https://images2.imgbox.com/f3/6a/RYaGSNeN_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/1f/4a/oWaWcGY1_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/01/43/tj62ZGWe_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_470"></a>测试动态库</h4> 
<p>测试文件<br> test.c文件</p> 
<pre><code class="prism language-c">   <span class="token number">1</span> #include<span class="token operator">&lt;</span>stdio<span class="token punctuation">.</span>h<span class="token operator">&gt;</span>
E<span class="token operator">&gt;</span>  <span class="token number">2</span> #include<span class="token string">"add.h"</span>
E<span class="token operator">&gt;</span>  <span class="token number">3</span> #include<span class="token string">"sub.h"</span>
    <span class="token number">4</span> <span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token number">5</span> <span class="token punctuation">{<!-- --></span>
    <span class="token number">6</span>     <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"welcome to my dynamic test\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token number">7</span>     <span class="token keyword">int</span> x<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">;</span>
    <span class="token number">8</span>     <span class="token keyword">int</span> y<span class="token operator">=</span><span class="token number">20</span><span class="token punctuation">;</span>
E<span class="token operator">&gt;</span>  <span class="token number">9</span>     <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"add result is %d\n"</span><span class="token punctuation">,</span><span class="token function">add</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span>y<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
E<span class="token operator">&gt;</span> <span class="token number">10</span>     <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"sub result is %d\n"</span><span class="token punctuation">,</span><span class="token function">sub</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span>y<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                                                                                                                                          
   <span class="token number">11</span>     <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
   <span class="token number">12</span> <span class="token punctuation">}</span>
  <span class="token operator">~</span>

</code></pre> 
<p>makefile<br> <img src="https://images2.imgbox.com/13/f5/gUwtITQC_o.png" alt="在这里插入图片描述"><br> 编译+运行<br> <img src="https://images2.imgbox.com/b9/f3/8wv7wJge_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/fa/71/MUlxGlKz_o.png" alt="在这里插入图片描述"></p> 
<p>解决方法：<br> 1、拷贝.so文件到系统共享库路径下, 一般指/usr/lib （不推荐），会污染库文件<br> 2.更改 LD_LIBRARY_PATH（推荐）<br> <img src="https://images2.imgbox.com/ee/b5/BKyqn0cU_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/26/3c/6HnVYZbw_o.png" alt="在这里插入图片描述"><br> 3.将动态库放在可执行程序路径下。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/614b0797dd14185387d11fef87e23582/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">九种常用的UML图总结</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/d96241689e2755ea55e9f7c03df6b743/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">python_urllib.request.urlretrieve使用方法</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 追风少年的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>