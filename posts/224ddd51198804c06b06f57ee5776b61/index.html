<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>mysql的主从同步和分库分表 - 追风少年的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="mysql的主从同步和分库分表" />
<meta property="og:description" content="mysql的主从同步：
mysql主服务器：10.128.199.232
mysql从服务器：10.128.199.233 数据库mycat_test 主服务器my.ini配置，在文件末尾添加： server-id = 1 log-bin = mysql-bin binlog-do-db = mycat_test replicate-do-db = mycat_test 从服务器my.ini配置，在文件末尾添加： server_id = 2 binlog-do-db = mycat_test log_bin = mysql-bin log_slave_updates = 1 read_only = 1 在主服务器执行以下命令： grant replication slave, replication client on *.* to &#39;repl&#39;@&#39;10.128.199.233&#39; identified by &#39;123&#39;; 输入命令SHOW MASTER STATUS; 记录下file和position(mysql-bin.000027、2698) 在从服务器执行以下命令： CHANGE MASTER TO MASTER_HOST=&#39;10.128.199.232&#39;,MASTER_USER=&#39;repl&#39;,MASTER_PASSWORD=&#39;123&#39;,MASTER_LOG_FILE=&#39;mysql-bin.000027&#39;,MASTER_LOG_POS=2698; 输入命令start slave开启复制 输入命令show slave status查看slave状态 在master、slave上建立结构相同的table，在主服务器上执行增删改查操作，从服务器也会进行相对应的操作，保持数据的一致性。 mycat的分库分表：
安装完mycat后，首先修改修改config目录下的server.xml文件
&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;&lt;!-- - - Licensed under the Apache License, Version 2." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://zhuifengsn.github.io/posts/224ddd51198804c06b06f57ee5776b61/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2016-11-29T17:07:14+08:00" />
<meta property="article:modified_time" content="2016-11-29T17:07:14+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="追风少年的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">追风少年的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">mysql的主从同步和分库分表</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p><strong><span style="font-size:18px">mysql的主从同步：</span></strong></p> 
<p>mysql主服务器：10.128.199.232</p> mysql从服务器：10.128.199.233 
<br> 数据库mycat_test 
<br> 
<br> 
<br> 主服务器my.ini配置，在文件末尾添加： 
<br> server-id = 1 
<br> log-bin = mysql-bin 
<br> binlog-do-db = mycat_test 
<br> replicate-do-db = mycat_test 
<br> 
<br> 
<br> 从服务器my.ini配置，在文件末尾添加： 
<br> server_id = 2 
<br> binlog-do-db = mycat_test 
<br> log_bin = mysql-bin    
<br> log_slave_updates = 1   
<br> read_only = 1 
<br> 
<br> 
<br> 在主服务器执行以下命令： 
<br> grant replication slave, replication client on *.* to 'repl'@'10.128.199.233' identified by '123'; 
<br> 输入命令SHOW MASTER STATUS; 
<br> 记录下file和position(mysql-bin.000027、2698) 
<br> 
<br> 
<br> 在从服务器执行以下命令： 
<br> CHANGE MASTER TO MASTER_HOST='10.128.199.232',MASTER_USER='repl',MASTER_PASSWORD='123',MASTER_LOG_FILE='mysql-bin.000027',MASTER_LOG_POS=2698; 
<br> 输入命令start slave开启复制 
<br> 输入命令show slave status查看slave状态 
<br> 
<br> 
<br> 在master、slave上建立结构相同的table，在主服务器上执行增删改查操作，从服务器也会进行相对应的操作，保持数据的一致性。 
<br> 
<br> 
<p><strong><span style="font-size:18px">mycat的分库分表：</span></strong></p> 
<p><span style="font-size:10px">安装完mycat后，首先修改修改config目录下的server.xml文件</span></p> 
<p><span style="font-size:10px"></span></p> 
<pre><code class="language-html">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;!-- - - Licensed under the Apache License, Version 2.0 (the "License"); 
<span style="white-space:pre">	</span>- you may not use this file except in compliance with the License. - You 
<span style="white-space:pre">	</span>may obtain a copy of the License at - - http://www.apache.org/licenses/LICENSE-2.0 
<span style="white-space:pre">	</span>- - Unless required by applicable law or agreed to in writing, software - 
<span style="white-space:pre">	</span>distributed under the License is distributed on an "AS IS" BASIS, - WITHOUT 
<span style="white-space:pre">	</span>WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. - See the 
<span style="white-space:pre">	</span>License for the specific language governing permissions and - limitations 
<span style="white-space:pre">	</span>under the License. --&gt;
&lt;!DOCTYPE mycat:server SYSTEM "server.dtd"&gt;
&lt;mycat:server xmlns:mycat="http://org.opencloudb/"&gt;
<span style="white-space:pre">	</span>&lt;system&gt;
<span style="white-space:pre">	</span>&lt;property name="defaultSqlParser"&gt;druidparser&lt;/property&gt;
<span style="white-space:pre">	</span>&lt;property name="sequnceHandlerType"&gt;0&lt;/property&gt;
      &lt;!--  &lt;property name="useCompression"&gt;1&lt;/property&gt;--&gt; &lt;!--1为开启mysql压缩协议--&gt;
<span style="white-space:pre">	</span>&lt;!-- &lt;property name="processorBufferChunk"&gt;40960&lt;/property&gt; --&gt;
<span style="white-space:pre">	</span>&lt;!-- 
<span style="white-space:pre">	</span>&lt;property name="processors"&gt;1&lt;/property&gt; 
<span style="white-space:pre">	</span>&lt;property name="processorExecutor"&gt;32&lt;/property&gt; 
<span style="white-space:pre">	</span> --&gt;
<span style="white-space:pre">		</span>&lt;!--默认是65535 64K 用于sql解析时最大文本长度 --&gt;
<span style="white-space:pre">		</span>&lt;!--&lt;property name="maxStringLiteralLength"&gt;65535&lt;/property&gt;--&gt;
<span style="white-space:pre">		</span>&lt;!--&lt;property name="sequnceHandlerType"&gt;0&lt;/property&gt;--&gt;
<span style="white-space:pre">		</span>&lt;!--&lt;property name="backSocketNoDelay"&gt;1&lt;/property&gt;--&gt;
<span style="white-space:pre">		</span>&lt;!--&lt;property name="frontSocketNoDelay"&gt;1&lt;/property&gt;--&gt;
<span style="white-space:pre">		</span>&lt;!--&lt;property name="processorExecutor"&gt;16&lt;/property&gt;--&gt;
<span style="white-space:pre">		</span>&lt;!-- 
<span style="white-space:pre">			</span>&lt;property name="mutiNodeLimitType"&gt;1&lt;/property&gt; 0：开启小数量级（默认） ；1：开启亿级数据排序
<span style="white-space:pre">	</span>    <span style="white-space:pre">	</span>&lt;property name="mutiNodePatchSize"&gt;100&lt;/property&gt; 亿级数量排序批量
<span style="white-space:pre">			</span>&lt;property name="processors"&gt;32&lt;/property&gt; &lt;property name="processorExecutor"&gt;32&lt;/property&gt; 
<span style="white-space:pre">			</span>&lt;property name="serverPort"&gt;8066&lt;/property&gt; &lt;property name="managerPort"&gt;9066&lt;/property&gt; 
<span style="white-space:pre">			</span>&lt;property name="idleTimeout"&gt;300000&lt;/property&gt; &lt;property name="bindIp"&gt;0.0.0.0&lt;/property&gt; 
<span style="white-space:pre">			</span>&lt;property name="frontWriteQueueSize"&gt;4096&lt;/property&gt; &lt;property name="processors"&gt;32&lt;/property&gt; --&gt;
<span style="white-space:pre">	</span>&lt;/system&gt;
<span style="white-space:pre">	</span>&lt;user name="furonge"&gt;  
        &lt;property name="password"&gt;12345678&lt;/property&gt;  
        &lt;property name="schemas"&gt;P2P&lt;/property&gt;  
    &lt;/user&gt; 


<span style="white-space:pre">	</span>&lt;!-- &lt;cluster&gt; &lt;node name="cobar1"&gt; &lt;property name="host"&gt;127.0.0.1&lt;/property&gt; 
<span style="white-space:pre">		</span>&lt;property name="weight"&gt;1&lt;/property&gt; &lt;/node&gt; &lt;/cluster&gt; --&gt;
<span style="white-space:pre">	</span>&lt;!-- &lt;quarantine&gt; &lt;host name="1.2.3.4"&gt; &lt;property name="user"&gt;test&lt;/property&gt; 
<span style="white-space:pre">		</span>&lt;/host&gt; &lt;/quarantine&gt; --&gt;


&lt;/mycat:server&gt;</code></pre> 
<p></p> 
<p>修改rule.xml文件，配置分库规则<span style="white-space:pre"> </span></p> 
<pre><code class="language-html">&lt;tableRule name="mod-long"&gt;
		&lt;rule&gt;
			&lt;columns&gt;id&lt;/columns&gt;
			&lt;algorithm&gt;mod-long&lt;/algorithm&gt;
		&lt;/rule&gt;
	&lt;/tableRule&gt;
	&lt;function name="mod-long" class="org.opencloudb.route.function.PartitionByMod"&gt;
		&lt;!-- how many data nodes --&gt;
		&lt;property name="count"&gt;2&lt;/property&gt;
	&lt;/function&gt;</code></pre> 
<p>修改schema.xml文件，进行分库分表配置：</p> 
<p></p> 
<pre><code class="language-html">&lt;?xml version="1.0"?&gt;
&lt;!DOCTYPE mycat:schema SYSTEM "schema.dtd"&gt;
&lt;mycat:schema&gt;


<span style="white-space:pre">	</span>&lt;schema name="P2P" checkSQLschema="true" sqlMaxLimit="100"&gt;
      &lt;table name="fu_users" primaryKey="user_id" dataNode="dn1,dn2" rule="mod-long" /&gt;
      &lt;table name="fu_admin" primaryKey="admin_id" dataNode="dn1" /&gt;
      &lt;table name="fu_apply_recover" primaryKey="id" dataNode="dn1" /&gt; 
      &lt;table name="fu_apply_repay" primaryKey="id" dataNode="dn1" /&gt; 
      &lt;table name="fu_auth_code" primaryKey="id" dataNode="dn1" /&gt;
      &lt;table name="fu_loan_apply" primaryKey="id" dataNode="dn1" /&gt;  
      &lt;table name="fu_loan_investment" primaryKey="id" dataNode="dn1" /&gt; 
      &lt;table name="fu_loan_type" primaryKey="id" dataNode="dn1" /&gt; 
      &lt;table name="fu_message" primaryKey="id" dataNode="dn1" /&gt; 
      &lt;table name="fu_popularize" primaryKey="popularize_id" dataNode="dn1" /&gt; 
      &lt;table name="fu_purview" primaryKey="purview_id" dataNode="dn1" /&gt; 
      &lt;table name="fu_role" primaryKey="role_id" dataNode="dn1" /&gt; 
      &lt;table name="fu_role_admin" primaryKey="id" dataNode="dn1" /&gt; 
      &lt;table name="fu_role_purview" primaryKey="id" dataNode="dn1" /&gt; 
      &lt;table name="fu_sidemenu" primaryKey="sidebar_id" dataNode="dn1" /&gt; 
      &lt;table name="fu_site_account" primaryKey="id" dataNode="dn1" /&gt; 
      &lt;table name="fu_site_account_log" primaryKey="id" dataNode="dn1" /&gt; 
      &lt;table name="fu_site_fee" primaryKey="fee_id" dataNode="dn1" /&gt;
      &lt;table name="fu_site_fee_type" primaryKey="charge_type_id" dataNode="dn1" /&gt;
      &lt;table name="fu_token" primaryKey="token_id" dataNode="dn1" /&gt;
      &lt;table name="fu_user_account" primaryKey="id" dataNode="dn1" /&gt;
      &lt;table name="fu_user_account_log" primaryKey="id" dataNode="dn1" /&gt;
      &lt;table name="fu_user_info" primaryKey="id" dataNode="dn1" /&gt;
      &lt;table name="fu_user_job" primaryKey="id" dataNode="dn1" /&gt;
      &lt;table name="fu_user_recharge" primaryKey="recharge_id" dataNode="dn1" /&gt;
      &lt;table name="fu_user_withdrawal" primaryKey="withdrawal_id" dataNode="dn1" /&gt;
      &lt;table name="fu_users_award_log" primaryKey="id" dataNode="dn1" /&gt;
      &lt;table name="fu_users_award_type" primaryKey="id" dataNode="dn1" /&gt;  
  <span style="white-space:pre">	</span>&lt;/schema&gt;


<span style="white-space:pre">	</span>&lt;dataNode name="dn1" dataHost="dataHost1" database="furonge_test" /&gt;   
<span style="white-space:pre">	</span>&lt;dataNode name="dn2" dataHost="dataHost2" database="furonge_test2" /&gt;  


    &lt;dataHost name="dataHost1" maxCon="1000" minCon="10" balance="1"  
        writeType="0" dbType="mysql" dbDriver="native" switchType="1"  slaveThreshold="100"&gt;  
        &lt;heartbeat&gt;select user()&lt;/heartbeat&gt;  
        &lt;writeHost host="hostM1" url="10.128.199.232:3306" user="furonge" password="12345678"&gt;  
        <span style="white-space:pre">	</span>&lt;readHost host="hostR1" url="10.128.199.234:3306" user="mycat-234" password="123"/&gt;
        &lt;/writeHost&gt; 
        &lt;writeHost host="hostS1" url="10.128.199.233:3306" user="mycat-233" password="123"&gt;&lt;/writeHost&gt;
    &lt;/dataHost&gt;


    &lt;dataHost name="dataHost2" maxCon="1000" minCon="10" balance="1"  
        writeType="0" dbType="mysql" dbDriver="native" switchType="1"  slaveThreshold="100"&gt;  
        &lt;heartbeat&gt;select user()&lt;/heartbeat&gt;  
        &lt;writeHost host="hostM1" url="10.128.199.232:3306" user="furonge" password="12345678"&gt;  
        <span style="white-space:pre">	</span>&lt;readHost host="hostR1" url="10.128.199.234:3306" user="mycat-234" password="123"/&gt;
        &lt;/writeHost&gt; 
        &lt;writeHost host="hostS1" url="10.128.199.233:3306" user="mycat-233" password="123"&gt;&lt;/writeHost&gt;
    &lt;/dataHost&gt;
<span style="white-space:pre">	</span>
&lt;/mycat:schema&gt;</code></pre> 
<br> 附： 
<a target="_blank" href="http://download.csdn.net/detail/yds492203171/9696993" rel="noopener noreferrer">mycat1.6文档</a> 
<p></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/2f49501b64116af92da3825e68960393/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">TEST 和 TEST_F 区别</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/4ebd50cbe9a2ef999f05b34a3ee9b4d4/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">C&#43;&#43;函数返回引用</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 追风少年的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>