<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Mybatis&#43;Collection一对多表查询踩坑 - 追风少年的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Mybatis&#43;Collection一对多表查询踩坑" />
<meta property="og:description" content="Mybatis&#43;Collection一对多表查询踩坑 需求思考解决方案实现方法MyBatis关联查询一对一association查询一对多collection查询坑1坑2 需求 自己写的springboot项目中有这样一个需求：
将简历模板映射到数据库中。
思考 简历模板包含多个属性，每个属性又有多个条目，比如个人上学经历，有小学，初中，高中，大学等多个条目，如果把这些全部都存到一个表里就不那么好。
解决方案 将简历表作为主表，将简历中包含的属性作为从表，这样就形成了主从表的结构。
实现方法 现在需要的是后端从数据库中将简历模板信息拿到，就涉及到了主从表查询，这里介绍MyBatis的关联查询
MyBatis关联查询 一对一association查询 很简单，就是一对多的简易版，不多赘述。主要讲collection查询。
一对多collection查询 一：建主从表的实体类
其中lev1Entity是主表其他都是从表
二：需要将从表作为一个属性单独的加到主表实体类中
三：接下来就要用到collection查询了
首先需要将collection作为返回写到resultmap中
注意resultmap的type和id等属性。
四：然后就写select查询即可
五：查询到的结果如下：
前面的主表内容相同，后面是一个从表的两个条目，查询结果是分开的，但是MyBatis根据一定规则将他们自动映射到数据集List中，合并为一条数据，这也就有了下面的坑：
坑1 坑1：注意这里select的返回类型需要是resultmap对应上面返回结果的resultmap类型，不能是resulttype，否则查询到的多条结果将不会合并到list’中，这里是一个注意点。
坑2 坑2：坑2是因为一个collection只能多一个sql查询，而我需要一个主表对应多个从表，就需要多个collection查询，select语句前面贴图已经有了，但是我遇到的问题是他们始终合并不了，类似于笛卡尔积，会多出许多重复的条目
原因：
原因是MyBatis中进行结果映射时是用数据库的列名进行查询的，这时如果多个表存在相同的字段名时，他们就会重复，不会合并，这是MyBatis这里的规则。
解决方案一：select查询时用别名查询
解决方案二：修改数据库中没有相同的字段名即可。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://zhuifengsn.github.io/posts/0dd3a38bf127cbd3164057b4ebfa253f/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-05-19T18:08:01+08:00" />
<meta property="article:modified_time" content="2022-05-19T18:08:01+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="追风少年的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">追风少年的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Mybatis&#43;Collection一对多表查询踩坑</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>Mybatis+Collection一对多表查询踩坑</h4> 
 <ul><li><a href="#_3" rel="nofollow">需求</a></li><li><a href="#_6" rel="nofollow">思考</a></li><li><a href="#_8" rel="nofollow">解决方案</a></li><li><a href="#_10" rel="nofollow">实现方法</a></li><li><a href="#MyBatis_12" rel="nofollow">MyBatis关联查询</a></li><li><ul><li><a href="#association_13" rel="nofollow">一对一association查询</a></li><li><a href="#collection_15" rel="nofollow">一对多collection查询</a></li><li><ul><li><a href="#1_31" rel="nofollow">坑1</a></li><li><a href="#2_33" rel="nofollow">坑2</a></li></ul> 
  </li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h2><a id="_3"></a>需求</h2> 
<p>自己写的springboot项目中有这样一个需求：<br> 将简历模板映射到数据库中。</p> 
<h2><a id="_6"></a>思考</h2> 
<p>简历模板包含多个属性，每个属性又有多个条目，比如个人上学经历，有小学，初中，高中，大学等多个条目，如果把这些全部都存到一个表里就不那么好。</p> 
<h2><a id="_8"></a>解决方案</h2> 
<p>将简历表作为主表，将简历中包含的属性作为从表，这样就形成了主从表的结构。</p> 
<h2><a id="_10"></a>实现方法</h2> 
<p>现在需要的是后端从数据库中将简历模板信息拿到，就涉及到了主从表查询，这里介绍MyBatis的关联查询</p> 
<h2><a id="MyBatis_12"></a>MyBatis关联查询</h2> 
<h3><a id="association_13"></a>一对一association查询</h3> 
<p>很简单，就是一对多的简易版，不多赘述。主要讲collection查询。</p> 
<h3><a id="collection_15"></a>一对多collection查询</h3> 
<p>一：建主从表的实体类<br> <img src="https://images2.imgbox.com/c2/5d/RvvFyoqr_o.png" alt="在这里插入图片描述"><br> 其中lev1Entity是主表其他都是从表<br> 二：需要将从表作为一个属性单独的加到主表实体类中<br> <img src="https://images2.imgbox.com/fa/bf/SO5EUEkY_o.png" alt="在这里插入图片描述"><br> 三：接下来就要用到collection查询了<br> 首先需要将collection作为返回写到resultmap中<br> <img src="https://images2.imgbox.com/cc/10/aFx13Bav_o.png" alt="在这里插入图片描述"><br> <strong>注意resultmap的type和id等属性。</strong><br> 四：然后就写select查询即可<br> <img src="https://images2.imgbox.com/97/b0/S8o35nsc_o.png" alt="在这里插入图片描述"><br> 五：查询到的结果如下：<br> <img src="https://images2.imgbox.com/11/27/gaeEzGy6_o.png" alt="在这里插入图片描述"><br> 前面的主表内容相同，后面是一个从表的两个条目，查询结果是分开的，但是MyBatis根据一定规则将他们自动映射到数据集List中，合并为一条数据，这也就有了下面的坑：</p> 
<h4><a id="1_31"></a>坑1</h4> 
<p><strong>坑1：注意这里select的返回类型需要是resultmap对应上面返回结果的resultmap类型，不能是resulttype，否则查询到的多条结果将不会合并到list’中，这里是一个注意点。</strong></p> 
<h4><a id="2_33"></a>坑2</h4> 
<p><strong>坑2：坑2是因为一个collection只能多一个sql查询，而我需要一个主表对应多个从表，就需要多个collection查询，select语句前面贴图已经有了，但是我遇到的问题是他们始终合并不了，类似于笛卡尔积，会多出许多重复的条目</strong><br> <strong>原因：</strong><br> 原因是MyBatis中进行结果映射时是用数据库的列名进行查询的，这时如果多个表存在相同的字段名时，他们就会重复，不会合并，这是MyBatis这里的规则。<br> <strong>解决方案一</strong>：select查询时用别名查询</p> 
<p><strong>解决方案二</strong>：修改数据库中没有相同的字段名即可。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/87646260d2b888abea82e60ec6a1c15a/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">关于Vue数组，对象数据变化无法更新到视图问题</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/291c9071173bfddec38be6d0c9628e9f/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Java 数组元素的删除</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 追风少年的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>