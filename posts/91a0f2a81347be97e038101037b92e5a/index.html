<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Springboot框架08 上传文件并且存到数据库 - 追风少年的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Springboot框架08 上传文件并且存到数据库" />
<meta property="og:description" content="业务层代码
@Override public JsonResult savefind(Find find, MultipartFile file,HttpServletRequest request) { //获取上传图片的相对路径 String img = LoadAndGetPath(file); //若返回为空 则报错文件过大 if (img==&#34;&#34;||img.equals(&#34;&#34;)){ return new JsonResult(0,&#34;文件不能超过50M&#34;); } //将获取的图片路径存入find 后期存入数据库 find.setImage(img); int res; try { //存入数据库 res = infoMapper.savefind(find); }catch (Exception e){ return new JsonResult(0,&#34;输入数据错误，请完善&#34;); } if (res!=1){ return new JsonResult(0,&#34;发布招领信息失败&#34;); } return new JsonResult(1,&#34;发布招领信息成功&#34;); } private String LoadAndGetPath(MultipartFile file) { //获取初始文件名 String filename=file.getOriginalFilename(); //获取文件后缀 String suffix=filename.substring(filename.lastIndexOf(&#34;.&#34;)&#43;1); //设置新文件创建路径 String newpath=&#34;&#34;; //限制文件大小不超过50M if (file.getSize()&gt;52428800){ return &#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://zhuifengsn.github.io/posts/91a0f2a81347be97e038101037b92e5a/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-03-17T00:26:03+08:00" />
<meta property="article:modified_time" content="2023-03-17T00:26:03+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="追风少年的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">追风少年的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Springboot框架08 上传文件并且存到数据库</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-dracula">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>业务层代码</p> 
<pre><code>   @Override
    public JsonResult savefind(Find find, MultipartFile file,HttpServletRequest request) {
        //获取上传图片的相对路径
        String img = LoadAndGetPath(file);
        //若返回为空 则报错文件过大
        if (img==""||img.equals("")){
            return new JsonResult(0,"文件不能超过50M");
        }
        //将获取的图片路径存入find 后期存入数据库
        find.setImage(img);
        int res;
        try {
            //存入数据库
            res = infoMapper.savefind(find);
        }catch (Exception e){
            return new JsonResult(0,"输入数据错误，请完善");
        }

        if (res!=1){
            return new JsonResult(0,"发布招领信息失败");
        }
        return new JsonResult(1,"发布招领信息成功");
    }
private String LoadAndGetPath(MultipartFile file) {
        //获取初始文件名
        String filename=file.getOriginalFilename();
        //获取文件后缀
        String suffix=filename.substring(filename.lastIndexOf(".")+1);
        //设置新文件创建路径
        String newpath="";
        //限制文件大小不超过50M
        if (file.getSize()&gt;52428800){
            return "";
        }
        //获取时间并转化为字符串 防止文件名重复
        SimpleDateFormat simpleDateFormat=new SimpleDateFormat("yyyyMMddHHmmss");
        Date date=new Date();
        //将获取的时间字符串混合随机数生成文件名
        Random random=new Random();
        int i=random.nextInt();
        String newfilename=simpleDateFormat.format(date)+i+"."+suffix;
        //获取新文件路径
        String c=System.getProperty("user.dir");
        String path=c+"/src/main/webapp/upload";
        File file1=new File(path);
        //如果目录不存在 则创建对应目录
        //放在webapp下可以实现动态加载
        if (!file1.exists()){
            file1.mkdir();
        }
        //创建路径文件
        File file2=new File(path,"/"+newfilename);
        try {
            //传输数据
            file.transferTo(file2);
            //返回对应的路径 方便存入数据库
            newpath= "/upload/" +newfilename;
        } catch (IOException e) {
            e.printStackTrace();
            return "";
        }

        return newpath;
    }
</code></pre> 
<p>之所以存在webapp下 这样可以不需要热部署就可以实现动态加载资源，webapp在main下，与resources，java平级</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/80f86022cc0929ee5e2b2b79eb6d767b/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">解决warning: ‘p‘ is used uninitialized in this function</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/d2458b07e1b24130ea76fdc66376f12f/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">【轻量级标记语言】Markdown完整语法</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 追风少年的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>