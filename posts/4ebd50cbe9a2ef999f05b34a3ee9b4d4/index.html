<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>C&#43;&#43;函数返回引用 - 追风少年的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="C&#43;&#43;函数返回引用" />
<meta property="og:description" content="注：C&#43;&#43; 有三种传递方式：值传递，指针传递，引用传递
返回“值”和返回“引用”是不同的
函数返回值时会产生一个临时变量作为函数返回值的副本，而返回引用时不会产生值的副本，既然是引用，那引用谁呢？这个问题必须清楚，否则将无法理解返回引用到底是个什么概念。以下是几种引用情况：
一、千万不要返回局部对象的引用 const string &amp;mainip(const string &amp;s) { string ret=s; return ret; } 当函数执行完毕，程序将释放分配给局部对象的存储空间。此时，对局部对象的引用就会指向不确定的内存。
同理，指针也是这样，返回指针的时候，不能指向局部临时变量，否则指针将变为野指针；
二、引用函数的参数，当然该参数也是一个引用 const string &amp;shorterString(const string &amp;s1,const string &amp;s2) { return s1.size()&lt;s2.size()?s1:s2; } 以上函数的返回值是引用类型。无论返回s1或是s2,调用函数和返回结果时，都没有拷贝这些string对象。简单的说，返回的引用是函数的参数s1或s2，并且参数s1、s2也是引用，不是在函数体内产生的。函数体内局部对象是不能被引用的，因为函数调用完局部对象会被释放。
三、返回 this 指向的对象 在类的成员函数中，返回引用的类对象，当然不能是函数内定义的类对象（会释放掉），一般为 this 指向的对象，典型的例子是 string类的赋值函数。
[cpp] view plain copy String&amp; String::operator =(const String &amp;str) //注意与“&#43;”比较，函数为什么要用引用呢？a=b=c，可以做为左值 { if (this == &amp;str) { return *this; } delete [] m_string; int len = strlen(str.m_string); m_string = new char[len&#43;1]; strcpy(m_string,str.m_string); return *this; } 四、引用返回this 的成员变量，或者 引用参数的成员变量 原标题为：引用返回左值（上例的=赋值也是如此，即a=b=c是可以的）" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://zhuifengsn.github.io/posts/4ebd50cbe9a2ef999f05b34a3ee9b4d4/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2016-12-08T13:31:23+08:00" />
<meta property="article:modified_time" content="2016-12-08T13:31:23+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="追风少年的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">追风少年的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">C&#43;&#43;函数返回引用</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p style="color:rgb(51,51,51); font-family:Arial; font-size:14px">注：C++ 有三种传递方式：值传递，指针传递，引用传递</p> 
<p style="color:rgb(51,51,51); font-family:Arial; font-size:14px">返回<strong>“值”</strong>和返回<strong>“引用”</strong>是不同的</p> 
<p style="color:rgb(51,51,51); font-family:Arial; font-size:14px"><span style="white-space:pre">        </span>函数返回<strong>值</strong>时会产生一个临时变量作为函数返回值的副本，而返回<strong>引用</strong>时不会产生值的副本，既然是引用，那引用谁呢？这个问题必须清楚，否则将无法理解返回引用到底是个什么概念。以下是几种引用情况：</p> 
<p style="color:rgb(51,51,51); font-family:Arial; font-size:14px"></p> 
<h3 style="color:rgb(51,51,51); font-family:Arial; font-size:14px"><span style="font-family:mceinline">一、千万不要返回局部对象的引用</span></h3> 
<p></p> 
<div> 
 <pre><code class="language-cpp">      const string &amp;mainip(const string &amp;s)
      {
             string ret=s;
             return ret;
      }</code></pre> 
</div> 
<p></p> 
<p style="color:rgb(51,51,51); font-family:Arial; font-size:14px"><span style="color:rgb(51,51,51); font-family:Arial; font-size:14px">        </span>当函数执行完毕，程序将释放分配给局部对象的存储空间。此时，对局部对象的引用就会指向不确定的内存。</p> 
<p style="color:rgb(51,51,51); font-family:Arial; font-size:14px"><span style="white-space:pre"></span><span style="color:rgb(51,51,51); font-family:Arial; font-size:14px">        </span>同理，指针也是这样，返回指针的时候，不能指向局部临时变量，否则指针将变为野指针；</p> 
<p style="color:rgb(51,51,51); font-family:Arial; font-size:14px"></p> 
<h3 style="color:rgb(51,51,51); font-family:Arial; font-size:14px"><span style="font-family:mceinline">二、</span><span style="font-family:mceinline">引用函数的参数，当然该参数也是一个引用</span></h3> 
<p></p> 
<div> 
 <pre><code class="language-cpp">     const string &amp;shorterString(const string &amp;s1,const string &amp;s2)
      {
             return s1.size()&lt;s2.size()?s1:s2;
      }</code></pre> 
</div> 
<p style="color:rgb(51,51,51); font-family:Arial; font-size:14px"><span style="white-space:pre"></span>        以上函数的返回值是引用类型。无论返回s1或是s2,调用函数和返回结果时，都没有拷贝这些string对象。简单的说，返回的引用是函数的参数s1或s2，并且参数s1、s2也是引用，不是在函数体内产生的。函数<span style="font-family:mceinline">体内局部对象</span>是不能被引用的，因为函数调用完局部对象会被释放。</p> 
<p style="color:rgb(51,51,51); font-family:Arial; font-size:14px"></p> 
<h3 style="font-family:Arial; font-size:14px"><span style="color:#333333">三、返回</span><span style="color:rgb(51,51,51); background-color:rgb(255,102,102)"><span style="color:rgb(255,255,255)"> this </span></span><span style="color:rgb(51,51,51)">指向的对象</span></h3> 
<p style="font-family:Arial; font-size:14px"><span style="color:#333333"><span style="white-space:pre"><span style="color:rgb(51,51,51); font-family:Arial; font-size:14px">        </span></span>在类的成员函数中，返回引用的类对象，当然不能是函数内定义的类对象（会释放掉），一般为</span><span style="background-color:rgb(255,255,255)"> this </span><span style="color:#333333">指向的对象，典型的例子是 string类的赋值函数。</span></p> 
<div class="dp-highlighter bg_cpp" style='font-family:Consolas,"Courier New",Courier,mono,serif; background-color:rgb(231,229,220); width:700.909px; overflow-x:auto; overflow-y:hidden; padding-top:1px; position:relative; margin:18px 0px!important'> 
 <div class="bar" style="padding-left:45px"> 
  <div class="tools" style="padding:3px 8px 10px 10px; font-size:9px; line-height:normal; font-family:Verdana,Geneva,Arial,Helvetica,sans-serif; color:silver; background-color:rgb(248,248,248); border-left:3px solid rgb(108,226,108)"> 
   <strong>[cpp]</strong>  
   <a target="_blank" href="http://blog.csdn.net/keyouan2008/article/details/5771844#" class="ViewSource" title="view plain" style="color:rgb(160,160,160); text-decoration:none; background-color:inherit; border:none; padding:1px; margin:0px 10px 0px 0px; font-size:9px; display:inline-block; width:16px; height:16px; text-indent:-2000px" rel="noopener noreferrer">view plain</a> 
    <a target="_blank" href="http://blog.csdn.net/keyouan2008/article/details/5771844#" class="CopyToClipboard" title="copy" style="color:rgb(160,160,160); text-decoration:none; background-color:inherit; border:none; padding:1px; margin:0px 10px 0px 0px; font-size:9px; display:inline-block; width:16px; height:16px; text-indent:-2000px" rel="noopener noreferrer">copy</a> 
   <div style="position:absolute; left:741px; top:1446px; width:18px; height:18px; z-index:99"> 
   </div> 
    
  </div> 
 </div> 
 <ol start="1" class="dp-cpp" style="padding:0px; border:none; list-style-position:initial; background-color:rgb(255,255,255); color:rgb(92,92,92); margin:0px 0px 1px 45px!important"><li class="alt" style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; color:inherit; line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit"><span style="margin:0px; padding:0px; border:none; background-color:inherit">String&amp; String::operator =(</span><span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); background-color:inherit; font-weight:bold">const</span><span style="margin:0px; padding:0px; border:none; background-color:inherit"> String &amp;str)  </span><span class="comment" style="margin:0px; padding:0px; border:none; color:rgb(0,130,0); background-color:inherit">//注意与“+”比较，函数为什么要用引用呢？a=b=c，可以做为左值</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">  </span></span></li><li style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; background-color:rgb(248,248,248); line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">{  </span></li><li class="alt" style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; color:inherit; line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">    <span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); background-color:inherit; font-weight:bold">if</span><span style="margin:0px; padding:0px; border:none; background-color:inherit"> (</span><span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); background-color:inherit; font-weight:bold">this</span><span style="margin:0px; padding:0px; border:none; background-color:inherit"> == &amp;str)  </span></span></li><li style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; background-color:rgb(248,248,248); line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">    {  </span></li><li class="alt" style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; color:inherit; line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">        <span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); background-color:inherit; font-weight:bold">return</span><span style="margin:0px; padding:0px; border:none; background-color:inherit"> *</span><span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); background-color:inherit; font-weight:bold">this</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">;    </span></span></li><li style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; background-color:rgb(248,248,248); line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">    }  </span></li><li class="alt" style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; color:inherit; line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">    <span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); background-color:inherit; font-weight:bold">delete</span><span style="margin:0px; padding:0px; border:none; background-color:inherit"> [] m_string;  </span></span></li><li style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; background-color:rgb(248,248,248); line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">    <span class="datatypes" style="margin:0px; padding:0px; border:none; color:rgb(46,139,87); background-color:inherit; font-weight:bold">int</span><span style="margin:0px; padding:0px; border:none; background-color:inherit"> len = strlen(str.m_string);  </span></span></li><li class="alt" style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; color:inherit; line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">    m_string = <span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); background-color:inherit; font-weight:bold">new</span><span style="margin:0px; padding:0px; border:none; background-color:inherit"> </span><span class="datatypes" style="margin:0px; padding:0px; border:none; color:rgb(46,139,87); background-color:inherit; font-weight:bold">char</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">[len+1];  </span></span></li><li style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; background-color:rgb(248,248,248); line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">    strcpy(m_string,str.m_string);  </span></li><li class="alt" style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; color:inherit; line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">    <span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); background-color:inherit; font-weight:bold">return</span><span style="margin:0px; padding:0px; border:none; background-color:inherit"> *</span><span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); background-color:inherit; font-weight:bold">this</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">;  </span></span></li><li style="border-top:none; border-right:none; border-bottom:none; border-left:3px solid rgb(108,226,108); list-style-type:decimal-leading-zero; background-color:rgb(248,248,248); line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important; list-style-position:outside!important"> <span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">}  </span></li></ol> 
</div> 
<p></p> 
<h3 style="color:rgb(51,51,51); font-family:Arial; font-size:14px">四、引用返回this 的成员变量，或者 引用参数的成员变量</h3> 
<h3 style="color:rgb(51,51,51); font-family:Arial; font-size:14px"> </h3><p>        <span style="font-weight:normal">原标题为：引用返回左值（上例的=赋值也是如此，即a=b=c是可以的）</span></p>  
<div> 
 <span style="color:rgb(51,51,51); font-family:Arial; font-size:14px">        原文这里表达不清晰，因为只要是引用，都可以作为左值使用。只因为下面的例子一般用在等号左边，当左值使用。</span> 
 <br> 
</div> 
<div>
          
 <span style="font-family:SimSun; font-size:12px">可以定义一个和返回值一样的引用类型，来接受函数的返回值，操作此引用值，和直接操作函数的参数是一样的,引用都是使用引用传递；</span> 
</div> 
<p></p> 
<pre><code class="language-cpp">      char &amp;get_val(string &amp;str,string::size_type ix)
      {
             return str[ix];
      }
      使用语句调用:
       string s("123456");
       cout&lt;&lt;s&lt;&lt;endl;
       get_val(s,0)='a';
       cout&lt;&lt;s&lt;&lt;endl;</code></pre> 
<p style="color:rgb(51,51,51); font-family:Arial"><span style="font-size:14px">        这种情况，和第二种是一样的，只不过是返回了参数（引用类型）的一部分。也可以不作为左值，故修改如下:</span></p> 
<p style="color:rgb(51,51,51); font-family:Arial"><span style="white-space:pre"></span></p> 
<pre><code class="language-cpp">char &amp;ch = get_val(s,0);
ch = ‘A’;</code></pre> 
<p></p> 
<pre></pre> 
<p>        此句进行的都是引用传递，故运行之后，s[0] 就变为了 A，s为“A23456”；</p> 
<p>        此外，可以返回引用参数的成员变量，亲测有效。似乎不是局部临时变量，只要函数结束之后内存没有被销毁的，作为引用返回都没问题：</p> 
<p><span style="white-space:pre"></span></p> 
<pre><code class="language-cpp">QString&amp; Test(Student &amp;stu)
{
    return stu.m_name;
}</code></pre> 
<p></p> 
<pre><code class="language-cpp">QString &amp; Student::getRName()
{
    return (*this).m_name;
}</code></pre> 
<p></p> 
<h3><span style="font-size:14px">五、最后转上一段code作为总结</span></h3> 
<div> 
 <span style="font-size:14px"></span> 
 <pre><code class="language-cpp">#include&lt;iostream&gt;
using namespace std;
string make_plural(size_t,const string&amp;,const string&amp;);
const string &amp;shorterString(const string &amp;,const string &amp;);
const string &amp;mainip(const string&amp;);
char &amp;get_val(string &amp;,string::size_type);
int main(void)  
{  
    cout&lt;&lt;make_plural(1,"dog","s")&lt;&lt;endl;  
    cout&lt;&lt;make_plural(2,"dog","s")&lt;&lt;endl;  
      
    string string1="1234";  
    string string2="abc";  
    cout&lt;&lt;shorterString(string1,string2)&lt;&lt;endl;  
      
    cout&lt;&lt;mainip("jiajia")&lt;&lt;endl;  
      
      
    string s("123456");  
    cout&lt;&lt;s&lt;&lt;endl;  
    get_val(s,0)='a';  
      
    cout&lt;&lt;s&lt;&lt;endl;  
      
    getchar();  
    return 0;  
}  
//返回非引用   
string make_plural(size_t i,const string &amp;word,const string &amp;ending)  
{  
    return (i==1)?word:word+ending;  
}  
//返回引用   
const string &amp;shorterString(const string &amp;s1,const string &amp;s2)  
{  
    return s1.size()&lt;s2.size()?s1:s2;  
}  
//禁止返回局部对象的引用（我的dev c++ 没有报错，比较可怕）   
const string &amp;mainip(const string &amp;s)  
{  
    string ret=s;  
    return ret;  
}  
//引用返回左值  
char &amp;get_val(string &amp;str,string::size_type ix)  
{  
    return str[ix];  
}  </code></pre> 
 <br> 
 <br> 
</div> 
<p></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/224ddd51198804c06b06f57ee5776b61/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">mysql的主从同步和分库分表</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/0503508b14e6b0f81a8b7d476acad20e/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">线程异步处理</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 追风少年的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>