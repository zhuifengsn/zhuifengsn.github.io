<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>页面浏览统计之(一) hitcount - 追风少年的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="页面浏览统计之(一) hitcount" />
<meta property="og:description" content="转：http://www.codingsoho.com/zh/blog/component-hitcount/
hit counter是用来计数模型对象的访问次数的。
Django hit counter application that tracks the number of hits/views for chosen objects.
https://github.com/thornomad/django-hitcount
安装 pip install django-hitcount
参考网站 http://django-hitcount.readthedocs.org/en/latest/installation.html
配置 将django-hitcount添加到INSTALLED_APPS，同时激活SESSION_SAVE_EVERY_REQUEST
settings.py
INSTALLED_APPS = ( ... &#39;hitcount&#39; ) # needed for django-hitcount to function properly SESSION_SAVE_EVERY_REQUEST = True 更多配置查看http://django-hitcount.readthedocs.org/en/latest/settings.html
视图 urls.py中加入
urlpatterns = patterns(&#39;&#39;, ... url(r&#39;hitcount/&#39;, include(&#39;hitcount.urls&#39;, namespace=&#39;hitcount&#39;)), ) 记录点击 https://django-hitcount.readthedocs.io/en/latest/installation.html#counting-hits
可以用HitCountMixin或者下面两个视图
HitCountJSONView: a JavaScript implementation which moves the business-logic to an Ajax View and hopefully speeds up page load times and eliminates some bot-trafficHitCountDetailView: which provides a wrapper from Django’s generic DetailView and allows you to process the Hit as the view is loaded 我的实现项目里有类视图和函数视图，用到了上面的HitCountMixin和HitCountDetailView两个方法" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://zhuifengsn.github.io/posts/4db2a39974e952c9e96c709948c2cf1e/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2018-10-01T22:20:00+08:00" />
<meta property="article:modified_time" content="2018-10-01T22:20:00+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="追风少年的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">追风少年的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">页面浏览统计之(一) hitcount</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown"> 
 <p>转：<a href="http://www.codingsoho.com/zh/blog/component-hitcount/" rel="nofollow" class="uri">http://www.codingsoho.com/zh/blog/component-hitcount/</a></p> 
 <p>hit counter是用来计数模型对象的访问次数的。</p> 
 <blockquote> 
  <p>Django hit counter application that tracks the number of hits/views for chosen objects.</p> 
 </blockquote> 
 <p><a href="https://github.com/thornomad/django-hitcount" class="uri">https://github.com/thornomad/django-hitcount</a></p> 
 <h2 id="安装">安装</h2> 
 <blockquote> 
  <p>pip install django-hitcount</p> 
 </blockquote> 
 <p>参考网站 <a href="http://django-hitcount.readthedocs.org/en/latest/installation.html" rel="nofollow" class="uri">http://django-hitcount.readthedocs.org/en/latest/installation.html</a></p> 
 <h2 id="配置">配置</h2> 
 <p>将django-hitcount添加到INSTALLED_APPS，同时激活SESSION_SAVE_EVERY_REQUEST</p> 
 <blockquote> 
  <p>settings.py</p> 
 </blockquote> 
 <pre><code class="language-python"><code>INSTALLED_APPS = (
    ...
    'hitcount'
)
# needed for django-hitcount to function properly
SESSION_SAVE_EVERY_REQUEST = True</code></code></pre> 
 <p>更多配置查看<a href="http://django-hitcount.readthedocs.org/en/latest/settings.html" rel="nofollow" class="uri">http://django-hitcount.readthedocs.org/en/latest/settings.html</a></p> 
 <h2 id="视图">视图</h2> 
 <p>urls.py中加入</p> 
 <pre><code class="language-python"><code>urlpatterns = patterns('',
    ...
    url(r'hitcount/', include('hitcount.urls', namespace='hitcount')),
)</code></code></pre> 
 <h2 id="记录点击">记录点击</h2> 
 <p><a href="https://django-hitcount.readthedocs.io/en/latest/installation.html#counting-hits" rel="nofollow" class="uri">https://django-hitcount.readthedocs.io/en/latest/installation.html#counting-hits</a></p> 
 <p>可以用<code>HitCountMixin</code>或者下面两个视图</p> 
 <ul><li><code>HitCountJSONView</code>: a JavaScript implementation which moves the business-logic to an Ajax View and hopefully speeds up page load times and eliminates some bot-traffic</li><li><code>HitCountDetailView</code>: which provides a wrapper from Django’s generic DetailView and allows you to process the Hit as the view is loaded</li></ul> 
 <p>我的实现项目里有类视图和函数视图，用到了上面的HitCountMixin和HitCountDetailView两个方法</p> 
 <h3 id="hitcountmixin">HitCountMixin</h3> 
 <p>mixin可以用于CBV类或者直接调用它的<code>hit_count()</code>类方法。该方法有两个参数<code>HttpRequest</code>和<code>HitCount</code>对象，返回一个名字元组<code>UpdateHitCountResponse(hit_counted=Boolean, hit_message='Message')</code>。<br> 如果该次点击被记录，那么<code>hit_counted=True</code>，否则为False. <code>hit_message</code>用于指示当前点击是否被计数或忽略.</p> 
 <blockquote> 
  <p>This mixin can be used in your own class-based views or you can call the hit_count() class method directly. The method takes two arguments, a HttpRequest and HitCount object it will return a namedtuple: UpdateHitCountResponse(hit_counted=Boolean, hit_message='Message'). hit_counted will be True if the hit was counted and False if it was not. hit_message will indicate by what means the Hit was either counted or ignored.</p> 
 </blockquote> 
 <p>代码样式如下</p> 
 <pre><code>from hitcount.models import HitCount
from hitcount.views import HitCountMixin

# first get the related HitCount object for your model object
hit_count = HitCount.objects.get_for_object(your_model_object)

# next, you can attempt to count a hit and get the response
# you need to pass it the request object as well
hit_count_response = HitCountMixin.hit_count(request, hit_count)

# your response could look like this:
# UpdateHitCountResponse(hit_counted=True, hit_message='Hit counted: session key')
# UpdateHitCountResponse(hit_counted=False, hit_message='Not counted: session key has active hit')</code></pre> 
 <h3 id="hitcountdetailview">HitCountDetailView</h3> 
 <p>通过设置<code>count_hit=True</code>，<code>HitCountDetailView</code>能够用于计算点击数的业务逻辑。</p> 
 <blockquote> 
  <p>The HitCountDetailView can be used to do the business-logic of counting the hits by setting count_hit=True. See the <a href="https://github.com/thornomad/django-hitcount/blob/master/hitcount/views.py">views</a> section for more information about what else is added to the template context with this view.</p> 
 </blockquote> 
 <p>下面是该库例子里的实现</p> 
 <pre><code class="language-python"><code>from hitcount.views import HitCountDetailView
class PostCountHitDetailView(HitCountDetailView):
    model = Post # your model goes here
    count_hit = True # set to True if you want it to try and count the hit</code></code></pre> 
 <h2 id="显示点击计数">显示点击计数</h2> 
 <p>有多种方式可实现计数显示 <a href="https://django-hitcount.readthedocs.io/en/latest/installation.html#displaying-hits" rel="nofollow">displaying-hits</a></p> 
 <ul><li><a href="https://django-hitcount.readthedocs.io/en/latest/installation.html#template-tags" rel="nofollow">Template Tags</a>: provide a robust way to get related counts</li><li><a href="https://github.com/thornomad/django-hitcount/blob/master/hitcount/views.py">Views</a>: allows you to wrap a class-based view and inject additional context into your template</li><li><a href="https://django-hitcount.readthedocs.io/en/latest/installation.html#models" rel="nofollow">Models</a>: can have a generic relation to their respective HitCount</li></ul> 
 <p>项目中我选用了第一种方法来实现，可以避免修改后台代码。具体实现见后面</p> 
 <pre><code># remember to load the tags first
{% load hitcount_tags %}

# Return total hits for an object:
{% get_hit_count for [object] %}

# Get total hits for an object as a specified variable:
{% get_hit_count for [object] as [var] %}

# Get total hits for an object over a certain time period:
{% get_hit_count for [object] within ["days=1,minutes=30"] %}

# Get total hits for an object over a certain time period as a variable:
{% get_hit_count for [object] within ["days=1,minutes=30"] as [var] %}</code></pre> 
 <h2 id="实例项目">实例项目</h2> 
 <h3 id="textcourse">TextCourse</h3> 
 <h4 id="通过hitcount记录浏览次数">通过hitcount记录浏览次数</h4> 
 <pre><code class="language-python"><code>from hitcount.models import HitCount
from hitcount.views import HitCountMixin

hit_count = HitCount.objects.get_for_object(node)

# next, you can attempt to count a hit and get the response
# you need to pass it the request object as well
hit_count_response = HitCountMixin.hit_count(request, hit_count)

# your response could look like this:
# UpdateHitCountResponse(hit_counted=True, hit_message='Hit counted: session key')
# UpdateHitCountResponse(hit_counted=False, hit_message='Not counted: session key has active hit')
    context = {
            'object': node,
    }
    context.update(hit_count_response._asdict())</code></code></pre> 
 <p><code>hit_count_response._asdict()</code>的结果就是<code>hit_counted</code>和<code>hit_message</code></p> 
 <h4 id="显示浏览数">显示浏览数</h4> 
 <p>在需要记录点击的页面开始处加载标签</p> 
 <pre><code class="language-html"><code>{% load hitcount_tags %}</code></code></pre> 
 <p>我只需要简单计数，所以用下面就可以了</p> 
 <pre><code class="language-html"><code>{% get_hit_count for object %}</code></code></pre> 
 <h3 id="aldryn_newsblog">aldryn_newsblog</h3> 
 <p>这个是djangocms插件，下面通过修改原有代码将其实现。<br> 目前还没有找到仅通过额外加代码解决的办法，现在的方案要改库，很不方便。</p> 
 <p>一种方法跟前面一样，修改文件</p> 
 <blockquote> 
  <p>aldryn_newsblog\views.py</p> 
 </blockquote> 
 <pre><code class="language-python"><code>from hitcount.models import HitCount
from hitcount.views import HitCountMixin

class ArticleDetail(AppConfigMixin, AppHookCheckMixin, PreviewModeMixin,
                    TranslatableSlugMixin, TemplatePrefixMixin, DetailView):
    def get(self, request, *args, **kwargs):
        hit_count = HitCount.objects.get_for_object(self.object)
        hit_count_response = HitCountMixin.hit_count(request, hit_count)
        ...</code></code></pre> 
 <p>或者我们可以用<code>HitCountDetailView</code>来实现，参考<a href="https://django-hitcount.readthedocs.io/en/latest/installation.html#hitcountdetailview" rel="nofollow" class="uri">https://django-hitcount.readthedocs.io/en/latest/installation.html#hitcountdetailview</a></p> 
 <blockquote> 
  <p>aldryn_newsblog\views.py</p> 
 </blockquote> 
 <pre><code class="language-python"><code>from hitcount.views import HitCountDetailView
class ArticleDetail(AppConfigMixin, AppHookCheckMixin, PreviewModeMixin,
                    TranslatableSlugMixin, TemplatePrefixMixin, HitCountDetailView, DetailView):
......
    count_hit = True</code></code></pre> 
 <p>然后同样修改一下模板文件</p> 
 <blockquote> 
  <p>aldryn_newsblog\includes\article.html</p> 
 </blockquote> 
 <pre><code class="language-html"><code>{% load hitcount_tags %}
        &lt;i class="fa fa-eye" style="font-size: smaller;"&gt; {% get_hit_count for object %} 浏览&lt;/i&gt; 
        &lt;i class="fa fa-clock-o" style="font-size: smaller;"&gt; {<!-- -->{ article.publishing_date|date }}&lt;/i&gt; </code></code></pre> 
</div> 
<p>转载于:https://www.cnblogs.com/2dogslife/p/9735956.html</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/0f4016540a665eab88c38e91d1ec893a/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">C/C&#43;&#43;——C语言跳出多重循环方法</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/1efbdd1c6341feb91d305c6b88436949/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">遗传算法的运算过程</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 追风少年的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>