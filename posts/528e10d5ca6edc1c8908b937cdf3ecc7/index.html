<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>SpringBoot - 简单构建web服务 - 追风少年的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="SpringBoot - 简单构建web服务" />
<meta property="og:description" content="文章目录 1. 第一个springboot程序2. IDEA快速创建springboot项目3. Springboot自动装配原理3.1 启动器3.2 主程序 4. yaml4.1 yaml语法4.2 给属性赋值的几种方式 5. JSR303数据校验6. 多环境配置及配置文件位置6.1 配置文件可以存在的位置6.2 多套配置环境直接快速切换 7. 自动配置原理再理解7.1 精髓7.2 其他 8. SpringBoot Web开发8.1 静态资源导入8.2 首页订制8.3 图标订制8.4 模板引擎8.5 Thymeleaf语法8.6 扩展装配SpringMVC 9. 员工管理系统9.1 首页配置9.2 国际化9.3 登录功能实现9.4 登录拦截器9.5 展示员工列表9.6 404页面处理 10. 整合JDBC11. 整合Druid数据源12. 整合Mybatis13. SpringSecurity(安全)13.1 用户认证和授权13.2 注销及权限控制13.3 记住我及登录页定制13.3 记住我及登录页定制 1. 第一个springboot程序 springboot:https://start.spring.io/
通过该网站进行项目搭建，下载压缩包，解压后导入IDEA
程序的主入口（该类本身就是spring的一个组件）：
@SpringBootApplication public class HelloworldApplication { public static void main(String[] args) { SpringApplication.run(HelloworldApplication.class, args); } } springboot可以直接运行，内置了tomcat
我们项目的目录要和程序的主入口类在同一目录下，如
写一个Controller，我们不需要任何配置，就可以直接访问" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://zhuifengsn.github.io/posts/528e10d5ca6edc1c8908b937cdf3ecc7/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-10-29T10:39:57+08:00" />
<meta property="article:modified_time" content="2023-10-29T10:39:57+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="追风少年的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">追风少年的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">SpringBoot - 简单构建web服务</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><ul><li><a href="#1_springboot_2" rel="nofollow">1. 第一个springboot程序</a></li><li><a href="#2_IDEAspringboot_113" rel="nofollow">2. IDEA快速创建springboot项目</a></li><li><a href="#3_Springboot_174" rel="nofollow">3. Springboot自动装配原理</a></li><li><ul><li><a href="#31__184" rel="nofollow">3.1 启动器</a></li><li><a href="#32__201" rel="nofollow">3.2 主程序</a></li></ul> 
   </li><li><a href="#4_yaml_275" rel="nofollow">4. yaml</a></li><li><ul><li><a href="#41_yaml_306" rel="nofollow">4.1 yaml语法</a></li><li><a href="#42__344" rel="nofollow">4.2 给属性赋值的几种方式</a></li></ul> 
   </li><li><a href="#5_JSR303_506" rel="nofollow">5. JSR303数据校验</a></li><li><a href="#6__567" rel="nofollow">6. 多环境配置及配置文件位置</a></li><li><ul><li><a href="#61__569" rel="nofollow">6.1 配置文件可以存在的位置</a></li><li><a href="#62__585" rel="nofollow">6.2 多套配置环境直接快速切换</a></li></ul> 
   </li><li><a href="#7__654" rel="nofollow">7. 自动配置原理再理解</a></li><li><ul><li><a href="#71__728" rel="nofollow">7.1 精髓</a></li><li><a href="#72__742" rel="nofollow">7.2 其他</a></li></ul> 
   </li><li><a href="#8_SpringBoot_Web_761" rel="nofollow">8. SpringBoot Web开发</a></li><li><ul><li><a href="#81__773" rel="nofollow">8.1 静态资源导入</a></li><li><a href="#82__834" rel="nofollow">8.2 首页订制</a></li><li><a href="#83__844" rel="nofollow">8.3 图标订制</a></li><li><a href="#84__861" rel="nofollow">8.4 模板引擎</a></li><li><a href="#85_Thymeleaf_907" rel="nofollow">8.5 Thymeleaf语法</a></li><li><a href="#86_SpringMVC_954" rel="nofollow">8.6 扩展装配SpringMVC</a></li></ul> 
   </li><li><a href="#9__995" rel="nofollow">9. 员工管理系统</a></li><li><ul><li><a href="#91__997" rel="nofollow">9.1 首页配置</a></li><li><a href="#92__1023" rel="nofollow">9.2 国际化</a></li><li><a href="#93__1127" rel="nofollow">9.3 登录功能实现</a></li><li><a href="#94__1153" rel="nofollow">9.4 登录拦截器</a></li><li><a href="#95__1190" rel="nofollow">9.5 展示员工列表</a></li><li><a href="#96_404_1256" rel="nofollow">9.6 404页面处理</a></li></ul> 
   </li><li><a href="#10_JDBC_1262" rel="nofollow">10. 整合JDBC</a></li><li><a href="#11_Druid_1320" rel="nofollow">11. 整合Druid数据源</a></li><li><a href="#12_Mybatis_1413" rel="nofollow">12. 整合Mybatis</a></li><li><a href="#13_SpringSecurity_1447" rel="nofollow">13. SpringSecurity(安全)</a></li><li><ul><li><a href="#131__1479" rel="nofollow">13.1 用户认证和授权</a></li><li><a href="#132__1534" rel="nofollow">13.2 注销及权限控制</a></li><li><a href="#133__1591" rel="nofollow">13.3 记住我及登录页定制</a></li><li><a href="#133__1685" rel="nofollow">13.3 记住我及登录页定制</a></li></ul> 
  </li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h3><a id="1_springboot_2"></a>1. 第一个springboot程序</h3> 
<p>springboot:https://start.spring.io/</p> 
<p>通过该网站进行项目搭建，下载压缩包，解压后导入IDEA</p> 
<p>程序的主入口（该类本身就是spring的一个组件）：</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@SpringBootApplication</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HelloworldApplication</span> <span class="token punctuation">{<!-- --></span>

	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">HelloworldApplication</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>springboot可以直接运行，内置了tomcat</p> 
<p>我们项目的目录要和程序的主入口类在同一目录下，如</p> 
<p><img src="https://images2.imgbox.com/c1/e1/OqbJMV1i_o.png" alt="在这里插入图片描述"></p> 
<p><strong>写一个Controller，我们不需要任何配置，就可以直接访问</strong></p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@RestController</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestController</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/test"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token string">"hello springboot!"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/5c/54/yzYYYiH7_o.png" alt="在这里插入图片描述"></p> 
<p>springboot核心原理：<strong>自动装配！！</strong></p> 
<p>springboot的核心依赖 pom.xml</p> 
<pre><code class="prism language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>project</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://maven.apache.org/POM/4.0.0<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">"</span></span>
	<span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>modelVersion</span><span class="token punctuation">&gt;</span></span>4.0.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>modelVersion</span><span class="token punctuation">&gt;</span></span>
	<span class="token comment">&lt;!--有一个父项目--&gt;</span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>parent</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-parent<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.2.7.RELEASE<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>relativePath</span><span class="token punctuation">/&gt;</span></span> <span class="token comment">&lt;!-- lookup parent from repository --&gt;</span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>parent</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>cn.codewei<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>helloworld<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>0.0.1-SNAPSHOT<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>helloworld<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>description</span><span class="token punctuation">&gt;</span></span>Demo project for Spring Boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>description</span><span class="token punctuation">&gt;</span></span>

	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>properties</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>java.version</span><span class="token punctuation">&gt;</span></span>1.8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>java.version</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>properties</span><span class="token punctuation">&gt;</span></span>

	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
        
         <span class="token comment">&lt;!--启动器--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        
		<span class="token comment">&lt;!--web依赖：tomcat，dispatcherServlet，xml...--&gt;</span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-web<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

		<span class="token comment">&lt;!--单元测试--&gt;</span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclusions</span><span class="token punctuation">&gt;</span></span>
				<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclusion</span><span class="token punctuation">&gt;</span></span>
					<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.junit.vintage<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
					<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>junit-vintage-engine<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
				<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exclusion</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exclusions</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>

	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>build</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugins</span><span class="token punctuation">&gt;</span></span>
			<span class="token comment">&lt;!--打jar包插件--&gt;</span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">&gt;</span></span>
				<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
				<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-maven-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugins</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>build</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>project</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>springboot所有的依赖都是使用spring-boot-starter开头的</p> 
<p>使用tomcat作为默认的嵌入式容器</p> 
<hr> 
<h3><a id="2_IDEAspringboot_113"></a>2. IDEA快速创建springboot项目</h3> 
<p>IDEA集成了springboot创建项目的网站，我们不再用去官网下载压缩包了</p> 
<p>直接用idea创建一个springboot项目(开发一般直接在IDEA中创建)</p> 
<p><img src="https://images2.imgbox.com/94/ff/qICS5MF4_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/59/7c/IEfoY2Nt_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/fd/a1/GGROz0N1_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/9a/11/Kq1pyZbo_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/07/33/N18Ymz02_o.png" alt="在这里插入图片描述"></p> 
<p>可以把多余的文件删除</p> 
<p><strong>可以在application.properties中修改配置</strong></p> 
<p><strong>如，修改端口号</strong></p> 
<pre><code class="prism language-properties">server.port=80
</code></pre> 
<p><strong>如，修改springboot banner</strong></p> 
<p>在resources目录下新建一个banner.txt，将从网上复制的banner粘贴进去</p> 
<pre><code class="prism language-txt">
//                          _ooOoo_                               //
//                         o8888888o                              //
//                         88" . "88                              //
//                         (| ^_^ |)                              //
//                         O\  =  /O                              //
//                      ____/`---'\____                           //
//                    .'  \\|     |//  `.                         //
//                   /  \\|||  :  |||//  \                        //
//                  /  _||||| -:- |||||-  \                       //
//                  |   | \\\  -  /// |   |                       //
//                  | \_|  ''\---/''  |   |                       //
//                  \  .-\__  `-`  ___/-. /                       //
//                ___`. .'  /--.--\  `. . ___                     //
//              ."" '&lt;  `.___\_&lt;|&gt;_/___.'  &gt;'"".                  //
//            | | :  `- \`.;`\ _ /`;.`/ - ` : | |                 //
//            \  \ `-.   \_ __\ /__ _/   .-` /  /                 //
//      ========`-.____`-.___\_____/___.-`____.-'========         //
//                           `=---='                              //
//      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^        //
//            佛祖保佑       永不宕机     永无BUG                    //

</code></pre> 
<p>直接启动springboot项目就会看到springboot banner修改了</p> 
<p><img src="https://images2.imgbox.com/09/ab/q9lB6CJq_o.png" alt="在这里插入图片描述"></p> 
<hr> 
<h3><a id="3_Springboot_174"></a>3. Springboot自动装配原理</h3> 
<p>pom.xml中</p> 
<p>spring-boot-dependencies：核心依赖，在父工程中</p> 
<p>springboot在父工程中也配置了解决资源过滤问题</p> 
<p>我们在写或者引入springboot依赖的时候，不再需要指定版本，因为由这些版本仓库在父工程中</p> 
<h4><a id="31__184"></a>3.1 启动器</h4> 
<p>启动器</p> 
<pre><code class="prism language-xml"><span class="token comment">&lt;!--启动器--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<ul><li>启动器：说白了就是springboot的启动场景(自认为启动器就是依赖jar包的集合)</li><li>比如：spring-boot-starter-web就会帮我们自动导入web环境所有的依赖</li><li>springboot会将所有的功能场景，都变成一个个的启动器</li><li>我们要使用什么功能，就只需要找到对应的启动器就可以了<code>starter</code></li></ul> 
<h4><a id="32__201"></a>3.2 主程序</h4> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@SpringBootApplication</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HelloworldApplication</span> <span class="token punctuation">{<!-- --></span>

	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 将springboot应用启动</span>
		<span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">HelloworldApplication</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<ul><li> <p>注解</p> <p>@SpringBootAppplication：标注这个类是一个SpringBoot应用：启动类下的所有资源被导入</p> <p><img src="https://images2.imgbox.com/31/71/QJHjLXYh_o.png" alt="在这里插入图片描述"></p> <pre><code class="prism language-java"><span class="token annotation punctuation">@SpringBootConfiguration</span>：springboot的配置
    <span class="token annotation punctuation">@Configuration</span>：spring配置类
    	<span class="token annotation punctuation">@Component</span>：说明这也是spring的一个组件
<span class="token annotation punctuation">@EnableAutoConfiguration</span>：自动配置
    <span class="token annotation punctuation">@AutoConfigurationPackage</span>：自动配置包
    	<span class="token annotation punctuation">@Import</span><span class="token punctuation">(</span><span class="token class-name">AutoConfigurationPackages<span class="token punctuation">.</span>Registrar</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>：自动配置包注册
    <span class="token annotation punctuation">@Import</span><span class="token punctuation">(</span><span class="token class-name">AutoConfigurationImportSelector</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>：自动配置导入选择
<span class="token comment">//获取所有的配置(AutoConfigurationImportSelector类下)    	</span>
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> configurations <span class="token operator">=</span> <span class="token function">getCandidateConfigurations</span><span class="token punctuation">(</span>annotationMetadata<span class="token punctuation">,</span> attributes<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <p>获取候选的配置(AutoConfigurationImportSelector类下)</p> <pre><code class="prism language-java"><span class="token keyword">protected</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token function">getCandidateConfigurations</span><span class="token punctuation">(</span><span class="token class-name">AnnotationMetadata</span> metadata<span class="token punctuation">,</span> <span class="token class-name">AnnotationAttributes</span> attributes<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> configurations <span class="token operator">=</span> <span class="token class-name">SpringFactoriesLoader</span><span class="token punctuation">.</span><span class="token function">loadFactoryNames</span><span class="token punctuation">(</span><span class="token function">getSpringFactoriesLoaderFactoryClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                                                                         <span class="token function">getBeanClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">notEmpty</span><span class="token punctuation">(</span>configurations<span class="token punctuation">,</span> <span class="token string">"No auto configuration classes found in META-INF/spring.factories. If you "</span>
                    <span class="token operator">+</span> <span class="token string">"are using a custom packaging, make sure that file is correct."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> configurations<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <p>META-INF/spring.factories：自动配置的核心文件<br> <img src="https://images2.imgbox.com/12/ae/3iOqsZEb_o.png" alt="在这里插入图片描述"></p> <p>自动配置类中核心注解：@ConditionalOnxxx：如果这里的条件都满足，才会生效</p> <p>…</p> <p>结论：springboot所有的自动配置都在启动类中被扫描并加载：<code>spring.factories</code>所有的自动配置类都在这里面，但是不一定生效，要判断条件是否成立，只要导入了对应的starter，就有对应的启动器了，有了启动器，我们自动装配就会生效，然后就配置成功了</p> 
  <ol><li>springboot在启动的时候，从类路径下/META-INF/<code>spring.factories</code>获取指定的值</li><li>将这些自动配置的类导入容器，自动配置就会生效，帮我进行自动配置</li><li>以前我们需要自动配置的东西，现在springboot帮我们做了</li><li>整合JAVAEE，解决方案和自动配置的东西都在spring-boot-autoconfigure-xxx.RELEASE.jar这个包下</li><li>它会把所有需要导入的组件，以类名的方式返回，这些组件就会被添加到容器</li><li>容器中也会存在非常多的xxxAutoConfiguration的文件(@Bean)，就是这些类给容器中导入了这个场景需要的所有组件，并自动配置，@Configuration,JavaConfig！</li><li>有了自动配置类，免去了我们手动编写配置文件的工作</li></ol> </li><li> <p>SpringApplication.run(xxxApplication.class, args);</p> <p>SpringApplication类</p> <p>run方法</p> 
  <ul><li>SpringApplication这个类做了一下四件事情： 
    <ol><li>推断应用的类型是普通的项目还是web项目</li><li>查找并加载所有可用初始化容器，设置到initializers属性中</li><li>找出所有的应用程序监听器，设置到listeners属性中</li><li>推断并设置main方法定义类，找出运行的主类</li></ol> </li></ul> </li></ul> 
<hr> 
<h3><a id="4_yaml_275"></a>4. yaml</h3> 
<p>springboot官方推荐yaml格式的配置文件，而不推荐使用properties文件</p> 
<p>springboot使用一个全局的配置文件，配置文件名称是固定的</p> 
<ol><li> <p>application.properties</p> <p>语法：key=value</p> </li><li> <p>application.yaml</p> <p>语法：key:空格 value</p> </li></ol> 
<p>配置文件作用：修改SpringBoot自动配置的默认值，因为SpringBoot在底层都给我们配置好了</p> 
<ul><li> <p>yaml中的语法，如</p> <pre><code class="prism language-yaml"><span class="token key atrule">server</span><span class="token punctuation">:</span>
	port<span class="token punctuation">:</span><span class="token number">8080</span>
</code></pre> </li><li> <p>xml中的语法，如</p> <pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>server</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>port</span><span class="token punctuation">&gt;</span></span>8080<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>port</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>server</span><span class="token punctuation">&gt;</span></span>
</code></pre> </li></ul> 
<h4><a id="41_yaml_306"></a>4.1 yaml语法</h4> 
<p>yaml语法对缩进(空格)要求极其严格！！</p> 
<ol><li> <p>普通的key-value</p> <pre><code class="prism language-yaml"><span class="token key atrule">name</span><span class="token punctuation">:</span> codewei
</code></pre> </li><li> <p>对象</p> <pre><code class="prism language-yaml"><span class="token key atrule">student</span><span class="token punctuation">:</span>
	<span class="token key atrule">name</span><span class="token punctuation">:</span> codewei
	<span class="token key atrule">age</span><span class="token punctuation">:</span> <span class="token number">12</span>
</code></pre> <p>对象的行内写法</p> <pre><code class="prism language-yaml"><span class="token key atrule">student</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span><span class="token key atrule">name</span><span class="token punctuation">:</span> codewei<span class="token punctuation">,</span><span class="token key atrule">age</span><span class="token punctuation">:</span> <span class="token number">12</span><span class="token punctuation">}</span>
</code></pre> </li><li> <p>数组</p> <pre><code class="prism language-yaml"><span class="token key atrule">pets</span><span class="token punctuation">:</span>
	<span class="token punctuation">-</span> cat
	<span class="token punctuation">-</span> dog
</code></pre> <p>数组的行内写法</p> <pre><code class="prism language-yaml"><span class="token key atrule">pets</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>cat<span class="token punctuation">,</span>dog<span class="token punctuation">]</span>
</code></pre> </li></ol> 
<h4><a id="42__344"></a>4.2 给属性赋值的几种方式</h4> 
<p><strong>yaml可以直接给实体类赋值</strong>，如：</p> 
<ul><li> <p>实体类</p> <pre><code class="prism language-java"><span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Dog</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> age<span class="token punctuation">;</span>
	<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    有参无参构造
    <span class="token class-name">Getter</span> <span class="token class-name">Setter</span>方法
<span class="token punctuation">}</span>
</code></pre> <pre><code class="prism language-java"><span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Person</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> age<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Boolean</span> happy<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Date</span> birth<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> map<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> list<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Dog</span> dog<span class="token punctuation">;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    有参无参构造
    <span class="token class-name">Getter</span> <span class="token class-name">Setter</span>方法
<span class="token punctuation">}</span>
</code></pre> <p>曾经我们通过@Value(“xxx”)或@Autowired的方式给属性赋值，而现在我们可以使用yaml</p> </li><li> <p>yaml配置</p> <pre><code class="prism language-yaml"><span class="token key atrule">person</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> 唐嫣
  <span class="token key atrule">age</span><span class="token punctuation">:</span> <span class="token number">36</span>
  <span class="token key atrule">happy</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
  <span class="token key atrule">birth</span><span class="token punctuation">:</span> 1986/12/21
  <span class="token key atrule">map</span><span class="token punctuation">:</span>
    <span class="token key atrule">k1</span><span class="token punctuation">:</span> v1
    <span class="token key atrule">k2</span><span class="token punctuation">:</span> v2
  <span class="token key atrule">list</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> l1
    <span class="token punctuation">-</span> l2
  <span class="token key atrule">dog</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> 旺财
    <span class="token key atrule">age</span><span class="token punctuation">:</span> <span class="token number">12</span>
</code></pre> </li><li> <p>在实体类上添加注解 @ConfigurationProperties(prefix=“xxx”) 注解中的值对应yaml中的对象名</p> <pre><code class="prism language-java"><span class="token annotation punctuation">@Component</span>
<span class="token annotation punctuation">@ConfigurationProperties</span><span class="token punctuation">(</span>prefix<span class="token operator">=</span><span class="token string">"person"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Person</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> age<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Boolean</span> happy<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Date</span> birth<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> map<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> list<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Dog</span> dog<span class="token punctuation">;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre> <p><mark>注意：yaml中的键名要和实体类中的属性名一致，否则实体类对应属性的值为null</mark></p> <p>添加注解后，可能会出现一个红条，但是不影响程序正常运行</p> <p><img src="https://images2.imgbox.com/dd/13/fuD15eqV_o.png" alt="在这里插入图片描述"></p> <p>解决方法：</p> <p>添加依赖</p> <pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-configuration-processor<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>optional</span><span class="token punctuation">&gt;</span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>optional</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> </li></ul> 
<ul><li> <p>测试结果</p> <p><img src="https://images2.imgbox.com/6f/4a/XCiV6cqX_o.png" alt="在这里插入图片描述"></p> </li></ul> 
<p><strong>也可以使用properties文件给实体类赋值</strong></p> 
<ul><li> <p>properties文件</p> <pre><code class="prism language-properties">name=唐嫣
age=23
</code></pre> </li><li> <p>在实体类上添加注解</p> <p>通过注解@PropertySource(value=“classpath:xxx”) 加载指定properties配置文件</p> <p>然后通过@Value进行一一赋值，通过SPEL表达式将配置文件中的值取出(SPEL和E表达式基本相同，${xxx})</p> <pre><code class="prism language-java"><span class="token annotation punctuation">@Component</span>
<span class="token annotation punctuation">@PropertySource</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"classpath:application.properties"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Person</span> <span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"${name}"</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"${age}"</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> age<span class="token punctuation">;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre> <p><img src="https://images2.imgbox.com/d3/47/mXPRxkW3_o.png" alt="在这里插入图片描述"></p> <p>测试结果，因为我们在配置文件中只给name和age赋值，所以后面的都为null</p> </li></ul> 
<p>在yaml文件中，同样支持SPEL语法，如</p> 
<pre><code class="prism language-yaml"><span class="token key atrule">person</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> 唐嫣$<span class="token punctuation">{<!-- --></span>random.uuid<span class="token punctuation">}</span>  <span class="token comment">#随机uuid</span>
  <span class="token key atrule">age</span><span class="token punctuation">:</span> 36$<span class="token punctuation">{<!-- --></span>random.int<span class="token punctuation">}</span>    <span class="token comment">#随机数</span>
  <span class="token key atrule">happy</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
  <span class="token key atrule">birth</span><span class="token punctuation">:</span> 1986/12/21
  <span class="token key atrule">map</span><span class="token punctuation">:</span>
    <span class="token key atrule">k1</span><span class="token punctuation">:</span> v1
    <span class="token key atrule">k2</span><span class="token punctuation">:</span> v2
  <span class="token key atrule">list</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> l1
    <span class="token punctuation">-</span> l2
  <span class="token key atrule">dog</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> $<span class="token punctuation">{<!-- --></span>person.hello<span class="token punctuation">:</span>hello<span class="token punctuation">}</span>旺财  <span class="token comment">#如果persion.hello值不存在，则会为冒号后面的值，如果存在，则为这个值</span>
    <span class="token key atrule">age</span><span class="token punctuation">:</span> <span class="token number">12</span>
</code></pre> 
<p>测试结果</p> 
<p><img src="https://images2.imgbox.com/77/3a/Bru64lJ9_o.png" alt="在这里插入图片描述"></p> 
<table><thead><tr><th></th><th>@ConfigurationProperties</th><th>@Value</th></tr></thead><tbody><tr><td>功能</td><td>批量注入配置文件中的属性</td><td>一个个指定</td></tr><tr><td>松散绑定(松散语法)</td><td>支持</td><td>不支持</td></tr><tr><td>SPEL</td><td>不支持</td><td>支持</td></tr><tr><td>JSR303数据校验</td><td>支持</td><td>不支持</td></tr><tr><td>复杂类型封装</td><td>支持</td><td>不支持</td></tr></tbody></table> 
<ul><li> <p>松散绑定：比如我的yaml中写的last-name，这个和lastName是一样的， - 后面跟着的字母默认是大写的，这就是松散绑定</p> </li><li> <p>JSR303数据校验：这个就是我们可以在字段是增加一层过滤验证，可以保证数据的合法性</p> </li><li> <p>复杂类型封装：yaml中可以封装对象，使用@Value就不支持</p> </li></ul> 
<hr> 
<h3><a id="5_JSR303_506"></a>5. JSR303数据校验</h3> 
<p>注解@Validate添加到实体类上，如</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Component</span>
<span class="token annotation punctuation">@ConfigurationProperties</span><span class="token punctuation">(</span>prefix <span class="token operator">=</span> <span class="token string">"person"</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Validated</span> <span class="token comment">//数据校验</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Person</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Email</span>  <span class="token comment">// 指定email属性要符合邮箱格式，可以指定一些值，如@Email(message="邮箱格式错误")</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> email<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> age<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Boolean</span> happy<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Date</span> birth<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> map<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> list<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Dog</span> dog<span class="token punctuation">;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre> 
<pre><code class="prism language-yaml"><span class="token key atrule">person</span><span class="token punctuation">:</span>
  <span class="token key atrule">email</span><span class="token punctuation">:</span> xxx
  <span class="token key atrule">name</span><span class="token punctuation">:</span> 唐嫣$<span class="token punctuation">{<!-- --></span>random.uuid<span class="token punctuation">}</span>  <span class="token comment">#随机uuid</span>
  <span class="token key atrule">age</span><span class="token punctuation">:</span> $<span class="token punctuation">{<!-- --></span>random.int<span class="token punctuation">}</span>    <span class="token comment">#随机数</span>
  <span class="token key atrule">happy</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
  <span class="token key atrule">birth</span><span class="token punctuation">:</span> 1986/12/21
  <span class="token punctuation">...</span>.
</code></pre> 
<p>测试结果：</p> 
<p><img src="https://images2.imgbox.com/f4/00/xTeO7d0I_o.png" alt="在这里插入图片描述"></p> 
<p>还有很多注解：(前提必须在实体类上写上了@Validated)</p> 
<table><thead><tr><th align="left"><strong>Constraint</strong></th><th align="left"><strong>详细信息</strong></th></tr></thead><tbody><tr><td align="left"><code>@Null</code></td><td align="left">被注释的元素必须为 <code>null</code></td></tr><tr><td align="left"><code>@NotNull</code></td><td align="left">被注释的元素必须不为 <code>null</code></td></tr><tr><td align="left"><code>@AssertTrue</code></td><td align="left">被注释的元素必须为 <code>true</code></td></tr><tr><td align="left"><code>@AssertFalse</code></td><td align="left">被注释的元素必须为 <code>false</code></td></tr><tr><td align="left"><code>@Min(value)</code></td><td align="left">被注释的元素必须是一个数字，其值必须大于等于指定的最小值</td></tr><tr><td align="left"><code>@Max(value)</code></td><td align="left">被注释的元素必须是一个数字，其值必须小于等于指定的最大值</td></tr><tr><td align="left"><code>@DecimalMin(value)</code></td><td align="left">被注释的元素必须是一个数字，其值必须大于等于指定的最小值</td></tr><tr><td align="left"><code>@DecimalMax(value)</code></td><td align="left">被注释的元素必须是一个数字，其值必须小于等于指定的最大值</td></tr><tr><td align="left"><code>@Size(max, min)</code></td><td align="left">被注释的元素的大小必须在指定的范围内</td></tr><tr><td align="left"><code>@Digits (integer, fraction)</code></td><td align="left">被注释的元素必须是一个数字，其值必须在可接受的范围内</td></tr><tr><td align="left"><code>@Past</code></td><td align="left">被注释的元素必须是一个过去的日期</td></tr><tr><td align="left"><code>@Future</code></td><td align="left">被注释的元素必须是一个将来的日期</td></tr><tr><td align="left"><code>@Pattern(value)</code></td><td align="left">被注释的元素必须符合指定的正则表达式</td></tr><tr><td align="left"><code>@Email</code></td><td align="left">被注释的元素必须是电子邮箱地址</td></tr><tr><td align="left"><code>@Length</code></td><td align="left">被注释的字符串的大小必须在指定的范围内</td></tr><tr><td align="left"><code>@NotEmpty</code></td><td align="left">被注释的字符串的必须非空</td></tr><tr><td align="left"><code>@Range</code></td><td align="left">被注释的元素必须在合适的范围内</td></tr></tbody></table> 
<hr> 
<h3><a id="6__567"></a>6. 多环境配置及配置文件位置</h3> 
<h4><a id="61__569"></a>6.1 配置文件可以存在的位置</h4> 
<ol><li>可以在项目根目录下建一个目录：config，和src目录同级，可以将配置文件放在config目录下</li><li>配置文件可以直接放在项目根目录下</li><li>配置文件可以放在main下的resources目录中</li><li>配置文件可以放在rescources目录下的config目录下</li></ol> 
<p><strong>配置文件的优先级(从高到底)：</strong></p> 
<ol><li>项目目录下的config目录下的配置文件</li><li>项目目录下的配置文件</li><li>main目录下的resources下的config目录下的配置文件</li><li>resources下的配置文件</li></ol> 
<p><img src="https://images2.imgbox.com/ac/5a/4Ry2BkcN_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="62__585"></a>6.2 多套配置环境直接快速切换</h4> 
<p><strong>方式一：在优先级高的地方新建配置文件，覆盖之前的配置文件</strong></p> 
<p><strong>方式二：通过配置进行选择配置文件</strong></p> 
<p>我们可以在同意目录下拥有多套配置文件，如</p> 
<p>application.yaml(默认)</p> 
<p>application-test.yaml</p> 
<p>application-dev.yaml</p> 
<p><img src="https://images2.imgbox.com/52/e3/NGCJeNVz_o.png" alt="在这里插入图片描述"></p> 
<p>在没有更高优先级配置文件时，springboot会自动读取application.yaml配置文件，我们可以在application.yaml中进行一些配置来指定使用其他的配置文件，如</p> 
<pre><code class="prism language-yaml"><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">profiles</span><span class="token punctuation">:</span>
    <span class="token key atrule">active</span><span class="token punctuation">:</span> test
</code></pre> 
<p>这样就指定了使用application-test.yaml配置文件</p> 
<p>使用该配置可以选择激活哪一个配置文件，值只写"-"后面的值就可以，如dev，test</p> 
<p><strong>方式三：</strong></p> 
<p>在yaml中，我们可以使用“—”来将一个yaml文件分隔成不同的模块，每一个模块相当于不同的配置文件</p> 
<pre><code class="prism language-yaml"><span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8081</span>
<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">profiles</span><span class="token punctuation">:</span>
    <span class="token key atrule">active</span><span class="token punctuation">:</span> test
<span class="token punctuation">---</span>
<span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8082</span>
<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">profiles</span><span class="token punctuation">:</span> dev
<span class="token punctuation">---</span>
<span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8083</span>
<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">profiles</span><span class="token punctuation">:</span> test
</code></pre> 
<p>我们可以通过</p> 
<pre><code class="prism language-yaml"><span class="token key atrule">spring</span><span class="token punctuation">:</span>
	<span class="token key atrule">profiles</span><span class="token punctuation">:</span> xxx
</code></pre> 
<p>来给模块取名字，如果没有给模块取名字，springboot则会使用最上面没有取名字的模块，我们仍然可以通过</p> 
<pre><code class="prism language-yaml"><span class="token key atrule">spring</span><span class="token punctuation">:</span>
	<span class="token key atrule">profiles</span><span class="token punctuation">:</span>
		<span class="token key atrule">active</span><span class="token punctuation">:</span> xxx
</code></pre> 
<p>来指定想要使用的模块</p> 
<hr> 
<h3><a id="7__654"></a>7. 自动配置原理再理解</h3> 
<p>在application.yaml配置文件中到底能写什么-----&gt;spring.factories 这两个之间有一定的联系</p> 
<p><img src="https://images2.imgbox.com/3a/99/1e918u4O_o.png" alt="在这里插入图片描述"></p> 
<p>spring.factories中指定的一些类，点进去就可以看到它们都是一个个的配置类，他们通过@EnableConfigurationProperties(xxx.class)来加载一些类，读取配置文件，在这些被加载的类中的属性就是我们可以配置的，如</p> 
<p><strong>我们随便点进去一个类</strong></p> 
<p><img src="https://images2.imgbox.com/2c/29/B4EnviJz_o.png" alt="在这里插入图片描述"></p> 
<p><strong>我们可以看到该类加载读取了ProjectInfoProperties.class类(XxxProperties.class)</strong></p> 
<p><img src="https://images2.imgbox.com/20/e5/PzFZ5IVW_o.png" alt="在这里插入图片描述"></p> 
<p><strong>我们点进这个类</strong></p> 
<p><img src="https://images2.imgbox.com/4a/70/uEEihEtS_o.png" alt="在这里插入图片描述"></p> 
<p><strong>就可以看到该类可以通过yaml文件来对该类中的属性进行赋值配置，前缀是spring.info</strong></p> 
<p>所以我们就可以通过配置文件application.yaml来配置这些属性，如</p> 
<p><img src="https://images2.imgbox.com/c1/e5/MgwUoWhq_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@ConditionalOnXxx</span>
<span class="token comment">// 该注解是spring底层的注解，根据不用的条件，来判断当前配置或者是类是否生效，如</span>
<span class="token annotation punctuation">@ConditionalOnClass</span><span class="token punctuation">(</span><span class="token class-name">CharacterEncodingFilter</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token comment">// 判断是否有CharacterEncodingFilter这个类，如果有这个类，当前配置才会生效，否则不生效</span>
</code></pre> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Conditional</span>扩展注解                 	 作用
    
 <span class="token annotation punctuation">@ConditionalOnJava</span>                     系统的java版本是否符合要求
 <span class="token annotation punctuation">@ConditionalOnBean</span>                     容器中存在指定<span class="token class-name">Bean</span>
 <span class="token annotation punctuation">@ConditionalOnMissingBean</span>          	容器中不存在指定<span class="token class-name">Bean</span>
 <span class="token annotation punctuation">@ConditionalOnExpression</span>             	满足<span class="token class-name">SpEL</span>表达式指定
 <span class="token annotation punctuation">@ConditionalOnClass</span>                    系统中有指定的类
 <span class="token annotation punctuation">@ConditionalOnMissingClass</span>          	系统中没有指定的类
 <span class="token annotation punctuation">@ConditionalOnSingleCandidate</span>     		容器中只有一个指定的<span class="token class-name">Bean</span>，或者这个<span class="token class-name">Bean</span>是首选<span class="token class-name">Bean</span>
 <span class="token annotation punctuation">@ConditionalOnProperty</span>                 系统中指定的属性是否有指定的值
 <span class="token annotation punctuation">@ConditionalOnResource</span>                 路径下是否存在指定资源文件
 <span class="token annotation punctuation">@ConditionalOnWebApplication</span>      		当前是web环境
 <span class="token annotation punctuation">@ConditionalOnNotWebApplication</span>		当前不是web环境
 <span class="token annotation punctuation">@ConditionalOnJndi</span>                     <span class="token constant">JNDI</span>存在指定项
</code></pre> 
<p>在我们配置文件中能配置的东西，都存在一个固有的规律：</p> 
<p>存在对应的xxxProperties文件，如</p> 
<pre><code class="prism language-yaml"><span class="token key atrule">spring</span><span class="token punctuation">:</span>
	<span class="token key atrule">webservices</span><span class="token punctuation">:</span>
		<span class="token key atrule">path</span><span class="token punctuation">:</span> xxx
</code></pre> 
<p>就对应着WebServicesProperties.class配置类</p> 
<p>这个类一般又会配xxxAutoConfiguration装配，如</p> 
<p>WebServicesAutoConfiguration就可以在spring.factories中找到</p> 
<p><img src="https://images2.imgbox.com/6d/e9/qOLrkDiM_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/db/fb/j2d6peLn_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/2b/72/ImffS0XL_o.png" alt="在这里插入图片描述"></p> 
<p>这样就在我们就找到了yaml文件和spring.factories文件之间存在的关系，这就是自动装配的原理</p> 
<h4><a id="71__728"></a>7.1 精髓</h4> 
<ol><li> <p>SpringBoot启动会加载大量的自动配置类</p> </li><li> <p>我们看我们需要的功能有没有在Springboot默认写好的自动配置类中</p> </li><li> <p>我们再来看这个自动配置类中到底配置了哪些组件(只要我们要用的组件存在其中，我们就不需要再手动配置了)</p> </li><li> <p>给容器中自动配置类添加组件的时候，会从properties类中读取某些属性，我们只需要再配置文件中指定这些属性的值即可</p> <p>xxxAutoConfiguration：自动配置类</p> <p>xxxProperties：封装配置文件中相关属性</p> </li></ol> 
<h4><a id="72__742"></a>7.2 其他</h4> 
<p>在配置文件中添加一行</p> 
<pre><code class="prism language-yaml"><span class="token key atrule">debug</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
</code></pre> 
<p>启动springboot程序，我们就可以看到哪些配置生效，哪些配置没有生效</p> 
<p>测试结果</p> 
<p><img src="https://images2.imgbox.com/eb/03/kxcHuQHi_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/90/70/W04gGIDT_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/39/ee/nRBFkjPM_o.png" alt="在这里插入图片描述"></p> 
<hr> 
<h3><a id="8_SpringBoot_Web_761"></a>8. SpringBoot Web开发</h3> 
<p>要解决的问题：</p> 
<ol><li>导入静态资源</li><li>首页</li><li>模板引擎</li><li>装配扩展SpringMVC</li><li>增删改查</li><li>拦截器</li><li>国际化(中英文切换)</li></ol> 
<h4><a id="81__773"></a>8.1 静态资源导入</h4> 
<p>在WebMvcConfiguration类中有相关配置</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">addResourceHandlers</span><span class="token punctuation">(</span><span class="token class-name">ResourceHandlerRegistry</span> registry<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>resourceProperties<span class="token punctuation">.</span><span class="token function">isAddMappings</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        logger<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">"Default resource handling disabled"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token class-name">Duration</span> cachePeriod <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>resourceProperties<span class="token punctuation">.</span><span class="token function">getCache</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getPeriod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">CacheControl</span> cacheControl <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>resourceProperties<span class="token punctuation">.</span><span class="token function">getCache</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getCachecontrol</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHttpCacheControl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>registry<span class="token punctuation">.</span><span class="token function">hasMappingForPattern</span><span class="token punctuation">(</span><span class="token string">"/webjars/**"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token function">customizeResourceHandlerRegistration</span><span class="token punctuation">(</span>registry<span class="token punctuation">.</span><span class="token function">addResourceHandler</span><span class="token punctuation">(</span><span class="token string">"/webjars/**"</span><span class="token punctuation">)</span>
                                             <span class="token punctuation">.</span><span class="token function">addResourceLocations</span><span class="token punctuation">(</span><span class="token string">"classpath:/META-INF/resources/webjars/"</span><span class="token punctuation">)</span>
                                             <span class="token punctuation">.</span><span class="token function">setCachePeriod</span><span class="token punctuation">(</span><span class="token function">getSeconds</span><span class="token punctuation">(</span>cachePeriod<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setCacheControl</span><span class="token punctuation">(</span>cacheControl<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token class-name">String</span> staticPathPattern <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>mvcProperties<span class="token punctuation">.</span><span class="token function">getStaticPathPattern</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>registry<span class="token punctuation">.</span><span class="token function">hasMappingForPattern</span><span class="token punctuation">(</span>staticPathPattern<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token function">customizeResourceHandlerRegistration</span><span class="token punctuation">(</span>registry<span class="token punctuation">.</span><span class="token function">addResourceHandler</span><span class="token punctuation">(</span>staticPathPattern<span class="token punctuation">)</span>
                                             <span class="token punctuation">.</span><span class="token function">addResourceLocations</span><span class="token punctuation">(</span><span class="token function">getResourceLocations</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>resourceProperties<span class="token punctuation">.</span><span class="token function">getStaticLocations</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                                             <span class="token punctuation">.</span><span class="token function">setCachePeriod</span><span class="token punctuation">(</span><span class="token function">getSeconds</span><span class="token punctuation">(</span>cachePeriod<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setCacheControl</span><span class="token punctuation">(</span>cacheControl<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><strong>什么是webjars：</strong></p> 
<p>我们可以通过webjars网站找到需要的资源，然后通过maven导入</p> 
<p><img src="https://images2.imgbox.com/02/53/mIILwPWO_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/d3/81/oAnkj7sT_o.png" alt="在这里插入图片描述"></p> 
<p>然后我们可以通过localhost:8080/webjars/xxx获取到刚才导入的资源，如</p> 
<p><img src="https://images2.imgbox.com/c3/98/oTIssmue_o.png" alt="在这里插入图片描述"></p> 
<p>我们静态资源可以放在</p> 
<p>classpath:(就相当于是resources目录) <mark>很少使用webjars</mark></p> 
<pre><code class="prism language-java">classpath<span class="token operator">:</span><span class="token operator">/</span><span class="token constant">META</span><span class="token operator">-</span><span class="token constant">INF</span><span class="token operator">/</span>resources<span class="token operator">/</span> 下，就是webjars
classpath<span class="token operator">:</span><span class="token operator">/</span>resources<span class="token operator">/</span> 下
classpath<span class="token operator">:</span><span class="token operator">/</span><span class="token keyword">static</span><span class="token operator">/</span> 下
classpath<span class="token operator">:</span><span class="token operator">/</span><span class="token keyword">public</span><span class="token operator">/</span> 下
classpath<span class="token operator">:</span><span class="token operator">/</span> 下
</code></pre> 
<p><img src="https://images2.imgbox.com/68/cd/CM9U4P9X_o.png" alt="在这里插入图片描述"></p> 
<p>静态资源放在这些文件夹下就可以通过localhost:8080/xxx直接访问到了(除了webjars)</p> 
<p>优先级(从高到底)：</p> 
<ol><li>classpath:/resources/ 下 优先级最高 一般放上传的文件</li><li>classpath:/static/ 下 优先级第二 一般放一些图片等</li><li>classpath:/public/ 下 优先级第三 一般放一些公共资源，js等</li></ol> 
<h4><a id="82__834"></a>8.2 首页订制</h4> 
<p>首页index.html可以放在静态资源目录下，resources下的resources中，或static中，或public中</p> 
<p>访问localhost:8080/ 我们就可以直接访问到主页</p> 
<p><img src="https://images2.imgbox.com/b3/d5/b9DXrARx_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/60/47/DG6dOie0_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="83__844"></a>8.3 图标订制</h4> 
<p>在springboot2.1.7前，可以进行图标订制</p> 
<p>把ico图标放在public或resources或static下</p> 
<p>然后在配置文件中关闭默认图标</p> 
<pre><code class="prism language-yaml"><span class="token key atrule">spring</span><span class="token punctuation">:</span>
	<span class="token key atrule">mvc</span><span class="token punctuation">:</span>
		<span class="token key atrule">favicon</span><span class="token punctuation">:</span>
			<span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
</code></pre> 
<p>访问我们的网页就可以看到ico小图标了</p> 
<h4><a id="84__861"></a>8.4 模板引擎</h4> 
<p>之前我们用的jsp就是一种模板引擎</p> 
<p>Thymeleaf官网：https://www.thymeleaf.org/</p> 
<p>Thymeleaf的GitHub主页：https://github.com/thymeleaf/thymeleaf</p> 
<p>springboot官网对应的starter：https://docs.spring.io/spring-boot/docs/2.2.7.RELEASE/reference/html/using-spring-boot.html#using-boot-starter</p> 
<p><img src="https://images2.imgbox.com/c8/e7/74qcnoKp_o.png" alt="在这里插入图片描述"></p> 
<p><strong>首先我们要导入依赖 启动器</strong></p> 
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.thymeleaf<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>thymeleaf-spring5<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.thymeleaf.extras<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>thymeleaf-extras-java8time<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>模板引擎的作用就是我们来写一个页面模板，比如有些值是动态的，我们写一些表达式，来获取从后台传过来的数据</p> 
<p>这样我们在resources目录下的templates目录下写的html就可以通过controller来跳转访问了</p> 
<p>templates目录下的资源像之前的/WEB-INF下的资源一样，不能够直接访问到，要通过controller跳转访问</p> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">DEFAULT_PREFIX</span> <span class="token operator">=</span> <span class="token string">"classpath:/templates/"</span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">DEFAULT_SUFFIX</span> <span class="token operator">=</span> <span class="token string">".html"</span><span class="token punctuation">;</span>
</code></pre> 
<p><strong>使用Thymeleaf</strong></p> 
<p>首先我们要导入约束</p> 
<pre><code class="prism language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name"><span class="token namespace">xmlns:</span>th</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.thymeleaf.org<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p><img src="https://images2.imgbox.com/3b/32/YtZlZNcm_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="85_Thymeleaf_907"></a>8.5 Thymeleaf语法</h4> 
<p>所有的html元素都可以被thymeleaf替换接管，<code>th:元素名</code>，如</p> 
<pre><code class="prism language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name"><span class="token namespace">th:</span>text</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>${msg}<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>   // 这样就可以取出后台传过来的msg数据了
</code></pre> 
<ul><li>简单表达式： 
  <ul><li>变量表达式： <code>${...}</code></li><li>选择变量表达式： <code>*{...}</code></li><li>消息表达： <code>#{...}</code></li><li>链接URL表达式： <code>@{...}</code></li><li>片段表达式： <code>~{...}</code></li></ul> </li></ul> 
<p><img src="https://images2.imgbox.com/9e/aa/EeTXtVWh_o.png" alt="在这里插入图片描述"></p> 
<p><strong>th:text th:utext</strong></p> 
<p>th:text 不转义</p> 
<p>th:utext 转义</p> 
<p>如果使用<code>th:text</code>，后台如果传<code>"&lt;h1&gt;xxx&lt;/h1&gt;"</code>，那么在页面上就会原样输出</p> 
<p>如果使用<code>th:utext</code>，就会对后台传入的数据进行转义，如传入<code>&lt;h1&gt;xxx&lt;/h1&gt;</code>，那么就会在页面上显示出<code>&lt;h1&gt;</code>的格式</p> 
<pre><code class="prism language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name"><span class="token namespace">th:</span>utext</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>${msg}<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>还有另外一种写法</p> 
<pre><code class="prism language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>[[${msg}]]<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>通过这种写法也可以取出msg的值</p> 
<p><strong>th:each 遍历</strong></p> 
<pre><code class="prism language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h3</span> <span class="token attr-name"><span class="token namespace">th:</span>each</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>user:${users}<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">th:</span>text</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>${user}<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h3</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p><img src="https://images2.imgbox.com/1f/80/nlLPXfPN_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="86_SpringMVC_954"></a>8.6 扩展装配SpringMVC</h4> 
<p>要拓展SpringMVC，实现一些拦截器，格式化，视图解析器等，我们要自己定义一个类，然后添加注解<code>@Configuration</code>，实现接口<code>WebMvcCongigurar</code>，不能添加注解<code>@EnableWebMvc</code>，重写里面的方法来实现想要的功能，如</p> 
<pre><code class="prism language-java"><span class="token comment">// 全面扩展SpringMVC</span>
<span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyMvcConfig</span> <span class="token keyword">implements</span> <span class="token class-name">WebMvcConfigurer</span> <span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">addInterceptors</span><span class="token punctuation">(</span><span class="token class-name">InterceptorRegistry</span> registry<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token punctuation">}</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>如果想diy一些定制化的功能，只要写这个组件，然后将他交给springboot，springboot就会帮我们自动装配，如</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyMvcConfig</span> <span class="token keyword">implements</span> <span class="token class-name">WebMvcConfigurer</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">ViewResolver</span> <span class="token function">myViewResolver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">MyViewResolver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">MyViewResolver</span> <span class="token keyword">implements</span> <span class="token class-name">ViewResolver</span><span class="token punctuation">{<!-- --></span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token class-name">View</span> <span class="token function">resolveViewName</span><span class="token punctuation">(</span><span class="token class-name">String</span> s<span class="token punctuation">,</span> <span class="token class-name">Locale</span> locale<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>在springboot中，有很多的xxxConfiguration，会帮助我们进行扩展配置，只要看见了这个东西，我们就要注意了！</p> 
<hr> 
<h3><a id="9__995"></a>9. 员工管理系统</h3> 
<h4><a id="91__997"></a>9.1 首页配置</h4> 
<p>注意点：所有页面静态资源都需要使用thymeleaf接管，<code>@{}</code>，如</p> 
<pre><code class="prism language-html"><span class="token comment">&lt;!-- Bootstrap core CSS --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name"><span class="token namespace">th:</span>href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@{/css/bootstrap.min.css}<span class="token punctuation">"</span></span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>stylesheet<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!-- Custom styles for this template --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name"><span class="token namespace">th:</span>href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@{/css/signin.css}<span class="token punctuation">"</span></span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>stylesheet<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>首页放在了templates目录下，不能够直接被访问，我们可以配置，直接访问</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyMvcConfig</span> <span class="token keyword">implements</span> <span class="token class-name">WebMvcConfigurer</span> <span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">addViewControllers</span><span class="token punctuation">(</span><span class="token class-name">ViewControllerRegistry</span> registry<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        registry<span class="token punctuation">.</span><span class="token function">addViewController</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setViewName</span><span class="token punctuation">(</span><span class="token string">"index"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        registry<span class="token punctuation">.</span><span class="token function">addViewController</span><span class="token punctuation">(</span><span class="token string">"/index.html"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setViewName</span><span class="token punctuation">(</span><span class="token string">"index"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>可以通过<code>localhost:8080/</code>或<code>localhost:8080/index.html</code>直接访问</p> 
<h4><a id="92__1023"></a>9.2 国际化</h4> 
<p>首先IDEA的fileencoding要全部改为UTF-8</p> 
<p>在resources目录下建一个i18n(国际化单词的缩写)目录</p> 
<p>在i18n目录下新建一个配置文件<code>login.properties</code></p> 
<p>再建一个配置文件<code>login_zh_CN.properties</code>，会发现两个配置晚间自动合并到了一个目录下</p> 
<p><img src="https://images2.imgbox.com/99/7d/Xcwq7k18_o.png" alt="在这里插入图片描述"></p> 
<p>然后右键自动生成的目录，点加号，输入<code>en_US</code>，点击OK，就又添加了一个配置文件</p> 
<p><img src="https://images2.imgbox.com/fd/f2/gkjsaoKH_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/bb/01/z4uKaJpi_o.png" alt="在这里插入图片描述"></p> 
<p>在idea中，在编写配置文件时，可以点击下面的Resource Bundle进行可视化配置</p> 
<p><img src="https://images2.imgbox.com/40/be/5HHLYzM5_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/fd/fe/8A83VCMH_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/c4/8b/gvANCu1V_o.png" alt="在这里插入图片描述"></p> 
<p>这样用可是化配置，在一个里面就可以配置三个配置文件</p> 
<p>这样就会在login.properties配置文件中存在login.tip=请登录</p> 
<p>在login_en_US.properties配置文件中存在login.tip=Please sign in</p> 
<p>在login_zh_CN.properties配置文件中存在login.tip=请登录</p> 
<p><img src="https://images2.imgbox.com/8a/d7/McAiJh2Q_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/5c/26/hRpDkDhl_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/b7/ef/oKFb45Cq_o.png" alt="在这里插入图片描述"></p> 
<p>然后在application配置文件中进行配置(指定国际化自动生成的那个包)，如</p> 
<pre><code class="prism language-yaml"><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">messages</span><span class="token punctuation">:</span>
    <span class="token key atrule">basename</span><span class="token punctuation">:</span> i18n.login
</code></pre> 
<p>thymeleaf中国际化的表达式为<code>#{...}</code></p> 
<p>然后在页面html中进行修改对应的值</p> 
<p><strong>那么怎么实现国际之间的切换呢？？</strong></p> 
<p>如果实现了<code>LocaleResolver</code>接口，那么这个类就是一个国际化解析的类，如</p> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyLocaleResolver</span> <span class="token keyword">implements</span> <span class="token class-name">LocaleResolver</span> <span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Locale</span> <span class="token function">resolveLocale</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 获取请求中的语言参数</span>
        <span class="token class-name">String</span> language <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token string">"l"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Locale</span> locale <span class="token operator">=</span> <span class="token class-name">Locale</span><span class="token punctuation">.</span><span class="token function">getDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 如果没有就使用默认的</span>
        <span class="token comment">// 如果请求的连接携带了国际化的参数</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>language<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            <span class="token comment">// zh_CN  国家，地区</span>
            <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> s <span class="token operator">=</span> language<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">"_"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            locale <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Locale</span><span class="token punctuation">(</span>s<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> s<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> locale<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setLocale</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">,</span> <span class="token class-name">Locale</span> locale<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>写完国际化类后，我们要将其放入IOC中，这样我们自定义的国际化组件就生效了</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">LocaleResolver</span> <span class="token function">localeResolver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">MyLocaleResolver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>由前端进行传递参数</p> 
<pre><code class="prism language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>btn btn-sm<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">th:</span>href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@{/index.html(l='zh_CN')}<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>中文<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>btn btn-sm<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">th:</span>href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@{/index.html(l='en_US')}<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>English<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>这样我们就实现了国际化的切换了</p> 
<p><strong>核心：</strong></p> 
<ol><li>配置i18n文件</li><li>如果要实现点击按钮自动切换，我们就需要自定义一个国际化组件LocaleResolver</li><li>将自己写的国际化组件放入IOC中</li><li>前端传递参数 <code>th:href="@{/index.html(xx='xxxx')}"</code></li></ol> 
<h4><a id="93__1127"></a>9.3 登录功能实现</h4> 
<p>在做提示信息回显是，在前端要判断回显的信息是否为空，如</p> 
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value css language-css"><span class="token property">color</span><span class="token punctuation">:</span> red</span><span class="token punctuation">"</span></span></span> <span class="token attr-name"><span class="token namespace">th:</span>if</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>${not #strings.isEmpty(msg)}<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">th:</span>text</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>${msg}<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p><code>#strings.xxx</code>是thymeleaf中封装的工具类，themeleaf中封装了很多的工具类</p> 
<p>测试登录成功后，url会暴露出用户名和密码，如</p> 
<p><img src="https://images2.imgbox.com/d6/47/MD9kpokG_o.png" alt="在这里插入图片描述"></p> 
<p>解决这个问题，我们可以在配置类中添加视图映射，就是在视图解析器配置类中添加</p> 
<pre><code class="prism language-java">registry<span class="token punctuation">.</span><span class="token function">addViewController</span><span class="token punctuation">(</span><span class="token string">"/main.html"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setViewName</span><span class="token punctuation">(</span><span class="token string">"dashboard"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>在访问<code>/main.html</code>时，显示的是<code>dashboard</code>的页面</p> 
<p>然后再我们的LoginController中，返回时重定向到<code>main.html</code>，这样显示的页面就为dashboard.html，且url为<code>localhost:8080/mian.html</code></p> 
<p><img src="https://images2.imgbox.com/4a/c0/nYXpFaCT_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="94__1153"></a>9.4 登录拦截器</h4> 
<p>首先写一个类，实现HandlerIntercepter接口，那么这个类，就称为了一个拦截器(和SpringMVC中一样)</p> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LoginHandlerInterceptor</span> <span class="token keyword">implements</span> <span class="token class-name">HandlerInterceptor</span> <span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">preHandle</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">,</span> <span class="token class-name">Object</span> handler<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 登录成功后，应该存在用户的session</span>
        <span class="token class-name">HttpSession</span> session <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> loginUser <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span>session<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">"loginUser"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>loginUser<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>loginUser<span class="token operator">==</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>loginUser<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>loginUser<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
            request<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"msg"</span><span class="token punctuation">,</span><span class="token string">"没有权限，请先登录"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            request<span class="token punctuation">.</span><span class="token function">getRequestDispatcher</span><span class="token punctuation">(</span><span class="token string">"/index.html"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forward</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>然后，在视图解析器配置类WebMvcConfiguter中将拦截器放入IOC中，并指定需要拦截的内容</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">addInterceptors</span><span class="token punctuation">(</span><span class="token class-name">InterceptorRegistry</span> registry<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        registry<span class="token punctuation">.</span><span class="token function">addInterceptor</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">LoginHandlerInterceptor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">addPathPatterns</span><span class="token punctuation">(</span><span class="token string">"/**"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">excludePathPatterns</span><span class="token punctuation">(</span><span class="token string">"/index.html"</span><span class="token punctuation">,</span><span class="token string">"/"</span><span class="token punctuation">,</span><span class="token string">"/user/login"</span><span class="token punctuation">,</span><span class="token string">"/css/**"</span><span class="token punctuation">,</span><span class="token string">"/js/**"</span><span class="token punctuation">,</span><span class="token string">"/img/**"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> 
<p>这样，我们的登录验证过滤器就实现了</p> 
<h4><a id="95__1190"></a>9.5 展示员工列表</h4> 
<p>抽取页面的公共部分</p> 
<p>一般我们会抽取出公共的组件放入commons.html中，然后在需要的地方进行引用</p> 
<p>抽取公共部分：</p> 
<pre><code class="prism language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name"><span class="token namespace">th:</span>fragment</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>topbar<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    ...
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>在需要使用的地方，进行引用</p> 
<pre><code class="prism language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name"><span class="token namespace">th:</span>insert</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>~{commons::topbar}<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>使用<code>th:insert</code>和使用<code>th:replace</code>基本相同</p> 
<pre><code class="prism language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name"><span class="token namespace">th:</span>replace</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>~{commons::topbar}<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>为了实现点击时高亮的切换</p> 
<p>在调用组件的时候传递一些参数</p> 
<pre><code class="prism language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name"><span class="token namespace">th:</span>replace</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>~{commons::topbar(active='mian.html')}<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>在commons.html中在需要参数的地方进行接收参数</p> 
<pre><code class="prism language-html">&lt;a th:class=${acive='main.html'?'样式一','样式二'}
</code></pre> 
<p>运用了三元表达式，如果参数等于main.html，则显示样式一，否则显示样式二</p> 
<p><mark><strong>在thymeleaf中，使用restful风格传递参数：</strong></mark></p> 
<pre><code class="prism language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name"><span class="token namespace">th:</span>href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@{/toUpdate/{empId(empId=${employee.getId()})}<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>编辑<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>或</p> 
<pre><code class="prism language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name"><span class="token namespace">th:</span>href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@{/toUpdate/}+${employee.getId()}<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>编辑<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>第二种方式，加号下面会出现红线，但是不影响正常运行</p> 
<p>springboot中默认日期格式<code>yyyy\MM\dd</code></p> 
<p>如果我们要修改，在application.yaml中指定格式，如</p> 
<pre><code class="prism language-yaml"><span class="token key atrule">spring</span><span class="token punctuation">:</span>
	<span class="token key atrule">mvc</span><span class="token punctuation">:</span>
		<span class="token key atrule">date-format</span><span class="token punctuation">:</span> yyyy<span class="token punctuation">-</span>MM<span class="token punctuation">-</span>dd
</code></pre> 
<h4><a id="96_404_1256"></a>9.6 404页面处理</h4> 
<p>在template目录下建立一个目录error，放一个404页面，就可以了</p> 
<hr> 
<h3><a id="10_JDBC_1262"></a>10. 整合JDBC</h3> 
<p>对于数据访问层，无论是SQL还是NOSQL，springboot底层都是用spring data的方式进行统一处理</p> 
<p>Spring Data官网：https://spring.io/projects/spring-data</p> 
<p>数据库相关的启动器：https://docs.spring.io/spring-boot/docs/2.2.7.RELEASE/reference/html/using-spring-boot.html#using-boot-starter</p> 
<p>创建一个新项目，勾选<code>JDBC Api</code> 和<code>MySQL Driver</code></p> 
<p><img src="https://images2.imgbox.com/d5/20/gHCTnlK7_o.png" alt="在这里插入图片描述"></p> 
<p><strong>首先，在yaml中进行配置</strong></p> 
<pre><code class="prism language-yaml"><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">datasource</span><span class="token punctuation">:</span>
    <span class="token key atrule">username</span><span class="token punctuation">:</span> root
    <span class="token key atrule">password</span><span class="token punctuation">:</span> shw123zxc
    <span class="token key atrule">url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>3306/mybatis<span class="token punctuation">?</span>useUnicode=true<span class="token important">&amp;characterEncoding=UTF-8&amp;useSSL=true&amp;serverTimezone=UTC</span>
    <span class="token key atrule">driver-class-name</span><span class="token punctuation">:</span> com.mysql.cj.jdbc.Driver
</code></pre> 
<p><strong>测试</strong></p> 
<p>只要maven中存在jdbc启动器和mysql驱动，那么就会存在一个对象DataSource</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Autowired</span>
<span class="token class-name">DataSource</span> dataSource<span class="token punctuation">;</span>

<span class="token annotation punctuation">@Test</span>
<span class="token keyword">void</span> <span class="token function">contextLoads</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">SQLException</span> <span class="token punctuation">{<!-- --></span>
    <span class="token class-name">Connection</span> connection <span class="token operator">=</span> dataSource<span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>dataSource<span class="token punctuation">)</span><span class="token punctuation">;</span>
    connection<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>在Springboot中有很多的xxxTemplate：SpringBoot已经配置好的模板Bean，拿来即用，如JdbcTemplate</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Autowired</span>
<span class="token keyword">private</span> <span class="token class-name">DataSource</span> dataSource<span class="token punctuation">;</span>

<span class="token annotation punctuation">@Autowired</span>
<span class="token keyword">private</span> <span class="token class-name">JdbcTemplate</span> jdbcTemplate<span class="token punctuation">;</span>

<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/userList"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Map</span><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> <span class="token function">userList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token class-name">String</span> sql <span class="token operator">=</span> <span class="token string">"select * from user"</span><span class="token punctuation">;</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Map</span><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> maps <span class="token operator">=</span> jdbcTemplate<span class="token punctuation">.</span><span class="token function">queryForList</span><span class="token punctuation">(</span>sql<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> maps<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<hr> 
<h3><a id="11_Druid_1320"></a>11. 整合Druid数据源</h3> 
<p>首先导入Druid的依赖</p> 
<pre><code class="prism language-xml"><span class="token comment">&lt;!-- https://mvnrepository.com/artifact/com.alibaba/druid --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>druid<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.1.22<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>在application.yaml中配置修改数据源(spring中默认的数据源是HikariCP)</p> 
<pre><code class="prism language-yaml"><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">datasource</span><span class="token punctuation">:</span>
    <span class="token key atrule">username</span><span class="token punctuation">:</span> root
    <span class="token key atrule">password</span><span class="token punctuation">:</span> shw123zxc
    <span class="token key atrule">url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>3306/mybatis<span class="token punctuation">?</span>useUnicode=true<span class="token important">&amp;characterEncoding=UTF-8&amp;useSSL=true&amp;serverTimezone=UTC</span>
    <span class="token key atrule">driver-class-name</span><span class="token punctuation">:</span> com.mysql.cj.jdbc.Driver
    <span class="token key atrule">type</span><span class="token punctuation">:</span> com.alibaba.druid.pool.DruidDataSource
</code></pre> 
<p>另外在application.yaml中我们可以配置一些最大连接数，最大等待数，日志记录等。。</p> 
<p>druid比其他数据源强势的一点在于：拥有<strong>监控功能</strong>，配置</p> 
<pre><code class="prism language-yaml">	<span class="token key atrule">filters</span><span class="token punctuation">:</span> stat<span class="token punctuation">,</span>wall<span class="token punctuation">,</span>log4j
</code></pre> 
<p>因为有log4j，所以我们要导入log4j的依赖</p> 
<p>配置Druid的后台监控功能</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DruidConfig</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Bean</span>
    <span class="token annotation punctuation">@ConfigurationProperties</span><span class="token punctuation">(</span>prefix <span class="token operator">=</span> <span class="token string">"spring.datasource"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">DataSource</span> <span class="token function">druidDataSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">DruidDataSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 后台监控功能</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">ServletRegistrationBean</span> <span class="token function">servletRegistrationBean</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token class-name">ServletRegistrationBean</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">StatViewServlet</span><span class="token punctuation">&gt;</span></span> bean <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ServletRegistrationBean</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">StatViewServlet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"/druid/*"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 后台需要有人登录，账号密码配置</span>
        <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> initParameters <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 增加配置</span>
        initParameters<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"loginUsername"</span><span class="token punctuation">,</span><span class="token string">"admin"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 登录key是固定的 loginUsername loginPassword</span>
        initParameters<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"loginPassword"</span><span class="token punctuation">,</span><span class="token string">"123456"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 允许谁能访问</span>
        <span class="token comment">// 值为空，代表所有人可以访问</span>
        initParameters<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"allow"</span><span class="token punctuation">,</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 禁止谁能访问</span>
		<span class="token comment">// initParameters.put("codewei","192.168.1.1");  // 指定名字和ip</span>
        bean<span class="token punctuation">.</span><span class="token function">setInitParameters</span><span class="token punctuation">(</span>initParameters<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 设置初始化参数</span>
        <span class="token keyword">return</span> bean<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>这样通过<code>localhost:8080/druid</code>就可以访问到后台页面了</p> 
<p>配置filter</p> 
<pre><code class="prism language-java"><span class="token comment">//filter</span>
<span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">FilterRegistrationBean</span> <span class="token function">webStatFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token class-name">FilterRegistrationBean</span> bean <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FilterRegistrationBean</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    bean<span class="token punctuation">.</span><span class="token function">setFilter</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">WebStatFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 可以过滤哪些请求</span>
    <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> initParameters <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 这些东西不进行统计</span>
    initParameters<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"exclusions"</span><span class="token punctuation">,</span><span class="token string">"*.js,*.css,/druid/"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    bean<span class="token punctuation">.</span><span class="token function">setInitParameters</span><span class="token punctuation">(</span>initParameters<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> bean<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<hr> 
<h3><a id="12_Mybatis_1413"></a>12. 整合Mybatis</h3> 
<p>首先导入依赖 mybatis-spring-boot-starter</p> 
<p>然后进行配置数据源</p> 
<pre><code class="prism language-yaml"><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">datasource</span><span class="token punctuation">:</span>
    <span class="token key atrule">type</span><span class="token punctuation">:</span> com.alibaba.druid.pool.DruidDataSource
    <span class="token key atrule">url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>3306<span class="token punctuation">?</span>useSSL=true<span class="token important">&amp;useUnicode=true&amp;characterEncoding=UTF-8&amp;serverTimezone=UTC</span>
    <span class="token key atrule">username</span><span class="token punctuation">:</span> root
    <span class="token key atrule">password</span><span class="token punctuation">:</span> shw123zxc
    <span class="token key atrule">driver-class-name</span><span class="token punctuation">:</span> com.mysql.cj.jdbc.Driver
</code></pre> 
<p>在Mapper接口上添加注解<code>@Mapper</code>，表示本类一个mybatis的接口</p> 
<p>或者在启动类上添加注解<code>@MapperScan("...")</code>，开启包扫描，就是扫描该包下所有Mapper</p> 
<p>然后要在接口上添加注解<code>@Repository</code>，让入IOC中</p> 
<p>然后可以在application.yaml中整合mybatis，如</p> 
<pre><code class="prism language-yaml"><span class="token key atrule">mybatis</span><span class="token punctuation">:</span>
  <span class="token key atrule">type-aliases-package</span><span class="token punctuation">:</span> cn.codewei.pojo   <span class="token comment"># 取别名，指定包</span>
  <span class="token key atrule">mapper-locations</span><span class="token punctuation">:</span> classpath<span class="token punctuation">:</span>mybatis/mapper/<span class="token important">*.xml</span>   <span class="token comment">#指定mapper.xml路径</span>
</code></pre> 
<p>这样就和正常写mybatis一样了</p> 
<hr> 
<h3><a id="13_SpringSecurity_1447"></a>13. SpringSecurity(安全)</h3> 
<p>在web开发中，安全第一位，过滤器，拦截器。。。</p> 
<p>利用了AOP横切的思想，不用改动原来的代码</p> 
<p>shiro和SpringSecurity很像，只是类不一样，名字不一样</p> 
<p>功能：认证(账号密码)和授权(vip1，vip2…)</p> 
<p>权限：</p> 
<ul><li>功能权限</li><li>访问权限</li><li>菜单权限</li></ul> 
<p>之前我们是用过滤器，拦截器</p> 
<p>记住这几个类：</p> 
<ul><li>WebSecurityConfigurerAdapter：自定义Security策略</li><li>AuthenticationManagerBuilder：自定义认证策略</li><li>@EnableWebSecurity：开启WebSecurity模式 @Enablexxxx 开启某个功能</li></ul> 
<p>Spring Security的两个主要目标是：“认证"和"授权”(访问控制)</p> 
<p>认证：Authentication</p> 
<p>授权：Authorization</p> 
<p>这个概念是通用的，而不是只在Spring Security中存在</p> 
<h4><a id="131__1479"></a>13.1 用户认证和授权</h4> 
<p>首先要导入security的启动器</p> 
<p>然后我们要写一个类，继承WebSecurityConfigurerAdapter，并且在类上添加注解@EnableWebSecurity</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@EnableWebSecurity</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SecurityConfig</span> <span class="token keyword">extends</span> <span class="token class-name">WebSecurityConfigurerAdapter</span> <span class="token punctuation">{<!-- --></span>
    
<span class="token punctuation">}</span>
</code></pre> 
<p>然后我们要重写里面的方法，如configure(HttpSecurity http)</p> 
<p>然后我们比对这父类中重写的方法进行配置定义</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@EnableWebSecurity</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SecurityConfig</span> <span class="token keyword">extends</span> <span class="token class-name">WebSecurityConfigurerAdapter</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 链式编程</span>
    <span class="token comment">// 定制授权规则</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">configure</span><span class="token punctuation">(</span><span class="token class-name">HttpSecurity</span> http<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 首页所有人可以访问，功能页只有对应有权限的人才能访问</span>
        <span class="token comment">// 请求授权的规则</span>
        http<span class="token punctuation">.</span><span class="token function">authorizeRequests</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">antMatchers</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">permitAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">antMatchers</span><span class="token punctuation">(</span><span class="token string">"/level1/**"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">hasRole</span><span class="token punctuation">(</span><span class="token string">"vip1"</span><span class="token punctuation">)</span>   <span class="token comment">// level1下的所有页面，vip1才能访问</span>
                <span class="token punctuation">.</span><span class="token function">antMatchers</span><span class="token punctuation">(</span><span class="token string">"/level2/**"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">hasRole</span><span class="token punctuation">(</span><span class="token string">"vip2"</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">antMatchers</span><span class="token punctuation">(</span><span class="token string">"/level3/**"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">hasRole</span><span class="token punctuation">(</span><span class="token string">"vip3"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 没有权限默认会到登录页面(Security自带的登录页)，需要开启登录的页面</span>
        http<span class="token punctuation">.</span><span class="token function">formLogin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


    <span class="token comment">// 定制认证规则</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">configure</span><span class="token punctuation">(</span><span class="token class-name">AuthenticationManagerBuilder</span> auth<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 读源码，看方法应该这么重写</span>
        <span class="token comment">// 数据正常从数据库中都，我们这里从内存中读取数据，进行模拟</span>
        <span class="token comment">// 如果报错：PasswordEncoder mapped for the id "null"</span>
        <span class="token comment">// 则是需要对密码进行加密，在Spring Security5.0+新增了很多加密方法，如BCryptPasswordEncoder</span>
        auth<span class="token punctuation">.</span><span class="token function">inMemoryAuthentication</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">passwordEncoder</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BCryptPasswordEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">withUser</span><span class="token punctuation">(</span><span class="token string">"root"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">password</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BCryptPasswordEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span><span class="token string">"shw123zxc"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">roles</span><span class="token punctuation">(</span><span class="token string">"vip1"</span><span class="token punctuation">,</span><span class="token string">"vip2"</span><span class="token punctuation">,</span><span class="token string">"vip3"</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">and</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">withUser</span><span class="token punctuation">(</span><span class="token string">"codewei"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">password</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BCryptPasswordEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span><span class="token string">"shw123zxc"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">roles</span><span class="token punctuation">(</span><span class="token string">"vip1"</span><span class="token punctuation">,</span><span class="token string">"vip2"</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">and</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">withUser</span><span class="token punctuation">(</span><span class="token string">"guest"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">password</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BCryptPasswordEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span><span class="token string">"shw123zxc"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">roles</span><span class="token punctuation">(</span><span class="token string">"vip1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="132__1534"></a>13.2 注销及权限控制</h4> 
<p><strong>注销</strong></p> 
<p>在刚才重写的方法中，写上<code>http.logout();</code>，开启注销功能</p> 
<p>在前端页面中，注销访问的链接应为<code>/logout</code></p> 
<p>我们可以指定注销后跳转到哪个页面：<code>http.logout().logouSuccesstUrl("/")</code>，注销后跳转到主页</p> 
<pre><code class="prism language-java">http<span class="token punctuation">.</span><span class="token function">logout</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">logoutSuccessUrl</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p><strong>权限控制</strong></p> 
<p>登录后，根据不同的权限展示出不同的内容，就需要thymeleaf与spring scurity整合</p> 
<p>首先，我们要导入thymeleaf和spring scurity的整合包<strong>Thymeleaf Extras Springsecurity4</strong></p> 
<p>在页面中添加命名空间<code>xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity4"</code></p> 
<p><strong><mark>springboot 2.0.9之前才支持thymeleaf与spring security整合，更高版本的springboot则不支持！！</mark></strong></p> 
<pre><code class="prism language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name"><span class="token namespace">sec:</span>authorize</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>!isAuthenticated()<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!--如果未认证(未登录)，则显示div中的内容--&gt;</span>
    ...
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name"><span class="token namespace">sec:</span>authorize</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>isAuthenticated()<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!--如果已认证(已登录)，则显示div中的内容--&gt;</span>
    ...
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>

<span class="token comment">&lt;!--如果已登录：显示用户名和角色--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name"><span class="token namespace">sec:</span>authorize</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>isAuthenticated()<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
       用户名：<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name"><span class="token namespace">sec:</span>authentication</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>name<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
       角色：<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name"><span class="token namespace">sec:</span>authentication</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>principal.authorities<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>当我们点击注销时，可能会出现404，这是因为springboot默认帮我们开启了<strong>CSRF(跨站请求伪造)</strong>，防止网站攻击的，我们需要关闭CSRF</p> 
<pre><code class="prism language-java">http<span class="token punctuation">.</span><span class="token function">csrf</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">disable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p><strong>根据不同的权限显示不同的内容，菜单的动态实现</strong>，如</p> 
<pre><code class="prism language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name"><span class="token namespace">sec:</span>authorize</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>hasRole('vip1')<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    ...
    <span class="token comment">&lt;!--有vip1的权限时，才会显示该div--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<h4><a id="133__1591"></a>13.3 记住我及登录页定制</h4> 
<p><strong>开启记住我功能</strong></p> 
<pre><code class="prism language-java">http<span class="token punctuation">.</span><span class="token function">rememberMe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p><strong>定制登录页</strong></p> 
<pre><code class="prism language-java">http<span class="token punctuation">.</span><span class="token function">formLogin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">loginPage</span><span class="token punctuation">(</span><span class="token string">"/toLogin"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 跳转到跳转自己的登录页面的controller</span>
<span class="token comment">// 前端登录表单的提交action也要和这个路径相同</span>
</code></pre> 
<pre><code class="prism language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name"><span class="token namespace">th:</span>action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@{/toLogin}<span class="token punctuation">"</span></span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>post<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>如果想前端表单提交的路径和指定的controller路径不一致，使用<code>/login</code>，可以进行指定</p> 
<pre><code class="prism language-java">http<span class="token punctuation">.</span><span class="token function">formLogin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">loginPage</span><span class="token punctuation">(</span><span class="token string">"/toLogin"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">loginProcessingUrl</span><span class="token punctuation">(</span><span class="token string">"/login"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>这样我们前端表单的action就可以写为<code>/login </code>了</p> 
<pre><code class="prism language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name"><span class="token namespace">th:</span>action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@{/login}<span class="token punctuation">"</span></span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>post<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p><mark>注意：</mark></p> 
<p>我们自己登录页面的表单属性名默认要和默认的属性名相同，username，password</p> 
<p>如果我们写的属性参数名和默认的不同，如name，pwd</p> 
<p>那么，我们可以进行自定义指定参数名，如</p> 
<pre><code class="prism language-java">http<span class="token punctuation">.</span><span class="token function">formLogin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">usernameParameter</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">passwordParameter</span><span class="token punctuation">(</span><span class="token string">"pwd"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>这样我们表单中的属性名就可以自定义了</p> 
<p>在我们自己的登录页面中添加记住我功能</p> 
<pre><code class="prism language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>checkbox<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>remember<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span> 记住我
</code></pre> 
<p>要自定义接收前端的参数</p> 
<pre><code class="prism language-java">http<span class="token punctuation">.</span><span class="token function">rememberMe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">rememberMeParameter</span><span class="token punctuation">(</span><span class="token string">"remember"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>eleaf-extras-springsecurity4"`</p> 
<p><strong><mark>springboot 2.0.9之前才支持thymeleaf与spring security整合，更高版本的springboot则不支持！！</mark></strong></p> 
<pre><code class="prism language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name"><span class="token namespace">sec:</span>authorize</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>!isAuthenticated()<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!--如果未认证(未登录)，则显示div中的内容--&gt;</span>
    ...
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name"><span class="token namespace">sec:</span>authorize</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>isAuthenticated()<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!--如果已认证(已登录)，则显示div中的内容--&gt;</span>
    ...
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>

<span class="token comment">&lt;!--如果已登录：显示用户名和角色--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name"><span class="token namespace">sec:</span>authorize</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>isAuthenticated()<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
       用户名：<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name"><span class="token namespace">sec:</span>authentication</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>name<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
       角色：<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name"><span class="token namespace">sec:</span>authentication</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>principal.authorities<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>当我们点击注销时，可能会出现404，这是因为springboot默认帮我们开启了<strong>CSRF(跨站请求伪造)</strong>，防止网站攻击的，我们需要关闭CSRF</p> 
<pre><code class="prism language-java">http<span class="token punctuation">.</span><span class="token function">csrf</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">disable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p><strong>根据不同的权限显示不同的内容，菜单的动态实现</strong>，如</p> 
<pre><code class="prism language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name"><span class="token namespace">sec:</span>authorize</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>hasRole('vip1')<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    ...
    <span class="token comment">&lt;!--有vip1的权限时，才会显示该div--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<h4><a id="133__1685"></a>13.3 记住我及登录页定制</h4> 
<p><strong>开启记住我功能</strong></p> 
<pre><code class="prism language-java">http<span class="token punctuation">.</span><span class="token function">rememberMe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p><strong>定制登录页</strong></p> 
<pre><code class="prism language-java">http<span class="token punctuation">.</span><span class="token function">formLogin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">loginPage</span><span class="token punctuation">(</span><span class="token string">"/toLogin"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 跳转到跳转自己的登录页面的controller</span>
<span class="token comment">// 前端登录表单的提交action也要和这个路径相同</span>
</code></pre> 
<pre><code class="prism language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name"><span class="token namespace">th:</span>action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@{/toLogin}<span class="token punctuation">"</span></span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>post<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>如果想前端表单提交的路径和指定的controller路径不一致，使用<code>/login</code>，可以进行指定</p> 
<pre><code class="prism language-java">http<span class="token punctuation">.</span><span class="token function">formLogin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">loginPage</span><span class="token punctuation">(</span><span class="token string">"/toLogin"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">loginProcessingUrl</span><span class="token punctuation">(</span><span class="token string">"/login"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>这样我们前端表单的action就可以写为<code>/login </code>了</p> 
<pre><code class="prism language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name"><span class="token namespace">th:</span>action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@{/login}<span class="token punctuation">"</span></span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>post<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p><mark>注意：</mark></p> 
<p>我们自己登录页面的表单属性名默认要和默认的属性名相同，username，password</p> 
<p>如果我们写的属性参数名和默认的不同，如name，pwd</p> 
<p>那么，我们可以进行自定义指定参数名，如</p> 
<pre><code class="prism language-java">http<span class="token punctuation">.</span><span class="token function">formLogin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">usernameParameter</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">passwordParameter</span><span class="token punctuation">(</span><span class="token string">"pwd"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>这样我们表单中的属性名就可以自定义了</p> 
<p>在我们自己的登录页面中添加记住我功能</p> 
<pre><code class="prism language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>checkbox<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>remember<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span> 记住我
</code></pre> 
<p>要自定义接收前端的参数</p> 
<pre><code class="prism language-java">http<span class="token punctuation">.</span><span class="token function">rememberMe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">rememberMeParameter</span><span class="token punctuation">(</span><span class="token string">"remember"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/20348fe75392ee6a338cf7c2b543237a/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">SpringMVC - 学习笔记</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/6ce63422f72eb09c0bb55ab6cf9beec6/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">快速入门Shiro - 整合SpringBoot</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 追风少年的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>