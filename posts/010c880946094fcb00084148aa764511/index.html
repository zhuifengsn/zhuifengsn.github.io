<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Unity3D-VR《静夜诗》5-李白吟诗 - 追风少年的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Unity3D-VR《静夜诗》5-李白吟诗" />
<meta property="og:description" content="Unity3D-VR《静夜诗》5-李白吟诗 1.设计场景中的可视内容1.1添加李白人物对象1.2添加显示诗词的文本对象 2. 李白行走路径动画2.1动画控制器libaiMain2.2 动画编辑器编辑动画剪辑libaiMain 3. 李白抬头等动画3.1 动画控制器3.2 动画事件脚本函数SetTrigger 4. 李白行走时同步吟诗4.1 设置动画事件4.2 动画事件脚本函数PlayPoem 5. 初始状态设定6. 背景音效7. 总结 窗户打开动画播放结束后，应该是出现李白吟诗了，如何实现呢？
在工程视图中选中NDVRresources\ Res\ Animations\ WinOpen动画剪辑文件，在监视视图中可以看到该动画剪辑的时长是1S。根据项目实现要求，大约在窗户打开1S后李白开始吟诗。
这样我们可以在播放窗户打开动画后延时2S再播放李白吟诗的动画。
按照习惯，先来完成场景中的可视内容的设计。
1.设计场景中的可视内容 1.1添加李白人物对象 将素材资源目录中已经提供的李白角色的预设对象拖放到场景中，调整到合适的位置及朝向。设置参考如下：
1.2添加显示诗词的文本对象 场景中合适的位置新建诗词文本背景Image对象ImagePoemBg，设置属性如下：
组件Image中的图片Five在资源目录NDVRresources\UIRcs中已经提供给大家了。
在对象ImagePoemBg下新建文本子对象TextPoem属性设置如下：
2. 李白行走路径动画 2.1动画控制器libaiMain 在LiBai\Animations目录下有许多李白的动画剪辑，如抬头、低头、左转等，还有2个动画控制器文件，其中动画控制器文件libaiMain是播放李白的行走的位移动画的，控制器设定如下：
默认状态是libaiMain，对应播放libaiMain动画剪辑，我们将动画控制器libaiMain拖放到LiBai对象上，自动为LiBai对象添加了动画控制器组件，并设置动画控制器Controller属性值为libaiMain。
可以试着运行场景，看看libaiMain动画状态播放的libaiMain动画剪辑
提示
不要搞混了概念，资源中提供的动画控制器文件、设定的动画状态名、状态对应的动画剪辑命名都是libaiMain）。
运行时在控制台出现了以下错误提示：
‘LiBai’ AnimationEvent ‘SetTrigger’ has no receiver! Are you missing a component?
你可以忽略这些错误继续运行，可以看到李白在屋里行走的过程，每走到一个地方，就会出现类似的错误，最后出现以下错误：
‘LiBai’ AnimationEvent ‘ShowQuestionp’ has no receiver! Are you missing a component?
错误的提示意思是动画播放到某一帧时动画事件没有对应受理的函数。
2.2 动画编辑器编辑动画剪辑libaiMain 动画控制器默认播放的就是libaiMain动画剪辑，libaiMain动画剪辑是一个路径动画，播放的是李白吟诗时在室内行走的路径。在场景中选中LiBai对象，通过Window | Animation 打开动画剪辑编辑器编辑LiBai对象上的动画剪辑libaiMain。操作界面如下：" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://zhuifengsn.github.io/posts/010c880946094fcb00084148aa764511/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-12-11T23:57:42+08:00" />
<meta property="article:modified_time" content="2022-12-11T23:57:42+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="追风少年的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">追风少年的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Unity3D-VR《静夜诗》5-李白吟诗</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>Unity3D-VR《静夜诗》5-李白吟诗</h4> 
 <ul><li><a href="#1_6" rel="nofollow">1.设计场景中的可视内容</a></li><li><ul><li><a href="#11_7" rel="nofollow">1.1添加李白人物对象</a></li><li><a href="#12_10" rel="nofollow">1.2添加显示诗词的文本对象</a></li></ul> 
  </li><li><a href="#2__18" rel="nofollow">2. 李白行走路径动画</a></li><li><ul><li><a href="#21libaiMain_19" rel="nofollow">2.1动画控制器libaiMain</a></li><li><a href="#22_libaiMain_36" rel="nofollow">2.2 动画编辑器编辑动画剪辑libaiMain</a></li></ul> 
  </li><li><a href="#3__62" rel="nofollow">3. 李白抬头等动画</a></li><li><ul><li><a href="#31__63" rel="nofollow">3.1 动画控制器</a></li><li><a href="#32_SetTrigger_71" rel="nofollow">3.2 动画事件脚本函数SetTrigger</a></li></ul> 
  </li><li><a href="#4__94" rel="nofollow">4. 李白行走时同步吟诗</a></li><li><ul><li><a href="#41__95" rel="nofollow">4.1 设置动画事件</a></li><li><a href="#42_PlayPoem_100" rel="nofollow">4.2 动画事件脚本函数PlayPoem</a></li></ul> 
  </li><li><a href="#5__170" rel="nofollow">5. 初始状态设定</a></li><li><a href="#6__211" rel="nofollow">6. 背景音效</a></li><li><a href="#7__214" rel="nofollow">7. 总结</a></li></ul> 
</div> 
<p></p> 
<blockquote> 
 <p>窗户打开动画播放结束后，应该是出现李白吟诗了，如何实现呢？</p> 
</blockquote> 
<p>在工程视图中选中NDVRresources\ Res\ Animations\ WinOpen动画剪辑文件，在监视视图中可以看到该动画剪辑的时长是1S。根据项目实现要求，大约在窗户打开1S后李白开始吟诗。<br> 这样我们可以在播放窗户打开动画后延时2S再播放李白吟诗的动画。<br> 按照习惯，先来完成场景中的可视内容的设计。</p> 
<h2><a id="1_6"></a>1.设计场景中的可视内容</h2> 
<h3><a id="11_7"></a>1.1添加李白人物对象</h3> 
<p>将素材资源目录中已经提供的李白角色的预设对象拖放到场景中，调整到合适的位置及朝向。设置参考如下：<br> <img src="https://images2.imgbox.com/d5/47/3WoUnjjY_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="12_10"></a>1.2添加显示诗词的文本对象</h3> 
<p>场景中合适的位置新建诗词文本背景Image对象ImagePoemBg，设置属性如下：<br> <img src="https://images2.imgbox.com/f4/7f/M8QI6iZR_o.png" alt="在这里插入图片描述"></p> 
<blockquote> 
 <p>组件Image中的图片Five在资源目录NDVRresources\UIRcs中已经提供给大家了。</p> 
</blockquote> 
<p>在对象ImagePoemBg下新建文本子对象TextPoem属性设置如下：<br> <img src="https://images2.imgbox.com/6c/dc/naigg9Te_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="2__18"></a>2. 李白行走路径动画</h2> 
<h3><a id="21libaiMain_19"></a>2.1动画控制器libaiMain</h3> 
<p>在LiBai\Animations目录下有许多李白的动画剪辑，如抬头、低头、左转等，还有2个动画控制器文件，其中动画控制器文件libaiMain是播放李白的行走的位移动画的，控制器设定如下：<br> <img src="https://images2.imgbox.com/15/e0/NNK9BufH_o.png" alt="在这里插入图片描述"></p> 
<blockquote> 
 <p>默认状态是libaiMain，对应播放libaiMain动画剪辑，我们将动画控制器libaiMain拖放到LiBai对象上，自动为LiBai对象添加了动画控制器组件，并设置动画控制器Controller属性值为libaiMain。</p> 
</blockquote> 
<p>可以试着运行场景，看看libaiMain动画状态播放的libaiMain动画剪辑<br> <strong>提示</strong></p> 
<blockquote> 
 <p>不要搞混了概念，资源中提供的动画控制器文件、设定的动画状态名、状态对应的动画剪辑命名都是libaiMain）。</p> 
</blockquote> 
<p>运行时在控制台出现了以下错误提示：</p> 
<blockquote> 
 <p>‘LiBai’ AnimationEvent ‘SetTrigger’ has no receiver! Are you missing a component?</p> 
</blockquote> 
<p>你可以忽略这些错误继续运行，可以看到李白在屋里行走的过程，每走到一个地方，就会出现类似的错误，最后出现以下错误：</p> 
<blockquote> 
 <p>‘LiBai’ AnimationEvent ‘ShowQuestionp’ has no receiver! Are you missing a component?</p> 
</blockquote> 
<p>错误的提示意思是动画播放到某一帧时动画事件没有对应受理的函数。</p> 
<h3><a id="22_libaiMain_36"></a>2.2 动画编辑器编辑动画剪辑libaiMain</h3> 
<p>动画控制器默认播放的就是libaiMain动画剪辑，libaiMain动画剪辑是一个路径动画，播放的是李白吟诗时在室内行走的路径。在场景中选中LiBai对象，通过Window | Animation 打开动画剪辑编辑器编辑LiBai对象上的动画剪辑libaiMain。操作界面如下：<br> <img src="https://images2.imgbox.com/b0/80/8dTXnlGs_o.png" alt="在这里插入图片描述"></p> 
<p><strong>说明</strong></p> 
<blockquote> 
 <ul><li>在时间标尺上拖动红线（动画帧）可以看到整个动画播放时李白行走的路径位移。</li><li>标尺下方白色柱状亮条表示该帧设定有一个动画事件，前面6个动画事件调用的函数是’SetTrigger’，最后一个动画事件调用的函数是’ShowQuestionp’。</li><li>李白在行走到某个位置时还应该有一些转身、抬头、低头等动作，通过设置动画事件调用函数来播放这些小动画是我们常用的实现方法。问题是目前我们还没有设计好这样的脚本函数，这就导致了运行时的这些错误。</li></ul> 
</blockquote> 
<p>为了修正这些错误，要为动画控制器所在的对象LiBai添加新的脚本animationCtl.cs，脚本中添加 Public void SetTrigger()，代码参考如下：</p> 
<pre><code class="prism language-csharp"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">animationCtl</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">MonoBehaviour</span></span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">SetTrigger</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> 
<p>函数SetTrigger的实现可以在后面继续完善的。</p> 
<blockquote> 
 <p>可以将libaiMain动画剪辑中的最后一个调用的函数’ShowQuestionp’的动画事件去掉，因为根据实现功能要求是不需要实现（其实是在李白吟诗结束后界面上显示一个问题让玩家作答吧，同学们有兴趣可以想想如何实现这样的功能？）</p> 
</blockquote> 
<p><strong>测试：</strong><br> 运行场景，错误没有了。</p> 
<h2><a id="3__62"></a>3. 李白抬头等动画</h2> 
<h3><a id="31__63"></a>3.1 动画控制器</h3> 
<blockquote> 
 <p>LiBai对象的动画控制器播放的是李白行走的路径，通过观看项目运行视频或运行程序，可以看到李白行走到某一位置时不但会吟诗还会做一个动作（比如抬头、低头、转身等）。</p> 
</blockquote> 
<p>在场景中选中LiBai对象下的子对象libai_libai_rig，在监视视图中可以看到子对象下也有一个动画控制器组件，动画控制器Animator的Controller属性默认为空，将工程视图中NDVRresources\SceneRcs\JiaoHu\LiBai\Animations目录下的另一动画控制器文件LiBai设置为该属性值。该动画控制器就是控制李白行走到某个位置时要做的转身、抬头等小动作。打开动画控制器文件LiBai，显示其动画状态设置如下：<br> <img src="https://images2.imgbox.com/bc/d6/l5QLanlD_o.png" alt="在这里插入图片描述"><br> <strong>说明</strong></p> 
<blockquote> 
 <p>可以看到控制器有5个状态（待机、左转90度、低头、走路、抬头），分别对应着李白角色的5个动画剪辑，默认状态时LiBai_DaiJi（待机），左边还设定了4个Trigger型的4个参数，分别是zuozhuan（左转）、zoulu（走路）、taitou（抬头）、ditou（低头），这4个参数控制着动画状态间的5个过渡，比如当前如果是LiBai_DaiJi状态，触发了zuozhuan参数后，控制器就会将动画过渡到LiBai_ZuoZhuan90du状态，播放该状态对应的动画剪辑。</p> 
</blockquote> 
<h3><a id="32_SetTrigger_71"></a>3.2 动画事件脚本函数SetTrigger</h3> 
<blockquote> 
 <p>通过反复观看视频或发布后的软件，可以推测李白行走的libaiMain动画剪辑中的前面6个动画事件调用的函数SetTrigger分别是依次触发zuozhuan、ditou、zoulu、taitou、zuozhuan、ditou这6个动画参数的。所以函数SetTrigger是带有字符串参数的，要调用libai_libai_rig对象上的动画控制器，根据传递的触发参数过渡到对应动画状态，从而播放该状态的动画剪辑，实现李白行走到某个位置时低头、抬头等一些列动作。</p> 
</blockquote> 
<p>打开animationCtl.cs脚本，根据需要进行修改，修改后的参考代码如下：</p> 
<pre><code class="prism language-csharp"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">animationCtl</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">MonoBehaviour</span></span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token class-name">Animator</span> anim_child<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">SetTrigger</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> name<span class="token punctuation">)</span>  <span class="token comment">//</span>
    <span class="token punctuation">{<!-- --></span>
        anim_child<span class="token punctuation">.</span><span class="token function">SetTrigger</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>	
<span class="token punctuation">}</span>

</code></pre> 
<blockquote> 
 <p>在场景中选中LiBai对象，将libai_libai_rig对象拖放到animationCtl脚本的参数anim_child中，赋值好了脚本的参数后，再设置好LiBai对象上libaiMain动画剪辑中的6个动画事件调用函数SetTrigger的参数，分别依次是zuozhuan、ditou、zoulu、taitou、zuozhuan、ditou。 可以试着运行了。</p> 
</blockquote> 
<p><strong>测试：</strong><br> 李白行走时配有转身、低头、抬头动作。<br> <strong>提示：</strong></p> 
<blockquote> 
 <p>在动画编辑器中可以拖动动画事件的高亮柱条，调整动画事件触发的事件。<br> 李白初始位置可以设置为动画第一帧时的位置值。</p> 
</blockquote> 
<h2><a id="4__94"></a>4. 李白行走时同步吟诗</h2> 
<h3><a id="41__95"></a>4.1 设置动画事件</h3> 
<blockquote> 
 <p>通过观看项目运行视频或发布后的运行程序，结合李白行走动画剪辑libaiMain在时间轴上的转身、抬头等动画事件的设定时间，可以初步拟定在libaiMain动画播放后，2秒、6秒、13秒、18秒处显示诗词第一、二、三、四句文本及播放对应的音频剪辑，23秒处诗词文本消失。</p> 
</blockquote> 
<p>在libaiMain动画的时间轴的对应点设置动画事件，调用脚本函数PlayPoem(int i)。<br> 接下来我们实现该播放对应位置诗词的脚本函数。</p> 
<h3><a id="42_PlayPoem_100"></a>4.2 动画事件脚本函数PlayPoem</h3> 
<blockquote> 
 <p>在animationCtl.cs脚本类中要新增一个函数PlayPoem，根据参数的序号，显示对应的诗词文本和播放诗词音频</p> 
</blockquote> 
<p>为此要在脚本类中增加一些变量的声明：</p> 
<blockquote> 
 <ul><li>要引用显示诗词文本的对象ImagePoemBg，以便通过调用对象的SetActive函数来设置诗词对象是否活动的（即可见），吟诗结束后设置诗词对象不活动（不可见）。根据动画事件函数的触发调用来更改ImagePoemBg对象的文本子对象TextPoem的显示内容</li><li>要引用播放诗词音频的播放器</li><li>要保存诗词音频剪辑的数组</li><li>保存诗词文本的字符串数组。</li></ul> 
</blockquote> 
<p>打开animationCtl.cs脚本，新增一些变量的定义代码，变量的初始化代码，以及动画事件要调用的函数PlayPoem(int i)实现，完整的脚本参考代码的如下：</p> 
<pre><code class="prism language-csharp"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">animationCtl</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">MonoBehaviour</span></span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token class-name">Animator</span> anim_child<span class="token punctuation">;</span>    
    <span class="token keyword">public</span> <span class="token class-name">GameObject</span> go_Poem<span class="token punctuation">;</span>
    <span class="token comment">//诗词文本，\r\n表示换行</span>
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">TextArea</span></span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token class-name"><span class="token keyword">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> poems<span class="token operator">=</span>
        <span class="token punctuation">{<!-- --></span><span class="token string">"窗\r\n前\r\n明\r\n月\r\n光"</span><span class="token punctuation">,</span>
         <span class="token string">"疑\r\n是\r\n地\r\n上\r\n霜"</span><span class="token punctuation">,</span>
         <span class="token string">"举\r\n头\r\n望\r\n明\r\n月"</span><span class="token punctuation">,</span>
         <span class="token string">"低\r\n头\r\n思\r\n故\r\n乡"</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token class-name">AudioClip<span class="token punctuation">[</span><span class="token punctuation">]</span></span> aduioPoems<span class="token punctuation">;</span><span class="token comment">//诗词音频</span>
    <span class="token comment">//私有变量</span>
    <span class="token keyword">private</span> <span class="token class-name">AudioSource</span> audioPlayer<span class="token punctuation">;</span><span class="token comment">//音频播放器</span>
    <span class="token keyword">private</span> <span class="token class-name">Text</span> textPoem<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Start</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>   <span class="token comment">//初始化一些变量</span>
        audioPlayer <span class="token operator">=</span> <span class="token generic-method"><span class="token function">GetComponent</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>AudioSource<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        textPoem <span class="token operator">=</span> go_Poem<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetComponentInChildren</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Text<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		go_Poem<span class="token punctuation">.</span><span class="token function">SetActive</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//初始不可见的</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//设置动画参数，过渡到相应动画状态</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">SetTrigger</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> name<span class="token punctuation">)</span>  <span class="token comment">//</span>
    <span class="token punctuation">{<!-- --></span>
        anim_child<span class="token punctuation">.</span><span class="token function">SetTrigger</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//显示对应序号的诗词文本、播放对应的诗词音频</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">PlayPoem</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> i<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>        
        go_Poem<span class="token punctuation">.</span><span class="token function">SetActive</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//设置诗词文字可见</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">&lt;=</span><span class="token number">3</span> <span class="token operator">&amp;&amp;</span> i<span class="token operator">&gt;=</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            textPoem<span class="token punctuation">.</span>text <span class="token operator">=</span> poems<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>	<span class="token comment">//显示诗词文字</span>
            audioPlayer<span class="token punctuation">.</span>clip <span class="token operator">=</span> aduioPoems<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">//赋值诗词声音</span>
            audioPlayer<span class="token punctuation">.</span><span class="token function">Play</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//播放诗词声音</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">if</span><span class="token punctuation">(</span>i<span class="token operator">==</span><span class="token number">4</span><span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            go_Poem<span class="token punctuation">.</span><span class="token function">SetActive</span><span class="token punctuation">(</span><span class="token boolean">false</span> <span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//设置诗词文字可见</span>
        <span class="token punctuation">}</span> 
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<blockquote> 
 <p>体会[TextArea]在变量声明中的使用，其效果可以看一下脚本在监视视图中变量展示形式的不同。数组定义初始赋值以及换行符请参考C#的语法。</p> 
</blockquote> 
<p>脚本完成后在监视视图脚本组件中设置脚本的参数如下：<br> <img src="https://images2.imgbox.com/39/16/KSbCQ5hF_o.png" alt="在这里插入图片描述"></p> 
<blockquote> 
 <p>最后还要为LiBai对象添加AudioSource组件，如果没有的话在Start函数调用GetComponent()时会报错的。</p> 
</blockquote> 
<p><strong>思考：</strong></p> 
<blockquote> 
 <p>变量能声明私有的尽量不要声明公有，脚本中anim_child变量声明改为私有private后，如何给它初始化？</p> 
</blockquote> 
<p><strong>测试：</strong></p> 
<blockquote> 
 <p>运行后播放libaiMain动画，在播放过程中通过设置的动画事件调用脚本函数，实现诗词文本音频及转身抬头等动画的同步播放，最后诗词文本对象自动消失。</p> 
</blockquote> 
<p><strong>说明</strong></p> 
<blockquote> 
 <p>项目演示中李白吟诗动画是在窗户打开后2秒播放的，初始不播放李白吟诗动画，只要设置LiBai对象的动画控制器组件Animator的enable属性为false即可，要播放时则设置为true。</p> 
</blockquote> 
<h2><a id="5__170"></a>5. 初始状态设定</h2> 
<blockquote> 
 <p>要设定游戏的初始状态值，建议在全局游戏控制脚本GameManager的Start函数中设置。需要在全局游戏控制脚本中定义一些变量，以便引用游戏中的对象。</p> 
</blockquote> 
<p>完成后的脚本GameManager.cs，参考代码如下：</p> 
<pre><code class="prism language-csharp"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GameManager</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">MonoBehaviour</span></span> <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">public</span> <span class="token class-name">Animator</span> animator_Window<span class="token punctuation">;</span><span class="token comment">//窗口动画控制器</span>
	<span class="token keyword">public</span> <span class="token class-name">Collider</span> collider_Window<span class="token punctuation">;</span><span class="token comment">//可交互的窗口对象碰撞器</span>
	<span class="token keyword">public</span> <span class="token class-name">Animator</span> animator_Libai<span class="token punctuation">;</span><span class="token comment">//李白动画控制器</span>
	<span class="token comment">// Use this for initialization</span>
	<span class="token return-type class-name"><span class="token keyword">void</span></span> Start <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>        
        animator_Window<span class="token punctuation">.</span>enabled  <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span> <span class="token comment">//设置窗口动画控制器不使能（不起作用）        </span>
        collider_Window<span class="token punctuation">.</span>enabled <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span> <span class="token comment">//设置窗口对象不可交互        </span>
        animator_Libai<span class="token punctuation">.</span>enabled <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span> <span class="token comment">//设置李白动画控制器不使能（不起作用）        </span>
    <span class="token punctuation">}</span>
    <span class="token comment">//凝视开始按钮触发交互后执行的方法</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">StartPlay</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>        
        animator_Window<span class="token punctuation">.</span>enabled <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span> <span class="token comment">//设置窗口动画控制器使能（起作用）        </span>
        collider_Window<span class="token punctuation">.</span>enabled <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>	<span class="token comment">//设置窗口对象可交互</span>
	<span class="token punctuation">}</span>
	<span class="token comment">//凝视窗户触发交互后执行的方法</span>
	<span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">OpenWindow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        collider_Window<span class="token punctuation">.</span>enabled <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>   <span class="token comment">//关闭窗户对象可交互功能                                                               </span>
        animator_Window<span class="token punctuation">.</span><span class="token function">SetTrigger</span><span class="token punctuation">(</span><span class="token string">"Open"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">//播放窗户打开动画</span>
        StartCoroutine <span class="token punctuation">(</span><span class="token string">"delayPlay"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">//调用协程 延时2秒播放李白吟诗动画</span>
	<span class="token punctuation">}</span>
	<span class="token comment">//延时2秒后，播放李白行走动画、诗词声音、文字</span>
	<span class="token return-type class-name">IEnumerator</span> <span class="token function">delayPlay</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
		<span class="token keyword">yield</span> <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">WaitForSeconds</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">//延时n秒</span>
		animator_Libai<span class="token punctuation">.</span>enabled <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>	<span class="token comment">//播放李白行走动画			 			</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<blockquote> 
 <p>注意协同函数delayPlay()的设计及调用方法，协同函数返回类型是IEnumerator，通过StartCoroutine(）函数调用，具体使用方法可以参考Unity Script API文档。</p> 
</blockquote> 
<p>在GameManager脚本的监视视图中对Public变量进行赋值，把场景中的LiBai对象赋值给animator_Libai（因为LiBai对象有Animator组件）。</p> 
<p><strong>想一想</strong></p> 
<blockquote> 
 <p>显示诗词文本的对象是在哪初始设定的？</p> 
</blockquote> 
<h2><a id="6__211"></a>6. 背景音效</h2> 
<p>演示的项目在运行时是有背景音效的，建议在场景中的GameManager对象添加AudioSource组件，并设置属性如下（设置循环播放）：<br> <img src="https://images2.imgbox.com/32/8e/C4BzTKKI_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="7__214"></a>7. 总结</h2> 
<ul><li> <p>建议用一个全局的脚本来控制一些游戏的逻辑实现，如全局变量的定义，公开一些函数在其他脚本中被调用，设置初始状态的值等。</p> </li><li> <p>对于多数呈现的视觉效果，如动画，可以用程序实现，也可以用动画编辑实现。</p> </li><li> <p>有时间轴延续进行的呈现（如李白吟诗），尽量用动画编辑器实现，配合动画事件的设定可以实现比较复杂的动画效果</p> </li><li> <p>对于不确定的需要交互延续的（窗户闪烁及窗户打开）只能用编程实现。</p> </li></ul>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/42e8fa61ac0e3e6fe84dd4feeb98ce7c/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">pxe服务</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/84c0880a3e6821a2d2f73b1164faff57/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">idea的两种导包【jar包和war包详解】以及在配置部署的注意事项</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 追风少年的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>