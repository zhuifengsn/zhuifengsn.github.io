<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>如何调优sql - 追风少年的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="如何调优sql" />
<meta property="og:description" content="如何定位并优化慢sql 根据慢日志定位慢查询sql 慢日志就是用来记录我们查询比较慢的sql
show variables like %quer%;
11：slow_query_log off 慢日志关闭
2：slow_query_log_file 文件记录慢日志
3：long_query_time sql执行多长时间会记录到慢日志文件中
show status like &#39;%slow_queries%&#39;
slow_queries：慢查询的数量 即有多少个sql执行的比较慢
打开慢查询：
set global slow_query_log = on;
设置慢查询的时间：
set global long_query_time = 1;（重新连接之后才能看到修改的状态）
(也可以通过配置文件来修改这些配置my.ini，修改配置是永久修改的)
使用explian等分析工具分析sql explain一般放在关键之的前面，用来描述mysql如何执行查询操作，以及mysql成功返回结果集需要执行的行数。explian可以帮助我们分析select语句，让我们知道查询效率低下的原因，从而改进我们的查询，让查询优化器更好的工作
id：标明sql的执行顺序，越大，越先执行
explian关键字段 type：mysql需要找到数据行的方式
性能是从最优到最差。index/all标明本次的查询走的是全表扫描
extra：辅助我们了解语句的执行方式
Using filesort ：没有使用表中的索引去排序，而是使用表外部的一个索引
修改sql，尽量让sql走索引 修改sql让查询的sql走索引
执行上面的sql并没有走主键索引（密集索引）。为什么不用id而是用account（索引）？
之所以走这个索引，是查询优化器做的决定，mysql查询优化器的最终目标是走索引，并且使用最严格的索引来消除尽可能多的数据行，最红是提交select查询数据行，而不是排除数据行，优化器试图排除数据行是原因排除数据行的速度越快，那么找到与条件匹配的数据行就越快，因袭查询优化器会根据它的分析和判断的标准决定走哪个索引。没有选择走主键索引大致原因：应该是因为密集索引的叶子结点把其他数据也存储到叶子节点当中，所以这里就变成他的一个缺点，这样查询的效率，因为我们的数据都放在一起，所以他是效率要比稀疏索引要低，因为稀疏索引存储关键字和以及主键的值，这样我们在内存里就能加载更多的关键字和主键的值，来进行count。我们也可以强制让sql查询走主键索引，如下：" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://zhuifengsn.github.io/posts/56e73cb7fdcc33c8715456ce4bec3d85/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2019-01-07T21:23:54+08:00" />
<meta property="article:modified_time" content="2019-01-07T21:23:54+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="追风少年的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">追风少年的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">如何调优sql</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h4>如何定位并优化慢sql</h4> 
<ul><li>根据慢日志定位慢查询sql</li></ul> 
<p>慢日志就是用来记录我们查询比较慢的sql</p> 
<p>show variables like %quer%;</p> 
<p><img alt="" class="has" height="246" src="https://images2.imgbox.com/e4/39/ALaViCQt_o.png" width="515"></p> 
<p><span id="cke_bm_813C">1</span>1：slow_query_log  off  慢日志关闭</p> 
<p>2：slow_query_log_file 文件记录慢日志</p> 
<p>3：long_query_time  sql执行多长时间会记录到慢日志文件中</p> 
<p>show status like '%slow_queries%'</p> 
<p><img alt="" class="has" height="33" src="https://images2.imgbox.com/db/48/1VfD7yfX_o.png" width="218"></p> 
<p> slow_queries：慢查询的数量 即有多少个sql执行的比较慢</p> 
<p>打开慢查询：</p> 
<p>set global slow_query_log = on;</p> 
<p>设置慢查询的时间：</p> 
<p>set global long_query_time = 1;（重新连接之后才能看到修改的状态）</p> 
<p>(也可以通过配置文件来修改这些配置my.ini，修改配置是永久修改的)</p> 
<p> </p> 
<ul><li>使用explian等分析工具分析sql</li></ul> 
<p>explain一般放在关键之的前面，用来描述mysql如何执行查询操作，以及mysql成功返回结果集需要执行的行数。explian可以帮助我们分析select语句，让我们知道查询效率低下的原因，从而改进我们的查询，让查询优化器更好的工作</p> 
<p><img alt="" class="has" height="23" src="https://images2.imgbox.com/1a/7d/UkL7mQh4_o.png" width="691"></p> 
<p><img alt="" class="has" height="29" src="https://images2.imgbox.com/37/e4/yuNI4mYQ_o.png" width="753"> </p> 
<p>id：标明sql的执行顺序，越大，越先执行</p> 
<h4>explian关键字段</h4> 
<p>type：mysql需要找到数据行的方式</p> 
<p><img alt="" class="has" height="100" src="https://images2.imgbox.com/fd/f0/eNWt1Wma_o.png" width="1063"></p> 
<p>性能是从最优到最差。index/all标明本次的查询走的是全表扫描</p> 
<p>extra：辅助我们了解语句的执行方式<img alt="" class="has" height="406" src="https://images2.imgbox.com/0e/8b/WxmHs9ib_o.png" width="1044"></p> 
<p>Using filesort ：没有使用表中的索引去排序，而是使用表外部的一个索引</p> 
<ul><li>修改sql，尽量让sql走索引</li></ul> 
<p>修改sql让查询的sql走索引</p> 
<p><img alt="" class="has" height="30" src="https://images2.imgbox.com/38/f8/YL6QluLG_o.png" width="515"></p> 
<p><img alt="" class="has" height="29" src="https://images2.imgbox.com/52/72/Q0gGV6pt_o.png" width="771"></p> 
<p>执行上面的sql并没有走主键索引（密集索引）。为什么不用id而是用account（索引）？</p> 
<p>之所以走这个索引，是查询优化器做的决定，mysql查询优化器的最终目标是走索引，并且使用最严格的索引来消除尽可能多的数据行，最红是提交select查询数据行，而不是排除数据行，优化器试图排除数据行是原因排除数据行的速度越快，那么找到与条件匹配的数据行就越快，因袭查询优化器会根据它的分析和判断的标准决定走哪个索引。没有选择走主键索引大致原因：应该是因为密集索引的叶子结点把其他数据也存储到叶子节点当中，所以这里就变成他的一个缺点，这样查询的效率，因为我们的数据都放在一起，所以他是效率要比稀疏索引要低，因为稀疏索引存储关键字和以及主键的值，这样我们在内存里就能加载更多的关键字和主键的值，来进行count。我们也可以强制让sql查询走主键索引，如下：</p> 
<p><img alt="" class="has" height="27" src="https://images2.imgbox.com/f5/00/6wtofwXQ_o.png" width="746"></p> 
<p> </p> 
<p> </p> 
<p> </p> 
<p> </p> 
<p> </p> 
<p> </p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/afbaba5dd04491b73d25e07cbf043c18/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">python安装报错error writing to file：......</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/135e0755f759f4245f4507492128ea66/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">【C&#43;&#43;】类和对象（4）类的六个默认成员函数</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 追风少年的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>