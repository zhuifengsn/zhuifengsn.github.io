<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>mysql 数据备份与恢复 - 追风少年的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="mysql 数据备份与恢复" />
<meta property="og:description" content="mysql数据库备份分为物理备份和逻辑备份两种，物理备份指将数据库data下的数据文件进行直接copy备份，逻辑备份指通过备份数据库的逻辑结构和数据。也就是数据库的对象对应的create语句和数据表的insert语句。这里主要说逻辑备份。
dump数据文件（mysqldump） mysqldump [options] db_name [table_name ...] 连接参数： -h, --host=name :指定数据库主机
-P, --port=#：指定连接端口号
-u, --user=name：指定用户名
-p, --password[=name]：指定用户密码
连接参数是必须的，访问数据库数据需要用户认证。host和port如果不指定默认访问本机数据库服务
数据库实例参数 –all-databases：导出所有数据库
mysqldump -uroot -p --all-databases &gt; all.sql 导出所有数据库会包含mysql本身自带的数据库，像mysql、sys、information_schema、performance_schema库。
如果明确导出一个具体的数据库，可以在mysqldump命令行上直接写明数据库名进行导出
mysqldump -uroot -p db_test &gt; db_test.sql 上面的语句就是直接导出db_test数据库。
导出多个数据库
使用–databases指定数据库列表
mysqldump -uroot -proot --databases db_test nacos210 &gt; db_multi.sql 导出db_test和nacos210两个数据库。
导出多个数据库会带有创建数据库的脚本，例如上面语句会有：
CREATE DATABASE /*!32312 IF NOT EXISTS*/ `db_test`; USE `db_test`; 可以添加–add-drop-database参数会在create数据库之前添加drop数据库语句。生成的好像drop语句是被注释的。
表设置参数 指定要备份的表
mysqldump -uroot -p --databases db_test --tables account test &gt; db_tb1.sql –tables后面跟要导出的表列表，这里导出了account和test两个表。当在明确要备份几个表名时使用。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://zhuifengsn.github.io/posts/4fa14c1ba5a5cde3bc8309ef20bdf15b/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-02-22T17:46:51+08:00" />
<meta property="article:modified_time" content="2024-02-22T17:46:51+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="追风少年的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">追风少年的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">mysql 数据备份与恢复</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>mysql数据库备份分为物理备份和逻辑备份两种，物理备份指将数据库data下的数据文件进行直接copy备份，逻辑备份指通过备份数据库的逻辑结构和数据。也就是数据库的对象对应的create语句和数据表的insert语句。这里主要说逻辑备份。</p> 
<h4><a id="dumpmysqldump_2"></a>dump数据文件（mysqldump）</h4> 
<pre><code>mysqldump [options] db_name [table_name ...] 
</code></pre> 
<h5><a id="_6"></a>连接参数：</h5> 
<p>-h, --host=name :指定数据库主机</p> 
<p>-P, --port=#：指定连接端口号</p> 
<p>-u, --user=name：指定用户名</p> 
<p>-p, --password[=name]：指定用户密码</p> 
<p>连接参数是必须的，访问数据库数据需要用户认证。host和port如果不指定默认访问本机数据库服务</p> 
<h5><a id="_18"></a>数据库实例参数</h5> 
<p>–all-databases：导出所有数据库</p> 
<pre><code>mysqldump -uroot -p --all-databases  &gt; all.sql
</code></pre> 
<p>导出所有数据库会包含mysql本身自带的数据库，像mysql、sys、information_schema、performance_schema库。</p> 
<p>如果明确导出一个具体的数据库，可以在mysqldump命令行上直接写明数据库名进行导出</p> 
<pre><code>mysqldump -uroot -p db_test  &gt; db_test.sql
</code></pre> 
<p>上面的语句就是直接导出db_test数据库。</p> 
<p>导出多个数据库</p> 
<p>使用–databases指定数据库列表</p> 
<pre><code>mysqldump -uroot -proot --databases db_test nacos210  &gt; db_multi.sql
</code></pre> 
<p>导出db_test和nacos210两个数据库。</p> 
<p>导出多个数据库会带有创建数据库的脚本，例如上面语句会有：</p> 
<pre><code>CREATE DATABASE /*!32312 IF NOT EXISTS*/ `db_test`;
USE `db_test`;
</code></pre> 
<p>可以添加–add-drop-database参数会在create数据库之前添加drop数据库语句。生成的好像drop语句是被注释的。</p> 
<h5><a id="_47"></a>表设置参数</h5> 
<p>指定要备份的表</p> 
<pre><code>mysqldump -uroot -p --databases db_test --tables account test  &gt; db_tb1.sql
</code></pre> 
<p>–tables后面跟要导出的表列表，这里导出了account和test两个表。当在明确要备份几个表名时使用。</p> 
<p>跳过某些表</p> 
<pre><code>mysqldump -uroot -p --databases db_test --ignore-table=db_test.account  &gt; db_tb1.sql
</code></pre> 
<p>–ignore-table指定不进行dump的表信息。可以加数据库前缀。并且–ignore-table可以出现多次用来指定多个表。这个和上面的指定具体的表正好相反，这里指定不导出的表列表。</p> 
<p>只导出表结构</p> 
<pre><code>mysqldump -uroot -proot --databases db_test --no-data  &gt; db_tb1.sql
</code></pre> 
<p>–no-data参数指定不到处表数据，只导出表结构。也可以直接使用-d来指定。</p> 
<p>条件导出</p> 
<pre><code>mysqldump -uroot -proot --databases db_test  --tables test  -w'id&gt;10'  &gt; db_tb1.sql
</code></pre> 
<p>-w,–where=name可以设置导出语句查询条件，这里tables理论上是可以支持多个，但是where条件对应的列要在所有表上都存在。</p> 
<h5><a id="_75"></a>其它设置参数</h5> 
<p>-r, --result-file=name：指定导出文件</p> 
<p>-i, --comments导出备注，默认是开启的，如果不带备注可以使用–skip-comments</p> 
<p>-l, --lock-tables导出表数据时先锁表，默认开启。可以使用–skip-lock-tables关闭</p> 
<p>–log-error=name：将错误或警告信息记录到具体的文件</p> 
<p>–default-character-set：字符集，默认是utf8（utf8mb4）。</p> 
<p>–single-transaction：这个会将数据库隔离基本调整为可重复读，并且开启一个新事物进行数据导出，不会阻塞其它连接操作。可以保证数据的一致性，只有在Innodb引擎有效。</p> 
<p>–quick：导出大表时通常结合–single-transaction一块使用，一行行的将表数据导出，而不是等所有的数据先放到内存再一块导出。</p> 
<p>导出时直接压缩</p> 
<pre><code>mysqldump -uroot -p --databases db_test  --tables test|gzip  &gt; db_tb1.sql.gz
</code></pre> 
<h4><a id="dump_95"></a>还原dump文件</h4> 
<pre><code>#方法1
&gt;mysql -uroot -p  db_test &lt; dump.sql
#方法2
mysql &gt; use db_test
mysql &gt; source dump.sql
</code></pre> 
<p>还原比较简单使用mysql命令连接到数据库，然后执行备份文件即可。这里要注意数据库库名环境一定要和mysqldump生成的备份文件的语句库名一致，，如果没有要先创建切换到对应的库。</p> 
<h4><a id="SELECT__INTO_OUTFILE_107"></a>数据文件导出（SELECT INTO OUTFILE）</h4> 
<p>有时候在多系统交互时，我们只需要表的数据而不需要表结构信息，这里的数据不是指insert类型语句，而是纯粹的行数据。比如在给其它系统或数仓进行供数的时候。这个就可以使用SELECT INTO OUTFILE来生成对应的数据文件。</p> 
<pre><code>SELECT column1, column2
INTO OUTFILE 数据文件名
FIELDS TERMINATED BY ','
ENCLOSED BY '"'
LINES TERMINATED BY '\n'
FROM your_table;
</code></pre> 
<p>FIELDS TERMINATED BY ‘,’： 指定字段之间分隔符，在指定分割符的时候，可能有时候需要用一些特殊字符，肯能是不可见字符，这个时候可以使用16进制进行设置，如 x’20’表示空格。</p> 
<p>ENCLOSED BY 指定每个字段的包裹内容，</p> 
<p>LINES TERMINATED BY ‘\n’ ：指定行与行之间的分隔符，window下换行符是’\r\n’。</p> 
<p>这是一个查询语句，要首先使用mysql命令登录mysql后执行，也可以mysql -e 之间指定导出语句来一条命令执行。</p> 
<h5><a id="securefilepriv_126"></a>secure-file-priv</h5> 
<p>在导出时候可能会提示以下错误</p> 
<p>The MySQL server is running with the --secure-file-priv option so it cannot execute this statement</p> 
<p>这是因为开启了secure-file-priv配置，mysql只允许在特定的目录进行导入导出数据。</p> 
<p>查看当前变量配置，终端mysql命令登录执行：SHOW VARIABLES LIKE ‘secure_file_priv’;</p> 
<pre><code>mysql&gt; SHOW VARIABLES LIKE 'secure_file_priv';
+------------------+-----------------------+
| Variable_name    | Value                 |
+------------------+-----------------------+
| secure_file_priv | /var/lib/mysql-files/ |
</code></pre> 
<p>这里看到只允许将数据导出到/var/lib/mysql-files/目录，同样的导入数据也只能从这个目录。</p> 
<p>并且如果导出的文件已经存在，会执行失败，不会覆盖原文件。</p> 
<p>ERROR 1086 (HY000): File ‘/var/lib/mysql-files/test.sql’ already exists</p> 
<p>secure_file_priv的几个值：</p> 
<p>1、null表示禁止导入导出</p> 
<p>2、empty空串表示可以导入导出</p> 
<p>3、具体的路径：只能在当前指定的路径执行导入导出</p> 
<p>secure_file_priv是一个只读属性，必须通过配置文件方式进行修改其值，</p> 
<p>在my.cnf文件</p> 
<pre><code>[mysqld]
secure_file_priv='具体值'
</code></pre> 
<p>修改完后要重启mysql服务。</p> 
<h4><a id="LOAD_DATA_INFILE_165"></a>数据文件导入（LOAD DATA INFILE）</h4> 
<p>数据文件导出后可以使用 load data命令将数据文件进行导入</p> 
<pre><code>LOAD DATA INFILE 'data.txt' INTO TABLE tbl_name
  FIELDS TERMINATED BY ',' ENCLOSED BY '"'
  LINES TERMINATED BY '\r\n'
  IGNORE 1 LINES;
</code></pre> 
<p>大体和导出文件参数差不多，ignore指定跳过多少行，当然后面还可以指定对应的表列信息，具体看官方文档吧。LOAD DATA Statement<br> 最后说依据文件导入导出还需要赋予用户对应的操作权限。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/abc76910c7acfb7e50e4184a1080150c/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">设置主从复制时发生报错Could not find first log file name in binary log index file‘；解决方案</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/0eae4e43322047462e2c51d88030856a/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">产品渲染3D效果图一张多少钱，哪个平台更有性价比？</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 追风少年的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>