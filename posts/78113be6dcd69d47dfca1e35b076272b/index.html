<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>windows 与linux noVnc远程桌面的安装部署与使用 - 追风少年的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="windows 与linux noVnc远程桌面的安装部署与使用" />
<meta property="og:description" content="原文地址：https://blog.csdn.net/qq_37242520/article/details/103688221
noVNC是一个 HTML5 VNC 客户端，采用 HTML 5 WebSockets, Canvas 和 JavaScript 实现，noVNC 被普遍用在各大云计算、虚拟机控制面板中，比如 OpenStack Dashboard 和 OpenNebula Sunstone 都用的是 noVNC。
noVNC采用WebSockets实现，但是目前大多数VNC服务器都不支持 WebSockets，所以noVNC是不能直接连接 VNC 服务器的，需要一个代理来做WebSockets和TCP sockets 之间的转换。这个代理在noVNC的目录里，叫做websockify 。
**目标：**通过浏览器远程访问Windows桌面。
**原理：**浏览器不支持VNC，所以不能直接连接VNC，但是可以使用代理，使用noVNC通过WebSocket建立连接，而VNC Server不支持WebSocket，所以需要开启Websockify代理来做WebSocket和TCP Socket之间的转换。
1、关闭防火墙
setenforce 0
systemctl stop firewalld
systemctl disable firewalld
2、在CentOS7上安装桌面环境
安装教程：https://www.cnblogs.com/u-drive/p/9832356.html
3、#安装依赖软件包
wget -O /etc/yum.repos.d/epel.repo http://mirrors.aliyun.com/repo/epel-7.repo
curl -o /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-7.repo
忽略：yum install -y git tigervnc-server -y
vim /etc/sysconfig/vncservers
在文件结尾加入
VNCSERVERS=“1:root”
VNCSERVERARGS[1]=&#34;-geometry 800x600 -nolisten tcp&#34;
配置说明：
1、VNCSERVERS 配置登录远程桌面的用户名;
2、VNC 的默认监听端口是 5900，监听端口规则为590&#43;usernumber【如 2:root对应端口号5902】" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://zhuifengsn.github.io/posts/78113be6dcd69d47dfca1e35b076272b/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-12-24T14:23:27+08:00" />
<meta property="article:modified_time" content="2020-12-24T14:23:27+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="追风少年的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">追风少年的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">windows 与linux noVnc远程桌面的安装部署与使用</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>原文地址：https://blog.csdn.net/qq_37242520/article/details/103688221</p> 
<p>noVNC是一个 HTML5 VNC 客户端，采用 HTML 5 WebSockets, Canvas 和 JavaScript 实现，noVNC 被普遍用在各大云计算、虚拟机控制面板中，比如 OpenStack Dashboard 和 OpenNebula Sunstone 都用的是 noVNC。<br> noVNC采用WebSockets实现，但是目前大多数VNC服务器都不支持 WebSockets，所以noVNC是不能直接连接 VNC 服务器的，需要一个代理来做WebSockets和TCP sockets 之间的转换。这个代理在noVNC的目录里，叫做websockify 。</p> 
<p>**目标：**通过浏览器远程访问Windows桌面。<br> **原理：**浏览器不支持VNC，所以不能直接连接VNC，但是可以使用代理，使用noVNC通过WebSocket建立连接，而VNC Server不支持WebSocket，所以需要开启Websockify代理来做WebSocket和TCP Socket之间的转换。</p> 
<p>1、关闭防火墙<br> setenforce 0<br> systemctl stop firewalld<br> systemctl disable firewalld<br> 2、在CentOS7上安装桌面环境<br> 安装教程：https://www.cnblogs.com/u-drive/p/9832356.html</p> 
<p>3、#安装依赖软件包<br> wget -O /etc/yum.repos.d/epel.repo http://mirrors.aliyun.com/repo/epel-7.repo<br> curl -o /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-7.repo<br> 忽略：yum install -y git tigervnc-server -y<br> vim /etc/sysconfig/vncservers<br> 在文件结尾加入<br> VNCSERVERS=“1:root”<br> VNCSERVERARGS[1]="-geometry 800x600 -nolisten tcp"<br> 配置说明：<br> 1、VNCSERVERS 配置登录远程桌面的用户名;<br> 2、VNC 的默认监听端口是 5900，监听端口规则为590+usernumber【如 2:root对应端口号5902】<br> 3、VNCSERVERARGS[2] 登录桌面配置；【2 为用户序号，1366x768 为分辨率，-nolisten tcp 为阻止tcp包，-nohttpd 为阻止http包，-localhost 代表只监听本地。如：VNCSERVERARGS[2]="-geometry 800x600 -nolisten tcp -nohttpd -localhost"】<br> 设置密码，两次输入即可；vncpasswd</p> 
<p>配置使用GNOME桌面<br> vim /root/.vnc/xstartup<br> 在文件结尾加入：<br> gnome-session &amp; set starting GNOME desktop<br> 注意：<br> 如果没有安装 Linux 图形界面，则需要安装：<br> rpm -qa |grep gnome 【检查是否安装了图形界面】<br> yum groupinstall “X Window System” “Chinese Support” “Desktop” 【安装】<br> 4、启动VNC服务并输入密码<br> vncserver :1</p> 
<p>#当执行vncserver :1设置为1时，下面要运行VNC是的端口号应该是5900+1，那就是5901，VNC的默认端口是5900。</p> 
<p>#写入开机自启动<br> chmod +x /etc/rc.d/rc.local<br> echo ‘/usr/bin/vncserver :1’ &gt;&gt;/etc/rc.d/rc.local<br> 查看日志：cat /root/.vnc/novnc:1.log<br> service vncserver restart<br> 查看端口：<br> netstat -lntup|grep 59</p> 
<p>---------------------------------------------------此vncserver安装有问题，先忽略（经检测，判断应该是没有问题，缺少添加chmod 755 /etc/rc.local 执行权限）------------------------------------------------<br> https://www.cnblogs.com/littlemonsters/p/5779331.html<br> 1、关闭防火墙<br> setenforce 0<br> systemctl stop firewalld<br> systemctl disable firewalld<br> centos 服务器版需安装 GNOME Desktop<br> yum groupinstall “GNOME Desktop” -y<br> 安装tigervncserver gir<br> yum install tigervnc-server tigervnc-server-module git -y</p> 
<p>cp /lib/systemd/system/vncserver@.service /etc/systemd/system/vncserver@:1.service</p> 
<p>cd /etc/systemd/system<br> 修改配置文件<br> vim /etc/systemd/system/vncserver@:1.service<br> 配置文件内容为：<br> [Unit]<br> Description=Remote desktop service (VNC)<br> After=syslog.target network.target</p> 
<p>[Service]<br> Type=forking<br> User=root<br> ExecStart=/usr/bin/vncserver :1 -geometry 1280x1024 -depth 16 -securitytypes=none -fp /usr/share/X11/fonts/misc<br> ExecStop=/usr/bin/vncserver -kill :1</p> 
<p>[Install]<br> WantedBy=multi-user.target<br> systemctl daemon-reload<br> 启用配置文件:systemctl enable vncserver@:1.service</p> 
<p>设置登陆密码:vncpasswd<br> 启动vncserver:systemctl start vncserver@:1.service　　(直接复制启动好像会找不到这个命令，最好在控制器用tab按键按出来，确保有这个服务)<br> 启动状态查看：systemctl status vncserver@:1.service<br> 查看端口状态：netstat -lnt | grep 590*<br> 查看报错信息：grep vnc /var/log/messages<br> 加入开机配置文件：<br> vi /etc/rc.d/rc.local<br> 文件结尾加入：<br> systemctl start vncserver@:1.service<br> ./root/noVNC/utils/launch.sh --vnc localhost:5901 &amp;<br> 也可以直接：<br> echo ‘systemctl start vncserver@:1.service’ &gt;&gt;/etc/rc.d/rc.local</p> 
<p>加入开机启动文件之后------最后需要修改rc.local文件的执行权限<br> chmod +x /etc/rc.local<br> chmod 755 /etc/rc.local</p> 
<p>设置<br> 固定死vnc端口号<br> grep “59” /usr/bin/vncserver -n</p> 
<p>注释掉+displayNumber<br> 注释掉：if (!bind(S, pack(‘S n x12’, AFINET,5900+n)))--------+n注释掉</p> 
<p>5、安装noVNC<br> 从git拉取：git clone https://github.com/novnc/noVNC.git<br> 6、创建安全连接(一路回车)<br> VNC的默认会话不是安全的，我们需要创建一个安全的VNC连接，会发现提示需要输入内容，这些字段我们并不需要都进行填写，当启动noVNC时，websockify将自动装载证书。<br> #要将生成的self.pem文件放到noVNC/utils底下<br> cd ./noVNC/utils/<br> openssl req -new -x509 -days 365 -nodes -out self.pem -keyout self.pem</p> 
<p>7、运行noVNC<br> /noVNC/utils/launch.sh --vnc localhost:5901</p> 
<p>测试进行访问连接<br> http://ip:6080/vnc.html</p> 
<p>8、设置开机自启动<br> echo ‘./root/noVNC/utils/launch.sh --vnc localhost:5901 &amp;’ &gt;&gt;/etc/rc.d/rc.local</p> 
<p>9、安装numpy，解决连接速度慢：<br> #安装python依赖<br> yum install python-dev python-devel -y<br> #上传压缩包解压<br> unzip numpy-1.11.2.zip<br> cd numpy-1.11.2/<br> python setup.py install</p> 
<p>liunx 安装部署novnc 一键安装脚本</p> 
<p>[root@novnc scripts]# cat novnc_install.sh<br> #!/bin/bash<br> ##############################################################</p> 
<h2><a id="File_Name_novnc_installsh_142"></a>File Name: novnc_install.sh</h2> 
<h2><a id="Version_V10_143"></a>Version: V1.0</h2> 
<h2><a id="Author_lcx_144"></a>Author: lcx</h2> 
<h2><a id="Organization_wwwin365robotcom_145"></a>Organization: www.in365robot.com</h2> 
<p>##############################################################</p> 
<h2><a id="_147"></a>环境优化</h2> 
<p>setenforce 0<br> systemctl stop firewalld<br> systemctl disable firewalld</p> 
<h2><a id="install_vncserver__git_152"></a>install vncserver &amp;&amp; git</h2> 
<p>yum install -y epel*<br> yum install tigervnc-server git -y</p> 
<p>#启动VNC服务并输入密码<br> echo ‘请输入密码:’<br> vncserver :1</p> 
<h2><a id="download_noVNC_160"></a>download noVNC</h2> 
<p>git clone git://github.com/kanaka/noVNC</p> 
<h2><a id="_162"></a>创建安全连接</h2> 
<p>cd ./noVNC/utils/<br> openssl req -new -x509 -days 365 -nodes -out self.pem -keyout self.pem</p> 
<h2><a id="run_noVNC_165"></a>run noVNC</h2> 
<p>cd …/<br> ./utils/launch.sh --vnc localhost:5901 &amp;<br> echo '请访问 http://ip:6080/vnc.html ’</p> 
<h2><a id="_169"></a>自启动</h2> 
<p>chmod +x /etc/rc.d/rc.local<br> echo ‘/usr/bin/vncserver :1’ &gt;&gt;/etc/rc.d/rc.local<br> echo ‘./root/noVNC/utils/launch.sh --vnc localhost:5901 &amp;’ &gt;&gt;/etc/rc.d/rc.local</p> 
<p>[root@novnc scripts]# chmod +x /server/scripts/novnc_install.sh<br> [root@novnc scripts]# ll /server/scripts/novnc_install.sh<br> -rwxr-xr-x. 1 root root 903 Dec 24 18:25 /server/scripts/novnc_install.sh</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/551cf9f6b659800e714056f1d23c345b/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">liunx 基础常用命令</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/8e248ae1bdd8abd5b90d2a9e35034e79/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">java 监控CDH集群获取集群信息</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 追风少年的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>