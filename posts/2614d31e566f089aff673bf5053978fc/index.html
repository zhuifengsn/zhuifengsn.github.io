<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Ubuntu18.04 下图像处理开源软件库Opencv3.4.16的安装及使用 - 追风少年的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Ubuntu18.04 下图像处理开源软件库Opencv3.4.16的安装及使用" />
<meta property="og:description" content="文章目录 一、安装Opencv3.4.161.安装Ubuntu图形界面2.下载Opencv3.4.16安装包3.使用cmake安装opencv4.使用make创建编译5.配置环境6.查看opencv的版本信息 二、编写图片进行特效显示的代码1.创建代码存放文件夹code并进入2.编写程序test1.cpp3.编译程序test1.cpp4.图片显示 三、编写打开摄像头压缩视频的程序1.虚拟机获取摄像头权限2.编写程序test2.cpp3.编译程序test2.cpp4.播放视频 四、编写录制视频的程序1.编写程序test3.cpp2.编译程序test3.cpp3.录制视频 五、总结六、参考资料 一、安装Opencv3.4.16 1.安装Ubuntu图形界面 输入命令sudo apt-get install ubuntu-desktop安装Ubuntu图形界面
等待安装完成之后重启虚拟机并登陆即可看到如下界面
2.下载Opencv3.4.16安装包 打开火狐浏览器，输入网址https://opencv.org/releases/
点击Sources下载OpenCV3.4.16压缩包，下载完成后将其复制到home文件夹下再解压缩。
输入命令unzip opencv-3.4.16.zip解压缩
3.使用cmake安装opencv （1）输入命令cd opencv-3.4.16进入解压后的文件夹opencv-3.4.16，然后输入命令sudo su进入root用户并输入命令sudo apt-get update更新
（2）输入命令sudo apt-get install cmake安装cmake
（3）安装依赖库，命令如下：
sudo apt-get install build-essential libgtk2.0-dev libavcodec-dev libavformat-dev libjpeg.dev libtiff5.dev libswscale-dev （4）创建build文件夹并进入
（5）使用cmake编译参数
4.使用make创建编译 （1）输入命令sudo make编译
（2）输入命令sudo make install安装
5.配置环境 （1）修改opencv.conf文件，打开后添加opencv库的安装路径：/usr/local/lib
添加完成后点击保存并关闭当前页面
显示的警示信息属于正常情况，不用担心。
（2）更新系统共享链接库
sudo ldconfig （3）配置bash，修改bash.bashrc文件
输入如下命令：
sudo gedit /etc/bash.bashrc 在文件末尾加入如下代码：
PKG_CONFIG_PATH=$PKG_CONFIG_PATH:/usr/local/lib/pkgconfig export PKG_CONFIG_PATH 加入后点击保存并关闭当前页面
（4）执行命令source /etc/bash.bashrc使得配置生效
输入命令sudo updatedb更新
6.查看opencv的版本信息 输入命令pkg-config --modversion opencv查看opencv的版本信息" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://zhuifengsn.github.io/posts/2614d31e566f089aff673bf5053978fc/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-10-21T19:42:05+08:00" />
<meta property="article:modified_time" content="2022-10-21T19:42:05+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="追风少年的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">追风少年的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Ubuntu18.04 下图像处理开源软件库Opencv3.4.16的安装及使用</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#Opencv3416_1" rel="nofollow">一、安装Opencv3.4.16</a></li><li><ul><li><a href="#1Ubuntu_2" rel="nofollow">1.安装Ubuntu图形界面</a></li><li><a href="#2Opencv3416_6" rel="nofollow">2.下载Opencv3.4.16安装包</a></li><li><a href="#3cmakeopencv_12" rel="nofollow">3.使用cmake安装opencv</a></li><li><a href="#4make_32" rel="nofollow">4.使用make创建编译</a></li><li><a href="#5_37" rel="nofollow">5.配置环境</a></li><li><a href="#6opencv_68" rel="nofollow">6.查看opencv的版本信息</a></li></ul> 
  </li><li><a href="#_73" rel="nofollow">二、编写图片进行特效显示的代码</a></li><li><ul><li><a href="#1code_74" rel="nofollow">1.创建代码存放文件夹code并进入</a></li><li><a href="#2test1cpp_77" rel="nofollow">2.编写程序test1.cpp</a></li><li><a href="#3test1cpp_120" rel="nofollow">3.编译程序test1.cpp</a></li><li><a href="#4_133" rel="nofollow">4.图片显示</a></li></ul> 
  </li><li><a href="#_140" rel="nofollow">三、编写打开摄像头压缩视频的程序</a></li><li><ul><li><a href="#1_141" rel="nofollow">1.虚拟机获取摄像头权限</a></li><li><a href="#2test2cpp_156" rel="nofollow">2.编写程序test2.cpp</a></li><li><a href="#3test2cpp_164" rel="nofollow">3.编译程序test2.cpp</a></li><li><a href="#4_172" rel="nofollow">4.播放视频</a></li></ul> 
  </li><li><a href="#_178" rel="nofollow">四、编写录制视频的程序</a></li><li><ul><li><a href="#1test3cpp_179" rel="nofollow">1.编写程序test3.cpp</a></li><li><a href="#2test3cpp_253" rel="nofollow">2.编译程序test3.cpp</a></li><li><a href="#3_261" rel="nofollow">3.录制视频</a></li></ul> 
  </li><li><a href="#_267" rel="nofollow">五、总结</a></li><li><a href="#_270" rel="nofollow">六、参考资料</a></li></ul> 
</div> 
<p></p> 
<h2><a id="Opencv3416_1"></a>一、安装Opencv3.4.16</h2> 
<h3><a id="1Ubuntu_2"></a>1.安装Ubuntu图形界面</h3> 
<p>输入命令<code>sudo apt-get install ubuntu-desktop</code>安装Ubuntu图形界面<br> 等待安装完成之后重启虚拟机并登陆即可看到如下界面<br> <img src="https://images2.imgbox.com/34/d1/KlIvy0yA_o.png" alt=""></p> 
<h3><a id="2Opencv3416_6"></a>2.下载Opencv3.4.16安装包</h3> 
<p>打开火狐浏览器，输入网址<a href="https://opencv.org/releases/" rel="nofollow">https://opencv.org/releases/</a><br> <img src="https://images2.imgbox.com/3d/fb/9HEskhnq_o.png" alt=""><br> 点击Sources下载OpenCV3.4.16压缩包，下载完成后将其复制到home文件夹下再解压缩。<br> 输入命令<code>unzip opencv-3.4.16.zip</code>解压缩<br> <img src="https://images2.imgbox.com/08/ea/LJNLJPIh_o.png" alt=""></p> 
<h3><a id="3cmakeopencv_12"></a>3.使用cmake安装opencv</h3> 
<p>（1）输入命令<code>cd opencv-3.4.16</code>进入解压后的文件夹opencv-3.4.16，然后输入命令<code>sudo su</code>进入root用户并输入命令<code>sudo apt-get update</code>更新<br> <img src="https://images2.imgbox.com/bf/5f/F9aLCuqA_o.jpg" alt=""><br> （2）输入命令<code>sudo apt-get install cmake</code>安装cmake<br> <img src="https://images2.imgbox.com/f8/8d/2kkFcdU9_o.jpg" alt=""><br> （3）安装依赖库，命令如下：</p> 
<pre><code class="prism language-c">sudo apt<span class="token operator">-</span>get install build<span class="token operator">-</span>essential libgtk2<span class="token punctuation">.</span><span class="token number">0</span><span class="token operator">-</span>dev libavcodec<span class="token operator">-</span>dev libavformat<span class="token operator">-</span>dev libjpeg<span class="token punctuation">.</span>dev libtiff5<span class="token punctuation">.</span>dev libswscale<span class="token operator">-</span>dev
</code></pre> 
<p><img src="https://images2.imgbox.com/90/af/ZX4v3RMd_o.png" alt=""></p> 
<p>（4）创建build文件夹并进入</p> 
<p><img src="https://images2.imgbox.com/2f/03/RvxwxYRu_o.jpg" alt=""><br> <img src="https://images2.imgbox.com/cf/34/2jpe5BPW_o.png" alt=""><br> （5）使用cmake编译参数<br> <img src="https://images2.imgbox.com/81/33/979B9olR_o.png" alt=""><br> <img src="https://images2.imgbox.com/48/71/x2zt9b1x_o.png" alt=""></p> 
<h3><a id="4make_32"></a>4.使用make创建编译</h3> 
<p>（1）输入命令<code>sudo make</code>编译<br> <img src="https://images2.imgbox.com/32/ba/WgBkpJzn_o.png" alt=""><br> （2）输入命令<code>sudo make install</code>安装<br> <img src="https://images2.imgbox.com/6b/42/fChXM7wL_o.png" alt=""></p> 
<h3><a id="5_37"></a>5.配置环境</h3> 
<p>（1）修改opencv.conf文件，打开后添加opencv库的安装路径：<code>/usr/local/lib</code><br> <img src="https://images2.imgbox.com/7c/02/GdT7M3zC_o.png" alt=""><br> 添加完成后点击保存并关闭当前页面<br> <img src="https://images2.imgbox.com/bb/2a/uU5htJRL_o.png" alt=""><br> 显示的警示信息属于正常情况，不用担心。<br> （2）更新系统共享链接库</p> 
<pre><code class="prism language-cpp">sudo ldconfig
</code></pre> 
<p><img src="https://images2.imgbox.com/11/f4/thcsRvkp_o.png" alt=""><br> （3）配置bash，修改bash.bashrc文件<br> 输入如下命令：</p> 
<pre><code class="prism language-c">sudo gedit <span class="token operator">/</span>etc<span class="token operator">/</span>bash<span class="token punctuation">.</span>bashrc
</code></pre> 
<p>在文件末尾加入如下代码：</p> 
<pre><code class="prism language-c">PKG_CONFIG_PATH<span class="token operator">=</span>$PKG_CONFIG_PATH<span class="token operator">:</span><span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>lib<span class="token operator">/</span>pkgconfig
export PKG_CONFIG_PATH
</code></pre> 
<p><img src="https://images2.imgbox.com/eb/23/RoEwm7eF_o.png" alt=""><br> 加入后点击保存并关闭当前页面<br> <img src="https://images2.imgbox.com/80/9d/HENh5Ysr_o.png" alt=""><br> （4）执行命令<code>source /etc/bash.bashrc</code>使得配置生效<br> <img src="https://images2.imgbox.com/64/ce/bHA2qj2o_o.png" alt=""><br> 输入命令<code>sudo updatedb</code>更新<br> <img src="https://images2.imgbox.com/74/1e/lwMM0Ne3_o.png" alt=""></p> 
<h3><a id="6opencv_68"></a>6.查看opencv的版本信息</h3> 
<p>输入命令<code>pkg-config --modversion opencv</code>查看opencv的版本信息<br> <img src="https://images2.imgbox.com/22/68/cjGLiVvN_o.png" alt=""><br> 可以看到我们安装的版本为 3.4.16，可见OpenCV3.4.16安装成功！</p> 
<h2><a id="_73"></a>二、编写图片进行特效显示的代码</h2> 
<h3><a id="1code_74"></a>1.创建代码存放文件夹code并进入</h3> 
<p><img src="https://images2.imgbox.com/5d/16/75HqBgiF_o.png" alt=""></p> 
<h3><a id="2test1cpp_77"></a>2.编写程序test1.cpp</h3> 
<p>输入命令<code>vim test1.cpp</code>编写程序，编写完成后按Esc键输入:wq退出编辑界面。<br> <img src="https://images2.imgbox.com/2e/14/v6k3sXP7_o.png" alt=""></p> 
<p>程序代码如下：</p> 
<pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;opencv2/highgui.hpp&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;opencv2/opencv.hpp&gt;</span></span>
using namespace cv<span class="token punctuation">;</span>
using namespace std<span class="token punctuation">;</span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span><span class="token operator">*</span><span class="token operator">*</span> argv<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	CvPoint center<span class="token punctuation">;</span>
    <span class="token keyword">double</span> scale <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">;</span> 

	IplImage<span class="token operator">*</span> image <span class="token operator">=</span> <span class="token function">cvLoadImage</span><span class="token punctuation">(</span><span class="token string">"lena.jpg"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	argc <span class="token operator">==</span> <span class="token number">2</span><span class="token operator">?</span> <span class="token function">cvLoadImage</span><span class="token punctuation">(</span>argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">;</span>
	
	<span class="token function">cvShowImage</span><span class="token punctuation">(</span><span class="token string">"Image"</span><span class="token punctuation">,</span> image<span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>image<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span> 	center <span class="token operator">=</span> <span class="token function">cvPoint</span><span class="token punctuation">(</span>image<span class="token operator">-&gt;</span>width <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> image<span class="token operator">-&gt;</span>height <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>image<span class="token operator">-&gt;</span>height<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span>
		<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>j<span class="token operator">&lt;</span>image<span class="token operator">-&gt;</span>width<span class="token punctuation">;</span>j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			<span class="token keyword">double</span> dx <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">double</span><span class="token punctuation">)</span><span class="token punctuation">(</span>j <span class="token operator">-</span> center<span class="token punctuation">.</span>x<span class="token punctuation">)</span> <span class="token operator">/</span> center<span class="token punctuation">.</span>x<span class="token punctuation">;</span>
			<span class="token keyword">double</span> dy <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">double</span><span class="token punctuation">)</span><span class="token punctuation">(</span>i <span class="token operator">-</span> center<span class="token punctuation">.</span>y<span class="token punctuation">)</span> <span class="token operator">/</span> center<span class="token punctuation">.</span>y<span class="token punctuation">;</span>
			<span class="token keyword">double</span> weight <span class="token operator">=</span> <span class="token function">exp</span><span class="token punctuation">(</span><span class="token punctuation">(</span>dx<span class="token operator">*</span>dx <span class="token operator">+</span> dy<span class="token operator">*</span>dy<span class="token punctuation">)</span><span class="token operator">*</span>scale<span class="token punctuation">)</span><span class="token punctuation">;</span>
			uchar<span class="token operator">*</span> ptr <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token function">CV_IMAGE_ELEM</span><span class="token punctuation">(</span>image<span class="token punctuation">,</span> uchar<span class="token punctuation">,</span> i<span class="token punctuation">,</span> j <span class="token operator">*</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			ptr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">cvRound</span><span class="token punctuation">(</span>ptr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">*</span> weight<span class="token punctuation">)</span><span class="token punctuation">;</span>
			ptr<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">cvRound</span><span class="token punctuation">(</span>ptr<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">*</span> weight<span class="token punctuation">)</span><span class="token punctuation">;</span>
			ptr<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">cvRound</span><span class="token punctuation">(</span>ptr<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">*</span> weight<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

	Mat src<span class="token punctuation">;</span>Mat dst<span class="token punctuation">;</span>
	src <span class="token operator">=</span> <span class="token function">cvarrToMat</span><span class="token punctuation">(</span>image<span class="token punctuation">)</span><span class="token punctuation">;</span>
	cv<span class="token operator">::</span><span class="token function">imwrite</span><span class="token punctuation">(</span><span class="token string">"test.png"</span><span class="token punctuation">,</span> src<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">cvNamedWindow</span><span class="token punctuation">(</span><span class="token string">"test"</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  	<span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"test"</span><span class="token punctuation">,</span> src<span class="token punctuation">)</span><span class="token punctuation">;</span>
	 <span class="token function">cvWaitKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	 <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="3test1cpp_120"></a>3.编译程序test1.cpp</h3> 
<p>输入如下命令生成可执行文件test1：</p> 
<pre><code class="prism language-c">gcc test1<span class="token punctuation">.</span>cpp <span class="token operator">-</span>o test1 `pkg<span class="token operator">-</span>config <span class="token operator">--</span>cflags <span class="token operator">--</span>libs opencv`

</code></pre> 
<p>gcc编译器：gcc + 文件名 + -o + 输出文件流名称 +` 支持包<br> <img src="https://images2.imgbox.com/76/f5/lkaVecWx_o.png" alt=""></p> 
<p>发现程序编译出错，寻找原因发现需要弄C++编译器编译接口模块。<br> 解决方法：将gcc改为g++即可。<br> <img src="https://images2.imgbox.com/80/d1/8geAIWBf_o.png" alt=""></p> 
<h3><a id="4_133"></a>4.图片显示</h3> 
<p>准备一张图片到code文件夹下，将图片重名为lena.jpg<br> <img src="https://images2.imgbox.com/a6/39/ssbv0jKF_o.png" alt=""><br> 执行命令<code>./test1</code>,运行结果如下：<br> <img src="https://images2.imgbox.com/2e/e9/8OP689Nk_o.png" alt=""><br> 可以看到由lena.jpg生成了一个test.png,呈现的效果不同。</p> 
<h2><a id="_140"></a>三、编写打开摄像头压缩视频的程序</h2> 
<h3><a id="1_141"></a>1.虚拟机获取摄像头权限</h3> 
<p>使用快捷键 Win + R ，输入 services.msc ，并回车。</p> 
<p><img src="https://images2.imgbox.com/8e/5a/pFtMfItn_o.png" alt=""><br> 找到VMware USB Arbitration S…服务，确保启动了。<br> <img src="https://images2.imgbox.com/fd/09/mjYFYaOt_o.png" alt=""><br> 点击“虚拟机”，然后点击“设置(S)…”。<br> <img src="https://images2.imgbox.com/02/d9/B6QZYigL_o.png" alt=""><br> 选择 “ USB控制器 ” ，将 “ USB兼容性 ” 设置为 “ USB 3.1 ” ，并点击确定。<br> <img src="https://images2.imgbox.com/78/f0/1sNeR8K7_o.png" alt=""><br> 选择 “ 虚拟机 ” ，再选择 “ 可移动设备 ” ，再选择 “ Quanta USB2.0 VGA UVC WebCam ” ，最后点击 “ 连接 ” ，再弹出的窗口内点击 “ 确定 ”。<br> <img src="https://images2.imgbox.com/12/7e/6AOjg1PO_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/f4/56/uS5RwbBG_o.png" alt=""><br> 若虚拟机右下角这个摄像头图标有个小绿点，则连接成功。<br> <img src="https://images2.imgbox.com/dd/db/h1xFvbOW_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="2test2cpp_156"></a>2.编写程序test2.cpp</h3> 
<p>输入命令<code>vim test2.cpp</code>按下Enter键进入vim编辑器，按下i键开始编写程序，程序代码如下图：<br> <img src="https://images2.imgbox.com/77/55/LoIzFURP_o.png" alt=""><br> 代码讲解：<br> ①如果语句：VideoCapture capture(0)，后面的参数设置为 0 ，则从摄像头读取视频并循环显示每一帧；如果设置为一个视频的文件名，比如：man.mp4 ，则会将视频读取并循环显示每一帧。<br> ②while 循环体中的 Mat 数据结构其实是一个点阵，对应图像上的每一个点，点的集合形成了一帧图像。<br> ③语句：waitKey(30) ，中的参数单位是 ms 毫秒，也就是每一帧间隔 30 ms ，该语句时不能删除的，否则会执行错误，无法播放视频或录制视频。</p> 
<h3><a id="3test2cpp_164"></a>3.编译程序test2.cpp</h3> 
<p>输入如下命令生成可执行文件test2:</p> 
<pre><code class="prism language-c">g<span class="token operator">++</span> test2<span class="token punctuation">.</span>cpp <span class="token operator">-</span>o test2 `pkg<span class="token operator">-</span>config <span class="token operator">--</span>cflags <span class="token operator">--</span>libs opencv`
</code></pre> 
<p><img src="https://images2.imgbox.com/d1/bb/QTplaTOj_o.png" alt=""></p> 
<h3><a id="4_172"></a>4.播放视频</h3> 
<p>准备一个视频到code 文件夹下，将其重命名为man.mp4<br> <img src="https://images2.imgbox.com/8e/34/D2h6NvW3_o.png" alt=""><br> 执行命令<code>./test2</code>，运行结果如下：<br> <img src="https://images2.imgbox.com/23/d7/mCl0rx6s_o.jpg" alt=""></p> 
<h2><a id="_178"></a>四、编写录制视频的程序</h2> 
<h3><a id="1test3cpp_179"></a>1.编写程序test3.cpp</h3> 
<p>输入命令<code>vim test1.cpp</code>编写程序，编写完成后按Esc键输入:wq退出编辑界面。<br> <img src="https://images2.imgbox.com/db/5d/75EKYnXq_o.png" alt=""><br> 代码如下：</p> 
<pre><code class="prism language-c"><span class="token comment">/*********************************************************************
打开电脑摄像头，空格控制视频录制，ESC退出并保存视频RecordVideo.avi
*********************************************************************/</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;iostream&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;opencv2/opencv.hpp&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;opencv2/core/core.hpp&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;opencv2/highgui/highgui.hpp&gt;</span></span>
using namespace cv<span class="token punctuation">;</span>
using namespace std<span class="token punctuation">;</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token comment">//打开电脑摄像头</span>
	VideoCapture <span class="token function">cap</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>cap<span class="token punctuation">.</span><span class="token function">isOpened</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		cout <span class="token operator">&lt;&lt;</span> <span class="token string">"error"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
		<span class="token function">waitKey</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">//获得cap的分辨率</span>
	<span class="token keyword">int</span> w <span class="token operator">=</span> static_cast<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>cap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>CV_CAP_PROP_FRAME_WIDTH<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">int</span> h <span class="token operator">=</span> static_cast<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>cap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>CV_CAP_PROP_FRAME_HEIGHT<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	Size <span class="token function">videoSize</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> h<span class="token punctuation">)</span><span class="token punctuation">;</span>
	VideoWriter <span class="token function">writer</span><span class="token punctuation">(</span><span class="token string">"RecordVideo.avi"</span><span class="token punctuation">,</span> <span class="token function">CV_FOURCC</span><span class="token punctuation">(</span><span class="token char">'M'</span><span class="token punctuation">,</span> <span class="token char">'J'</span><span class="token punctuation">,</span> <span class="token char">'P'</span><span class="token punctuation">,</span> <span class="token char">'G'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">,</span> videoSize<span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	Mat frame<span class="token punctuation">;</span>
	<span class="token keyword">int</span> key<span class="token punctuation">;</span><span class="token comment">//记录键盘按键</span>
	<span class="token keyword">char</span> startOrStop <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token comment">//0  开始录制视频； 1 结束录制视频</span>
	<span class="token keyword">char</span> flag <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token comment">//正在录制标志 0-不在录制； 1-正在录制</span>

	<span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		cap <span class="token operator">&gt;&gt;</span> frame<span class="token punctuation">;</span>
		key <span class="token operator">=</span> <span class="token function">waitKey</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>key <span class="token operator">==</span> <span class="token number">32</span><span class="token punctuation">)</span><span class="token comment">//按下空格开始录制、暂停录制   可以来回切换</span>
		<span class="token punctuation">{<!-- --></span>
			startOrStop <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">-</span> startOrStop<span class="token punctuation">;</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>startOrStop <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
			<span class="token punctuation">{<!-- --></span>
				flag <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>key <span class="token operator">==</span> <span class="token number">27</span><span class="token punctuation">)</span><span class="token comment">//按下ESC退出整个程序，保存视频文件到磁盘</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token keyword">break</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token keyword">if</span> <span class="token punctuation">(</span>startOrStop <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> flag<span class="token operator">==</span><span class="token number">1</span><span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			writer <span class="token operator">&lt;&lt;</span> frame<span class="token punctuation">;</span>
			cout <span class="token operator">&lt;&lt;</span> <span class="token string">"recording"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>startOrStop <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			flag <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
			cout <span class="token operator">&lt;&lt;</span> <span class="token string">"end recording"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
			
		<span class="token punctuation">}</span>
		<span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"picture"</span><span class="token punctuation">,</span> frame<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	cap<span class="token punctuation">.</span><span class="token function">release</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	writer<span class="token punctuation">.</span><span class="token function">release</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">destroyAllWindows</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="2test3cpp_253"></a>2.编译程序test3.cpp</h3> 
<p>输入如下命令生成可执行文件test3:</p> 
<pre><code class="prism language-c">g<span class="token operator">++</span> test3<span class="token punctuation">.</span>cpp <span class="token operator">-</span>o test3 `pkg<span class="token operator">-</span>config <span class="token operator">--</span>cflags <span class="token operator">--</span>libs opencv`
</code></pre> 
<p><img src="https://images2.imgbox.com/16/ae/7vKqc4Ye_o.png" alt=""></p> 
<h3><a id="3_261"></a>3.录制视频</h3> 
<p>执行命令<code>./test3</code>开始录制视频，空格控制视频录制，按Esc键退出录制。<br> 生成了一个.avi文件，并不断生成帧。<br> <img src="https://images2.imgbox.com/25/45/a4NlMvfq_o.png" alt=""><br> <img src="https://images2.imgbox.com/da/e1/rHxq3fC3_o.jpg" alt=""></p> 
<h2><a id="_267"></a>五、总结</h2> 
<p>在Ubuntu18.04下安装OpenCV3.4.16步骤非常繁琐，耗时比较久，有时还会出现一些错误需要自己百度解决，比较费时费力，此过程需要足够的耐心，不过安装完成之后发现其功能挺有意思的，但是其使用方法有很多需要注意的地方，还需要深入学习。</p> 
<h2><a id="_270"></a>六、参考资料</h2> 
<p><a href="https://blog.csdn.net/ssj925319/article/details/109231145">Ubuntu18.04下OpenCV3.4.11的安装及使用示例</a><br> <a href="https://blog.csdn.net/weixin_46129506/article/details/120646081">Ubuntu18.04使用opencv库编写打开摄像头压缩视频</a></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/c422f645428649e546419208daaca041/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">编写一段程序，对通过键盘输入的一串字符,分别统计其中字母(a-ZA-Z) 、数字(0 -9)和其他类型字符的个数，结果以字典保存并输出。如{‘alpha‘:3,‘digit‘:5,‘other‘:7}</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/95091d00acf6aa40a6b1e12445d5bd91/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Numpy基础入门知识点总结</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 追风少年的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>