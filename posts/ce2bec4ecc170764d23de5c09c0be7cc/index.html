<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>mysql主从同步分库分表同步 - 追风少年的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="mysql主从同步分库分表同步" />
<meta property="og:description" content="一、mysql数据库的安装
分别在master 和slave上源码安装mysql数据库
1.1 安装相关包
1.1.1 cmake软件
cd /home/oldboy/tools/
tar xf cmake-2.8.8.tar.gz
cd cmake-2.8.8
./configure
#CMake has bootstrapped. Now run gmake.
gmake
gmake install
cd ../
1.1.2 依赖包
yum install ncurses-devel -y
1.2 开始安装mysql
1.2.1 创建用户和组
groupadd mysql
useradd mysql -s /sbin/nologin -M -g mysql
1.2.2 解压编译MySQL
tar zxf mysql-5.5.32.tar.gz cd mysql-5.5.32
cmake . -DCMAKE_INSTALL_PREFIX=/application/mysql/mysql-5.5.40 \
-DMYSQL_DATADIR=/application/mysql/mysql-5.5.40/data \
-DMYSQL_UNIX_ADDR=/application/mysql/mysql-5.5.40/tmp/mysql.sock \
-DDEFAULT_CHARSET=utf8 \
-DDEFAULT_COLLATION=utf8_general_ci \
-DEXTRA_CHARSETS=gbk,gb2312,utf8,ascii \
-DENABLED_LOCAL_INFILE=ON \
-DWITH_INNOBASE_STORAGE_ENGINE=1 \" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://zhuifengsn.github.io/posts/ce2bec4ecc170764d23de5c09c0be7cc/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2017-05-08T14:22:28+08:00" />
<meta property="article:modified_time" content="2017-05-08T14:22:28+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="追风少年的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">追风少年的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">mysql主从同步分库分表同步</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <div class="artical-content-bak main-content editor-side-new"> 
 <div class="con editor-preview-side" id="result"> 
  <p>一、mysql数据库的安装</p> 
  <p>分别在master 和slave上源码安装mysql数据库</p> 
  <p>1.1 安装相关包<br>1.1.1 cmake软件<br>cd /home/oldboy/tools/<br>tar xf cmake-2.8.8.tar.gz<br>cd cmake-2.8.8<br>./configure<br>#CMake has bootstrapped.  Now run gmake.<br>gmake<br>gmake install<br>cd ../<br><br>1.1.2 依赖包<br>yum install ncurses-devel -y<br><br>1.2 开始安装mysql<br>1.2.1 创建用户和组<br>groupadd mysql<br>useradd mysql -s /sbin/nologin -M -g mysql<br><br>1.2.2 解压编译MySQL<br>tar zxf mysql-5.5.32.tar.gz <br>cd mysql-5.5.32<br>cmake . -DCMAKE_INSTALL_PREFIX=/application/mysql/mysql-5.5.40 \<br>-DMYSQL_DATADIR=/application/mysql/mysql-5.5.40/data \<br>-DMYSQL_UNIX_ADDR=/application/mysql/mysql-5.5.40/tmp/mysql.sock \<br>-DDEFAULT_CHARSET=utf8 \<br>-DDEFAULT_COLLATION=utf8_general_ci \<br>-DEXTRA_CHARSETS=gbk,gb2312,utf8,ascii \<br>-DENABLED_LOCAL_INFILE=ON \<br>-DWITH_INNOBASE_STORAGE_ENGINE=1 \<br>-DWITH_FEDERATED_STORAGE_ENGINE=1 \<br>-DWITH_BLACKHOLE_STORAGE_ENGINE=1 \<br>-DWITHOUT_EXAMPLE_STORAGE_ENGINE=1 \<br>-DWITHOUT_PARTITION_STORAGE_ENGINE=1 \<br>-DWITH_FAST_MUTEXES=1 \<br>-DWITH_ZLIB=bundled \<br>-DENABLED_LOCAL_INFILE=1 \<br>-DWITH_READLINE=1 \<br>-DWITH_EMBEDDED_SERVER=1 \<br>-DWITH_DEBUG=0<br><br>#-- Build files have been written to: /home/oldboy/tools/mysql-5.5.32<br>提示，编译时可配置的选项很多，具体可参考结尾附录或官方文档：<br>make<br>#[100%] Built target my_safe_process<br>make install<br>ln -s /application/mysql-5.5.32/ /application/mysql<br>如果上述操作未出现错误，则MySQL5.5.32软件cmake方式的安装就算成功了。<br></p> 
  <p>1.3安装数据库成功后</p> 
  <p>1.3.1 修改mysql安装目录的权限，全部修改为mysql</p> 
  <p>chown -R mysql:mysql /application/mysql</p> 
  <p>1.3.2 初始化数据库</p> 
  <p>cd /application/mysql/scripts</p> 
  <p>[root@localhost scripts]# ./mysql_install_db --basedir=/application/mysql --datadir=/data/mysql --user=mysql</p> 
  <p>1.3.3 替换/etc/下的配置文件和数据库的启动文件</p> 
  <p>/application/mysql/support-files</p> 
  <p>cp -r my-small.cnf  /etc/my.cnf</p> 
  <p>cp -r mysql.server  /etc/init.d/mysql</p> 
  <p>1.4启动数据库</p> 
  <p>/etc/init.d/mysql  start<br></p> 
  <p>/etc/init.d/mysql  stop<br></p> 
  <p>/etc/init.d/mysql  restart<br></p> 
  <p>二、mysql数据库分库分表的同步</p> 
  <p>2.1master配置文件</p> 
  <p>log-bin=mysql-bin</p> 
  <p>binlog_format=row</p> 
  <p>server-id       = 15</p> 
  <p>binlog-do-db=sales</p> 
  <p>/etc/init.d/mysql  restart（重启数据库）</p> 
  <p>2.2slave配置文件</p> 
  <p>server-id       = 25</p> 
  <p>relay-log=relay-bin<br>read-only = 1<br>replicate-do-db = sales</p> 
  <p>replicate-do-db =user_info</p> 
  <p>replicate-ignore-db = information_schema<br>replicate-ignore-db = mysql<br>replicate-ignore-db = user_info</p> 
  <p>replicate-do-table =sales.story    // 所要同步的数据库的单个表</p> 
  <p>/etc/init.d/mysql  restart（重启数据库）</p> 
  <p>2.3在master上创建同步的用户<br> grant replication client,replication slave on *.* to rep@'172.27.1.%' identified by 'password';</p> 
  <p>mysql&gt; show master status\G;<br>*************************** 1. row ***************************<br>             File: mysql-bin.000003<br>         Position: 150<br>     Binlog_Do_DB: sales,user_info<br> Binlog_Ignore_DB: <br>Executed_Gtid_Set: <br>1 row in set (0.00 sec)<br><br>ERROR: <br>No query specified<br></p> 
  <p>2.4在slave上执行如下语句，同步到master</p> 
  <p>change master to master_host='172.27.1.12'(主库IP地址),master_user='rep',master_password='financial',master_log_file='mysql-bin.000003',master_log_pos=150;</p> 
  <p>start slave(启动从库)</p> 
  <p>stop slave(停止从库)</p> 
  <p>reset slave（重置从库）</p> 
  <p>启动数据库后查看slave的状态如下：<br></p> 
  <p>mysql&gt; show slave status\G;<br>*************************** 1. row ***************************<br>               Slave_IO_State: Waiting for master to send event<br>                  Master_Host: 172.27.1.12<br>                  Master_User: rep<br>                  Master_Port: 3306<br>                Connect_Retry: 60<br>              Master_Log_File: mysql-bin.000003<br>          Read_Master_Log_Pos: 150<br>               Relay_Log_File: relay-bin.000002<br>                Relay_Log_Pos: 269<br>        Relay_Master_Log_File: mysql-bin.001603<br>             Slave_IO_Running: Yes<br>            Slave_SQL_Running: Yes<br>              Replicate_Do_DB: sales<br>          Replicate_Ignore_DB: information_schema,mysql,user_info<br>           Replicate_Do_Table: sales.story<br>       Replicate_Ignore_Table: <br>      Replicate_Wild_Do_Table: <br>  Replicate_Wild_Ignore_Table: <br>                   Last_Errno: 0<br>                   Last_Error: <br>                 Skip_Counter: 0<br>          Exec_Master_Log_Pos: 150<br>              Relay_Log_Space: 419<br>              Until_Condition: None<br>               Until_Log_File: <br>                Until_Log_Pos: 0<br>           Master_SSL_Allowed: No<br>           Master_SSL_CA_File: <br>           Master_SSL_CA_Path: <br>              Master_SSL_Cert: <br>            Master_SSL_Cipher: <br>               Master_SSL_Key: <br>        Seconds_Behind_Master: 0<br>Master_SSL_Verify_Server_Cert: No<br>                Last_IO_Errno: 0<br>                Last_IO_Error: <br>               Last_SQL_Errno: 0<br>               Last_SQL_Error: <br>  Replicate_Ignore_Server_Ids: <br>             Master_Server_Id: 15<br>1 row in set (0.00 sec)<br><br>ERROR: <br>No query specified<br></p> 
  <p>上述表示数据库master and slave 已配置好，可以进行同库单个表的配置</p> 
  <p><br></p> 
  <p>测试：</p> 
  <p>1.分别在master和slave创建数据库sales（row模式下需要手动创建数据库）。</p> 
  <p>2.use sales库下，在master上创建表</p> 
  <p>CREATE TABLE user_info (<br>    PersonID int,<br>    LastName varchar(255),<br>    FirstName varchar(255),<br>    Address varchar(255),<br>    City varchar(255) <br>);</p> 
  <p>3.在master上创建表</p> 
  <p>CREATE TABLE story (<br>    PersonID int,<br>    LastName varchar(255),<br>    FirstName varchar(255),<br>    Address varchar(255),<br>    City varchar(255) <br>);</p> 
  <p>查看slave同步状态：</p> 
  <p>a. story表同步成功</p> 
  <p>b. user_info表同步不成功</p> 
  <p><br></p> 
  <p>则mysql数据库单库，单表同步成功。<br></p> 
  <p>如果只是单库同步，则在slave的配置文件中去掉：</p> 
  <p>replicate-do-table =sales.story    // 所要同步的数据库的单个表</p> 
  <p>在安装过程中发现从低版本往高版本同步没有问题，从高版本往低版本同步一直出现问题。</p> 
  <p><br></p> 
  <p>三、数据库5.7二进制版本</p> 
  <p>下载链接：<br>https://dev.mysql.com/get/Downloads/MySQL-5.7/mysql-5.7.18-linux-glibc2.5-x86_64.tar.gz<br>直接解压使用，授权，初始化命令变为：<br> bin/mysqld --initialize --user=mysql --basedir=/application/mysql-5.7.18 --datadir=/application/mysql-5.7.18/data<br></p> 
  <p><strong>注意：</strong>初始化会生成登录数据库的初始密码，要记得保存。<br></p> 
  <p><br></p> 
  <p><br></p> 
  <p><br></p> 
  <p><br></p> 
  <p><br></p> 
  <p><br></p> 
 </div> 
</div> 
<p>转载于:https://blog.51cto.com/yanruohan/1923245</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/296c2f829b2495729f71509cc3594dea/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">C#中继承实现父类方法、重写、重载</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/d584f6205dfbb19965519bb45c3e2225/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">7-Linux内核配置编译及安装</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 追风少年的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>