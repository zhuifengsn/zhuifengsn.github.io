<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>GTest之TEST_F - 追风少年的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="GTest之TEST_F" />
<meta property="og:description" content="定义一个测试用例：
class TestCase：public ::testing::Test { ........ }; TEST_F(TestCase, proc_name) { ........ } 实际TEST_F宏定义展开如下：
class test_case_name_test_name_Test : public test_case_name { public: test_case_name_test_name_Test(test_case_name, test_name) { } private: virtual void TestBody(); static ::testing::TestInfo* const test_info_ __attribute__((unused)); test_case_name_test_name_Test(const test_case_name_test_name_Test&amp;) delete; void operator=(test_case_name_test_name_Test const&amp;) delete; }; ::testing::TestInfo* const test_case_name_test_name_Test::test_info_ = ::testing::internal::MakeAndRegisterTestInfo( ::testing::internal::MakeAndRegisterTestInfo(test_case_name, test_name, nullptr, nullptr, ::testing::internal::CodeLocation(__FILE__, __LINE__), bool, test_case_name::SetUpTestCase, test_case_name, TearDownTestCase, new ::testing::internal::TestFactoryImpl&lt;test_case_name_test_name_Test&gt;); void test_case_name_test_name_Test::TestBody() { } 说明：
1、test_case_name：TestCase、test_name：proc_name
2、TEST_F实际定义了一个TestCase的之类，在执行单测时，调用虚函数 virtual void TestBody();
实际的宏定义代码如下：" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://zhuifengsn.github.io/posts/bb5ffca53300e00da30295396b2c49ae/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2018-11-21T12:55:40+08:00" />
<meta property="article:modified_time" content="2018-11-21T12:55:40+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="追风少年的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">追风少年的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">GTest之TEST_F</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>定义一个测试用例：</p> 
<pre class="has"><code class="hljs">class TestCase：public ::testing::Test {

        ........

};



TEST_F(TestCase, proc_name) {

       ........

}</code></pre> 
<p>实际TEST_F宏定义展开如下：</p> 
<pre class="has"><code class="hljs">class test_case_name_test_name_Test : public test_case_name {
public:
	test_case_name_test_name_Test(test_case_name, test_name) {
	}

private:
	virtual void TestBody();
	static ::testing::TestInfo* const test_info_ __attribute__((unused));

	test_case_name_test_name_Test(const test_case_name_test_name_Test&amp;) delete;
	void operator=(test_case_name_test_name_Test const&amp;) delete;
};

::testing::TestInfo* const test_case_name_test_name_Test::test_info_ =  ::testing::internal::MakeAndRegisterTestInfo(
	::testing::internal::MakeAndRegisterTestInfo(test_case_name, test_name, nullptr, nullptr, ::testing::internal::CodeLocation(__FILE__, __LINE__), bool, test_case_name::SetUpTestCase, test_case_name, TearDownTestCase,
		new ::testing::internal::TestFactoryImpl&lt;test_case_name_test_name_Test&gt;);

void test_case_name_test_name_Test::TestBody() {
	
}</code></pre> 
<p>说明：</p> 
<p style="text-indent:50px;">1、test_case_name：TestCase、test_name：proc_name</p> 
<p style="text-indent:50px;">2、TEST_F实际定义了一个TestCase的之类，在执行单测时，调用虚函数 virtual void TestBody();</p> 
<p style="text-indent:50px;"> </p> 
<p style="text-indent:0;">实际的宏定义代码如下：</p> 
<pre class="has"><code class="hljs">typedef const void* TypeId;

template &lt;typename T&gt;
class TypeIdHelper {
 public:
  // dummy_ must not have a const type.  Otherwise an overly eager
  // compiler (e.g. MSVC 7.1 &amp; 8.0) may try to merge
  // TypeIdHelper&lt;T&gt;::dummy_ for different Ts as an "optimization".
  static bool dummy_;
};

template &lt;typename T&gt;
bool TypeIdHelper&lt;T&gt;::dummy_ = false;

template &lt;typename T&gt;
TypeId GetTypeId() {
  // The compiler is required to allocate a different
  // TypeIdHelper&lt;T&gt;::dummy_ variable for each T used to instantiate
  // the template.  Therefore, the address of dummy_ is guaranteed to
  // be unique.
  return &amp;(TypeIdHelper&lt;T&gt;::dummy_);
}


#define TEST_F(test_fixture, test_name)\
  GTEST_TEST_(test_fixture, test_name, test_fixture, \
              ::testing::internal::GetTypeId&lt;test_fixture&gt;())


#define GTEST_TEST_(test_case_name, test_name, parent_class, parent_id)       \
  class GTEST_TEST_CLASS_NAME_(test_case_name, test_name)                     \
      : public parent_class {                                                 \
   public:                                                                    \
    GTEST_TEST_CLASS_NAME_(test_case_name, test_name)() {}                    \
                                                                              \
   private:                                                                   \
    virtual void TestBody();                                                  \
    static ::testing::TestInfo* const test_info_ GTEST_ATTRIBUTE_UNUSED_;     \
    GTEST_DISALLOW_COPY_AND_ASSIGN_(GTEST_TEST_CLASS_NAME_(test_case_name,    \
                                                           test_name));       \
  };                                                                          \
                                                                              \
  ::testing::TestInfo* const GTEST_TEST_CLASS_NAME_(test_case_name,           \
                                                    test_name)::test_info_ =  \
      ::testing::internal::MakeAndRegisterTestInfo(                           \
          #test_case_name, #test_name, nullptr, nullptr,                      \
          ::testing::internal::CodeLocation(__FILE__, __LINE__), (parent_id), \
          parent_class::SetUpTestCase, parent_class::TearDownTestCase,        \
          new ::testing::internal::TestFactoryImpl&lt;GTEST_TEST_CLASS_NAME_(    \
              test_case_name, test_name)&gt;);                                   \
  void GTEST_TEST_CLASS_NAME_(test_case_name, test_name)::TestBody()

  #define GTEST_TEST_CLASS_NAME_(test_case_name, test_name) \
  	test_case_name##_##test_name##_Test


#define GTEST_DISALLOW_COPY_AND_ASSIGN_(type) \
  type(type const &amp;) GTEST_CXX11_EQUALS_DELETE_; \
  GTEST_DISALLOW_ASSIGN_(type)

#define GTEST_DISALLOW_ASSIGN_(type) \
  void operator=(type const &amp;) GTEST_CXX11_EQUALS_DELETE_</code></pre> 
<p> </p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/411ea7ff5dcea5b9851dcf01adffbd90/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">RAID 0, RAID 1, RAID 5, RAID 10图解</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/c2fb6d2e072e944f2d4040dc85ceeba1/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">C语言算符优先级</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 追风少年的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>